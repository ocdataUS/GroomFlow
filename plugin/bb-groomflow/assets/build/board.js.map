{"version":3,"file":"board.js","sources":["../src/index.js"],"sourcesContent":["import './style.scss';\n\nconst settings = window.bbgfBoardSettings || {};\n\nconst strings = {\n\tloading: settings.strings?.loading ?? 'Loading GroomFlow boardâ€¦',\n\temptyColumn: settings.strings?.emptyColumn ?? 'No visits in this stage yet',\n\tnoVisits: settings.strings?.noVisits ?? 'No visits available.',\n\trefresh: settings.strings?.refresh ?? 'Refresh',\n\tlastUpdated: settings.strings?.lastUpdated ?? 'Last updated',\n\tviewSwitcher: settings.strings?.viewSwitcher ?? 'Board views',\n\tservices: settings.strings?.services ?? 'Services',\n\tflags: settings.strings?.flags ?? 'Behavior flags',\n\tnotes: settings.strings?.notes ?? 'Notes',\n\tcheckIn: settings.strings?.checkIn ?? 'Check-in',\n\tmovePrev: settings.strings?.movePrev ?? 'Back',\n\tmoveNext: settings.strings?.moveNext ?? 'Next',\n\tunknownClient: settings.strings?.unknownClient ?? 'Client',\n\tstageControls: settings.strings?.stageControls ?? 'Stage controls',\n\tloadingError: settings.strings?.loadingError ?? 'Unable to load the board. Please refresh.',\n\tmodalTitle: settings.strings?.modalTitle ?? 'Visit details',\n\tmodalLoading: settings.strings?.modalLoading ?? 'Loading visitâ€¦',\n\tmodalClose: settings.strings?.modalClose ?? 'Close',\n\tmodalReadOnly: settings.strings?.modalReadOnly ?? 'Read-only view',\n\tmodalSummary: settings.strings?.modalSummary ?? 'Summary',\n\tmodalNotes: settings.strings?.modalNotes ?? 'Notes',\n\tmodalServices: settings.strings?.modalServices ?? 'Services',\n\tmodalHistory: settings.strings?.modalHistory ?? 'History',\n\tmodalPhotos: settings.strings?.modalPhotos ?? 'Photos',\n\tmodalSave: settings.strings?.modalSave ?? 'Save changes',\n\tmodalSaving: settings.strings?.modalSaving ?? 'Savingâ€¦',\n\tmodalNoHistory: settings.strings?.modalNoHistory ?? 'No history recorded yet.',\n\tmodalNoPhotos: settings.strings?.modalNoPhotos ?? 'No photos uploaded for this visit.',\n\tsearchPlaceholder: settings.strings?.searchPlaceholder ?? 'Search clients, guardians, servicesâ€¦',\n\tmoveSuccess: settings.strings?.moveSuccess ?? 'Visit moved.',\n\tfullscreen: settings.strings?.fullscreen ?? 'Fullscreen',\n\texitFullscreen: settings.strings?.exitFullscreen ?? 'Exit fullscreen',\n\tautoRefresh: settings.strings?.autoRefresh ?? 'Auto-refresh in',\n\tmaskedGuardian: settings.strings?.maskedGuardian ?? 'Guardian hidden for lobby view',\n\terrorFetching: settings.strings?.errorFetching ?? 'Unable to refresh the board. Please try again.',\n};\n\nconst presentation = settings.presentation || {};\nconst ensureArray = (value) => (Array.isArray(value) ? value : []);\nconst safeString = (value) => (typeof value === 'string' ? value : '');\nconst toNumber = (value) => {\n\tconst parsed = Number(value);\n\treturn Number.isFinite(parsed) ? parsed : null;\n};\n\nconst placeholderPhotos = ensureArray(settings.placeholders?.photos)\n\t.filter((url) => typeof url === 'string' && url.length > 0);\n\nconst resolvePresentationConfig = (board) => {\n\tconst modeCandidate = safeString(presentation.mode ?? '');\n\tlet mode = modeCandidate === 'display' || modeCandidate === 'interactive' ? modeCandidate : '';\n\n\tif (!mode) {\n\t\tmode = board.readonly || board.is_public ? 'display' : 'interactive';\n\t}\n\n\tconst pickFlag = (key, fallback) => {\n\t\tconst value = presentation[key];\n\t\tif (typeof value === 'boolean') {\n\t\t\treturn value;\n\t\t}\n\t\treturn fallback;\n\t};\n\n\tconst defaultMaskBadge = mode === 'display' ? false : Boolean(board.visibility?.mask_guardian);\n\tconst viewSwitcherValue = safeString(presentation.view_switcher ?? '');\n\tconst allowSwitcher = board?.view?.allow_switcher !== false;\n\tlet viewSwitcher = ['dropdown', 'buttons', 'none'].includes(viewSwitcherValue)\n\t\t? viewSwitcherValue\n\t\t: mode === 'display'\n\t\t\t? 'none'\n\t\t\t: 'dropdown';\n\n\tif (!allowSwitcher || mode === 'display') {\n\t\tviewSwitcher = 'none';\n\t}\n\n\treturn {\n\t\tmode,\n\t\tshowToolbar: pickFlag('show_toolbar', mode !== 'display'),\n\t\tshowSearch: pickFlag('show_search', mode !== 'display'),\n\t\tshowFilters: pickFlag('show_filters', mode !== 'display'),\n\t\tshowRefresh: pickFlag('show_refresh', mode !== 'display'),\n\t\tshowLastUpdated: pickFlag('show_last_updated', mode !== 'display'),\n\t\tshowCountdown: pickFlag('show_countdown', mode !== 'display'),\n\t\tshowFullscreen: pickFlag('show_fullscreen', true),\n\t\tshowMaskBadge: pickFlag('show_mask_badge', defaultMaskBadge),\n\t\tshowNotes: pickFlag('show_notes', mode !== 'display'),\n\t\tviewSwitcher,\n\t};\n};\n\nconst cloneVisit = (visit) => (visit && typeof visit === 'object' ? JSON.parse(JSON.stringify(visit)) : visit);\nconst cloneStage = (stage) => {\n\tif (!stage || typeof stage !== 'object') {\n\t\treturn stage;\n\t}\n\n\treturn {\n\t\t...stage,\n\t\tvisits: ensureArray(stage.visits).map((visit) => cloneVisit(visit)),\n\t};\n};\n\nconst buildStageMap = (stages) => {\n\tconst map = new Map();\n\n\tensureArray(stages).forEach((stage) => {\n\t\tconst key = safeString(stage?.key ?? stage?.stage_key);\n\t\tif (!key) {\n\t\t\treturn;\n\t\t}\n\n\t\tmap.set(key, cloneStage(stage));\n\t});\n\n\treturn map;\n};\n\nconst applyBoardPatch = (currentBoard, patchBoard) => {\n\tif (!patchBoard || typeof patchBoard !== 'object') {\n\t\treturn currentBoard;\n\t}\n\n\tif (!currentBoard || typeof currentBoard !== 'object') {\n\t\treturn patchBoard;\n\t}\n\n\tconst currentStageMap = buildStageMap(currentBoard.stages);\n\tconst patchStageMap = buildStageMap(patchBoard.stages);\n\n\tif (!patchStageMap.size) {\n\t\treturn {\n\t\t\t...currentBoard,\n\t\t\t...patchBoard,\n\t\t\tstages: ensureArray(currentBoard.stages).map((stage) => cloneStage(stage)),\n\t\t};\n\t}\n\n\tconst changedVisitIds = new Set();\n\tpatchStageMap.forEach((stage) => {\n\t\tensureArray(stage.visits).forEach((visit) => {\n\t\t\tif (visit && (visit.id || visit.id === 0)) {\n\t\t\t\tchangedVisitIds.add(Number(visit.id));\n\t\t\t}\n\t\t});\n\t});\n\n\tif (changedVisitIds.size) {\n\t\tcurrentStageMap.forEach((stage, key) => {\n\t\t\tif (!stage) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst filtered = ensureArray(stage.visits).filter((visit) => {\n\t\t\t\tif (!visit || (visit.id === undefined || visit.id === null)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn !changedVisitIds.has(Number(visit.id));\n\t\t\t});\n\n\t\t\tcurrentStageMap.set(key, {\n\t\t\t\t...stage,\n\t\t\t\tvisits: filtered,\n\t\t\t});\n\t\t});\n\t}\n\n\tpatchStageMap.forEach((stage, key) => {\n\t\tconst existing = currentStageMap.get(key);\n\t\tconst mergedStage = {\n\t\t\t...(existing ?? {}),\n\t\t\t...stage,\n\t\t\tvisits: ensureArray(stage.visits).map((visit) => cloneVisit(visit)),\n\t\t};\n\n\t\tcurrentStageMap.set(key, mergedStage);\n\t});\n\n\tconst mergedStages = Array.from(currentStageMap.values());\n\tmergedStages.sort((a, b) => {\n\t\tconst aOrder = toNumber(a?.sort_order) ?? 0;\n\t\tconst bOrder = toNumber(b?.sort_order) ?? 0;\n\t\treturn aOrder - bOrder;\n\t});\n\n\treturn {\n\t\t...currentBoard,\n\t\t...patchBoard,\n\t\tstages: mergedStages,\n\t};\n};\n\nconst findVisitById = (board, visitId) => {\n\tconst normalizedId = Number(visitId);\n\tif (!board || Number.isNaN(normalizedId)) {\n\t\treturn null;\n\t}\n\n\tfor (const stage of ensureArray(board.stages)) {\n\t\tfor (const visit of ensureArray(stage.visits)) {\n\t\t\tif (Number(visit?.id) === normalizedId) {\n\t\t\t\treturn {\n\t\t\t\t\tstage,\n\t\t\t\t\tvisit,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n};\n\nconst formatDuration = (totalSeconds) => {\n\tif (!Number.isFinite(totalSeconds)) {\n\t\treturn '0s';\n\t}\n\n\tconst seconds = Math.max(0, Math.floor(totalSeconds));\n\tconst hours = Math.floor(seconds / 3600);\n\tconst minutes = Math.floor((seconds % 3600) / 60);\n\tconst remainingSeconds = seconds % 60;\n\n\tif (hours >= 1) {\n\t\treturn `${hours}h ${minutes.toString().padStart(2, '0')}m`;\n\t}\n\n\tif (minutes >= 1) {\n\t\treturn `${minutes}m`;\n\t}\n\n\treturn `${remainingSeconds}s`;\n};\n\nconst formatTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst date = new Date(isoString);\n\tif (Number.isNaN(date.getTime())) {\n\t\treturn '';\n\t}\n\n\treturn date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n};\n\nconst formatDateForLastUpdated = (isoString) => formatTime(isoString);\n\nconst formatDateTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst date = new Date(isoString);\n\tif (Number.isNaN(date.getTime())) {\n\t\treturn '';\n\t}\n\n\treturn date.toLocaleString([], {\n\t\thour: 'numeric',\n\t\tminute: '2-digit',\n\t\tmonth: 'short',\n\t\tday: 'numeric',\n\t\tyear: 'numeric',\n\t});\n};\n\nconst humanizeRelativeTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst target = new Date(isoString);\n\tif (Number.isNaN(target.getTime())) {\n\t\treturn '';\n\t}\n\n\tconst now = new Date();\n\tconst deltaSeconds = Math.round((now.getTime() - target.getTime()) / 1000);\n\n\tif (deltaSeconds < 10) {\n\t\treturn 'just now';\n\t}\n\n\tif (deltaSeconds < 60) {\n\t\treturn `${deltaSeconds}s ago`;\n\t}\n\n\tconst minutes = Math.round(deltaSeconds / 60);\n\tif (minutes < 60) {\n\t\treturn `${minutes} min${minutes === 1 ? '' : 's'} ago`;\n\t}\n\n\tconst hours = Math.round(minutes / 60);\n\tif (hours < 24) {\n\t\treturn `${hours} hr${hours === 1 ? '' : 's'} ago`;\n\t}\n\n\tconst days = Math.round(hours / 24);\n\treturn `${days} day${days === 1 ? '' : 's'} ago`;\n};\n\nconst getTimerState = (seconds, thresholds = {}) => {\n\tconst yellow = toNumber(thresholds.yellow) ?? 0;\n\tconst red = toNumber(thresholds.red) ?? 0;\n\n\tif (red > 0 && seconds >= red) {\n\t\treturn 'critical';\n\t}\n\n\tif (yellow > 0 && seconds >= yellow) {\n\t\treturn 'warning';\n\t}\n\n\treturn 'on-track';\n};\n\nconst buildCapacityHint = (capacity = {}, count = 0) => {\n\tconst soft = toNumber(capacity.soft);\n\tconst hard = toNumber(capacity.hard);\n\n\tif (Number.isFinite(hard) && count > hard) {\n\t\treturn 'Hard limit exceeded';\n\t}\n\n\tif (Number.isFinite(soft) && count > soft) {\n\t\treturn 'At capacity';\n\t}\n\n\tif (Number.isFinite(soft) && soft > 0) {\n\t\tconst remaining = Math.max(0, soft - count);\n\n\t\tif (remaining > 1) {\n\t\t\treturn `${remaining} slots open`;\n\t\t}\n\n\t\tif (remaining === 1) {\n\t\t\treturn '1 slot open';\n\t\t}\n\n\t\treturn 'Fully booked';\n\t}\n\n\treturn 'Flexible capacity';\n};\n\nconst extractPrimaryPhoto = (photos) => {\n\tconst list = ensureArray(photos);\n\tif (!list.length) {\n\t\treturn null;\n\t}\n\n\tconst first = list[0];\n\tif (!first || typeof first !== 'object') {\n\t\treturn null;\n\t}\n\n\tif (first.url) {\n\t\treturn { url: first.url, alt: safeString(first.alt) };\n\t}\n\n\tif (first.sizes) {\n\t\tconst candidate = first.sizes.thumbnail?.url || first.sizes.medium?.url || first.sizes.full?.url;\n\t\tif (candidate) {\n\t\t\treturn { url: candidate, alt: safeString(first.alt) };\n\t\t}\n\t}\n\n\treturn null;\n};\n\nconst getPlaceholderPhoto = (visit) => {\n\tif (!placeholderPhotos.length) {\n\t\treturn null;\n\t}\n\n\tconst visitId = Number(visit?.id);\n\tconst index = Number.isFinite(visitId) ? Math.abs(visitId) % placeholderPhotos.length : 0;\n\tconst url = placeholderPhotos[index];\n\tconst clientName = safeString(visit?.client?.name ?? strings.unknownClient);\n\treturn {\n\t\turl,\n\t\talt: clientName ? `${clientName} placeholder photo` : strings.unknownClient,\n\t};\n};\n\nconst getVisitPhoto = (visit) => extractPrimaryPhoto(visit?.photos) ?? getPlaceholderPhoto(visit);\n\nconst buildServiceSummary = (services) =>\n\tensureArray(services)\n\t\t.map((service) => safeString(service?.name))\n\t\t.filter(Boolean)\n\t\t.join(', ');\n\nconst escapeHtml = (value) => {\n\treturn safeString(value).replace(/[&<>\"']/g, (char) => {\n\t\tswitch (char) {\n\t\t\tcase '&':\n\t\t\t\treturn '&amp;';\n\t\t\tcase '<':\n\t\t\t\treturn '&lt;';\n\t\t\tcase '>':\n\t\t\t\treturn '&gt;';\n\t\t\tcase '\"':\n\t\t\t\treturn '&quot;';\n\t\t\tcase \"'\":\n\t\t\t\treturn '&#039;';\n\t\t\tdefault:\n\t\t\t\treturn char;\n\t\t}\n\t});\n};\n\nconst buildModalFormFromVisit = (visit) => {\n if (!visit || typeof visit !== 'object') {\n \treturn {\n \t\tinstructions: '',\n \t\tpublicNotes: '',\n \t\tprivateNotes: '',\n \t\tservices: [],\n \t};\n }\n\n return {\n \tinstructions: safeString(visit.instructions ?? ''),\n \tpublicNotes: safeString(visit.public_notes ?? ''),\n \tprivateNotes: safeString(visit.private_notes ?? ''),\n \tservices: ensureArray(visit.services)\n \t\t.map((service) => Number(service?.id))\n \t\t.filter((id) => Number.isFinite(id)),\n };\n};\n\nconst visitMatchesQuery = (visit, query) => {\n\tif (!visit) {\n\t\treturn false;\n\t}\n\n\tconst haystack = [\n\t\tvisit.client?.name,\n\t\tvisit.client?.breed,\n\t\tvisit.guardian?.first_name,\n\t\tvisit.guardian?.last_name,\n\t\tvisit.guardian?.email,\n\t\tvisit.guardian?.phone,\n\t\tvisit.instructions,\n\t\tvisit.public_notes,\n\t\tvisit.private_notes,\n\t]\n\t\t.concat(ensureArray(visit.services).map((service) => service?.name))\n\t\t.concat(ensureArray(visit.flags).map((flag) => flag?.name))\n\t\t.filter(Boolean)\n\t\t.map((value) => String(value).toLowerCase());\n\n\treturn haystack.some((value) => value.includes(query));\n};\n\nconst getStageNeighbors = (board, stageKey) => {\n\tconst stages = ensureArray(board?.stages);\n\tconst index = stages.findIndex((stage) => stage.key === stageKey);\n\tif (index === -1) {\n\t\treturn { prev: null, next: null };\n\t}\n\n\treturn {\n\t\tprev: index > 0 ? stages[index - 1] : null,\n\t\tnext: index < stages.length - 1 ? stages[index + 1] : null,\n\t};\n};\n\nconst getBoardFilterOptions = (board) => {\n\tconst servicesMap = new Map();\n\tconst flagsMap = new Map();\n\n\tensureArray(board?.stages).forEach((stage) => {\n\t\tensureArray(stage.visits).forEach((visit) => {\n\t\t\tensureArray(visit.services).forEach((service) => {\n\t\t\t\tconst id = Number(service?.id);\n\t\t\t\tif (!Number.isFinite(id) || servicesMap.has(id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tservicesMap.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\tname: safeString(service?.name ?? ''),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tensureArray(visit.flags).forEach((flag) => {\n\t\t\t\tconst id = Number(flag?.id);\n\t\t\t\tif (!Number.isFinite(id) || flagsMap.has(id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tflagsMap.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\tname: safeString(flag?.name ?? ''),\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\tconst services = Array.from(servicesMap.values()).sort((a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }));\n\tconst flags = Array.from(flagsMap.values()).sort((a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }));\n\n\treturn { services, flags };\n};\n\nconst formatCountdownSeconds = (targetTimestamp) => {\n\tif (!targetTimestamp) {\n\t\treturn '';\n\t}\n\n\tconst delta = Math.round((targetTimestamp - Date.now()) / 1000);\n\tif (delta <= 0) {\n\t\treturn '0s';\n\t}\n\n\tif (delta < 60) {\n\t\treturn `${delta}s`;\n\t}\n\n\tconst minutes = Math.floor(delta / 60);\n\tconst seconds = delta % 60;\n\treturn `${minutes}m ${seconds.toString().padStart(2, '0')}s`;\n};\n\nconst formatCheckIn = (isoString) => {\n\tconst time = formatTime(isoString);\n\treturn time ? `${strings.checkIn} ${time}` : '';\n};\n\nconst createStore = (initialState = {}) => {\n\tlet state = { ...initialState };\n\tconst listeners = new Set();\n\n\treturn {\n\t\tgetState: () => state,\n\t\tsetState: (updater) => {\n\t\t\tconst nextState = typeof updater === 'function' ? updater(state) : updater;\n\t\t\tif (!nextState || typeof nextState !== 'object') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstate = { ...state, ...nextState };\n\t\t\tlisteners.forEach((listener) => {\n\t\t\t\ttry {\n\t\t\t\t\tlistener(state);\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error('[BBGF] store listener error', error);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsubscribe: (listener) => {\n\t\t\tif (typeof listener !== 'function') {\n\t\t\t\treturn () => {};\n\t\t\t}\n\n\t\t\tlisteners.add(listener);\n\t\t\treturn () => listeners.delete(listener);\n\t\t},\n\t};\n};\n\nconst createApiClient = (rest = {}, context = {}) => {\n\tconst buildHeaders = () => {\n\t\tconst headers = {\n\t\t\tAccept: 'application/json',\n\t\t};\n\n\t\tif (rest.nonce) {\n\t\t\theaders['X-WP-Nonce'] = rest.nonce;\n\t\t}\n\n\t\treturn headers;\n\t};\n\n\tconst buildUrl = (endpoint, params = {}) => {\n\t\tif (!endpoint) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst url = new URL(endpoint, window.location.origin);\n\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\tif (value === undefined || value === null || value === '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\turl.searchParams.append(key, value);\n\t\t});\n\n\t\treturn url.toString();\n\t};\n\n\tconst fetchBoard = async (params = {}) => {\n\t\tconst query = { ...params };\n\t\tif (context.publicToken) {\n\t\t\tquery.public_token = context.publicToken;\n\t\t}\n\n\t\tconst url = buildUrl(rest.endpoints?.board, query);\n\t\tif (!url) {\n\t\t\tthrow new Error('Board endpoint unavailable');\n\t\t}\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Board request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchVisit = async (visitId, params = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst query = { ...params };\n\t\tif (context.publicToken && !query.public_token) {\n\t\t\tquery.public_token = context.publicToken;\n\t\t}\n\n\t\tif (context.view && !query.view) {\n\t\t\tquery.view = context.view;\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}`, query);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Visit request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst moveVisit = async (visitId, toStage, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}/move`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tto_stage: toStage,\n\t\t\t\tcomment: payload.comment ?? '',\n\t\t\t}),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Move failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst updateVisit = async (visitId, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'PATCH',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Update failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchServices = async () => {\n\t\tconst endpoint = rest.endpoints?.services;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Services endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(endpoint, {\n\t\t\tper_page: 100,\n\t\t\tcontext: 'view',\n\t\t});\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Services request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\treturn {\n\t\tfetchBoard,\n\t\tfetchVisit,\n\t\tmoveVisit,\n\t\tupdateVisit,\n\t\tfetchServices,\n\t};\n};\n\nconst createCardElement = (visit, stage, options) => {\n\tconst { copy, previous, next, canMove, pendingMoves, readonly, draggingVisitId, presentation = {} } = options;\n\tconst showNotes = presentation.showNotes !== false;\n\n\tconst stageKey = safeString(stage.key ?? stage.stage_key ?? '');\n\tconst card = document.createElement('article');\n\tcard.className = 'bbgf-card';\n\tcard.dataset.visitId = String(visit.id ?? '');\n\tcard.dataset.stage = stageKey;\n\tcard.dataset.updatedAt = safeString(visit.updated_at ?? '');\n\tcard.setAttribute('role', 'listitem');\n\tcard.setAttribute('aria-label', `${safeString(visit.client?.name ?? copy.unknownClient)} â€” ${safeString(stage.label ?? stageKey)}`);\n\tif (presentation.mode === 'display') {\n\t\tcard.setAttribute('tabindex', '-1');\n\t\tcard.classList.add('bbgf-card--static');\n\t} else {\n\t\tcard.setAttribute('tabindex', '0');\n\t\tcard.classList.remove('bbgf-card--static');\n\t}\n\n\tconst visitIdNumber = Number(visit.id);\n\tconst isPending = pendingMoves?.has(visitIdNumber);\n\tconst isDragging = draggingVisitId !== null && visitIdNumber === Number(draggingVisitId);\n\tconst canDrag = !readonly && settings.capabilities?.moveStages;\n\n\tif (canDrag) {\n\t\tcard.setAttribute('draggable', 'true');\n\t\tcard.classList.add('bbgf-card--draggable');\n\t} else {\n\t\tcard.removeAttribute('draggable');\n\t\tcard.classList.remove('bbgf-card--draggable');\n\t}\n\n\tcard.classList.toggle('bbgf-card--pending', Boolean(isPending));\n\tcard.classList.toggle('is-dragging', Boolean(isDragging));\n\tcard.setAttribute('aria-grabbed', isDragging ? 'true' : 'false');\n\n\tconst timerSeconds = toNumber(visit.timer_elapsed_seconds) ?? 0;\n\tconst timerState = getTimerState(timerSeconds, stage.timer_thresholds ?? {});\n\tcard.classList.add(`bbgf-card--timer-${timerState}`);\n\n\tif (timerState === 'critical') {\n\t\tcard.classList.add('bbgf-card--overdue');\n\t} else if (timerState === 'warning') {\n\t\tcard.classList.add('bbgf-card--capacity-warning');\n\t}\n\n\tconst photoWrapper = document.createElement('div');\n\tphotoWrapper.className = 'bbgf-card-photo';\n\tphotoWrapper.setAttribute('aria-hidden', 'true');\n\n\tconst photoData = getVisitPhoto(visit);\n\tif (photoData && photoData.url) {\n\t\tconst img = document.createElement('img');\n\t\timg.src = photoData.url;\n\t\timg.alt = photoData.alt || safeString(visit.client?.name ?? copy.unknownClient);\n\t\tphotoWrapper.appendChild(img);\n\t} else {\n\t\tconst fallback = document.createElement('span');\n\t\tfallback.textContent = (safeString(visit.client?.name ?? copy.unknownClient).charAt(0) || 'ðŸ¾').toUpperCase();\n\t\tphotoWrapper.appendChild(fallback);\n\t}\n\n\tconst body = document.createElement('div');\n\tbody.className = 'bbgf-card-body';\n\n\tconst header = document.createElement('div');\n\theader.className = 'bbgf-card-header';\n\n\tconst name = document.createElement('p');\n\tname.className = 'bbgf-card-name';\n\tname.textContent = safeString(visit.client?.name ?? copy.unknownClient);\n\n\tconst timer = document.createElement('span');\n\ttimer.className = 'bbgf-card-timer';\n\ttimer.dataset.state = timerState;\n\ttimer.dataset.seconds = String(Math.max(0, timerSeconds));\n\ttimer.textContent = formatDuration(timerSeconds);\n\tname.appendChild(timer);\n\n\theader.appendChild(name);\n\n\tconst meta = document.createElement('p');\n\tmeta.className = 'bbgf-card-meta';\n\n\tconst serviceSummary = buildServiceSummary(visit.services);\n\tif (serviceSummary) {\n\t\tconst serviceSpan = document.createElement('span');\n\t\tserviceSpan.textContent = serviceSummary;\n\t\tmeta.appendChild(serviceSpan);\n\t}\n\n\tconst checkInText = formatCheckIn(visit.check_in_at);\n\tif (checkInText) {\n\t\tif (meta.childNodes.length) {\n\t\t\tconst separator = document.createElement('span');\n\t\t\tseparator.textContent = 'â€¢';\n\t\t\tseparator.setAttribute('aria-hidden', 'true');\n\t\t\tmeta.appendChild(separator);\n\t\t}\n\n\t\tconst checkInSpan = document.createElement('span');\n\t\tcheckInSpan.textContent = checkInText;\n\t\tmeta.appendChild(checkInSpan);\n\t}\n\n\tif (meta.childNodes.length) {\n\t\theader.appendChild(meta);\n\t}\n\n\tbody.appendChild(header);\n\n\tconst services = ensureArray(visit.services);\n\tif (services.length) {\n\t\tconst servicesWrapper = document.createElement('div');\n\t\tservicesWrapper.className = 'bbgf-card-services';\n\t\tservicesWrapper.setAttribute('aria-label', copy.services);\n\n\t\tservices.forEach((service) => {\n\t\t\tconst chip = document.createElement('span');\n\t\t\tchip.className = 'bbgf-service-chip';\n\t\t\tchip.setAttribute('aria-hidden', 'true');\n\n\t\t\tconst icon = safeString(service.icon);\n\t\t\tconst label = safeString(service.name);\n\t\t\tchip.textContent = icon && icon !== label ? `${icon} ${label}` : label;\n\n\t\t\tservicesWrapper.appendChild(chip);\n\t\t});\n\n\t\tbody.appendChild(servicesWrapper);\n\t}\n\n\tconst flags = ensureArray(visit.flags);\n\tif (flags.length) {\n\t\tconst flagsWrapper = document.createElement('div');\n\t\tflagsWrapper.className = 'bbgf-card-flags';\n\t\tflagsWrapper.setAttribute('aria-label', copy.flags);\n\n\t\tflags.forEach((flag) => {\n\t\t\tconst chip = document.createElement('span');\n\t\t\tchip.className = 'bbgf-flag-chip';\n\n\t\t\tconst emoji = document.createElement('span');\n\t\t\temoji.setAttribute('aria-hidden', 'true');\n\t\t\temoji.textContent = safeString(flag.emoji);\n\t\t\tchip.appendChild(emoji);\n\n\t\t\tconst nameSpan = document.createElement('span');\n\t\t\tnameSpan.textContent = safeString(flag.name);\n\t\t\tchip.appendChild(nameSpan);\n\n\t\t\tflagsWrapper.appendChild(chip);\n\t\t});\n\n\t\tbody.appendChild(flagsWrapper);\n\t}\n\n\tconst notes = safeString(visit.public_notes ?? visit.instructions ?? '');\n\tif (showNotes && notes) {\n\t\tconst notesParagraph = document.createElement('p');\n\t\tnotesParagraph.className = 'bbgf-card-notes';\n\t\tnotesParagraph.textContent = notes;\n\t\tbody.appendChild(notesParagraph);\n\t}\n\n\tif (!readonly && canMove && (previous || next)) {\n\t\tconst actions = document.createElement('div');\n\t\tactions.className = 'bbgf-card-actions';\n\t\tactions.setAttribute('aria-label', copy.stageControls);\n\n\t\tif (previous) {\n\t\t\tconst prevButton = document.createElement('button');\n\t\t\tprevButton.type = 'button';\n\t\t\tprevButton.className = 'bbgf-button bbgf-move-prev is-disabled';\n\t\t\tprevButton.dataset.targetStage = safeString(previous.key ?? previous.stage_key ?? '');\n\t\t\tprevButton.textContent = copy.movePrev;\n\t\t\tconst disabled =\n\t\t\t\t!previous ||\n\t\t\t\t!previous.key ||\n\t\t\t\treadonly ||\n\t\t\t\t!canMove ||\n\t\t\t\t(pendingMoves && pendingMoves.has(Number(visit.id)));\n\n\t\t\tif (disabled) {\n\t\t\t\tprevButton.disabled = true;\n\t\t\t\tprevButton.setAttribute('aria-disabled', 'true');\n\t\t\t\tprevButton.classList.add('is-disabled');\n\t\t\t} else {\n\t\t\t\tprevButton.disabled = false;\n\t\t\t\tprevButton.removeAttribute('aria-disabled');\n\t\t\t\tprevButton.classList.remove('is-disabled');\n\t\t\t}\n\t\t\tactions.appendChild(prevButton);\n\t\t}\n\n\t\tif (next) {\n\t\t\tconst nextButton = document.createElement('button');\n\t\t\tnextButton.type = 'button';\n\t\t\tnextButton.className = 'bbgf-button bbgf-move-next is-disabled';\n\t\t\tnextButton.dataset.targetStage = safeString(next.key ?? next.stage_key ?? '');\n\t\t\tnextButton.textContent = copy.moveNext;\n\t\t\tconst disabled =\n\t\t\t\t!next ||\n\t\t\t\t!next.key ||\n\t\t\t\treadonly ||\n\t\t\t\t!canMove ||\n\t\t\t\t(pendingMoves && pendingMoves.has(Number(visit.id)));\n\n\t\t\tif (disabled) {\n\t\t\t\tnextButton.disabled = true;\n\t\t\t\tnextButton.setAttribute('aria-disabled', 'true');\n\t\t\t\tnextButton.classList.add('is-disabled');\n\t\t\t} else {\n\t\t\t\tnextButton.disabled = false;\n\t\t\t\tnextButton.removeAttribute('aria-disabled');\n\t\t\t\tnextButton.classList.remove('is-disabled');\n\t\t\t}\n\t\t\tactions.appendChild(nextButton);\n\t\t}\n\n\t\tif (actions.childNodes.length) {\n\t\t\tbody.appendChild(actions);\n\t\t}\n\t}\n\n\tcard.appendChild(photoWrapper);\n\tcard.appendChild(body);\n\n\treturn card;\n};\n\nconst createColumnElement = (stage, options) => {\n\tconst { copy, previous, next, canMove, pendingMoves, readonly, draggingVisitId, searchActive, presentation = {} } = options;\n\n\tconst stageKey = safeString(stage.key ?? stage.stage_key ?? '');\n\tconst label = safeString(stage.label ?? stageKey);\n\tconst capacity = stage.capacity ?? {};\n\tconst visits = ensureArray(stage.visits);\n\tconst count = visits.length;\n\tconst softLimit = toNumber(capacity.soft);\n\tconst hardLimit = toNumber(capacity.hard);\n\n\tconst column = document.createElement('section');\n\tcolumn.className = 'bbgf-column';\n\tcolumn.dataset.stage = stageKey;\n\tcolumn.dataset.capacitySoft = Number.isFinite(softLimit) ? String(softLimit) : '';\n\tcolumn.dataset.capacityHard = Number.isFinite(hardLimit) ? String(hardLimit) : '';\n\tcolumn.dataset.visitCount = String(count);\n\tcolumn.dataset.availableSoft = Number.isFinite(capacity.available_soft) ? String(capacity.available_soft) : '';\n\tcolumn.dataset.availableHard = Number.isFinite(capacity.available_hard) ? String(capacity.available_hard) : '';\n\tcolumn.dataset.softExceeded = capacity.is_soft_exceeded ? 'true' : 'false';\n\tcolumn.dataset.hardExceeded = capacity.is_hard_exceeded ? 'true' : 'false';\n\tcolumn.dataset.capacityHint = buildCapacityHint(capacity, count);\n\tcolumn.setAttribute('role', 'listitem');\n\tcolumn.setAttribute('aria-label', label);\n\tcolumn.setAttribute('aria-dropeffect', readonly ? 'none' : 'move');\n\n\tif (capacity.is_soft_exceeded && !capacity.is_hard_exceeded) {\n\t\tcolumn.classList.add('bbgf-column--soft-full');\n\t}\n\n\tif (capacity.is_hard_exceeded) {\n\t\tcolumn.classList.add('bbgf-column--hard-full');\n\t}\n\n\tconst nearCapacity =\n\t\t!capacity.is_soft_exceeded &&\n\t\t!capacity.is_hard_exceeded &&\n\t\tNumber.isFinite(softLimit) &&\n\t\tsoftLimit > 0 &&\n\t\t(Number.isFinite(capacity.available_soft) ? capacity.available_soft : softLimit - count) <= 1;\n\n\tif (nearCapacity) {\n\t\tcolumn.classList.add('bbgf-column--near-capacity');\n\t}\n\n\tconst header = document.createElement('header');\n\theader.className = 'bbgf-column-header';\n\n\tconst title = document.createElement('div');\n\ttitle.className = 'bbgf-column-title';\n\n\tconst labelSpan = document.createElement('span');\n\tlabelSpan.className = 'bbgf-column-label';\n\tlabelSpan.textContent = label;\n\ttitle.appendChild(labelSpan);\n\n\tconst countSpan = document.createElement('span');\n\tcountSpan.className = 'bbgf-column-count';\n\tcountSpan.dataset.role = 'bbgf-column-count';\n\tcountSpan.dataset.softLimit = Number.isFinite(softLimit) ? String(softLimit) : '';\n\tcountSpan.textContent = Number.isFinite(softLimit) && softLimit > 0 ? `${count} / ${softLimit}` : String(count);\n\tcountSpan.setAttribute('aria-label', Number.isFinite(softLimit) && softLimit > 0 ? `${count} of ${softLimit}` : String(count));\n\ttitle.appendChild(countSpan);\n\n\theader.appendChild(title);\n\n\tconst capacityBadge = document.createElement('span');\n\tcapacityBadge.className = 'bbgf-capacity-badge';\n\tcapacityBadge.dataset.role = 'bbgf-capacity-hint';\n\tcapacityBadge.setAttribute('aria-hidden', 'true');\n\tcapacityBadge.textContent = column.dataset.capacityHint;\n\theader.appendChild(capacityBadge);\n\n\tcolumn.appendChild(header);\n\n\tconst body = document.createElement('div');\n\tbody.className = 'bbgf-column-body';\n\tbody.setAttribute('role', 'list');\n\tbody.setAttribute('aria-label', `${label} column cards`);\n\n\tif (!visits.length) {\n\t\tconst empty = document.createElement('p');\n\t\tempty.className = 'bbgf-column-empty';\n\t\tempty.textContent = searchActive ? copy.noVisits : copy.emptyColumn;\n\t\tbody.appendChild(empty);\n\t} else {\n\t\tvisits.forEach((visit) => {\n\t\t\tconst card = createCardElement(visit, stage, { copy, previous, next, canMove, pendingMoves, readonly, draggingVisitId, presentation });\n\t\t\tbody.appendChild(card);\n\t\t});\n\t}\n\n\tcolumn.appendChild(body);\n\n\treturn column;\n};\n\nconst getActiveViewSlug = (state) =>\n\tstate.viewOverride ||\n\tstate.board?.view?.slug ||\n\tsettings.context?.view ||\n\tsettings.view?.slug ||\n\t'';\n\nconst buildDisplayControls = (ui) => {\n\tif (!ui.showFullscreen) {\n\t\treturn null;\n\t}\n\n\tconst controls = document.createElement('div');\n\tcontrols.className = 'bbgf-display-controls';\n\n\tconst fullscreenToggle = document.createElement('button');\n\tfullscreenToggle.type = 'button';\n\tfullscreenToggle.className = 'bbgf-button bbgf-button--ghost bbgf-toolbar-fullscreen';\n\tfullscreenToggle.dataset.role = 'bbgf-fullscreen-toggle';\n\tfullscreenToggle.textContent = strings.fullscreen;\n\n\tcontrols.appendChild(fullscreenToggle);\n\n\treturn controls;\n};\n\nconst buildInteractiveToolbar = (state, board, config, copy, ui) => {\n\tif (!ui.showToolbar) {\n\t\treturn null;\n\t}\n\n\tconst toolbar = document.createElement('div');\n\ttoolbar.id = 'bbgf-board-toolbar';\n\ttoolbar.className = 'bbgf-board-toolbar';\n\n\tconst views = ensureArray(config.views);\n\tconst activeSlug = getActiveViewSlug(state);\n\n\tif (ui.viewSwitcher !== 'none' && views.length) {\n\t\tif (ui.viewSwitcher === 'dropdown') {\n\t\t\tconst viewWrapper = document.createElement('div');\n\t\t\tviewWrapper.className = 'bbgf-toolbar-view';\n\t\t\tviewWrapper.setAttribute('role', 'group');\n\t\t\tviewWrapper.setAttribute('aria-label', copy.viewSwitcher);\n\n\t\t\tconst select = document.createElement('select');\n\t\t\tselect.className = 'bbgf-view-select';\n\t\t\tselect.dataset.role = 'bbgf-view-select';\n\n\t\t\tviews.forEach((view) => {\n\t\t\t\tconst option = document.createElement('option');\n\t\t\t\tconst slug = safeString(view.slug ?? view.key ?? '');\n\t\t\t\toption.value = slug;\n\t\t\t\toption.textContent = safeString(view.name ?? view.label ?? slug);\n\t\t\t\tif (slug === activeSlug) {\n\t\t\t\t\toption.selected = true;\n\t\t\t\t}\n\t\t\t\tselect.appendChild(option);\n\t\t\t});\n\n\t\t\tviewWrapper.appendChild(select);\n\t\t\ttoolbar.appendChild(viewWrapper);\n\t\t} else {\n\t\t\tconst viewGroup = document.createElement('div');\n\t\t\tviewGroup.className = 'bbgf-toolbar-view';\n\t\t\tviewGroup.setAttribute('role', 'group');\n\t\t\tviewGroup.setAttribute('aria-label', copy.viewSwitcher);\n\n\t\t\tviews.forEach((view) => {\n\t\t\t\tconst slug = safeString(view.slug ?? view.key ?? '');\n\t\t\t\tif (!slug) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst button = document.createElement('button');\n\t\t\t\tbutton.type = 'button';\n\t\t\t\tbutton.className = `bbgf-button ${slug === activeSlug ? 'bbgf-button--primary' : 'bbgf-button--ghost'}`;\n\t\t\t\tbutton.dataset.view = slug;\n\t\t\t\tbutton.setAttribute('aria-pressed', slug === activeSlug ? 'true' : 'false');\n\t\t\t\tbutton.textContent = safeString(view.name ?? view.label ?? slug);\n\n\t\t\t\tviewGroup.appendChild(button);\n\t\t\t});\n\n\t\t\tif (viewGroup.childNodes.length) {\n\t\t\t\ttoolbar.appendChild(viewGroup);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (ui.showSearch) {\n\t\tconst searchWrapper = document.createElement('div');\n\t\tsearchWrapper.className = 'bbgf-toolbar-search';\n\t\tconst searchLabel = document.createElement('label');\n\t\tsearchLabel.className = 'screen-reader-text';\n\t\tsearchLabel.textContent = copy.searchPlaceholder;\n\t\tconst searchInput = document.createElement('input');\n\t\tsearchInput.type = 'search';\n\t\tsearchInput.className = 'bbgf-toolbar-search__input';\n\t\tsearchInput.placeholder = copy.searchPlaceholder;\n\t\tsearchInput.value = state.filters?.query ?? '';\n\t\tsearchInput.dataset.role = 'bbgf-toolbar-search';\n\t\tsearchWrapper.appendChild(searchLabel);\n\t\tsearchWrapper.appendChild(searchInput);\n\t\ttoolbar.appendChild(searchWrapper);\n\t}\n\n\tlet filterWrapper = null;\n\tif (ui.showFilters) {\n\t\tconst filterOptions = getBoardFilterOptions(board);\n\t\tconst filtersState = state.filters ?? { query: '', services: [], flags: [] };\n\n\t\tfilterWrapper = document.createElement('div');\n\t\tfilterWrapper.className = 'bbgf-toolbar-filters';\n\n\t\tconst makeFilter = (labelText, role, options, selectedValues) => {\n\t\t\tif (!options.length) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst field = document.createElement('label');\n\t\t\tfield.className = 'bbgf-toolbar-filter';\n\t\t\tfield.innerHTML = `<span>${escapeHtml(labelText)}</span>`;\n\n\t\t\tconst select = document.createElement('select');\n\t\t\tselect.className = 'bbgf-toolbar-select';\n\t\t\tselect.multiple = true;\n\t\t\tselect.size = Math.min(options.length, 6);\n\t\t\tselect.dataset.role = role;\n\n\t\t\tconst selectedSet = new Set(ensureArray(selectedValues).map((value) => String(value)));\n\n\t\t\toptions.forEach((option) => {\n\t\t\t\tconst opt = document.createElement('option');\n\t\t\t\topt.value = String(option.id);\n\t\t\t\topt.textContent = option.name;\n\t\t\t\tif (selectedSet.has(String(option.id))) {\n\t\t\t\t\topt.selected = true;\n\t\t\t\t}\n\t\t\t\tselect.appendChild(opt);\n\t\t\t});\n\n\t\t\tfield.appendChild(select);\n\n\t\t\treturn field;\n\t\t};\n\n\t\tconst servicesFilter = makeFilter(copy.filterServices, 'bbgf-filter-services', filterOptions.services, filtersState.services || []);\n\t\tconst flagsFilter = makeFilter(copy.filterFlags, 'bbgf-filter-flags', filterOptions.flags, filtersState.flags || []);\n\n\t\tif (servicesFilter) {\n\t\t\tfilterWrapper.appendChild(servicesFilter);\n\t\t}\n\n\t\tif (flagsFilter) {\n\t\t\tfilterWrapper.appendChild(flagsFilter);\n\t\t}\n\n\t\tif (filterWrapper.childNodes.length) {\n\t\t\tconst resetButton = document.createElement('button');\n\t\t\tresetButton.type = 'button';\n\t\t\tresetButton.className = 'bbgf-button bbgf-toolbar-reset';\n\t\t\tresetButton.dataset.role = 'bbgf-filter-reset';\n\t\t\tresetButton.textContent = copy.filterAll;\n\t\t\tfilterWrapper.appendChild(resetButton);\n\t\t}\n\t}\n\n\tif (filterWrapper && filterWrapper.childNodes.length) {\n\t\ttoolbar.appendChild(filterWrapper);\n\t}\n\n\tconst controls = document.createElement('div');\n\tcontrols.className = 'bbgf-toolbar-controls';\n\n\tif (ui.showRefresh) {\n\t\tconst refreshButton = document.createElement('button');\n\t\trefreshButton.type = 'button';\n\t\trefreshButton.className = 'bbgf-refresh-button bbgf-button';\n\t\trefreshButton.textContent = copy.refresh;\n\t\tif (state.isLoading) {\n\t\t\trefreshButton.setAttribute('disabled', 'disabled');\n\t\t\trefreshButton.classList.add('is-disabled');\n\t\t}\n\t\tcontrols.appendChild(refreshButton);\n\t}\n\n\tif (ui.showLastUpdated) {\n\t\tconst lastUpdated = document.createElement('span');\n\t\tlastUpdated.className = 'bbgf-last-updated';\n\t\tlastUpdated.dataset.role = 'bbgf-last-updated';\n\t\tlastUpdated.textContent = board.last_updated ? `${copy.lastUpdated} ${formatDateForLastUpdated(board.last_updated)}` : copy.lastUpdated;\n\t\tcontrols.appendChild(lastUpdated);\n\t}\n\n\tif (ui.showCountdown) {\n\t\tconst refreshCountdown = document.createElement('span');\n\t\trefreshCountdown.className = 'bbgf-next-refresh';\n\t\trefreshCountdown.dataset.role = 'bbgf-next-refresh';\n\t\tconst countdownText = formatCountdownSeconds(state.nextRefreshAt);\n\t\trefreshCountdown.textContent = countdownText ? `${copy.autoRefresh} ${countdownText}` : `${copy.autoRefresh} â€¦`;\n\t\tcontrols.appendChild(refreshCountdown);\n\t}\n\n\tif (ui.showFullscreen) {\n\t\tconst fullscreenToggle = document.createElement('button');\n\t\tfullscreenToggle.type = 'button';\n\t\tfullscreenToggle.className = 'bbgf-button bbgf-toolbar-fullscreen';\n\t\tfullscreenToggle.dataset.role = 'bbgf-fullscreen-toggle';\n\t\tfullscreenToggle.textContent = strings.fullscreen;\n\t\tcontrols.appendChild(fullscreenToggle);\n\t}\n\n\tif (controls.childNodes.length) {\n\t\ttoolbar.appendChild(controls);\n\t}\n\n\tif (ui.showMaskBadge && board.visibility?.mask_guardian) {\n\t\tconst maskBadge = document.createElement('span');\n\t\tmaskBadge.className = 'bbgf-toolbar-badge';\n\t\tmaskBadge.textContent = copy.maskedGuardian;\n\t\ttoolbar.appendChild(maskBadge);\n\t}\n\n\tif (!toolbar.childNodes.length) {\n\t\treturn null;\n\t}\n\n\treturn toolbar;\n};\n\nconst renderBoard = (state, root, config, copy) => {\n\troot.classList.add('bbgf-board--bootstrapped');\n\n\tconst board = state.board;\n\tif (!board) {\n\t\troot.innerHTML = '';\n\t\tconst loading = document.createElement('div');\n\t\tloading.className = 'bbgf-board-loading';\n\t\tloading.textContent = copy.loading;\n\t\troot.appendChild(loading);\n\t\treturn;\n\t}\n\n\tconst ui = resolvePresentationConfig(board);\n\tcurrentPresentation = ui;\n\n\troot.dataset.readonly = board.readonly ? 'true' : 'false';\n\troot.dataset.isPublic = board.is_public ? 'true' : 'false';\n\troot.dataset.activeView = getActiveViewSlug(state);\n\tconst viewType = safeString(board.view?.type ?? '');\n\troot.dataset.viewType = viewType;\n\troot.dataset.boardMode = ui.mode;\n\n\tif (board.readonly) {\n\t\troot.classList.add('bbgf-board--readonly');\n\t} else {\n\t\troot.classList.remove('bbgf-board--readonly');\n\t}\n\n\tif (ui.mode === 'display') {\n\t\troot.classList.add('bbgf-board-wrapper--display');\n\t} else {\n\t\troot.classList.remove('bbgf-board-wrapper--display');\n\t}\n\n\troot.innerHTML = '';\n\trenderErrors(state, root, copy);\n\n\tif (ui.mode === 'display') {\n\t\tconst controls = buildDisplayControls(ui);\n\t\tif (controls) {\n\t\t\troot.appendChild(controls);\n\t\t}\n\t} else {\n\t\tconst toolbar = buildInteractiveToolbar(state, board, config, copy, ui);\n\t\tif (toolbar) {\n\t\t\troot.appendChild(toolbar);\n\t\t}\n\t}\n\n\tconst columnsWrapper = document.createElement('div');\n\tcolumnsWrapper.className = 'bbgf-board';\n\tcolumnsWrapper.setAttribute('role', 'list');\n\n\tconst searchQuery = (state.filters?.query ?? '').trim().toLowerCase();\n\tconst selectedServices = ensureArray(state.filters?.services).map((value) => Number(value)).filter((value) => Number.isFinite(value));\n\tconst selectedFlags = ensureArray(state.filters?.flags).map((value) => Number(value)).filter((value) => Number.isFinite(value));\n\tconst searchActive = Boolean(searchQuery);\n\tconst allowFilters = ui.showSearch || ui.showFilters;\n\tconst filtersActive = allowFilters && (searchActive || selectedServices.length > 0 || selectedFlags.length > 0);\n\tconst baseStages = ensureArray(board.stages);\n\n\tconst filterVisit = (visit) => {\n\t\tif (!visit) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (searchActive && !visitMatchesQuery(visit, searchQuery)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (selectedServices.length) {\n\t\t\tconst visitServiceIds = ensureArray(visit.services)\n\t\t\t\t.map((service) => Number(service?.id))\n\t\t\t\t.filter((value) => Number.isFinite(value));\n\t\t\tconst serviceSet = new Set(visitServiceIds);\n\t\t\tconst matchesServices = selectedServices.every((id) => serviceSet.has(id));\n\t\t\tif (!matchesServices) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tif (selectedFlags.length) {\n\t\t\tconst visitFlagIds = ensureArray(visit.flags)\n\t\t\t\t.map((flag) => Number(flag?.id))\n\t\t\t\t.filter((value) => Number.isFinite(value));\n\t\t\tconst flagSet = new Set(visitFlagIds);\n\t\t\tconst matchesFlags = selectedFlags.every((id) => flagSet.has(id));\n\t\t\tif (!matchesFlags) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst stages = baseStages.map((stage) => {\n\t\tconst visits = ensureArray(stage.visits);\n\t\tif (!filtersActive) {\n\t\t\treturn { ...stage };\n\t\t}\n\n\t\tconst filteredVisits = visits.filter(filterVisit);\n\t\treturn {\n\t\t\t...stage,\n\t\t\tvisits: filteredVisits,\n\t\t};\n\t});\n\n\troot.dataset.searchActive = filtersActive ? 'true' : 'false';\n\tif (!stages.length) {\n\t\tconst empty = document.createElement('p');\n\t\tempty.className = 'bbgf-board-empty';\n\t\tempty.textContent = copy.noVisits;\n\t\tcolumnsWrapper.appendChild(empty);\n\t} else {\n\t\tconst pendingSet = new Set(ensureArray(state.pendingMoves).map((id) => Number(id)));\n\t\tconst draggingVisitId = state.drag?.isDragging ? state.drag.visitId : null;\n\n\t\tstages.forEach((stage, index) => {\n\t\t\tconst previous = stages[index - 1] || null;\n\t\t\tconst next = stages[index + 1] || null;\n\t\t\tconst column = createColumnElement(stage, {\n\t\t\t\tcopy,\n\t\t\t\tprevious,\n\t\t\t\tnext,\n\t\t\t\tcanMove: Boolean(config.capabilities?.moveStages) && !board.readonly,\n\t\t\t\tpendingMoves: pendingSet,\n\t\t\t\treadonly: board.readonly,\n\t\t\t\tdraggingVisitId,\n\t\t\t\tsearchActive: filtersActive,\n\t\t\t\tpresentation: ui,\n\t\t\t});\n\t\t\tcolumnsWrapper.appendChild(column);\n\t\t});\n\t}\n\n\troot.appendChild(columnsWrapper);\n\n\tconst existingModal = root.querySelector('#bbgf-modal');\n\tif (!existingModal) {\n\t\tconst modal = document.createElement('div');\n\t\tmodal.id = 'bbgf-modal';\n\t\tmodal.setAttribute('hidden', 'hidden');\n\t\tmodal.className = 'bbgf-modal';\n\t\tmodal.innerHTML = `\n\t\t\t<div class=\"bbgf-modal__backdrop\" data-role=\"bbgf-modal-backdrop\"></div>\n\t\t\t<div class=\"bbgf-modal__dialog\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"bbgf-modal-title\">\n\t\t\t\t<header class=\"bbgf-modal__header\">\n\t\t\t\t\t<h2 id=\"bbgf-modal-title\" class=\"bbgf-modal__title\">${copy.modalTitle}</h2>\n\t\t\t\t\t<span class=\"bbgf-modal__badge\" data-role=\"bbgf-modal-readonly\" hidden>${copy.modalReadOnly}</span>\n\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-modal-close\" data-role=\"bbgf-modal-close\">${copy.modalClose}</button>\n\t\t\t\t</header>\n\t\t\t\t<nav class=\"bbgf-modal__tabs\" data-role=\"bbgf-modal-tabs\"></nav>\n\t\t\t\t<div class=\"bbgf-modal__body\" data-role=\"bbgf-modal-body\">\n\t\t\t\t\t<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`.trim();\n\t\troot.appendChild(modal);\n\t}\n\n\tconst lastUpdatedNode = root.querySelector('[data-role=\"bbgf-last-updated\"]');\n\tif (lastUpdatedNode) {\n\t\tlastUpdatedNode.dataset.timestamp = safeString(board.last_updated ?? state.lastFetchedAt ?? '');\n\t}\n};\n\nconst handleToolbarSearchInput = (event) => {\n    const value = event.target.value ?? '';\n    setFilters({ query: value });\n};\n\nconst handleFilterChange = (event) => {\n    const role = event.target.dataset.role;\n    if (!role) {\n        return;\n    }\n\n    const selectedValues = Array.from(event.target.selectedOptions || [])\n        .map((option) => Number(option.value))\n        .filter((value) => Number.isFinite(value));\n\n    if (role === 'bbgf-filter-services') {\n        setFilters({ services: selectedValues });\n    } else if (role === 'bbgf-filter-flags') {\n        setFilters({ flags: selectedValues });\n    }\n};\n\nconst handleFilterReset = () => {\n    setFilters({ query: '', services: [], flags: [] });\n};\n\nconst dismissError = () => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\terrors: ensureArray(state.errors).slice(0, -1),\n\t}));\n\n\tif (toastTimer) {\n\t\twindow.clearTimeout(toastTimer);\n\t\ttoastTimer = null;\n\t}\n\n\tconst container = boardRootElement?.querySelector('#bbgf-board-errors');\n\tif (container) {\n\t\tcontainer.classList.remove('is-active');\n\t}\n};\n\nconst renderErrors = (state, root, copy) => {\n\tconst existing = root.querySelector('#bbgf-board-errors');\n\tconst message = ensureArray(state.errors).slice(-1)[0];\n\n\tif (!message) {\n\t\tif (existing) {\n\t\t\texisting.remove();\n\t\t}\n\t\tif (toastTimer) {\n\t\t\twindow.clearTimeout(toastTimer);\n\t\t\ttoastTimer = null;\n\t\t}\n\t\treturn;\n\t}\n\n\tlet container = existing;\n\tif (!container) {\n\t\tcontainer = document.createElement('div');\n\t\tcontainer.id = 'bbgf-board-errors';\n\t\tcontainer.className = 'bbgf-toast';\n\t\tcontainer.innerHTML = `\n\t\t\t<p class=\"bbgf-toast__message\"></p>\n\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--ghost bbgf-toast__dismiss\" data-role=\"bbgf-toast-dismiss\" aria-label=\"${escapeHtml(\n\t\t\t\tcopy.modalClose\n\t\t\t)}\">Ã—</button>\n\t\t`;\n\t\tcontainer.querySelector('[data-role=\"bbgf-toast-dismiss\"]').addEventListener('click', dismissError);\n\t\troot.appendChild(container);\n\t}\n\n\tconst messageNode = container.querySelector('.bbgf-toast__message');\n\tif (messageNode) {\n\t\tmessageNode.textContent = message;\n\t}\n\n\tcontainer.classList.add('is-active');\n\n\tif (toastTimer) {\n\t\twindow.clearTimeout(toastTimer);\n\t}\n\n\ttoastTimer = window.setTimeout(() => {\n\t\tcontainer?.classList.remove('is-active');\n\t\tdismissError();\n\t}, 6000);\n};\n\nconst attachToolbarHandlers = (root) => {\n\tconst refreshButton = root.querySelector('.bbgf-refresh-button');\n\tif (refreshButton && !refreshButton.dataset.bound) {\n\t\trefreshButton.addEventListener('click', () => {\n\t\t\tif (refreshButton.disabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tloadBoard({ reason: 'manual', forceFull: true });\n\t\t});\n\t\trefreshButton.dataset.bound = 'true';\n\t}\n\n\tconst viewButtons = root.querySelectorAll('.bbgf-toolbar-view button[data-view]');\n\tif (viewButtons.length) {\n\t\tviewButtons.forEach((button) => {\n\t\t\tif (button.dataset.bound === 'true') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tbutton.addEventListener('click', () => {\n\t\t\t\tconst targetView = button.dataset.view;\n\t\t\t\tif (!targetView || targetView === getActiveViewSlug(store.getState())) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.setState({\n\t\t\t\t\tviewOverride: targetView,\n\t\t\t\t});\n\n\t\t\t\tloadBoard({ reason: 'view-change', forceFull: true, targetView });\n\t\t\t});\n\t\t\tbutton.dataset.bound = 'true';\n\t\t});\n\t}\n\n\tconst viewSelect = root.querySelector('[data-role=\"bbgf-view-select\"]');\n\tif (viewSelect && viewSelect.dataset.bound !== 'true') {\n\t\tviewSelect.addEventListener('change', () => {\n\t\t\tconst targetView = viewSelect.value;\n\t\t\tif (!targetView || targetView === getActiveViewSlug(store.getState())) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstore.setState({\n\t\t\t\tviewOverride: targetView,\n\t\t\t});\n\n\t\t\tloadBoard({ reason: 'view-change', forceFull: true, targetView });\n\t\t});\n\t\tviewSelect.dataset.bound = 'true';\n\t}\n\n\tconst searchInput = root.querySelector('[data-role=\"bbgf-toolbar-search\"]');\n\tif (searchInput && searchInput.dataset.bound !== 'true') {\n\t\tsearchInput.addEventListener('input', handleToolbarSearchInput);\n\t\tsearchInput.dataset.bound = 'true';\n\t}\n\n\tconst filterSelects = root.querySelectorAll('[data-role=\"bbgf-filter-services\"], [data-role=\"bbgf-filter-flags\"]');\n\tfilterSelects.forEach((select) => {\n\t\tif (select.dataset.bound === 'true') {\n\t\t\treturn;\n\t\t}\n\t\tselect.addEventListener('change', handleFilterChange);\n\t\tselect.dataset.bound = 'true';\n\t});\n\n\tconst resetButton = root.querySelector('[data-role=\"bbgf-filter-reset\"]');\n\tif (resetButton && resetButton.dataset.bound !== 'true') {\n\t\tresetButton.addEventListener('click', handleFilterReset);\n\t\tresetButton.dataset.bound = 'true';\n\t}\n\n\tfullscreenButton = root.querySelector('[data-role=\"bbgf-fullscreen-toggle\"]') || fullscreenButton;\n\tif (fullscreenButton && fullscreenButton.dataset.bound !== 'true') {\n\t\tfullscreenButton.addEventListener('click', toggleFullscreen);\n\t\tfullscreenButton.dataset.bound = 'true';\n\t\tupdateFullscreenButton();\n\t}\n};\n\nconst updateToolbarStates = (root, state) => {\n\tconst refreshButton = root.querySelector('.bbgf-refresh-button');\n\tif (refreshButton) {\n\t\tif (state.isLoading) {\n\t\t\trefreshButton.setAttribute('disabled', 'disabled');\n\t\t\trefreshButton.classList.add('is-disabled');\n\t\t} else {\n\t\t\trefreshButton.removeAttribute('disabled');\n\t\t\trefreshButton.classList.remove('is-disabled');\n\t\t}\n\t}\n\n\tconst viewButtons = root.querySelectorAll('.bbgf-toolbar-view button[data-view]');\n\tif (viewButtons.length) {\n\t\tconst active = getActiveViewSlug(state);\n\t\tviewButtons.forEach((button) => {\n\t\t\tconst isActive = button.dataset.view === active;\n\t\t\tbutton.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n\t\t\tif (isActive) {\n\t\t\t\tbutton.classList.add('bbgf-button--primary');\n\t\t\t\tbutton.classList.remove('bbgf-button--ghost');\n\t\t\t} else {\n\t\t\t\tbutton.classList.remove('bbgf-button--primary');\n\t\t\t\tbutton.classList.add('bbgf-button--ghost');\n\t\t\t}\n\t\t});\n\t}\n\n\tconst viewSelect = root.querySelector('[data-role=\"bbgf-view-select\"]');\n\tif (viewSelect) {\n\t\tconst active = getActiveViewSlug(state);\n\t\tif (viewSelect.value !== active) {\n\t\t\tviewSelect.value = active;\n\t\t}\n\t}\n\n\tconst searchInput = root.querySelector('[data-role=\"bbgf-toolbar-search\"]');\n\tif (searchInput && document.activeElement !== searchInput) {\n\t\tsearchInput.value = state.filters?.query ?? '';\n\t}\n\n\tconst serviceSelect = root.querySelector('[data-role=\"bbgf-filter-services\"]');\n\tif (serviceSelect) {\n\t\tconst selected = new Set((state.filters?.services || []).map((value) => String(value)));\n\t\tArray.from(serviceSelect.options).forEach((option) => {\n\t\t\toption.selected = selected.has(option.value);\n\t\t});\n\t}\n\n\tconst flagSelect = root.querySelector('[data-role=\"bbgf-filter-flags\"]');\n\tif (flagSelect) {\n\t\tconst selected = new Set((state.filters?.flags || []).map((value) => String(value)));\n\t\tArray.from(flagSelect.options).forEach((option) => {\n\t\t\toption.selected = selected.has(option.value);\n\t\t});\n\t}\n\n\tconst countdownNode = root.querySelector('[data-role=\"bbgf-next-refresh\"]');\n\tif (countdownNode) {\n\t\tconst countdown = formatCountdownSeconds(state.nextRefreshAt);\n\t\tcountdownNode.textContent = countdown ? `${strings.autoRefresh} ${countdown}` : `${strings.autoRefresh} â€¦`;\n\t}\n\n\tfullscreenButton = root.querySelector('[data-role=\"bbgf-fullscreen-toggle\"]') || fullscreenButton;\n\tupdateFullscreenButton();\n};\n\nconst setupLastUpdatedTicker = (root) => {\n\tconst target = root.querySelector('[data-role=\"bbgf-last-updated\"]');\n\tif (!target) {\n\t\tif (root._bbgfLastUpdatedInterval) {\n\t\t\twindow.clearInterval(root._bbgfLastUpdatedInterval);\n\t\t\troot._bbgfLastUpdatedInterval = null;\n\t\t}\n\t\treturn;\n\t}\n\n\tconst update = () => {\n\t\tconst base = target.dataset.timestamp;\n\t\tconst humanized = humanizeRelativeTime(base);\n\t\ttarget.textContent = base ? `${strings.lastUpdated} ${humanized || formatDateForLastUpdated(base)}` : strings.lastUpdated;\n\n\t\tconst refreshNode = root.querySelector('[data-role=\"bbgf-next-refresh\"]');\n\t\tif (refreshNode) {\n\t\t\tconst countdown = formatCountdownSeconds(store.getState().nextRefreshAt);\n\t\t\trefreshNode.textContent = countdown ? `${strings.autoRefresh} ${countdown}` : `${strings.autoRefresh} â€¦`;\n\t\t}\n\t};\n\n\tif (root._bbgfLastUpdatedInterval) {\n\t\twindow.clearInterval(root._bbgfLastUpdatedInterval);\n\t}\n\n\tupdate();\n\troot._bbgfLastUpdatedInterval = window.setInterval(update, 15000);\n};\n\nconst announce = (message) => {\n\tif (message && window.wp?.a11y?.speak) {\n\t\twindow.wp.a11y.speak(message, 'polite');\n\t}\n};\n\nconst initialState = {\n\tboard: settings.initialBoard || null,\n\tisLoading: false,\n\terrors: [],\n\tlastFetchedAt: null,\n\tviewOverride: '',\n\tpendingMoves: [],\n\tfilters: {\n\t\tquery: '',\n\t\tservices: [],\n\t\tflags: [],\n\t},\n\tnextRefreshAt: null,\n\tdrag: {\n\t\tisDragging: false,\n\t\tvisitId: null,\n\t\tfromStage: '',\n\t},\n\tmodal: {\n\t\tisOpen: false,\n\t\tvisitId: null,\n\t\tloading: false,\n\t\tvisit: null,\n\t\treadOnly: false,\n\t\tactiveTab: 'summary',\n\t\tisSaving: false,\n\t\tform: {\n\t\t\tinstructions: '',\n\t\t\tpublicNotes: '',\n\t\t\tprivateNotes: '',\n\t\t\tservices: [],\n\t\t},\n\t\terror: '',\n\t},\n\tcatalog: {\n\t\tservices: {\n\t\t\titems: [],\n\t\t\tisLoading: false,\n\t\t\tloaded: false,\n\t\t\terror: '',\n\t\t},\n\t},\n};\n\nconst store = createStore(initialState);\nconst api = createApiClient(settings.rest || {}, settings.context || {});\n\nconst setModalState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst modal = typeof updater === 'function' ? updater(state.modal, state) : { ...state.modal, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tmodal: modal,\n\t\t};\n\t});\n};\n\nconst setDragState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst drag = typeof updater === 'function' ? updater(state.drag, state) : { ...state.drag, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tdrag,\n\t\t};\n\t});\n};\n\nconst setFilters = (partial) => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\tfilters: {\n\t\t\t...state.filters,\n\t\t\t...partial,\n\t\t},\n\t}));\n};\n\nconst setNextRefreshAt = (timestamp) => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\tnextRefreshAt: timestamp,\n\t}));\n};\n\nconst ensureServicesCatalog = async () => {\n\tif (!settings.capabilities?.manageServices) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.catalog.services.loaded || state.catalog.services.isLoading) {\n\t\treturn;\n\t}\n\n\tstore.setState((current) => ({\n\t\tcatalog: {\n\t\t\t...current.catalog,\n\t\t\tservices: {\n\t\t\t\t...current.catalog.services,\n\t\t\t\tisLoading: true,\n\t\t\t\terror: '',\n\t\t\t},\n\t\t},\n\t}));\n\n\ttry {\n\t\tconst services = await api.fetchServices();\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tservices: {\n\t\t\t\t\titems: services,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: true,\n\t\t\t\t\terror: '',\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t} catch (error) {\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tservices: {\n\t\t\t\t\titems: ensureArray(current.catalog.services.items),\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: false,\n\t\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t}\n};\n\nconst updateModalFormField = (field, value) => {\n\tsetModalState((modal) => ({\n\t\t...modal,\n\t\tform: {\n\t\t\t...modal.form,\n\t\t\t[field]: value,\n\t\t},\n\t}));\n};\n\nconst toggleModalService = (serviceId, isChecked) => {\n\tsetModalState((modal) => {\n\t\tconst current = new Set(ensureArray(modal.form.services).map((id) => Number(id)));\n\t\tif (isChecked) {\n\t\t\tcurrent.add(serviceId);\n\t\t} else {\n\t\t\tcurrent.delete(serviceId);\n\t\t}\n\n\t\treturn {\n\t\t\t...modal,\n\t\t\tform: {\n\t\t\t\t...modal.form,\n\t\t\t\tservices: Array.from(current.values()),\n\t\t\t},\n\t\t};\n\t});\n};\n\nconst handleModalTabChange = (tabId) => {\n\tsetModalState((modal) => ({\n\t\t...modal,\n\t\tactiveTab: tabId,\n\t\terror: '',\n\t}));\n\n\tif (tabId === 'services') {\n\t\tensureServicesCatalog();\n\t}\n};\n\nconst refreshBoardAfterModalSave = () => {\n\tloadBoard({ reason: 'modal-save', forceFull: true });\n};\n\nconst saveModalNotes = async () => {\n\tconst state = store.getState();\n\tconst { modal } = state;\n\tif (modal.readOnly || modal.isSaving) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tconst payload = {\n\t\t\tinstructions: modal.form.instructions,\n\t\t\tpublic_notes: modal.form.publicNotes,\n\t\t\tprivate_notes: modal.form.privateNotes,\n\t\t};\n\n\t\tconst updated = await api.updateVisit(modal.visitId, payload);\n\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\tvisit: updated,\n\t\t\tform: buildModalFormFromVisit(updated),\n\t\t\terror: '',\n\t\t}));\n\n\t\tannounce(strings.modalSave);\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t}\n};\n\nconst saveModalServices = async () => {\n\tconst state = store.getState();\n\tconst { modal } = state;\n\tif (modal.readOnly || modal.isSaving) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tconst payload = {\n\t\t\tservices: ensureArray(modal.form.services).map((id) => Number(id)).filter((id) => Number.isFinite(id)),\n\t\t};\n\n\t\tconst updated = await api.updateVisit(modal.visitId, payload);\n\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\tvisit: updated,\n\t\t\tform: {\n\t\t\t\t...current.form,\n\t\t\t\tservices: ensureArray(updated.services)\n\t\t\t\t\t.map((service) => Number(service?.id))\n\t\t\t\t\t.filter((id) => Number.isFinite(id)),\n\t\t\t},\n\t\t\terror: '',\n\t\t}));\n\n\t\tannounce(strings.modalSave);\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t}\n};\n\nconst handleModalSave = (section) => {\n\tswitch (section) {\n\t\tcase 'notes':\n\t\t\tsaveModalNotes();\n\t\t\tbreak;\n\t\tcase 'services':\n\t\t\tsaveModalServices();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n};\n\nconst getPollIntervalMs = () => {\n\tconst state = store.getState();\n\tconst viewInterval = toNumber(state.board?.view?.refresh_interval);\n\tconst configInterval = toNumber(settings.view?.refresh_interval);\n\tconst defaultInterval = toNumber(settings.pollInterval) ?? 30;\n\tconst seconds = viewInterval || configInterval || defaultInterval || 30;\n\n\treturn Math.max(5, seconds) * 1000;\n};\n\nlet pollTimer = null;\nlet modalLastFocusedElement = null;\nlet boardRootElement = null;\nlet currentDragHoverStage = '';\nlet toastTimer = null;\nlet fullscreenButton = null;\nlet currentPresentation = { mode: 'interactive' };\n\nconst updateFullscreenButton = () => {\n\tif (!fullscreenButton) {\n\t\treturn;\n\t}\n\n\tconst isFullscreen = Boolean(document.fullscreenElement);\n\tfullscreenButton.textContent = isFullscreen ? strings.exitFullscreen : strings.fullscreen;\n\tfullscreenButton.setAttribute('aria-pressed', isFullscreen ? 'true' : 'false');\n};\n\nconst toggleFullscreen = () => {\n\tconst root = boardRootElement;\n\tif (!root) {\n\t\treturn;\n\t}\n\n\tif (!document.fullscreenElement) {\n\t\troot.requestFullscreen?.();\n\t} else {\n\t\tdocument.exitFullscreen?.();\n\t}\n\n\tupdateFullscreenButton();\n};\n\nconst clearPollTimer = () => {\n\tif (pollTimer) {\n\t\twindow.clearTimeout(pollTimer);\n\t\tpollTimer = null;\n\t}\n};\n\nconst scheduleNextPoll = () => {\n\tclearPollTimer();\n\n\tconst delay = getPollIntervalMs();\n\tsetNextRefreshAt(Date.now() + delay);\n\tpollTimer = window.setTimeout(() => {\n\t\tloadBoard({ reason: 'poll' });\n\t}, delay);\n};\n\nconst loadBoard = async ({ reason = 'manual', forceFull = false, targetView } = {}) => {\n\tclearPollTimer();\n\tsetNextRefreshAt(null);\n\n\tconst currentState = store.getState();\n\tconst activeView = targetView || getActiveViewSlug(currentState);\n\tconst params = {};\n\n\tif (activeView) {\n\t\tparams.view = activeView;\n\t}\n\n\tconst useModifiedAfter = !forceFull && !!currentState.board?.last_updated;\n\tif (useModifiedAfter) {\n\t\tparams.modified_after = currentState.board.last_updated;\n\t}\n\n\tstore.setState({\n\t\tisLoading: true,\n\t});\n\n\ttry {\n\t\tconst response = await api.fetchBoard(params);\n\n\t\tstore.setState((state) => {\n\t\t\tconst mergedBoard = useModifiedAfter && state.board ? applyBoardPatch(state.board, response) : response;\n\n\t\t\treturn {\n\t\t\t\tboard: mergedBoard,\n\t\t\t\tisLoading: false,\n\t\t\t\terrors: [],\n\t\t\t\tlastFetchedAt: new Date().toISOString(),\n\t\t\t};\n\t\t});\n\t} catch (error) {\n\t\tconst message = error?.message || strings.errorFetching || strings.loadingError;\n\n\t\tstore.setState((state) => ({\n\t\t\tisLoading: false,\n\t\t\terrors: [...ensureArray(state.errors), message],\n\t\t}));\n\n\t\tannounce(strings.errorFetching || strings.loadingError);\n\t}\n\n\tscheduleNextPoll();\n};\n\nconst updatePendingMoves = (visitId, action = 'add') => {\n\tconst visitNumericId = Number(visitId);\n\tif (Number.isNaN(visitNumericId)) {\n\t\treturn;\n\t}\n\n\tstore.setState((state) => {\n\t\tconst existing = new Set(ensureArray(state.pendingMoves).map((id) => Number(id)));\n\n\t\tif (action === 'remove') {\n\t\t\texisting.delete(visitNumericId);\n\t\t} else {\n\t\t\texisting.add(visitNumericId);\n\t\t}\n\n\t\treturn {\n\t\t\tpendingMoves: Array.from(existing.values()),\n\t\t};\n\t});\n};\n\nconst moveVisitToStage = async (visitId, toStage) => {\n\tif (!toStage) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tif (state.pendingMoves?.includes(Number(visitId))) {\n\t\treturn;\n\t}\n\n\tupdatePendingMoves(visitId, 'add');\n\n\ttry {\n\t\tawait api.moveVisit(visitId, toStage);\n\t\tannounce(strings.moveSuccess);\n\t\tawait loadBoard({ reason: 'move', forceFull: true });\n\t} catch (error) {\n\t\tconst message = error?.message || strings.errorFetching || strings.loadingError;\n\t\tstore.setState((currentState) => ({\n\t\t\terrors: [...ensureArray(currentState.errors), message],\n\t\t}));\n\t\tannounce(message);\n\t} finally {\n\t\tupdatePendingMoves(visitId, 'remove');\n\t}\n};\n\nconst moveVisitWithDirection = (card, direction) => {\n\tconst visitId = Number(card.dataset.visitId);\n\tconst fromStage = safeString(card.dataset.stage);\n\tif (Number.isNaN(visitId) || !fromStage) {\n\t\treturn;\n\t}\n\n\tconst board = store.getState().board;\n\tconst { prev, next } = getStageNeighbors(board, fromStage);\n\tconst target = direction === 'prev' ? prev?.key : next?.key;\n\tif (!target || target === fromStage) {\n\t\treturn;\n\t}\n\n\tmoveVisitToStage(visitId, target);\n};\n\nconst handleQuickMove = async (button) => {\n\tconst card = button.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tconst visitId = Number(card.dataset.visitId);\n\tconst toStage = safeString(button.dataset.targetStage);\n\n\tif (Number.isNaN(visitId) || !toStage) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tbutton.disabled = true;\n\tbutton.classList.add('is-disabled');\n\n\tawait moveVisitToStage(visitId, toStage);\n\n\tbutton.disabled = false;\n\tbutton.classList.remove('is-disabled');\n};\n\nconst handleBoardClick = (event) => {\n\tif (currentPresentation.mode === 'display') {\n\t\treturn;\n\t}\n\n\tconst moveNext = event.target.closest('.bbgf-move-next');\n\tif (moveNext) {\n\t\tevent.preventDefault();\n\t\thandleQuickMove(moveNext);\n\t\treturn;\n\t}\n\n\tconst movePrev = event.target.closest('.bbgf-move-prev');\n\tif (movePrev) {\n\t\tevent.preventDefault();\n\t\thandleQuickMove(movePrev);\n\t\treturn;\n\t}\n\n\tconst card = event.target.closest('.bbgf-card');\n\tif (card) {\n\t\tconst visitId = Number(card.dataset.visitId);\n\t\tif (Number.isNaN(visitId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst state = store.getState();\n\t\tmodalLastFocusedElement = card;\n\n\t\tconst boardVisit = findVisitById(state.board, visitId)?.visit ?? null;\n\t\tstore.setState({\n\t\t\tmodal: {\n\t\t\t\tisOpen: true,\n\t\t\t\tvisitId,\n\t\t\t\tloading: true,\n\t\t\t\tvisit: boardVisit,\n\t\t\t\treadOnly: state.board?.readonly || !settings.capabilities?.editVisits,\n\t\t\t\tactiveTab: 'summary',\n\t\t\t\tisSaving: false,\n\t\t\t\tform: buildModalFormFromVisit(boardVisit),\n\t\t\t\terror: '',\n\t\t\t},\n\t\t});\n\n\t\tensureServicesCatalog();\n\n\t\tapi.fetchVisit(visitId, {\n\t\t\tview: getActiveViewSlug(store.getState()),\n\t\t})\n\t\t\t.then((visit) => {\n\t\t\t\tstore.setState((prev) => ({\n\t\t\t\t\tmodal: {\n\t\t\t\t\t\t...prev.modal,\n\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\tvisit,\n\t\t\t\t\t\tform: buildModalFormFromVisit(visit),\n\t\t\t\t\t\terror: '',\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tstore.setState((prev) => ({\n\t\t\t\t\terrors: [...ensureArray(prev.errors), error?.message || strings.loadingError],\n\t\t\t\t\tmodal: {\n\t\t\t\t\t\t...prev.modal,\n\t\t\t\t\t\tloading: false,\n\t\t\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t\t\t},\n\t\t\t\t}));\n\t\t\t});\n \t}\n};\n\nconst closeModal = () => {\n\tstore.setState((state) => ({\n\t\tmodal: {\n\t\t\t...state.modal,\n\t\t\tisOpen: false,\n\t\t},\n\t}));\n};\n\nconst handleModalContainerClick = (event) => {\n\tconst role = event.target.dataset.role;\n\tif (role === 'bbgf-modal-tab') {\n\t\tconst tab = event.target.dataset.tab;\n\t\tif (tab) {\n\t\t\thandleModalTabChange(tab);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-modal-save') {\n\t\tconst section = event.target.dataset.section;\n\t\tif (section) {\n\t\t\thandleModalSave(section);\n\t\t}\n\t}\n};\n\nconst handleModalContainerInput = (event) => {\n\tconst role = event.target.dataset?.role;\n\tif (role === 'bbgf-modal-input') {\n\t\tconst field = event.target.dataset.field;\n\t\tif (field) {\n\t\t\tupdateModalFormField(field, event.target.value);\n\t\t}\n\t}\n};\n\nconst handleModalContainerChange = (event) => {\n\tconst { dataset, checked } = event.target;\n\tif (dataset?.role === 'bbgf-modal-service') {\n\t\tconst serviceId = Number(dataset.serviceId);\n\t\tif (!Number.isNaN(serviceId)) {\n\t\t\ttoggleModalService(serviceId, checked);\n\t\t}\n\t}\n};\n\nconst highlightColumn = (stageKey) => {\n\tif (!boardRootElement) {\n\t\treturn;\n\t}\n\n\tif (!stageKey) {\n\t\tboardRootElement.querySelectorAll('.bbgf-column--drag-hover').forEach((column) => {\n\t\t\tcolumn.classList.remove('bbgf-column--drag-hover');\n\t\t});\n\t\tcurrentDragHoverStage = '';\n\t\treturn;\n\t}\n\n\tif (currentDragHoverStage === stageKey) {\n\t\treturn;\n\t}\n\n\tboardRootElement.querySelectorAll('.bbgf-column--drag-hover').forEach((column) => {\n\t\tcolumn.classList.remove('bbgf-column--drag-hover');\n\t});\n\n\tconst target = boardRootElement.querySelector(`.bbgf-column[data-stage=\"${stageKey}\"]`);\n\tif (target) {\n\t\ttarget.classList.add('bbgf-column--drag-hover');\n\t\tcurrentDragHoverStage = stageKey;\n\t}\n};\n\nconst handleDragStart = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\tevent.preventDefault();\n\t\treturn;\n\t}\n\n\tconst visitId = Number(card.dataset.visitId);\n\tconst fromStage = safeString(card.dataset.stage);\n\tif (Number.isNaN(visitId) || !fromStage) {\n\t\tevent.preventDefault();\n\t\treturn;\n\t}\n\n\tsetDragState({ isDragging: true, visitId, fromStage });\n\n\tif (event.dataTransfer) {\n\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\tevent.dataTransfer.setData('text/plain', String(visitId));\n\t}\n\n\tcard.classList.add('is-dragging');\n\tcard.setAttribute('aria-grabbed', 'true');\n};\n\nconst handleDragEnd = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (card) {\n\t\tcard.classList.remove('is-dragging');\n\t\tcard.setAttribute('aria-grabbed', 'false');\n\t}\n\n\tsetDragState({ isDragging: false, visitId: null, fromStage: '' });\n\thighlightColumn(null);\n};\n\nconst handleDragOver = (event) => {\n\tconst state = store.getState();\n\tif (!state.drag?.isDragging) {\n\t\treturn;\n\t}\n\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tif (event.dataTransfer) {\n\t\tevent.dataTransfer.dropEffect = 'move';\n\t}\n\n\tif (!state.board?.readonly && settings.capabilities?.moveStages) {\n\t\tevent.preventDefault();\n\t\tconst stageKey = column.dataset.stage;\n\t\tif (stageKey && stageKey !== state.drag.fromStage) {\n\t\t\thighlightColumn(stageKey);\n\t\t}\n\t}\n};\n\nconst handleDragLeave = (event) => {\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tif (!column.contains(event.relatedTarget)) {\n\t\thighlightColumn(null);\n\t}\n};\n\nconst handleDrop = (event) => {\n\tconst state = store.getState();\n\tif (!state.drag?.isDragging) {\n\t\treturn;\n\t}\n\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tevent.preventDefault();\n\n\tconst stageKey = column.dataset.stage;\n\tconst visitId = Number(event.dataTransfer?.getData('text/plain')) || state.drag.visitId;\n\n\tconst targetStage = stageKey;\n\tconst fromStage = state.drag.fromStage;\n\tif (!targetStage || targetStage === fromStage) {\n\t\treturn;\n\t}\n\n\thighlightColumn(null);\n\tsetDragState({ isDragging: false, visitId: null, fromStage: '' });\n\n\tif (!Number.isNaN(visitId)) {\n\t\tmoveVisitToStage(visitId, targetStage);\n\t}\n};\n\nconst handleModalEvents = (root) => {\n\tif (root.dataset.bbgfModalBound === 'true') {\n\t\treturn;\n\t}\n\n\tconst backdrop = root.querySelector('[data-role=\"bbgf-modal-backdrop\"]');\n\tconst closeButton = root.querySelector('[data-role=\"bbgf-modal-close\"]');\n\n\tif (backdrop) {\n\t\tbackdrop.addEventListener('click', closeModal);\n\t}\n\n\tif (closeButton) {\n\t\tcloseButton.addEventListener('click', closeModal);\n\t}\n\n\tdocument.addEventListener('keydown', (event) => {\n\t\tif (event.key === 'Escape') {\n\t\t\tconst { modal } = store.getState();\n\t\t\tif (modal.isOpen) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcloseModal();\n\t\t\t}\n\t\t}\n\t});\n\n\tconst dialog = root.querySelector('.bbgf-modal__dialog');\n\tif (dialog) {\n\t\tdialog.addEventListener('click', handleModalContainerClick);\n\t\tdialog.addEventListener('input', handleModalContainerInput, true);\n\t\tdialog.addEventListener('change', handleModalContainerChange);\n\t}\n\n\troot.dataset.bbgfModalBound = 'true';\n};\n\nconst renderModal = (state, root, copy) => {\n\tconst container = root.querySelector('#bbgf-modal');\n\tif (!container) {\n\t\treturn;\n\t}\n\n\tconst { modal } = state;\n\tif (!modal.isOpen) {\n\t\tcontainer.setAttribute('hidden', 'hidden');\n\t\tconst previous = modalLastFocusedElement;\n\t\tif (previous && previous.focus) {\n\t\t\twindow.requestAnimationFrame(() => previous.focus());\n\t\t}\n\t\tmodalLastFocusedElement = null;\n\t\treturn;\n\t}\n\n\tcontainer.removeAttribute('hidden');\n\n\tconst body = container.querySelector('[data-role=\"bbgf-modal-body\"]');\n\tconst tabsNav = container.querySelector('[data-role=\"bbgf-modal-tabs\"]');\n\tconst title = container.querySelector('#bbgf-modal-title');\n\tconst closeButton = container.querySelector('[data-role=\"bbgf-modal-close\"]');\n\n\tconst tabs = [\n\t\t{ id: 'summary', label: copy.modalSummary },\n\t\t{ id: 'notes', label: copy.modalNotes },\n\t\t{ id: 'services', label: copy.modalServices },\n\t\t{ id: 'history', label: copy.modalHistory },\n\t\t{ id: 'photos', label: copy.modalPhotos },\n\t];\n\n\tif (tabsNav) {\n\t\ttabsNav.innerHTML = tabs\n\t\t\t.map(\n\t\t\t\t(tab) =>\n\t\t\t\t\t`<button type=\"button\" class=\"bbgf-modal__tab${modal.activeTab === tab.id ? ' is-active' : ''}\" data-role=\"bbgf-modal-tab\" data-tab=\"${tab.id}\">${escapeHtml(\n\t\t\t\t\t\ttab.label\n\t\t\t\t\t)}</button>`\n\t\t\t)\n\t\t\t.join('');\n\t}\n\n\tlet contentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\n\tif (modal.loading) {\n\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\t} else if (!modal.visit) {\n\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.loadingError}</p>`;\n\t} else {\n\t\tconst visit = modal.visit;\n\t\tconst stageLabel = ensureArray(state.board?.stages).find((stage) => stage.key === visit.current_stage)?.label ?? visit.current_stage;\n\t\tconst clientName = escapeHtml(visit.client?.name ?? copy.unknownClient);\n\t\tconst guardian = visit.guardian || {};\n\t\tconst maskGuardian = Boolean(state.board?.visibility?.mask_guardian);\n\t\tconst servicesSelection = new Set(ensureArray(modal.form.services).map((id) => Number(id)));\n\t\tconst catalogServices = state.catalog.services;\n\n\t\tif (modal.activeTab === 'summary') {\n\t\t\tconst photoData = getVisitPhoto(visit);\n\t\t\tconst photoMarkup =\n\t\t\t\tphotoData && photoData.url\n\t\t\t\t\t? `<img src=\"${escapeHtml(photoData.url)}\" alt=\"${escapeHtml(photoData.alt ?? clientName)}\">`\n\t\t\t\t\t: `<span>${(safeString(visit.client?.name ?? copy.unknownClient).charAt(0) || 'ðŸ¾').toUpperCase()}</span>`;\n\n\t\t\tconst serviceChips = ensureArray(visit.services)\n\t\t\t\t.map((service) => {\n\t\t\t\t\tconst icon = safeString(service?.icon ?? '');\n\t\t\t\t\tconst label = safeString(service?.name ?? '');\n\t\t\t\t\tconst text = label ? (icon && icon !== label ? `${icon} ${label}` : label) : icon;\n\t\t\t\t\treturn text ? `<span class=\"bbgf-modal-chip\">${escapeHtml(text)}</span>` : '';\n\t\t\t\t})\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.join('');\n\t\t\tconst flagChips = ensureArray(visit.flags)\n\t\t\t\t.map((flag) => {\n\t\t\t\t\tconst emoji = safeString(flag?.emoji ?? '');\n\t\t\t\t\tconst label = safeString(flag?.name ?? '');\n\t\t\t\t\tconst text = label ? `${emoji ? `${emoji} ` : ''}${label}` : emoji;\n\t\t\t\t\treturn text ? `<span class=\"bbgf-modal-chip bbgf-modal-chip--flag\">${escapeHtml(text)}</span>` : '';\n\t\t\t\t})\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.join('');\n\t\t\tconst tagsHtml = [serviceChips, flagChips].filter(Boolean).join('');\n\t\t\tconst guardianNameParts = [safeString(guardian.first_name ?? ''), safeString(guardian.last_name ?? '')].filter(Boolean);\n\t\t\tconst guardianName = guardianNameParts.join(' ').trim();\n\t\t\tconst contactPieces = [safeString(guardian.phone ?? ''), safeString(guardian.email ?? '')].filter(Boolean);\n\t\t\tconst guardianMetaPieces = [];\n\t\t\tif (maskGuardian) {\n\t\t\t\tguardianMetaPieces.push(escapeHtml(copy.maskedGuardian));\n\t\t\t} else {\n\t\t\t\tif (guardianName) {\n\t\t\t\t\tguardianMetaPieces.push(escapeHtml(guardianName));\n\t\t\t\t}\n\t\t\t\tif (contactPieces.length) {\n\t\t\t\t\tguardianMetaPieces.push(contactPieces.map((piece) => escapeHtml(piece)).join(' â€¢ '));\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst guardianMeta =\n\t\t\t\tguardianMetaPieces.length > 0 ? `<p class=\"bbgf-modal-summary__meta\">${guardianMetaPieces.join(' â€¢ ')}</p>` : '';\n\t\t\tconst checkIn = escapeHtml(formatDateTime(visit.check_in_at) || '');\n\t\t\tconst checkOut = escapeHtml(formatDateTime(visit.check_out_at) || '');\n\t\t\tconst timerSeconds = toNumber(visit.timer_elapsed_seconds) ?? 0;\n\t\t\tconst elapsedDisplay = timerSeconds > 0 ? escapeHtml(formatDuration(timerSeconds)) : '';\n\t\t\tconst instructions = escapeHtml(visit.instructions ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst publicNotes = escapeHtml(visit.public_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst privateNotes = escapeHtml(visit.private_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst summaryItems = [];\n\t\t\tsummaryItems.push({ label: copy.checkIn, value: checkIn || '-' });\n\t\t\tsummaryItems.push({ label: 'Check-out', value: checkOut || '-' });\n\t\t\tconst summaryGridHtml = summaryItems\n\t\t\t\t.map(\n\t\t\t\t\t(item) =>\n\t\t\t\t\t\t`<div class=\"bbgf-summary-item\"><span class=\"bbgf-summary-item__label\">${escapeHtml(item.label)}</span><span class=\"bbgf-summary-item__value\">${item.value}</span></div>`\n\t\t\t\t)\n\t\t\t\t.join('');\n\t\t\tconst noteBlocks = [];\n\t\t\tif (instructions) {\n\t\t\t\tnoteBlocks.push({ heading: 'Instructions', body: instructions });\n\t\t\t}\n\t\t\tif (publicNotes) {\n\t\t\t\tnoteBlocks.push({ heading: 'Public notes', body: publicNotes });\n\t\t\t}\n\t\t\tif (!modal.readOnly && privateNotes) {\n\t\t\t\tnoteBlocks.push({ heading: 'Private notes', body: privateNotes });\n\t\t\t}\n\t\t\tconst notesHtml = noteBlocks.length\n\t\t\t\t? `<div class=\"bbgf-modal-summary__notes\">${noteBlocks\n\t\t\t\t\t\t.map((note) => `<article class=\"bbgf-modal-note\"><h4>${escapeHtml(note.heading)}</h4><p>${note.body}</p></article>`)\n\t\t\t\t\t\t.join('')}</div>`\n\t\t\t\t: '';\n\n\t\t\tcontentHtml = `\n\t\t\t\t<section class=\"bbgf-modal-summary\">\n\t\t\t\t\t<header class=\"bbgf-modal-summary__header\">\n\t\t\t\t\t\t<div class=\"bbgf-modal-summary__photo\">${photoMarkup}</div>\n\t\t\t\t\t\t<div class=\"bbgf-modal-summary__primary\">\n\t\t\t\t\t\t\t<h3 class=\"bbgf-modal-summary__name\">${clientName}</h3>\n\t\t\t\t\t\t\t<p class=\"bbgf-modal-summary__subtitle\">\n\t\t\t\t\t\t\t\t<span class=\"bbgf-modal-summary__stage\">${escapeHtml(stageLabel || visit.current_stage || '')}</span>\n\t\t\t\t\t\t\t\t${elapsedDisplay ? `<span class=\"bbgf-modal-summary__elapsed\">${elapsedDisplay}</span>` : ''}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t${guardianMeta}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\t\t\t\t\t${tagsHtml ? `<div class=\"bbgf-modal-summary__tags\">${tagsHtml}</div>` : ''}\n\t\t\t\t\t${summaryGridHtml ? `<div class=\"bbgf-modal-summary__grid\">${summaryGridHtml}</div>` : ''}\n\t\t\t\t\t${notesHtml}\n\t\t\t\t</section>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'notes') {\n\t\t\tcontentHtml = `\n\t\t\t\t<form class=\"bbgf-modal-form\" data-role=\"bbgf-modal-notes-form\">\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-instructions\">${escapeHtml(copy.notes)} (${escapeHtml('Instructions')})</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-instructions\" data-role=\"bbgf-modal-input\" data-field=\"instructions\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-public-notes\">${escapeHtml('Public notes')}</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-public-notes\" data-role=\"bbgf-modal-input\" data-field=\"publicNotes\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-private-notes\">${escapeHtml('Private notes')}</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-private-notes\" data-role=\"bbgf-modal-input\" data-field=\"privateNotes\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t${modal.readOnly ? '' : `<div class=\"bbgf-modal__actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-modal-save\" data-section=\"notes\" ${modal.isSaving ? 'disabled' : ''}>${escapeHtml(modal.isSaving ? copy.modalSaving : copy.modalSave)}</button></div>`}\n\t\t\t\t</form>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'services') {\n\t\t\tif (!settings.capabilities?.manageServices) {\n\t\t\t\tconst serviceList = ensureArray(visit.services)\n\t\t\t\t\t.map((service) => `<li>${escapeHtml(service.name)}</li>`)\n\t\t\t\t\t.join('');\n\n\t\t\t\tcontentHtml = `\n\t\t\t\t\t<div class=\"bbgf-modal-section\">\n\t\t\t\t\t\t<p>${escapeHtml('You do not have permission to modify services. Contact an administrator if you need changes.')}</p>\n\t\t\t\t\t\t<ul class=\"bbgf-modal-list\">${serviceList || `<li>${escapeHtml(copy.emptyColumn)}</li>`}</ul>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t} else if (catalogServices.isLoading && !catalogServices.loaded) {\n\t\t\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\t\t\t} else if (catalogServices.error) {\n\t\t\t\tcontentHtml = `<p class=\"bbgf-modal__error\">${escapeHtml(catalogServices.error)}</p>`;\n\t\t\t} else {\n\t\t\t\tconst serviceItems = ensureArray(catalogServices.items)\n\t\t\t\t\t.map((service) => {\n\t\t\t\t\t\tconst id = Number(service?.id);\n\t\t\t\t\t\tconst checked = servicesSelection.has(id) ? 'checked' : '';\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t\t<label class=\"bbgf-modal-service\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" data-role=\"bbgf-modal-service\" data-service-id=\"${id}\" ${checked} ${modal.readOnly ? 'disabled' : ''}>\n\t\t\t\t\t\t\t\t<span>${escapeHtml(service?.name ?? '')}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t`;\n\t\t\t\t\t})\n\t\t\t\t\t.join('');\n\n\t\t\t\tcontentHtml = `\n\t\t\t\t\t<div class=\"bbgf-modal-service-list\">\n\t\t\t\t\t\t${serviceItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.emptyColumn)}</p>`}\n\t\t\t\t\t</div>\n\t\t\t\t\t${modal.readOnly ? '' : `<div class=\"bbgf-modal__actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-modal-save\" data-section=\"services\" ${modal.isSaving ? 'disabled' : ''}>${escapeHtml(modal.isSaving ? copy.modalSaving : copy.modalSave)}</button></div>`}\n\t\t\t\t`;\n\t\t\t}\n\t\t} else if (modal.activeTab === 'history') {\n\t\t\tconst historyItems = ensureArray(visit.history)\n\t\t\t\t.map((entry) => {\n\t\t\t\t\tconst when = formatDateTime(entry.changed_at);\n\t\t\t\t\tconst from = escapeHtml(entry.from_stage?.label ?? entry.from_stage?.key ?? '');\n\t\t\t\t\tconst to = escapeHtml(entry.to_stage?.label ?? entry.to_stage?.key ?? '');\n\t\t\t\t\tconst comment = escapeHtml(entry.comment ?? '').replace(/\\n/g, '<br>');\n\t\t\t\t\tconst duration = entry.elapsed_seconds ? formatDuration(entry.elapsed_seconds) : '';\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<div class=\"bbgf-history-entry\">\n\t\t\t\t\t\t\t\t<strong>${when}</strong>\n\t\t\t\t\t\t\t\t<p>${from} â†’ ${to}</p>\n\t\t\t\t\t\t\t\t${duration ? `<p class=\"bbgf-history-duration\">${escapeHtml(duration)}</p>` : ''}\n\t\t\t\t\t\t\t\t${comment ? `<p>${comment}</p>` : ''}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join('');\n\n\t\t\tcontentHtml = `\n\t\t\t\t<ul class=\"bbgf-modal-history\">\n\t\t\t\t\t${historyItems || `<li>${escapeHtml(copy.modalNoHistory)}</li>`}\n\t\t\t\t</ul>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'photos') {\n\t\t\tconst photos = ensureArray(visit.photos);\n\t\t\tlet photoItems = photos\n\t\t\t\t.map((photo) => {\n\t\t\t\t\tconst url = escapeHtml(photo.url ?? '');\n\t\t\t\t\tconst alt = escapeHtml(photo.alt ?? clientName);\n\t\t\t\t\treturn `<figure class=\"bbgf-modal-photo\"><img src=\"${url}\" alt=\"${alt}\"><figcaption>${alt}</figcaption></figure>`;\n\t\t\t\t})\n\t\t\t\t.join('');\n\n\t\t\tif (!photoItems) {\n\t\t\t\tconst placeholder = getPlaceholderPhoto(visit);\n\t\t\t\tif (placeholder && placeholder.url) {\n\t\t\t\t\tconst alt = escapeHtml(placeholder.alt ?? clientName);\n\t\t\t\t\tphotoItems = `<figure class=\"bbgf-modal-photo\"><img src=\"${escapeHtml(placeholder.url)}\" alt=\"${alt}\"><figcaption>${alt}</figcaption></figure>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcontentHtml = `\n\t\t\t\t<div class=\"bbgf-modal-photos\">\n\t\t\t\t\t${photoItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalNoPhotos)}</p>`}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\tif (modal.error) {\n\t\t\tcontentHtml = `<div class=\"bbgf-modal__error\">${escapeHtml(modal.error)}</div>${contentHtml}`;\n\t\t}\n\t}\n\n\tbody.innerHTML = contentHtml;\n\n\tif (modal.activeTab === 'notes') {\n\t\tconst instructionsField = body.querySelector('[data-field=\"instructions\"]');\n\t\tconst publicField = body.querySelector('[data-field=\"publicNotes\"]');\n\t\tconst privateField = body.querySelector('[data-field=\"privateNotes\"]');\n\t\tif (instructionsField) {\n\t\t\tinstructionsField.value = modal.form.instructions ?? '';\n\t\t}\n\t\tif (publicField) {\n\t\t\tpublicField.value = modal.form.publicNotes ?? '';\n\t\t}\n\t\tif (privateField) {\n\t\t\tprivateField.value = modal.form.privateNotes ?? '';\n\t\t}\n\t}\n\n\tif (modal.activeTab === 'services') {\n\t\tconst checkboxes = body.querySelectorAll('[data-role=\"bbgf-modal-service\"]');\n\t\tcheckboxes.forEach((input) => {\n\t\t\tconst id = Number(input.dataset.serviceId);\n\t\t\tinput.checked = servicesSelection.has(id);\n\t\t\tif (modal.isSaving) {\n\t\t\t\tinput.setAttribute('disabled', 'disabled');\n\t\t\t}\n\t\t});\n\t}\n\n\tif (title) {\n\t\tconst name = modal.visit?.client?.name ? `: ${modal.visit.client.name}` : '';\n\t\ttitle.textContent = `${copy.modalTitle}${name}`;\n\t}\n\n\tif (modal.readOnly) {\n\t\tcontainer.classList.add('bbgf-modal--readonly');\n\t} else {\n\t\tcontainer.classList.remove('bbgf-modal--readonly');\n\t}\n\n\tconst badge = container.querySelector('[data-role=\"bbgf-modal-readonly\"]');\n\tif (badge) {\n\t\tif (modal.readOnly) {\n\t\t\tbadge.removeAttribute('hidden');\n\t\t} else {\n\t\t\tbadge.setAttribute('hidden', 'hidden');\n\t\t}\n\t}\n\n\tconst activeElement = document.activeElement;\n\tif (closeButton && (!container.contains(activeElement) || activeElement === container)) {\n\t\twindow.requestAnimationFrame(() => closeButton.focus());\n\t}\n};\n\nconst setupDragAndDrop = (root, state) => {\n\tif (currentPresentation.mode === 'display') {\n\t\treturn;\n\t}\n\n\tconst cards = root.querySelectorAll('.bbgf-card');\n\tconst readonly = state.board?.readonly;\n\n\tcards.forEach((card) => {\n\t\tif (readonly || !settings.capabilities?.moveStages) {\n\t\t\tcard.removeAttribute('draggable');\n\t\t\tcard.setAttribute('aria-grabbed', 'false');\n\t\t} else {\n\t\t\tcard.setAttribute('draggable', 'true');\n\t\t\tif (!card.hasAttribute('aria-grabbed')) {\n\t\t\t\tcard.setAttribute('aria-grabbed', 'false');\n\t\t\t}\n\t\t}\n\t});\n};\n\nconst handleBoardKeyDown = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tif (event.target.closest('.bbgf-card-actions button')) {\n\t\treturn;\n\t}\n\n\tif (event.key === 'Enter' || event.key === ' ') {\n\t\tevent.preventDefault();\n\t\tcard.click();\n\t\treturn;\n\t}\n\n\tif (event.key === 'ArrowLeft') {\n\t\tevent.preventDefault();\n\t\tmoveVisitWithDirection(card, 'prev');\n\t\treturn;\n\t}\n\n\tif (event.key === 'ArrowRight') {\n\t\tevent.preventDefault();\n\t\tmoveVisitWithDirection(card, 'next');\n\t}\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconst root = document.getElementById('bbgf-board-root');\n\tif (!root) {\n\t\treturn;\n\t}\n\n\tboardRootElement = root;\n\tdocument.addEventListener('fullscreenchange', updateFullscreenButton);\n\n\tif (settings.context?.view) {\n\t\troot.dataset.activeView = settings.context.view;\n\t}\n\n\trenderBoard(store.getState(), root, settings, strings);\n\tupdateToolbarStates(root, store.getState());\n\tattachToolbarHandlers(root);\n\tsetupLastUpdatedTicker(root);\n\trenderModal(store.getState(), root, strings);\n\thandleModalEvents(root);\n\tsetupDragAndDrop(root, store.getState());\n\n\tstore.subscribe((state) => {\n\t\trenderBoard(state, root, settings, strings);\n\t\tupdateToolbarStates(root, state);\n\t\tattachToolbarHandlers(root);\n\t\tsetupLastUpdatedTicker(root);\n\t\trenderModal(state, root, strings);\n\t\tsetupDragAndDrop(root, state);\n\t});\n\n\twindow.bbgfBoardSettings = settings;\n\twindow.bbgfBoardStore = store;\n\twindow.bbgfBoardApi = api;\n\twindow.bbgfBoardRefresh = () => loadBoard({ reason: 'manual', forceFull: true });\n\n\troot.addEventListener('click', handleBoardClick);\n\troot.addEventListener('keydown', handleBoardKeyDown);\n\troot.addEventListener('dragstart', handleDragStart);\n\troot.addEventListener('dragend', handleDragEnd);\n\troot.addEventListener('dragover', handleDragOver);\n\troot.addEventListener('dragleave', handleDragLeave);\n\troot.addEventListener('drop', handleDrop);\n\n\tloadBoard({ reason: 'initial', forceFull: !settings.initialBoard });\n});\n"],"names":["settings","strings","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","_y","_z","_A","_B","_C","_D","_E","_F","_G","_H","_I","presentation","ensureArray","value","safeString","toNumber","parsed","placeholderPhotos","_J","url","resolvePresentationConfig","board","modeCandidate","mode","pickFlag","key","fallback","defaultMaskBadge","viewSwitcherValue","allowSwitcher","viewSwitcher","cloneVisit","visit","cloneStage","stage","buildStageMap","stages","map","applyBoardPatch","currentBoard","patchBoard","currentStageMap","patchStageMap","changedVisitIds","filtered","mergedStage","mergedStages","a","b","aOrder","bOrder","findVisitById","visitId","normalizedId","formatDuration","totalSeconds","seconds","hours","minutes","remainingSeconds","formatTime","isoString","date","formatDateForLastUpdated","formatDateTime","humanizeRelativeTime","target","deltaSeconds","days","getTimerState","thresholds","yellow","red","buildCapacityHint","capacity","count","soft","hard","remaining","extractPrimaryPhoto","photos","list","first","candidate","getPlaceholderPhoto","index","clientName","getVisitPhoto","buildServiceSummary","services","service","escapeHtml","char","buildModalFormFromVisit","id","visitMatchesQuery","query","flag","getStageNeighbors","stageKey","getBoardFilterOptions","servicesMap","flagsMap","flags","formatCountdownSeconds","targetTimestamp","delta","formatCheckIn","time","createStore","initialState","state","listeners","updater","nextState","listener","error","createApiClient","rest","context","buildHeaders","headers","buildUrl","endpoint","params","response","toStage","payload","message","data","createCardElement","options","copy","previous","next","canMove","pendingMoves","readonly","draggingVisitId","showNotes","card","visitIdNumber","isPending","isDragging","timerSeconds","timerState","photoWrapper","photoData","img","body","header","name","timer","meta","serviceSummary","serviceSpan","checkInText","separator","checkInSpan","servicesWrapper","chip","icon","label","flagsWrapper","emoji","nameSpan","notes","notesParagraph","actions","prevButton","nextButton","createColumnElement","searchActive","visits","softLimit","hardLimit","column","title","labelSpan","countSpan","capacityBadge","empty","getActiveViewSlug","buildDisplayControls","ui","controls","fullscreenToggle","buildInteractiveToolbar","config","toolbar","views","activeSlug","viewWrapper","select","view","option","slug","viewGroup","button","searchWrapper","searchLabel","searchInput","filterWrapper","filterOptions","filtersState","makeFilter","labelText","role","selectedValues","field","selectedSet","opt","servicesFilter","flagsFilter","resetButton","refreshButton","lastUpdated","refreshCountdown","countdownText","maskBadge","renderBoard","root","loading","currentPresentation","viewType","renderErrors","columnsWrapper","searchQuery","selectedServices","selectedFlags","filtersActive","baseStages","filterVisit","visitServiceIds","serviceSet","visitFlagIds","flagSet","filteredVisits","pendingSet","modal","lastUpdatedNode","handleToolbarSearchInput","event","setFilters","handleFilterChange","handleFilterReset","dismissError","store","toastTimer","container","boardRootElement","existing","messageNode","attachToolbarHandlers","loadBoard","viewButtons","targetView","viewSelect","fullscreenButton","toggleFullscreen","updateFullscreenButton","updateToolbarStates","active","isActive","serviceSelect","selected","flagSelect","countdownNode","countdown","setupLastUpdatedTicker","update","base","humanized","refreshNode","announce","api","setModalState","setDragState","drag","partial","setNextRefreshAt","timestamp","ensureServicesCatalog","current","updateModalFormField","toggleModalService","serviceId","isChecked","handleModalTabChange","tabId","refreshBoardAfterModalSave","saveModalNotes","updated","saveModalServices","handleModalSave","section","getPollIntervalMs","viewInterval","configInterval","defaultInterval","pollTimer","modalLastFocusedElement","currentDragHoverStage","isFullscreen","clearPollTimer","scheduleNextPoll","delay","reason","forceFull","currentState","activeView","useModifiedAfter","updatePendingMoves","action","visitNumericId","moveVisitToStage","moveVisitWithDirection","direction","fromStage","prev","handleQuickMove","handleBoardClick","moveNext","movePrev","boardVisit","closeModal","handleModalContainerClick","tab","handleModalContainerInput","handleModalContainerChange","dataset","checked","highlightColumn","handleDragStart","handleDragEnd","handleDragOver","handleDragLeave","handleDrop","targetStage","handleModalEvents","backdrop","closeButton","dialog","renderModal","tabsNav","tabs","contentHtml","stageLabel","guardian","maskGuardian","servicesSelection","catalogServices","photoMarkup","serviceChips","text","flagChips","tagsHtml","guardianName","contactPieces","guardianMetaPieces","piece","guardianMeta","checkIn","checkOut","elapsedDisplay","instructions","publicNotes","privateNotes","summaryItems","summaryGridHtml","item","noteBlocks","notesHtml","note","serviceList","entry","when","from","to","comment","duration","photoItems","photo","alt","placeholder","instructionsField","publicField","privateField","input","badge","activeElement","setupDragAndDrop","cards","handleBoardKeyDown"],"mappings":"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"}