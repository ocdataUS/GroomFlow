{"version":3,"file":"board.js","sources":["../src/index.js"],"sourcesContent":["import './style.scss';\n\nconst settings = window.bbgfBoardSettings || {};\n\nconst strings = {\n\tloading: settings.strings?.loading ?? 'Loading GroomFlow boardâ€¦',\n\temptyColumn: settings.strings?.emptyColumn ?? 'No visits in this stage yet',\n\tnoVisits: settings.strings?.noVisits ?? 'No visits available.',\n\trefresh: settings.strings?.refresh ?? 'Refresh',\n\tlastUpdated: settings.strings?.lastUpdated ?? 'Last updated',\n\tviewSwitcher: settings.strings?.viewSwitcher ?? 'Board views',\n\tservices: settings.strings?.services ?? 'Services',\n\tflags: settings.strings?.flags ?? 'Behavior flags',\n\tnotes: settings.strings?.notes ?? 'Notes',\n\tcheckIn: settings.strings?.checkIn ?? 'Check-in',\n\taddVisit: settings.strings?.addVisit ?? 'Add visit',\n\tmovePrev: settings.strings?.movePrev ?? 'Back',\n\tmoveNext: settings.strings?.moveNext ?? 'Next',\n\tunknownClient: settings.strings?.unknownClient ?? 'Client',\n\tstageControls: settings.strings?.stageControls ?? 'Stage controls',\n\tloadingError: settings.strings?.loadingError ?? 'Unable to load the board. Please refresh.',\n\tmodalTitle: settings.strings?.modalTitle ?? 'Visit details',\n\tmodalLoading: settings.strings?.modalLoading ?? 'Loading visitâ€¦',\n\tmodalClose: settings.strings?.modalClose ?? 'Close',\n\tmodalReadOnly: settings.strings?.modalReadOnly ?? 'Read-only view',\n\tmodalSummary: settings.strings?.modalSummary ?? 'Summary',\n\tmodalNotes: settings.strings?.modalNotes ?? 'Notes',\n\tmodalServices: settings.strings?.modalServices ?? 'Services',\n\tmodalVisit: settings.strings?.modalVisit ?? 'Visit',\n\tmodalHistory: settings.strings?.modalHistory ?? 'History',\n\tmodalPhotos: settings.strings?.modalPhotos ?? 'Photos',\n\tmodalNoPrevious: settings.strings?.modalNoPrevious ?? 'No previous visits found.',\n\tmodalUploadPhoto: settings.strings?.modalUploadPhoto ?? 'Upload photo',\n\tmodalVisibleToGuardian: settings.strings?.modalVisibleToGuardian ?? 'Visible to guardian',\n\tmodalViewPhoto: settings.strings?.modalViewPhoto ?? 'View full size',\n\tmodalSave: settings.strings?.modalSave ?? 'Save changes',\n\tmodalSaving: settings.strings?.modalSaving ?? 'Savingâ€¦',\n\tmodalCheckout: settings.strings?.modalCheckout ?? 'Check out',\n\tmodalCheckedOut: settings.strings?.modalCheckedOut ?? 'Checked out',\n\tmodalCheckoutAt: settings.strings?.modalCheckoutAt ?? 'Checked out at',\n\tmodalPreparingUpload: settings.strings?.modalPreparingUpload ?? 'Preparing photosâ€¦',\n\tmodalNoHistory: settings.strings?.modalNoHistory ?? 'No history recorded yet.',\n\tmodalNoPhotos: settings.strings?.modalNoPhotos ?? 'No photos uploaded for this visit.',\n\tsearchPlaceholder: settings.strings?.searchPlaceholder ?? 'Search clients, guardians, servicesâ€¦',\n\tmoveSuccess: settings.strings?.moveSuccess ?? 'Visit moved.',\n\tfullscreen: settings.strings?.fullscreen ?? 'Fullscreen',\n\texitFullscreen: settings.strings?.exitFullscreen ?? 'Exit fullscreen',\n\tautoRefresh: settings.strings?.autoRefresh ?? 'Auto-refresh in',\n\tmaskedGuardian: settings.strings?.maskedGuardian ?? 'Guardian hidden for lobby view',\n\terrorFetching: settings.strings?.errorFetching ?? 'Unable to refresh the board. Please try again.',\n\tactiveVisits: settings.strings?.activeVisits ?? 'Active visits',\n\toverdueVisits: settings.strings?.overdueVisits ?? 'Overdue',\n\tflaggedVisits: settings.strings?.flaggedVisits ?? 'Flagged',\n\tfiltersActive: settings.strings?.filtersActive ?? 'Filters applied',\n\tclearFilters: settings.strings?.clearFilters ?? 'Clear filters',\n\tguardianLabel: settings.strings?.guardianLabel ?? 'Guardian',\n\tstageLabel: settings.strings?.stageLabel ?? 'Stage',\n\tstagesLabel: settings.strings?.stagesLabel ?? 'Stages',\n\tintakeTitle: settings.strings?.intakeTitle ?? 'Add visit',\n\tintakeSearchLabel: settings.strings?.intakeSearchLabel ?? 'Search clients or guardians',\n\tintakeNoResults: settings.strings?.intakeNoResults ?? 'No matches found in this tab. Try Guardian/Client or add details below.',\n\tintakeGuardian: settings.strings?.intakeGuardian ?? 'Guardian',\n\tintakeClient: settings.strings?.intakeClient ?? 'Client',\n\tintakeVisit: settings.strings?.intakeVisit ?? 'Visit details',\n\tintakeSubmit: settings.strings?.intakeSubmit ?? 'Create visit',\n\tintakeSaving: settings.strings?.intakeSaving ?? 'Creating visitâ€¦',\n\tintakeSuccess: settings.strings?.intakeSuccess ?? 'Visit created and added to the board.',\n\tintakeSearchHint: settings.strings?.intakeSearchHint ?? 'Search by client, guardian, phone, or email.',\n\tintakeSelect: settings.strings?.intakeSelect ?? 'Select',\n\tmodalCheckoutConfirm: settings.strings?.modalCheckoutConfirm ?? 'Are you sure you want to check out this visit?',\n};\n\nconst presentation = settings.presentation || {};\nconst appearance = settings.appearance || {};\nconst appearanceColors = appearance.colors || {};\nconst allowedMetadataBlocks = ['meta', 'services', 'flags', 'notes'];\n\nconst resolveMetadataOrder = () => {\n\tconst configured = Array.isArray(appearance.metadata_order) ? appearance.metadata_order : [];\n\tconst normalized = configured\n\t\t.map((item) => {\n\t\t\tconst key = String(item || '').trim().toLowerCase();\n\t\t\tif (['summary', 'checkin', 'check_in'].includes(key)) {\n\t\t\t\treturn 'meta';\n\t\t\t}\n\t\t\treturn key;\n\t\t})\n\t\t.filter((item) => allowedMetadataBlocks.includes(item));\n\n\tif (normalized.length) {\n\t\treturn normalized.filter((item, index) => normalized.indexOf(item) === index);\n\t}\n\n\treturn allowedMetadataBlocks;\n};\n\nconst showServicesSetting = appearance.show_services !== false;\nconst showFlagsSetting = appearance.show_flags !== false;\nconst showNotesSetting = appearance.show_notes !== false;\n\nconst ensureArray = (value) => (Array.isArray(value) ? value : []);\nconst safeString = (value) => (typeof value === 'string' ? value : '');\nconst toNumber = (value) => {\n\tconst parsed = Number(value);\n\treturn Number.isFinite(parsed) ? parsed : null;\n};\n\nconst placeholderPhotos = ensureArray(settings.placeholders?.photos)\n\t.filter((url) => typeof url === 'string' && url.length > 0);\n\nconst resolvePresentationConfig = (board) => {\n\tconst modeCandidate = safeString(presentation.mode ?? '');\n\tlet mode = modeCandidate === 'display' || modeCandidate === 'interactive' ? modeCandidate : '';\n\n\tif (!mode) {\n\t\tmode = board.readonly || board.is_public ? 'display' : 'interactive';\n\t}\n\n\tconst pickFlag = (key, fallback) => {\n\t\tconst value = presentation[key];\n\t\tif (typeof value === 'boolean') {\n\t\t\treturn value;\n\t\t}\n\t\treturn fallback;\n\t};\n\n\tconst defaultMaskBadge = mode === 'display' ? false : Boolean(board.visibility?.mask_guardian);\n\tconst viewSwitcherValue = safeString(presentation.view_switcher ?? '');\n\tconst allowSwitcher = board?.view?.allow_switcher !== false;\n\tlet viewSwitcher = ['dropdown', 'buttons', 'none'].includes(viewSwitcherValue)\n\t\t? viewSwitcherValue\n\t\t: mode === 'display'\n\t\t\t? 'none'\n\t\t\t: 'dropdown';\n\n\tif (!allowSwitcher || mode === 'display') {\n\t\tviewSwitcher = 'none';\n\t}\n\n\treturn {\n\t\tmode,\n\t\tshowToolbar: pickFlag('show_toolbar', mode !== 'display'),\n\t\tshowSearch: pickFlag('show_search', mode !== 'display'),\n\t\tshowFilters: pickFlag('show_filters', mode !== 'display'),\n\t\tshowRefresh: pickFlag('show_refresh', mode !== 'display'),\n\t\tshowLastUpdated: pickFlag('show_last_updated', mode !== 'display'),\n\t\tshowCountdown: pickFlag('show_countdown', mode !== 'display'),\n\t\tshowFullscreen: pickFlag('show_fullscreen', true),\n\t\tshowMaskBadge: pickFlag('show_mask_badge', defaultMaskBadge),\n\t\tshowNotes: pickFlag('show_notes', mode !== 'display'),\n\t\tviewSwitcher,\n\t};\n};\n\nconst cloneVisit = (visit) => (visit && typeof visit === 'object' ? JSON.parse(JSON.stringify(visit)) : visit);\nconst cloneStage = (stage) => {\n\tif (!stage || typeof stage !== 'object') {\n\t\treturn stage;\n\t}\n\n\treturn {\n\t\t...stage,\n\t\tvisits: ensureArray(stage.visits).map((visit) => cloneVisit(visit)),\n\t};\n};\n\nconst parseTimestamp = (value) => {\n\tconst ts = Date.parse(value);\n\treturn Number.isNaN(ts) ? null : ts;\n};\n\nconst getVisitSortTimestamp = (visit) => {\n\tconst checkIn = parseTimestamp(visit?.check_in_at);\n\tif (checkIn !== null) {\n\t\treturn checkIn;\n\t}\n\n\tconst created = parseTimestamp(visit?.created_at);\n\tif (created !== null) {\n\t\treturn created;\n\t}\n\n\tconst updated = parseTimestamp(visit?.updated_at);\n\treturn updated !== null ? updated : Number.MAX_SAFE_INTEGER;\n};\n\nconst sortVisitsFifo = (visits) =>\n\tensureArray(visits)\n\t\t.slice()\n\t\t.sort((a, b) => {\n\t\t\tconst timeDiff = getVisitSortTimestamp(a) - getVisitSortTimestamp(b);\n\t\t\tif (timeDiff !== 0) {\n\t\t\t\treturn timeDiff;\n\t\t\t}\n\n\t\t\tconst idDiff = (Number(a?.id) || 0) - (Number(b?.id) || 0);\n\t\t\treturn idDiff;\n\t\t});\n\nconst sortBoardStages = (board) => {\n\tif (!board || typeof board !== 'object') {\n\t\treturn board;\n\t}\n\n\tconst sortedStages = ensureArray(board.stages).map((stage) => ({\n\t\t...stage,\n\t\tvisits: sortVisitsFifo(stage?.visits),\n\t}));\n\n\treturn {\n\t\t...board,\n\t\tstages: sortedStages,\n\t};\n};\n\nconst getDefaultExpandedStage = (board) => {\n\tconst stages = ensureArray(board?.stages);\n\tconst firstWithVisits = stages.find((stage) => ensureArray(stage?.visits).length > 0);\n\tif (firstWithVisits) {\n\t\treturn safeString(firstWithVisits.key ?? firstWithVisits.stage_key ?? '');\n\t}\n\treturn safeString(stages[0]?.key ?? stages[0]?.stage_key ?? '');\n};\n\nconst evaluateLayoutMode = (root) => {\n\tif (!root) {\n\t\treturn 'horizontal';\n\t}\n\n\tconst minColumnWidth = 260;\n\tconst columnGap = 24;\n\tconst requiredForThree = minColumnWidth * 3 + columnGap * 2;\n\tconst width = root.clientWidth || window.innerWidth || 0;\n\n\treturn width < requiredForThree ? 'vertical' : 'horizontal';\n};\n\nconst syncLayoutMode = (root) => {\n\tconst state = store.getState();\n\tconst board = state.board;\n\tconst requestedMode = evaluateLayoutMode(root);\n\tconst stageKeys = ensureArray(board?.stages).map((stage) => safeString(stage?.key ?? stage?.stage_key ?? ''));\n\tconst wasVertical = state.layout?.mode === 'vertical';\n\tlet expandedStage = state.layout?.expandedStage ?? '';\n\n\tif (requestedMode === 'vertical') {\n\t\tif (expandedStage && !stageKeys.includes(expandedStage)) {\n\t\t\tconst fallback = getDefaultExpandedStage(board);\n\t\t\tif (fallback) {\n\t\t\t\texpandedStage = fallback;\n\t\t\t}\n\t\t} else if (!expandedStage && !wasVertical) {\n\t\t\tconst fallback = getDefaultExpandedStage(board);\n\t\t\tif (fallback) {\n\t\t\t\texpandedStage = fallback;\n\t\t\t}\n\t\t}\n\t} else {\n\t\texpandedStage = '';\n\t}\n\n\tif (requestedMode !== state.layout.mode || expandedStage !== state.layout.expandedStage) {\n\t\tsetLayoutState({\n\t\t\tmode: requestedMode,\n\t\t\texpandedStage,\n\t\t});\n\t}\n\n\treturn {\n\t\tmode: requestedMode,\n\t\texpandedStage,\n\t};\n};\n\nconst buildStageMap = (stages) => {\n\tconst map = new Map();\n\n\tensureArray(stages).forEach((stage) => {\n\t\tconst key = safeString(stage?.key ?? stage?.stage_key);\n\t\tif (!key) {\n\t\t\treturn;\n\t\t}\n\n\t\tmap.set(key, cloneStage(stage));\n\t});\n\n\treturn map;\n};\n\nconst applyBoardPatch = (currentBoard, patchBoard) => {\n\tif (!patchBoard || typeof patchBoard !== 'object') {\n\t\treturn sortBoardStages(currentBoard);\n\t}\n\n\tif (!currentBoard || typeof currentBoard !== 'object') {\n\t\treturn sortBoardStages(patchBoard);\n\t}\n\n\tconst currentStageMap = buildStageMap(currentBoard.stages);\n\tconst patchStageMap = buildStageMap(patchBoard.stages);\n\n\tif (!patchStageMap.size) {\n\t\treturn sortBoardStages({\n\t\t\t...currentBoard,\n\t\t\t...patchBoard,\n\t\t\tstages: ensureArray(currentBoard.stages).map((stage) => cloneStage(stage)),\n\t\t});\n\t}\n\n\tconst changedVisitIds = new Set();\n\tpatchStageMap.forEach((stage) => {\n\t\tensureArray(stage.visits).forEach((visit) => {\n\t\t\tif (visit && (visit.id || visit.id === 0)) {\n\t\t\t\tchangedVisitIds.add(Number(visit.id));\n\t\t\t}\n\t\t});\n\t});\n\n\t// Remove any changed visits from the current map so we can merge in the new records.\n\tif (changedVisitIds.size) {\n\t\tcurrentStageMap.forEach((stage, key) => {\n\t\t\tif (!stage) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst filtered = ensureArray(stage.visits).filter((visit) => {\n\t\t\t\tif (!visit || (visit.id === undefined || visit.id === null)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn !changedVisitIds.has(Number(visit.id));\n\t\t\t});\n\n\t\t\tcurrentStageMap.set(key, {\n\t\t\t\t...stage,\n\t\t\t\tvisits: filtered,\n\t\t\t});\n\t\t});\n\t}\n\n\tpatchStageMap.forEach((stage, key) => {\n\t\tconst existing = currentStageMap.get(key);\n\t\tconst existingVisits = ensureArray(existing?.visits).map((visit) => cloneVisit(visit));\n\t\tconst patchVisits = ensureArray(stage.visits).map((visit) => cloneVisit(visit));\n\n\t\tconst mergedStage = {\n\t\t\t...(existing ?? {}),\n\t\t\t...stage,\n\t\t\tvisits: [...existingVisits, ...patchVisits],\n\t\t};\n\n\t\tcurrentStageMap.set(key, mergedStage);\n\t});\n\n\tconst mergedStages = Array.from(currentStageMap.values());\n\tmergedStages.sort((a, b) => {\n\t\tconst aOrder = toNumber(a?.sort_order) ?? 0;\n\t\tconst bOrder = toNumber(b?.sort_order) ?? 0;\n\t\treturn aOrder - bOrder;\n\t});\n\n\treturn sortBoardStages({\n\t\t...currentBoard,\n\t\t...patchBoard,\n\t\tstages: mergedStages,\n\t});\n};\n\nconst findVisitById = (board, visitId) => {\n\tconst normalizedId = Number(visitId);\n\tif (!board || Number.isNaN(normalizedId)) {\n\t\treturn null;\n\t}\n\n\tfor (const stage of ensureArray(board.stages)) {\n\t\tfor (const visit of ensureArray(stage.visits)) {\n\t\t\tif (Number(visit?.id) === normalizedId) {\n\t\t\t\treturn {\n\t\t\t\t\tstage,\n\t\t\t\t\tvisit,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n};\n\nconst formatDuration = (totalSeconds) => {\n\tif (!Number.isFinite(totalSeconds)) {\n\t\treturn '>1m';\n\t}\n\n\tconst seconds = Math.max(0, Math.floor(totalSeconds));\n\tconst hours = Math.floor(seconds / 3600);\n\tconst minutes = Math.floor((seconds % 3600) / 60);\n\tconst remainingSeconds = seconds % 60;\n\n\tif (seconds < 60) {\n\t\treturn '>1m';\n\t}\n\n\tif (hours >= 1) {\n\t\treturn `${hours}h ${minutes.toString().padStart(2, '0')}m`;\n\t}\n\n\tif (minutes >= 1) {\n\t\treturn `${minutes}m`;\n\t}\n\n\treturn `${remainingSeconds}s`;\n};\n\nconst formatTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst date = new Date(isoString);\n\tif (Number.isNaN(date.getTime())) {\n\t\treturn '';\n\t}\n\n\treturn date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });\n};\n\nconst formatDateForLastUpdated = (isoString) => formatTime(isoString);\n\nconst formatDateTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst date = new Date(isoString);\n\tif (Number.isNaN(date.getTime())) {\n\t\treturn '';\n\t}\n\n\treturn date.toLocaleString([], {\n\t\thour: 'numeric',\n\t\tminute: '2-digit',\n\t\tmonth: 'short',\n\t\tday: 'numeric',\n\t\tyear: 'numeric',\n\t});\n};\n\nconst humanizeRelativeTime = (isoString) => {\n\tif (!isoString) {\n\t\treturn '';\n\t}\n\n\tconst target = new Date(isoString);\n\tif (Number.isNaN(target.getTime())) {\n\t\treturn '';\n\t}\n\n\tconst now = new Date();\n\tconst deltaSeconds = Math.round((now.getTime() - target.getTime()) / 1000);\n\n\tif (deltaSeconds < 10) {\n\t\treturn 'just now';\n\t}\n\n\tif (deltaSeconds < 60) {\n\t\treturn `${deltaSeconds}s ago`;\n\t}\n\n\tconst minutes = Math.round(deltaSeconds / 60);\n\tif (minutes < 60) {\n\t\treturn `${minutes} min${minutes === 1 ? '' : 's'} ago`;\n\t}\n\n\tconst hours = Math.round(minutes / 60);\n\tif (hours < 24) {\n\t\treturn `${hours} hr${hours === 1 ? '' : 's'} ago`;\n\t}\n\n\tconst days = Math.round(hours / 24);\n\treturn `${days} day${days === 1 ? '' : 's'} ago`;\n};\n\nconst getTimerState = (seconds, thresholds = {}) => {\n\tconst yellow = toNumber(thresholds.yellow) ?? 0;\n\tconst red = toNumber(thresholds.red) ?? 0;\n\n\tif (red > 0 && seconds >= red) {\n\t\treturn 'critical';\n\t}\n\n\tif (yellow > 0 && seconds >= yellow) {\n\t\treturn 'warning';\n\t}\n\n\treturn 'on-track';\n};\n\nconst buildCapacityHint = (capacity = {}, count = 0) => {\n\tconst soft = toNumber(capacity.soft);\n\tconst hard = toNumber(capacity.hard);\n\n\tif (Number.isFinite(hard) && count > hard) {\n\t\treturn 'Hard limit exceeded';\n\t}\n\n\tif (Number.isFinite(soft) && count > soft) {\n\t\treturn 'At capacity';\n\t}\n\n\tif (Number.isFinite(soft) && soft > 0) {\n\t\tconst remaining = Math.max(0, soft - count);\n\n\t\tif (remaining > 1) {\n\t\t\treturn `${remaining} slots open`;\n\t\t}\n\n\t\tif (remaining === 1) {\n\t\t\treturn '1 slot open';\n\t\t}\n\n\t\treturn 'Fully booked';\n\t}\n\n\treturn 'Flexible capacity';\n};\n\nconst extractPrimaryPhoto = (photos) => {\n\tconst list = ensureArray(photos);\n\tif (!list.length) {\n\t\treturn null;\n\t}\n\n\tconst first = list[0];\n\tif (!first || typeof first !== 'object') {\n\t\treturn null;\n\t}\n\n\tif (first.url) {\n\t\treturn { url: first.url, alt: safeString(first.alt) };\n\t}\n\n\tif (first.sizes) {\n\t\tconst candidate = first.sizes.thumbnail?.url || first.sizes.medium?.url || first.sizes.full?.url;\n\t\tif (candidate) {\n\t\t\treturn { url: candidate, alt: safeString(first.alt) };\n\t\t}\n\t}\n\n\treturn null;\n};\n\nconst getPlaceholderPhoto = (visit) => {\n\tif (!placeholderPhotos.length) {\n\t\treturn null;\n\t}\n\n\tconst visitId = Number(visit?.id);\n\tconst index = Number.isFinite(visitId) ? Math.abs(visitId) % placeholderPhotos.length : 0;\n\tconst url = placeholderPhotos[index];\n\tconst clientName = safeString(visit?.client?.name ?? strings.unknownClient);\n\treturn {\n\t\turl,\n\t\talt: clientName ? `${clientName} placeholder photo` : strings.unknownClient,\n\t};\n};\n\nconst getVisitPhoto = (visit) => extractPrimaryPhoto(visit?.photos) ?? visit?.client?.main_photo ?? getPlaceholderPhoto(visit);\n\nconst loadImageForCanvas = async (file) => {\n\tif (!file) {\n\t\tthrow new Error('Missing file');\n\t}\n\n\tif (window.createImageBitmap) {\n\t\ttry {\n\t\t\tconst bitmap = await createImageBitmap(file);\n\t\t\treturn {\n\t\t\t\tsource: bitmap,\n\t\t\t\twidth: bitmap.width,\n\t\t\t\theight: bitmap.height,\n\t\t\t\tcleanup: () => {\n\t\t\t\t\tif (typeof bitmap.close === 'function') {\n\t\t\t\t\t\tbitmap.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t} catch (error) {\n\t\t\t// Fall back to Image element loader below.\n\t\t}\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst url = URL.createObjectURL(file);\n\t\tconst image = new Image();\n\t\timage.onload = () => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\tresolve({\n\t\t\t\tsource: image,\n\t\t\t\twidth: image.naturalWidth || image.width,\n\t\t\t\theight: image.naturalHeight || image.height,\n\t\t\t\tcleanup: () => {},\n\t\t\t});\n\t\t};\n\t\timage.onerror = (error) => {\n\t\t\tURL.revokeObjectURL(url);\n\t\t\treject(error || new Error('Unable to load image'));\n\t\t};\n\t\timage.src = url;\n\t});\n};\n\nconst normalizeImageFile = async (file, options = {}) => {\n\tif (!(file instanceof File) || typeof file.type !== 'string' || !file.type.startsWith('image/')) {\n\t\treturn file;\n\t}\n\n\tconst maxDimension = Number(options.maxDimension ?? 1600);\n\tconst maxBytes = Number(options.maxBytes ?? 1.8 * 1024 * 1024);\n\tconst baseQuality = Number(options.quality ?? 0.82);\n\tconst image = await loadImageForCanvas(file);\n\tconst largestSide = Math.max(image.width, image.height);\n\n\tif (!largestSide) {\n\t\timage.cleanup();\n\t\treturn file;\n\t}\n\n\tconst scale = largestSide > maxDimension ? maxDimension / largestSide : 1;\n\tconst targetWidth = Math.max(1, Math.round(image.width * scale));\n\tconst targetHeight = Math.max(1, Math.round(image.height * scale));\n\tconst canvas = document.createElement('canvas');\n\tcanvas.width = targetWidth;\n\tcanvas.height = targetHeight;\n\n\tconst ctx = canvas.getContext('2d');\n\tif (!ctx) {\n\t\treturn file;\n\t}\n\n\tctx.drawImage(image.source, 0, 0, targetWidth, targetHeight);\n\n\tconst mimeType = file.type === 'image/png' ? 'image/png' : 'image/jpeg';\n\tconst toBlob = (quality) =>\n\t\tnew Promise((resolve, reject) => {\n\t\t\tcanvas.toBlob(\n\t\t\t\t(blob) => {\n\t\t\t\t\tif (blob) {\n\t\t\t\t\t\tresolve(blob);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(new Error('Unable to process image'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmimeType,\n\t\t\t\tquality\n\t\t\t);\n\t\t});\n\n\tlet quality = mimeType === 'image/png' ? 0.92 : baseQuality;\n\tlet blob = await toBlob(quality);\n\tlet attempts = 0;\n\n\twhile (blob && blob.size > maxBytes && quality > 0.5 && attempts < 5) {\n\t\tquality = Math.max(0.5, quality - 0.1);\n\t\tblob = await toBlob(quality);\n\t\tattempts += 1;\n\t}\n\n\tif (blob && blob.size > maxBytes && scale === 1) {\n\t\tconst compressionScale = Math.sqrt(maxBytes / blob.size);\n\t\tconst scaledWidth = Math.max(1, Math.round(targetWidth * compressionScale));\n\t\tconst scaledHeight = Math.max(1, Math.round(targetHeight * compressionScale));\n\t\tcanvas.width = scaledWidth;\n\t\tcanvas.height = scaledHeight;\n\t\tctx.clearRect(0, 0, scaledWidth, scaledHeight);\n\t\tctx.drawImage(image.source, 0, 0, scaledWidth, scaledHeight);\n\t\tblob = await toBlob(quality);\n\t}\n\n\tif (!blob) {\n\t\timage.cleanup();\n\t\treturn file;\n\t}\n\n\timage.cleanup();\n\n\tconst baseName = file.name.replace(/\\.[^.]+$/, '') || 'photo';\n\tconst extension = mimeType === 'image/png' ? 'png' : 'jpg';\n\n\treturn new File([blob], `${baseName}.${extension}`, {\n\t\ttype: mimeType,\n\t\tlastModified: Date.now(),\n\t});\n};\n\nconst buildServiceSummary = (services) =>\n\tensureArray(services)\n\t\t.map((service) => safeString(service?.name))\n\t\t.filter(Boolean)\n\t\t.join(', ');\n\nconst applyAppearanceTheme = (root) => {\n\tif (!root) {\n\t\treturn;\n\t}\n\n\tconst setColor = (token, value) => {\n\t\tif (typeof value === 'string' && value) {\n\t\t\troot.style.setProperty(token, value);\n\t\t}\n\t};\n\n\tsetColor('--bbgf-accent', appearanceColors.accent);\n\tsetColor('--bbgf-card-bg', appearanceColors.card);\n\tsetColor('--bbgf-column-bg', appearanceColors.column);\n\tsetColor('--bbgf-background-start', appearanceColors.background_start);\n\tsetColor('--bbgf-background-end', appearanceColors.background_end);\n\tsetColor('--bbgf-text', appearanceColors.text);\n\tif (appearanceColors.text) {\n\t\tsetColor('--bbgf-muted', appearanceColors.text);\n\t\tsetColor('--bbgf-muted-soft', appearanceColors.text);\n\t}\n\tsetColor('--bbgf-warning', appearanceColors.timer_warning);\n\tsetColor('--bbgf-critical', appearanceColors.timer_critical);\n\tsetColor('--bbgf-flag', appearanceColors.flag);\n};\n\nconst escapeHtml = (value) => {\n\treturn safeString(value).replace(/[&<>\"']/g, (char) => {\n\t\tswitch (char) {\n\t\t\tcase '&':\n\t\t\t\treturn '&amp;';\n\t\t\tcase '<':\n\t\t\t\treturn '&lt;';\n\t\t\tcase '>':\n\t\t\t\treturn '&gt;';\n\t\t\tcase '\"':\n\t\t\t\treturn '&quot;';\n\t\t\tcase \"'\":\n\t\t\t\treturn '&#039;';\n\t\t\tdefault:\n\t\t\t\treturn char;\n\t\t}\n\t});\n};\n\nconst buildModalFormFromVisit = (visit) => {\n if (!visit || typeof visit !== 'object') {\n \treturn {\n \t\tinstructions: '',\n \t\tpublicNotes: '',\n \t\tprivateNotes: '',\n \t\tservices: [],\n \t};\n }\n\n return {\n \tinstructions: safeString(visit.instructions ?? ''),\n \tpublicNotes: safeString(visit.public_notes ?? ''),\n \tprivateNotes: safeString(visit.private_notes ?? ''),\n \tservices: ensureArray(visit.services)\n \t\t.map((service) => Number(service?.id))\n \t\t.filter((id) => Number.isFinite(id)),\n };\n};\n\nconst visitMatchesQuery = (visit, query) => {\n\tif (!visit) {\n\t\treturn false;\n\t}\n\n\tconst haystack = [\n\t\tvisit.client?.name,\n\t\tvisit.client?.breed,\n\t\tvisit.guardian?.first_name,\n\t\tvisit.guardian?.last_name,\n\t\tvisit.guardian?.email,\n\t\tvisit.guardian?.phone,\n\t\tvisit.instructions,\n\t\tvisit.public_notes,\n\t\tvisit.private_notes,\n\t]\n\t\t.concat(ensureArray(visit.services).map((service) => service?.name))\n\t\t.concat(ensureArray(visit.flags).map((flag) => flag?.name))\n\t\t.filter(Boolean)\n\t\t.map((value) => String(value).toLowerCase());\n\n\treturn haystack.some((value) => value.includes(query));\n};\n\nconst getStageNeighbors = (board, stageKey) => {\n\tconst stages = ensureArray(board?.stages);\n\tconst index = stages.findIndex((stage) => stage.key === stageKey);\n\tif (index === -1) {\n\t\treturn { prev: null, next: null };\n\t}\n\n\treturn {\n\t\tprev: index > 0 ? stages[index - 1] : null,\n\t\tnext: index < stages.length - 1 ? stages[index + 1] : null,\n\t};\n};\n\nconst getBoardFilterOptions = (board) => {\n\tconst servicesMap = new Map();\n\tconst flagsMap = new Map();\n\n\tensureArray(board?.stages).forEach((stage) => {\n\t\tensureArray(stage.visits).forEach((visit) => {\n\t\t\tensureArray(visit.services).forEach((service) => {\n\t\t\t\tconst id = Number(service?.id);\n\t\t\t\tif (!Number.isFinite(id) || servicesMap.has(id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tservicesMap.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\tname: safeString(service?.name ?? ''),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tensureArray(visit.flags).forEach((flag) => {\n\t\t\t\tconst id = Number(flag?.id);\n\t\t\t\tif (!Number.isFinite(id) || flagsMap.has(id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tflagsMap.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\tname: safeString(flag?.name ?? ''),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tensureArray(visit.client?.flags).forEach((flag) => {\n\t\t\t\tconst id = Number(flag?.id);\n\t\t\t\tif (!Number.isFinite(id) || flagsMap.has(id)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tflagsMap.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\tname: safeString(flag?.name ?? ''),\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n\n\tconst services = Array.from(servicesMap.values()).sort((a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }));\n\tconst flags = Array.from(flagsMap.values()).sort((a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }));\n\n\treturn { services, flags };\n};\n\nconst formatCountdownSeconds = (targetTimestamp) => {\n\tif (!targetTimestamp) {\n\t\treturn '';\n\t}\n\n\tconst delta = Math.round((targetTimestamp - Date.now()) / 1000);\n\tif (delta <= 0) {\n\t\treturn '0s';\n\t}\n\n\tif (delta < 60) {\n\t\treturn `${delta}s`;\n\t}\n\n\tconst minutes = Math.floor(delta / 60);\n\tconst seconds = delta % 60;\n\treturn `${minutes}m ${seconds.toString().padStart(2, '0')}s`;\n};\n\nlet overflowResizeHandler = null;\n\nconst applyBoardOverflowState = (wrapper, layoutMode, boardMode) => {\n\tif (!wrapper) {\n\t\treturn;\n\t}\n\n\twindow.requestAnimationFrame(() => {\n\t\tconst overflowing = wrapper.scrollWidth > wrapper.clientWidth + 2;\n\t\tconst shouldCenter = layoutMode === 'horizontal' && boardMode !== 'display';\n\t\twrapper.classList.toggle('bbgf-board--overflowing', overflowing);\n\t\twrapper.classList.toggle('bbgf-board--centered', shouldCenter && !overflowing);\n\t\tif (overflowing) {\n\t\t\twrapper.scrollLeft = 0;\n\t\t}\n\t});\n};\n\nconst formatCheckIn = (isoString) => {\n\tconst time = formatTime(isoString);\n\treturn time ? `${strings.checkIn} ${time}` : '';\n};\n\nconst resolveTimerSeconds = (visit) => {\n\tconst raw = toNumber(visit?.timer_elapsed_seconds);\n\tconst maxReasonableSeconds = 60 * 60 * 24 * 14; // 14 days.\n\n\tif (Number.isFinite(raw) && raw >= 0 && raw <= maxReasonableSeconds) {\n\t\treturn raw;\n\t}\n\n\tconst startIso = visit?.timer_started_at || visit?.check_in_at;\n\tif (startIso) {\n\t\tconst startDate = new Date(startIso);\n\t\tif (!Number.isNaN(startDate.getTime())) {\n\t\t\treturn Math.max(0, Math.round((Date.now() - startDate.getTime()) / 1000));\n\t\t}\n\t}\n\n\treturn Number.isFinite(raw) && raw >= 0 ? raw : 0;\n};\n\nconst createStore = (initialState = {}) => {\n\tlet state = { ...initialState };\n\tconst listeners = new Set();\n\n\treturn {\n\t\tgetState: () => state,\n\t\tsetState: (updater) => {\n\t\t\tconst nextState = typeof updater === 'function' ? updater(state) : updater;\n\t\t\tif (!nextState || typeof nextState !== 'object') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tstate = { ...state, ...nextState };\n\t\t\tlisteners.forEach((listener) => {\n\t\t\t\ttry {\n\t\t\t\t\tlistener(state);\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.error('[BBGF] store listener error', error);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsubscribe: (listener) => {\n\t\t\tif (typeof listener !== 'function') {\n\t\t\t\treturn () => {};\n\t\t\t}\n\n\t\t\tlisteners.add(listener);\n\t\t\treturn () => listeners.delete(listener);\n\t\t},\n\t};\n};\n\nconst createApiClient = (rest = {}, context = {}) => {\n\tconst fallbackNonce = window?.wpApiSettings?.nonce || '';\n\tconst buildHeaders = () => {\n\t\tconst headers = {\n\t\t\tAccept: 'application/json',\n\t\t};\n\n\t\tif (rest.nonce || fallbackNonce) {\n\t\t\theaders['X-WP-Nonce'] = rest.nonce || fallbackNonce;\n\t\t}\n\n\t\treturn headers;\n\t};\n\n\tconst buildUrl = (endpoint, params = {}) => {\n\t\tif (!endpoint) {\n\t\t\treturn '';\n\t\t}\n\n\t\tconst url = new URL(endpoint, window.location.origin);\n\t\tObject.entries(params).forEach(([key, value]) => {\n\t\t\tif (value === undefined || value === null || value === '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\turl.searchParams.append(key, value);\n\t\t});\n\n\t\treturn url.toString();\n\t};\n\n\tconst fetchBoard = async (params = {}) => {\n\t\tconst query = { ...params };\n\t\tif (context.publicToken) {\n\t\t\tquery.public_token = context.publicToken;\n\t\t}\n\n\t\tconst url = buildUrl(rest.endpoints?.board, query);\n\t\tif (!url) {\n\t\t\tthrow new Error('Board endpoint unavailable');\n\t\t}\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Board request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchVisit = async (visitId, params = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst query = { ...params };\n\t\tif (context.publicToken && !query.public_token) {\n\t\t\tquery.public_token = context.publicToken;\n\t\t}\n\n\t\tif (context.view && !query.view) {\n\t\t\tquery.view = context.view;\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}`, query);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Visit request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst moveVisit = async (visitId, toStage, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}/move`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tto_stage: toStage,\n\t\t\t\tcomment: payload.comment ?? '',\n\t\t\t}),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Move failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst checkoutVisit = async (visitId, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}/checkout`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tcomment: payload.comment ?? '',\n\t\t\t}),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Checkout failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst updateVisit = async (visitId, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'PATCH',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Update failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst createVisit = async (payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(endpoint);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Create failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// Ignore parse errors.\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst searchIntake = async (query = '') => {\n\t\tconst endpoint = rest.endpoints?.intakeSearch;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Intake search endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(endpoint, {\n\t\t\tquery,\n\t\t});\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Search failed with status ${response.status}`);\n\t\t}\n\n\t\tconst data = await response.json();\n\t\treturn data?.items ?? [];\n\t};\n\n\tconst addPhoto = async (visitId, file, visibleToGuardian = true) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}/photo`);\n\t\tconst formData = new FormData();\n\t\tformData.append('visible_to_guardian', visibleToGuardian ? '1' : '0');\n\t\tformData.append('file', file);\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: formData,\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Photo upload failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst updatePhoto = async (visitId, photoId, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.visits;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Visit endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(visitId)}/photo/${encodeURIComponent(photoId)}`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'PATCH',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Photo update failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchServices = async () => {\n\t\tconst endpoint = rest.endpoints?.services;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Services endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(endpoint, {\n\t\t\tper_page: 100,\n\t\t\tcontext: 'view',\n\t\t});\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Services request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchFlags = async () => {\n\t\tconst endpoint = rest.endpoints?.flags;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Flags endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(endpoint, {\n\t\t\tper_page: 100,\n\t\t\tcontext: 'view',\n\t\t});\n\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tthrow new Error(`Flags request failed with status ${response.status}`);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst updateClient = async (clientId, payload = {}) => {\n\t\tconst endpoint = rest.endpoints?.clients;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Clients endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(clientId)}`);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'PATCH',\n\t\t\theaders: {\n\t\t\t\t...buildHeaders(),\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t},\n\t\t\tcredentials: 'same-origin',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `Client update failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\tconst fetchClientHistory = async (clientId, params = {}) => {\n\t\tconst endpoint = rest.endpoints?.clients;\n\t\tif (!endpoint) {\n\t\t\tthrow new Error('Clients endpoint unavailable');\n\t\t}\n\n\t\tconst url = buildUrl(`${endpoint}/${encodeURIComponent(clientId)}/history`, params);\n\t\tconst response = await fetch(url, {\n\t\t\tmethod: 'GET',\n\t\t\theaders: buildHeaders(),\n\t\t\tcredentials: 'same-origin',\n\t\t});\n\n\t\tif (!response.ok) {\n\t\t\tlet message = `History request failed with status ${response.status}`;\n\t\t\ttry {\n\t\t\t\tconst data = await response.json();\n\t\t\t\tif (data?.message) {\n\t\t\t\t\tmessage = data.message;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// ignore\n\t\t\t}\n\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\treturn response.json();\n\t};\n\n\treturn {\n\t\tfetchBoard,\n\t\tfetchVisit,\n\t\tmoveVisit,\n\t\tcheckoutVisit,\n\t\tupdateVisit,\n\t\tcreateVisit,\n\t\tsearchIntake,\n\t\taddPhoto,\n\t\tupdatePhoto,\n\t\tfetchServices,\n\t\tfetchFlags,\n\t\tupdateClient,\n\t\tfetchClientHistory,\n\t};\n};\n\nconst createCardElement = (visit, stage, options) => {\n\tconst { copy, previous, next, canMove, pendingMoves, readonly, draggingVisitId, presentation = {} } = options;\n\n\tconst stageKey = safeString(stage.key ?? stage.stage_key ?? '');\n\tconst card = document.createElement('article');\n\tcard.className = 'bbgf-card';\n\tcard.dataset.visitId = String(visit.id ?? '');\n\tcard.dataset.stage = stageKey;\n\tcard.dataset.updatedAt = safeString(visit.updated_at ?? '');\n\tcard.setAttribute('role', 'listitem');\n\tcard.setAttribute('aria-label', safeString(visit.client?.name ?? copy.unknownClient));\n\n\tif (!readonly && settings.capabilities?.moveStages) {\n\t\tcard.setAttribute('draggable', 'true');\n\t\tcard.classList.add('bbgf-card--draggable');\n\t} else {\n\t\tcard.removeAttribute('draggable');\n\t\tcard.classList.remove('bbgf-card--draggable');\n\t}\n\n\tconst visitIdNumber = Number(visit.id);\n\tconst isPending = pendingMoves?.has(visitIdNumber);\n\tconst isDragging = draggingVisitId !== null && visitIdNumber === Number(draggingVisitId);\n\tcard.classList.toggle('bbgf-card--pending', Boolean(isPending));\n\tcard.classList.toggle('is-dragging', Boolean(isDragging));\n\tcard.setAttribute('aria-grabbed', isDragging ? 'true' : 'false');\n\n\tconst timerSeconds = resolveTimerSeconds(visit);\n\tconst timerState = getTimerState(timerSeconds, stage.timer_thresholds ?? {});\n\tcard.classList.add(`bbgf-card--timer-${timerState}`);\n\n\tconst photoWrapper = document.createElement('div');\n\tphotoWrapper.className = 'bbgf-card-photo';\n\tphotoWrapper.setAttribute('aria-hidden', 'true');\n\n\tconst photoData = getVisitPhoto(visit);\n\tif (photoData && photoData.url) {\n\t\tconst img = document.createElement('img');\n\t\timg.src = photoData.url;\n\t\timg.alt = photoData.alt || safeString(visit.client?.name ?? copy.unknownClient);\n\t\tphotoWrapper.appendChild(img);\n\t} else {\n\t\tconst fallback = document.createElement('span');\n\t\tfallback.textContent = (safeString(visit.client?.name ?? copy.unknownClient).charAt(0) || 'ðŸ¾').toUpperCase();\n\t\tphotoWrapper.appendChild(fallback);\n\t}\n\n\tconst body = document.createElement('div');\n\tbody.className = 'bbgf-card-body';\n\n\tconst topRow = document.createElement('div');\n\ttopRow.className = 'bbgf-card-top';\n\ttopRow.appendChild(photoWrapper);\n\n\tconst info = document.createElement('div');\n\tinfo.className = 'bbgf-card-info';\n\n\tconst name = document.createElement('p');\n\tname.className = 'bbgf-card-name';\n\tname.textContent = safeString(visit.client?.name ?? copy.unknownClient);\n\tinfo.appendChild(name);\n\n\tconst breed = safeString(visit.client?.breed ?? '');\n\tif (breed) {\n\t\tconst breedLine = document.createElement('p');\n\t\tbreedLine.className = 'bbgf-card-breed';\n\t\tbreedLine.textContent = breed;\n\t\tinfo.appendChild(breedLine);\n\t}\n\n\tconst visitFlags = ensureArray(visit.flags);\n\tconst clientFlags = ensureArray(visit.client?.flags);\n\tconst combinedFlags = [];\n\tconst seenFlagIds = new Set();\n\t[...visitFlags, ...clientFlags].forEach((flag) => {\n\t\tconst id = Number(flag?.id ?? flag);\n\t\tif (!Number.isFinite(id) || seenFlagIds.has(id)) {\n\t\t\treturn;\n\t\t}\n\t\tseenFlagIds.add(id);\n\t\tcombinedFlags.push(flag);\n\t});\n\n\tif (combinedFlags.length && showFlagsSetting) {\n\t\tconst flagsWrapper = document.createElement('div');\n\t\tflagsWrapper.className = 'bbgf-card-flags';\n\t\tflagsWrapper.setAttribute('aria-label', copy.flags);\n\n\t\tcombinedFlags.forEach((flag) => {\n\t\t\tconst chip = document.createElement('span');\n\t\t\tchip.className = 'bbgf-flag-chip';\n\n\t\t\tconst emoji = document.createElement('span');\n\t\t\temoji.setAttribute('aria-hidden', 'true');\n\t\t\temoji.textContent = safeString(flag.emoji);\n\t\t\tchip.appendChild(emoji);\n\n\t\t\tconst nameSpan = document.createElement('span');\n\t\t\tnameSpan.textContent = safeString(flag.name);\n\t\t\tchip.appendChild(nameSpan);\n\n\t\t\tflagsWrapper.appendChild(chip);\n\t\t});\n\n\t\tinfo.appendChild(flagsWrapper);\n\t}\n\n\ttopRow.appendChild(info);\n\tbody.appendChild(topRow);\n\n\tconst timerRow = document.createElement('div');\n\ttimerRow.className = 'bbgf-card-meta';\n\n\tconst timer = document.createElement('span');\n\ttimer.className = 'bbgf-card-timer';\n\ttimer.dataset.state = timerState;\n\ttimer.dataset.seconds = String(timerSeconds);\n\ttimer.dataset.baseSeconds = String(timerSeconds);\n\ttimer.dataset.yellow = String(toNumber(stage.timer_thresholds?.yellow) ?? '');\n\ttimer.dataset.red = String(toNumber(stage.timer_thresholds?.red) ?? '');\n\ttimer.textContent = formatDuration(timerSeconds);\n\ttimerRow.appendChild(timer);\n\n\tconst checkInText = formatCheckIn(visit.check_in_at);\n\tif (checkInText) {\n\t\tconst checkInSpan = document.createElement('span');\n\t\tcheckInSpan.className = 'bbgf-card-checkin';\n\t\tcheckInSpan.textContent = checkInText;\n\t\ttimerRow.appendChild(checkInSpan);\n\t}\n\n\tbody.appendChild(timerRow);\n\n\tconst services = ensureArray(visit.services);\n\tif (services.length && showServicesSetting) {\n\t\tconst servicesWrapper = document.createElement('div');\n\t\tservicesWrapper.className = 'bbgf-card-services';\n\t\tservicesWrapper.setAttribute('aria-label', copy.services);\n\n\t\tservices.forEach((service) => {\n\t\t\tconst chip = document.createElement('span');\n\t\t\tchip.className = 'bbgf-service-chip';\n\t\t\tchip.setAttribute('aria-hidden', 'true');\n\n\t\t\tconst icon = safeString(service.icon);\n\t\t\tconst label = safeString(service.name);\n\t\t\tchip.textContent = icon && icon !== label ? `${icon} ${label}` : label;\n\n\t\t\tservicesWrapper.appendChild(chip);\n\t\t});\n\n\t\tbody.appendChild(servicesWrapper);\n\t}\n\n\tcard.appendChild(body);\n\n\treturn card;\n};\n\nconst createColumnElement = (stage, options) => {\n\tconst {\n\t\tcopy,\n\t\tprevious,\n\t\tnext,\n\t\tcanMove,\n\t\tpendingMoves,\n\t\treadonly,\n\t\tdraggingVisitId,\n\t\tsearchActive,\n\t\tpresentation = {},\n\t\tlayoutMode = 'horizontal',\n\t\texpandedStage,\n\t} = options;\n\n\tconst stageKey = safeString(stage.key ?? stage.stage_key ?? '');\n\tconst label = safeString(stage.label ?? stageKey);\n\tconst visits = ensureArray(stage.visits);\n\tconst count = visits.length;\n\tconst isVertical = layoutMode === 'vertical';\n\tconst isExpanded = !isVertical || (expandedStage && expandedStage === stageKey);\n\n\tconst column = document.createElement('section');\n\tcolumn.className = 'bbgf-column';\n\tcolumn.dataset.stage = stageKey;\n\tcolumn.dataset.visitCount = String(count);\n\tcolumn.dataset.expanded = isExpanded ? 'true' : 'false';\n\tcolumn.setAttribute('role', 'listitem');\n\tcolumn.setAttribute('aria-label', label);\n\tcolumn.setAttribute('aria-dropeffect', readonly ? 'none' : 'move');\n\n\tif (isVertical && !isExpanded) {\n\t\tcolumn.classList.add('bbgf-column--collapsed');\n\t}\n\n\tconst header = document.createElement('header');\n\theader.className = 'bbgf-column-header';\n\n\tconst title = document.createElement('div');\n\ttitle.className = 'bbgf-column-title';\n\n\tconst labelSpan = document.createElement('span');\n\tlabelSpan.className = 'bbgf-column-label';\n\tlabelSpan.textContent = label;\n\ttitle.appendChild(labelSpan);\n\n\tconst countSpan = document.createElement('span');\n\tcountSpan.className = 'bbgf-column-count';\n\tcountSpan.textContent = String(count);\n\tcountSpan.setAttribute('aria-label', String(count));\n\ttitle.appendChild(countSpan);\n\n\tconst toggle = document.createElement('button');\n\ttoggle.type = 'button';\n\ttoggle.className = 'bbgf-column-toggle';\n\ttoggle.dataset.role = 'bbgf-column-toggle';\n\ttoggle.dataset.stage = stageKey;\n\ttoggle.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\n\ttoggle.appendChild(title);\n\theader.appendChild(toggle);\n\n\tcolumn.appendChild(header);\n\n\tconst body = document.createElement('div');\n\tbody.className = 'bbgf-column-body';\n\tbody.setAttribute('role', 'list');\n\tbody.setAttribute('aria-label', `${label} column cards`);\n\tif (isVertical && !isExpanded) {\n\t\tbody.setAttribute('hidden', 'hidden');\n\t} else {\n\t\tbody.removeAttribute('hidden');\n\t}\n\n\tif (!visits.length) {\n\t\tconst empty = document.createElement('p');\n\t\tempty.className = 'bbgf-column-empty';\n\t\tempty.textContent = searchActive ? copy.noVisits : copy.emptyColumn;\n\t\tbody.appendChild(empty);\n\t} else {\n\t\tvisits.forEach((visit) => {\n\t\t\tconst card = createCardElement(visit, stage, {\n\t\t\t\tcopy,\n\t\t\t\tprevious,\n\t\t\t\tnext,\n\t\t\t\tcanMove,\n\t\t\t\tpendingMoves,\n\t\t\t\treadonly,\n\t\t\t\tdraggingVisitId,\n\t\t\t\tpresentation,\n\t\t\t});\n\t\t\tbody.appendChild(card);\n\t\t});\n\t}\n\n\tcolumn.appendChild(body);\n\n\treturn column;\n};\n\nconst getActiveViewSlug = (state) =>\n\tstate.viewOverride ||\n\tstate.board?.view?.slug ||\n\tsettings.context?.view ||\n\tsettings.view?.slug ||\n\t'';\n\nconst buildActionDock = (state, board, copy, ui) => {\n\treturn null;\n};\n\nconst renderBoard = (state, root, config, copy) => {\n\troot.classList.add('bbgf-board--bootstrapped');\n\n\tconst layoutState = syncLayoutMode(root);\n\tconst layoutMode = layoutState?.mode || state.layout?.mode || 'horizontal';\n\tconst expandedStage = layoutState?.expandedStage || state.layout?.expandedStage || '';\n\n\tconst board = state.board;\n\tif (!board) {\n\t\troot.innerHTML = '';\n\t\tconst loading = document.createElement('div');\n\t\tloading.className = 'bbgf-board-loading';\n\t\tloading.textContent = copy.loading;\n\t\troot.appendChild(loading);\n\t\treturn;\n\t}\n\n\tconst ui = resolvePresentationConfig(board);\n\tcurrentPresentation = ui;\n\n\tconst preservedModal = root.querySelector('#bbgf-modal');\n\tconst preservedIntakeModal = root.querySelector('#bbgf-intake-modal');\n\n\troot.dataset.readonly = board.readonly ? 'true' : 'false';\n\troot.dataset.isPublic = board.is_public ? 'true' : 'false';\n\troot.dataset.activeView = getActiveViewSlug(state);\n\tconst viewType = safeString(board.view?.type ?? '');\n\troot.dataset.viewType = viewType;\n\troot.dataset.boardMode = ui.mode;\n\troot.dataset.layoutMode = layoutMode;\n\troot.dataset.expandedStage = expandedStage || '';\n\n\tif (board.readonly) {\n\t\troot.classList.add('bbgf-board--readonly');\n\t} else {\n\t\troot.classList.remove('bbgf-board--readonly');\n\t}\n\n\tif (ui.mode === 'display') {\n\t\troot.classList.add('bbgf-board-wrapper--display');\n\t} else {\n\t\troot.classList.remove('bbgf-board-wrapper--display');\n\t}\n\n\troot.innerHTML = '';\n\trenderErrors(state, root, copy);\n\n\tconst columnsWrapper = document.createElement('div');\n\tcolumnsWrapper.className = 'bbgf-board';\n\tcolumnsWrapper.setAttribute('role', 'list');\n\tcolumnsWrapper.dataset.layoutMode = layoutMode;\n\tcolumnsWrapper.dataset.expandedStage = expandedStage || '';\n\n\tconst filtersActive = false;\n\tconst baseStages = ensureArray(board.stages);\n\n\tconst filterVisit = (visit) => {\n\t\tif (!visit) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tconst stages = baseStages.map((stage) => ({\n\t\t...stage,\n\t\tvisits: ensureArray(stage.visits).filter(filterVisit),\n\t}));\n\n\troot.dataset.searchActive = filtersActive ? 'true' : 'false';\n\tif (!stages.length) {\n\t\tconst empty = document.createElement('p');\n\t\tempty.className = 'bbgf-board-empty';\n\t\tempty.textContent = copy.noVisits;\n\t\tcolumnsWrapper.appendChild(empty);\n\t} else {\n\t\tconst pendingSet = new Set(ensureArray(state.pendingMoves).map((id) => Number(id)));\n\t\tconst draggingVisitId = state.drag?.isDragging ? state.drag.visitId : null;\n\n\t\tstages.forEach((stage, index) => {\n\t\t\tconst previous = stages[index - 1] || null;\n\t\t\tconst next = stages[index + 1] || null;\n\t\t\tconst column = createColumnElement(stage, {\n\t\t\t\tcopy,\n\t\t\t\tprevious,\n\t\t\t\tnext,\n\t\t\t\tcanMove: Boolean(config.capabilities?.moveStages) && !board.readonly,\n\t\t\t\tpendingMoves: pendingSet,\n\t\t\t\treadonly: board.readonly,\n\t\t\t\tdraggingVisitId,\n\t\t\t\tsearchActive: filtersActive,\n\t\t\t\tpresentation: ui,\n\t\t\t\tlayoutMode,\n\t\t\t\texpandedStage,\n\t\t\t});\n\t\t\tcolumnsWrapper.appendChild(column);\n\t\t});\n\t}\n\n\troot.appendChild(columnsWrapper);\n\n\tconst reapplyOverflow = () => applyBoardOverflowState(columnsWrapper, layoutMode, ui.mode);\n\treapplyOverflow();\n\tif (typeof window !== 'undefined') {\n\t\tif (overflowResizeHandler) {\n\t\t\twindow.removeEventListener('resize', overflowResizeHandler);\n\t\t}\n\t\toverflowResizeHandler = () => reapplyOverflow();\n\t\twindow.addEventListener('resize', overflowResizeHandler, { passive: true });\n\t}\n\tstartTimerTicker(root);\n\n\tconst existingControls = root.querySelector('.bbgf-floating-controls');\n\tif (!existingControls) {\n\t\tconst controls = document.createElement('div');\n\t\tcontrols.className = 'bbgf-floating-controls';\n\n\t\tif (settings.capabilities?.editVisits && currentPresentation.mode !== 'display') {\n\t\t\tconst intakeButton = document.createElement('button');\n\t\t\tintakeButton.type = 'button';\n\t\t\tintakeButton.className = 'bbgf-icon-button bbgf-intake-button';\n\t\t\tintakeButton.dataset.role = 'bbgf-intake-open';\n\t\t\tintakeButton.setAttribute('aria-label', strings.addVisit || strings.intakeTitle);\n\t\t\tintakeButton.innerHTML = `<span aria-hidden=\"true\">ï¼‹</span><span class=\"screen-reader-text\">${escapeHtml(strings.intakeTitle)}</span>`;\n\t\t\tcontrols.appendChild(intakeButton);\n\t\t}\n\n\t\tconst refreshButton = document.createElement('button');\n\t\trefreshButton.type = 'button';\n\t\trefreshButton.className = 'bbgf-icon-button bbgf-refresh-button';\n\t\trefreshButton.setAttribute('aria-label', copy.refresh);\n\t\trefreshButton.textContent = 'âŸ³';\n\t\tif (state.isLoading) {\n\t\t\trefreshButton.setAttribute('disabled', 'disabled');\n\t\t\trefreshButton.classList.add('is-disabled');\n\t\t}\n\t\tcontrols.appendChild(refreshButton);\n\n\t\tif (ui.showFullscreen) {\n\t\t\tconst fullscreenToggle = document.createElement('button');\n\t\t\tfullscreenToggle.type = 'button';\n\t\t\tfullscreenToggle.className = 'bbgf-icon-button bbgf-toolbar-fullscreen';\n\t\t\tfullscreenToggle.dataset.role = 'bbgf-fullscreen-toggle';\n\t\t\tfullscreenToggle.setAttribute('aria-label', copy.fullscreen);\n\t\t\tfullscreenToggle.textContent = 'â›¶';\n\t\t\tcontrols.appendChild(fullscreenToggle);\n\t\t}\n\n\t\troot.appendChild(controls);\n\t}\n\n\tconst existingModal = preservedModal || root.querySelector('#bbgf-modal');\n\tif (existingModal) {\n\t\t// Preserve the existing modal DOM to avoid losing form state while the board re-renders.\n\t\troot.appendChild(existingModal);\n\t} else {\n\t\tconst modal = document.createElement('div');\n\t\tmodal.id = 'bbgf-modal';\n\t\tmodal.setAttribute('hidden', 'hidden');\n\t\tmodal.className = 'bbgf-modal';\n\t\tmodal.innerHTML = `\n\t\t\t<div class=\"bbgf-modal__backdrop\" data-role=\"bbgf-modal-backdrop\"></div>\n\t\t\t<div class=\"bbgf-modal__dialog\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"bbgf-modal-title\">\n\t\t\t\t<header class=\"bbgf-modal__header\">\n\t\t\t\t\t<div class=\"bbgf-modal__heading\">\n\t\t\t\t\t\t<h2 id=\"bbgf-modal-title\" class=\"bbgf-modal__title\">${copy.modalTitle}</h2>\n\t\t\t\t\t\t<span class=\"bbgf-modal__badge\" data-role=\"bbgf-modal-readonly\" hidden>${copy.modalReadOnly}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-modal__header-actions\">\n\t\t\t\t\t\t<div class=\"bbgf-modal__nav\" data-role=\"bbgf-modal-nav\"></div>\n\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-modal__close\" data-role=\"bbgf-modal-close\" aria-label=\"${copy.modalClose}\">&times;</button>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<nav class=\"bbgf-modal__tabs\" data-role=\"bbgf-modal-tabs\"></nav>\n\t\t\t\t<div class=\"bbgf-modal__body\" data-role=\"bbgf-modal-body\">\n\t\t\t\t\t<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`.trim();\n\t\troot.appendChild(modal);\n\t}\n\n\tconst intakeModalExisting = preservedIntakeModal || root.querySelector('#bbgf-intake-modal');\n\tif (intakeModalExisting) {\n\t\troot.appendChild(intakeModalExisting);\n\t} else {\n\t\tconst intakeModal = document.createElement('div');\n\t\tintakeModal.id = 'bbgf-intake-modal';\n\t\tintakeModal.setAttribute('hidden', 'hidden');\n\t\tintakeModal.className = 'bbgf-modal bbgf-intake-modal';\n\t\tintakeModal.innerHTML = `\n\t\t\t<div class=\"bbgf-modal__backdrop\" data-role=\"bbgf-intake-close\"></div>\n\t\t\t<div class=\"bbgf-modal__dialog\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"bbgf-intake-title\">\n\t\t\t\t<header class=\"bbgf-modal__header\">\n\t\t\t\t\t<div class=\"bbgf-modal__heading\">\n\t\t\t\t\t\t<h2 id=\"bbgf-intake-title\" class=\"bbgf-modal__title\">${escapeHtml(strings.intakeTitle)}</h2>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-intake-header-actions\" data-role=\"bbgf-intake-header-actions\">\n\t\t\t\t\t\t<div class=\"bbgf-intake-selected--header\" data-role=\"bbgf-intake-selected-slot\"></div>\n\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-intake-submit\">${escapeHtml(strings.intakeSubmit)}</button>\n\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-modal__close\" data-role=\"bbgf-intake-close\" aria-label=\"${escapeHtml(strings.modalClose)}\">&times;</button>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t<div class=\"bbgf-modal__body bbgf-intake-body\" data-role=\"bbgf-intake-body\">\n\t\t\t\t\t<p class=\"bbgf-modal__loading\">${escapeHtml(strings.loading)}</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bbgf-modal__actions bbgf-intake-actions\" data-role=\"bbgf-intake-actions\"></div>\n\t\t\t</div>\n\t\t`.trim();\n\t\troot.appendChild(intakeModal);\n\t}\n\n\tconst lastUpdatedNode = root.querySelector('[data-role=\"bbgf-last-updated\"]');\n\tif (lastUpdatedNode) {\n\t\tlastUpdatedNode.dataset.timestamp = safeString(board.last_updated ?? state.lastFetchedAt ?? '');\n\t}\n};\n\nconst handleToolbarSearchInput = (event) => {\n\tconst value = event.target.value ?? '';\n\tsetFilters({ query: value });\n};\n\nconst handleFilterChange = (event) => {\n\tconst role = event.target.dataset.role;\n\tif (!role) {\n\t\treturn;\n\t}\n\n\tconst selectedValues = Array.from(event.target.selectedOptions || [])\n\t\t.map((option) => Number(option.value))\n\t\t.filter((value) => Number.isFinite(value));\n\n\tif (role === 'bbgf-filter-services') {\n\t\tsetFilters({ services: selectedValues });\n\t} else if (role === 'bbgf-filter-flags') {\n\t\tsetFilters({ flags: selectedValues });\n\t}\n};\n\nconst handleFilterReset = () => {\n\tsetFilters({ query: '', services: [], flags: [] });\n};\n\nconst dismissError = () => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\terrors: ensureArray(state.errors).slice(0, -1),\n\t}));\n\n\tif (toastTimer) {\n\t\twindow.clearTimeout(toastTimer);\n\t\ttoastTimer = null;\n\t}\n\n\tconst container = boardRootElement?.querySelector('#bbgf-board-errors');\n\tif (container) {\n\t\tcontainer.classList.remove('is-active');\n\t}\n};\n\nconst renderErrors = (state, root, copy) => {\n\tconst existing = root.querySelector('#bbgf-board-errors');\n\tconst message = ensureArray(state.errors).slice(-1)[0];\n\n\tif (!message) {\n\t\tif (existing) {\n\t\t\texisting.remove();\n\t\t}\n\t\tif (toastTimer) {\n\t\t\twindow.clearTimeout(toastTimer);\n\t\t\ttoastTimer = null;\n\t\t}\n\t\treturn;\n\t}\n\n\tlet container = existing;\n\tif (!container) {\n\t\tcontainer = document.createElement('div');\n\t\tcontainer.id = 'bbgf-board-errors';\n\t\tcontainer.className = 'bbgf-toast';\n\t\tcontainer.innerHTML = `\n\t\t\t<p class=\"bbgf-toast__message\"></p>\n\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--ghost bbgf-toast__dismiss\" data-role=\"bbgf-toast-dismiss\" aria-label=\"${escapeHtml(\n\t\t\t\tcopy.modalClose\n\t\t\t)}\">Ã—</button>\n\t\t`;\n\t\tcontainer.querySelector('[data-role=\"bbgf-toast-dismiss\"]').addEventListener('click', dismissError);\n\t\troot.appendChild(container);\n\t}\n\n\tconst messageNode = container.querySelector('.bbgf-toast__message');\n\tif (messageNode) {\n\t\tmessageNode.textContent = message;\n\t}\n\n\tcontainer.classList.add('is-active');\n\n\tif (toastTimer) {\n\t\twindow.clearTimeout(toastTimer);\n\t}\n\n\ttoastTimer = window.setTimeout(() => {\n\t\tcontainer?.classList.remove('is-active');\n\t\tdismissError();\n\t}, 6000);\n};\n\nconst attachToolbarHandlers = (root) => {\n\tconst refreshButton = root.querySelector('.bbgf-refresh-button');\n\tif (refreshButton && !refreshButton.dataset.bound) {\n\t\trefreshButton.addEventListener('click', () => {\n\t\t\tif (refreshButton.disabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tloadBoard({ reason: 'manual', forceFull: true });\n\t\t});\n\t\trefreshButton.dataset.bound = 'true';\n\t}\n\n\tfullscreenButton = root.querySelector('[data-role=\"bbgf-fullscreen-toggle\"]') || fullscreenButton;\n\tif (fullscreenButton && fullscreenButton.dataset.bound !== 'true') {\n\t\tfullscreenButton.addEventListener('click', toggleFullscreen);\n\t\tfullscreenButton.dataset.bound = 'true';\n\t\tupdateFullscreenButton();\n\t}\n};\n\nconst updateToolbarStates = (root, state) => {\n\tconst refreshButton = root.querySelector('.bbgf-refresh-button');\n\tif (refreshButton) {\n\t\tif (state.isLoading) {\n\t\t\trefreshButton.setAttribute('disabled', 'disabled');\n\t\t\trefreshButton.classList.add('is-disabled');\n\t\t} else {\n\t\t\trefreshButton.removeAttribute('disabled');\n\t\t\trefreshButton.classList.remove('is-disabled');\n\t\t}\n\t}\n\n\tfullscreenButton = root.querySelector('[data-role=\"bbgf-fullscreen-toggle\"]') || fullscreenButton;\n\tupdateFullscreenButton();\n};\n\nconst setupLastUpdatedTicker = (root) => {\n\tconst targets = Array.from(root.querySelectorAll('[data-role=\"bbgf-last-updated\"]'));\n\tif (!targets.length) {\n\t\tif (root._bbgfLastUpdatedInterval) {\n\t\t\twindow.clearInterval(root._bbgfLastUpdatedInterval);\n\t\t\troot._bbgfLastUpdatedInterval = null;\n\t\t}\n\t\treturn;\n\t}\n\n\tconst update = () => {\n\t\ttargets.forEach((node) => {\n\t\t\tconst base = node.dataset.timestamp;\n\t\t\tconst humanized = humanizeRelativeTime(base);\n\t\t\tnode.textContent = base ? `${strings.lastUpdated} ${humanized || formatDateForLastUpdated(base)}` : strings.lastUpdated;\n\t\t});\n\n\t\tconst refreshNode = root.querySelector('[data-role=\"bbgf-next-refresh\"]');\n\t\tif (refreshNode) {\n\t\t\tconst countdown = formatCountdownSeconds(store.getState().nextRefreshAt);\n\t\t\trefreshNode.textContent = countdown ? `${strings.autoRefresh} ${countdown}` : `${strings.autoRefresh} â€¦`;\n\t\t}\n\t};\n\n\tif (root._bbgfLastUpdatedInterval) {\n\t\twindow.clearInterval(root._bbgfLastUpdatedInterval);\n\t}\n\n\tupdate();\n\troot._bbgfLastUpdatedInterval = window.setInterval(update, 15000);\n};\n\nconst startTimerTicker = (root) => {\n\t// Timers are now server-driven and refreshed via polling; render once without intervals.\n\tconst timers = root.querySelectorAll('.bbgf-card-timer');\n\ttimers.forEach((node) => {\n\t\tconst total = Math.max(0, Number(node.dataset.baseSeconds ?? node.dataset.seconds ?? 0));\n\t\tnode.textContent = formatDuration(total);\n\n\t\tconst yellow = toNumber(node.dataset.yellow);\n\t\tconst red = toNumber(node.dataset.red);\n\t\tconst state = getTimerState(total, { yellow, red });\n\t\tnode.dataset.state = state;\n\t\tconst card = node.closest('.bbgf-card');\n\t\tif (card) {\n\t\t\tcard.classList.remove('bbgf-card--timer-on-track', 'bbgf-card--timer-warning', 'bbgf-card--timer-critical');\n\t\t\tcard.classList.remove('bbgf-card--overdue', 'bbgf-card--capacity-warning');\n\t\t\tcard.classList.add(`bbgf-card--timer-${state}`);\n\t\t\tif (state === 'critical') {\n\t\t\t\tcard.classList.add('bbgf-card--overdue');\n\t\t\t} else if (state === 'warning') {\n\t\t\t\tcard.classList.add('bbgf-card--capacity-warning');\n\t\t\t}\n\t\t}\n\t});\n};\n\nconst announce = (message) => {\n\tif (message && window.wp?.a11y?.speak) {\n\t\twindow.wp.a11y.speak(message, 'polite');\n\t}\n};\n\nconst resolveDefaultStageKey = (board) => {\n\tconst stages = ensureArray(board?.stages);\n\tif (!stages.length) {\n\t\treturn '';\n\t}\n\tconst raw = stages[0]?.key ?? stages[0]?.stage_key ?? stages[0]?.id ?? '';\n\treturn safeString(raw).toLowerCase();\n};\n\nconst getDefaultIntakeState = (board) => ({\n\tisOpen: false,\n\tisSaving: false,\n\terror: '',\n\tactiveTab: 'search',\n\tsearchQuery: '',\n\tsearchResults: [],\n\tselected: null,\n\tguardian: {\n\t\tid: null,\n\t\tfirst_name: '',\n\t\tlast_name: '',\n\t\temail: '',\n\t\tphone: '',\n\t\tpreferred_contact: '',\n\t\tnotes: '',\n\t},\n\tclient: {\n\t\tid: null,\n\t\tname: '',\n\t\tbreed: '',\n\t\tweight: '',\n\t\ttemperament: '',\n\t\tnotes: '',\n\t\tguardian_id: null,\n\t},\n\tvisit: {\n\t\tview_id: board?.view?.id ?? null,\n\t\tcurrent_stage: resolveDefaultStageKey(board),\n\t\tinstructions: '',\n\t\tpublic_notes: '',\n\t},\n});\n\nconst initialState = {\n\tboard: sortBoardStages(settings.initialBoard || null),\n\tisLoading: false,\n\terrors: [],\n\tlastFetchedAt: null,\n\tviewOverride: '',\n\tpendingMoves: [],\n\tfilters: {\n\t\tquery: '',\n\t\tservices: [],\n\t\tflags: [],\n\t},\n\tnextRefreshAt: null,\n\tdrag: {\n\t\tisDragging: false,\n\t\tvisitId: null,\n\t\tfromStage: '',\n\t},\n\tlayout: {\n\t\tmode: 'horizontal',\n\t\texpandedStage: '',\n\t},\n\tmodal: {\n\t\tisOpen: false,\n\t\tvisitId: null,\n\t\tloading: false,\n\t\tvisit: null,\n\t\treadOnly: false,\n\t\tactiveTab: 'summary',\n\t\tisSaving: false,\n\t\tclientFlags: [],\n\t\tform: {\n\t\t\tinstructions: '',\n\t\t\tpublicNotes: '',\n\t\t\tprivateNotes: '',\n\t\t\tservices: [],\n\t\t},\n\t\terror: '',\n\t\tpendingUploads: [],\n\t\tisPreparingUploads: false,\n\t\thistory: {\n\t\t\titems: [],\n\t\t\tpage: 1,\n\t\t\tperPage: 5,\n\t\t\thasMore: false,\n\t\t\tloaded: false,\n\t\t\tloading: false,\n\t\t\terror: '',\n\t\t},\n\t},\n\tintake: getDefaultIntakeState(settings.initialBoard || null),\n\tcatalog: {\n\t\tservices: {\n\t\t\titems: [],\n\t\t\tisLoading: false,\n\t\t\tloaded: false,\n\t\t\terror: '',\n\t\t},\n\t\tflags: {\n\t\t\titems: [],\n\t\t\tisLoading: false,\n\t\t\tloaded: false,\n\t\t\terror: '',\n\t\t},\n\t},\n};\n\nconst store = createStore(initialState);\nconst api = createApiClient(settings.rest || {}, settings.context || {});\n\nconst setModalState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst modal = typeof updater === 'function' ? updater(state.modal, state) : { ...state.modal, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tmodal: modal,\n\t\t};\n\t});\n};\n\nconst preparePhotoUploads = async (files) => {\n\tconst token = ++photoPreparationToken;\n\tconst list = Array.isArray(files) ? files : [];\n\n\tsetModalState((modal) => ({\n\t\t...modal,\n\t\tisPreparingUploads: true,\n\t\terror: '',\n\t\tpendingUploads: [],\n\t}));\n\n\tif (!list.length) {\n\t\tsetModalState((modal) => ({\n\t\t\t...modal,\n\t\t\tisPreparingUploads: false,\n\t\t\tpendingUploads: [],\n\t\t}));\n\t\treturn;\n\t}\n\n\ttry {\n\t\tconst normalized = [];\n\t\tfor (const file of list) {\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tnormalized.push(await normalizeImageFile(file));\n\t\t}\n\n\t\tif (token !== photoPreparationToken) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetModalState((modal) => ({\n\t\t\t...modal,\n\t\t\tpendingUploads: normalized,\n\t\t\tisPreparingUploads: false,\n\t\t}));\n\t} catch (error) {\n\t\tif (token !== photoPreparationToken) {\n\t\t\treturn;\n\t\t}\n\n\t\tsetModalState((modal) => ({\n\t\t\t...modal,\n\t\t\tpendingUploads: [],\n\t\t\tisPreparingUploads: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t}\n};\n\nconst setIntakeState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst intake = typeof updater === 'function' ? updater(state.intake, state) : { ...state.intake, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tintake,\n\t\t};\n\t});\n};\n\nconst setLayoutState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst layout = typeof updater === 'function' ? updater(state.layout, state) : { ...state.layout, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tlayout,\n\t\t};\n\t});\n};\n\nconst setDragState = (updater) => {\n\tstore.setState((state) => {\n\t\tconst drag = typeof updater === 'function' ? updater(state.drag, state) : { ...state.drag, ...updater };\n\t\treturn {\n\t\t\t...state,\n\t\t\tdrag,\n\t\t};\n\t});\n};\n\nconst setFilters = (partial) => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\tfilters: {\n\t\t\t...state.filters,\n\t\t\t...partial,\n\t\t},\n\t}));\n};\n\nconst setNextRefreshAt = (timestamp) => {\n\tstore.setState((state) => ({\n\t\t...state,\n\t\tnextRefreshAt: timestamp,\n\t}));\n};\n\nconst ensureServicesCatalog = async () => {\n\tif (!settings.capabilities?.manageServices) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.catalog.services.loaded || state.catalog.services.isLoading) {\n\t\treturn;\n\t}\n\n\tstore.setState((current) => ({\n\t\tcatalog: {\n\t\t\t...current.catalog,\n\t\t\tservices: {\n\t\t\t\t...current.catalog.services,\n\t\t\t\tisLoading: true,\n\t\t\t\terror: '',\n\t\t\t},\n\t\t},\n\t}));\n\n\ttry {\n\t\tconst services = await api.fetchServices();\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tservices: {\n\t\t\t\t\titems: services,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: true,\n\t\t\t\t\terror: '',\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t} catch (error) {\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tservices: {\n\t\t\t\t\titems: ensureArray(current.catalog.services.items),\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: false,\n\t\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t}\n};\n\nconst ensureFlagsCatalog = async () => {\n\tconst state = store.getState();\n\tif (state.catalog.flags.loaded || state.catalog.flags.isLoading) {\n\t\treturn;\n\t}\n\n\tstore.setState((current) => ({\n\t\tcatalog: {\n\t\t\t...current.catalog,\n\t\t\tflags: {\n\t\t\t\t...current.catalog.flags,\n\t\t\t\tisLoading: true,\n\t\t\t\terror: '',\n\t\t\t},\n\t\t},\n\t}));\n\n\ttry {\n\t\tconst flags = await api.fetchFlags();\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tflags: {\n\t\t\t\t\titems: flags,\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: true,\n\t\t\t\t\terror: '',\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t} catch (error) {\n\t\tstore.setState((current) => ({\n\t\t\tcatalog: {\n\t\t\t\t...current.catalog,\n\t\t\t\tflags: {\n\t\t\t\t\titems: ensureArray(current.catalog.flags.items),\n\t\t\t\t\tisLoading: false,\n\t\t\t\t\tloaded: false,\n\t\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t\t},\n\t\t\t},\n\t\t}));\n\t}\n};\n\nconst loadClientHistory = async ({ page = 1, append = false } = {}) => {\n\tconst state = store.getState();\n\tconst { modal } = state;\n\tconst visit = modal.visit;\n\tif (!visit?.client?.id) {\n\t\treturn;\n\t}\n\n\tconst perPage = modal.history?.perPage || 5;\n\n\tsetModalState((current) => ({\n\t\t...current,\n\t\thistory: {\n\t\t\t...current.history,\n\t\t\tloading: true,\n\t\t\terror: '',\n\t\t\titems: append ? current.history.items : [],\n\t\t},\n\t}));\n\n\ttry {\n\t\tconst data = await api.fetchClientHistory(visit.client.id, {\n\t\t\tpage,\n\t\t\tper_page: perPage,\n\t\t\texclude_visit: visit.id,\n\t\t});\n\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\thistory: {\n\t\t\t\t...current.history,\n\t\t\t\titems: append ? [...ensureArray(current.history.items), ...ensureArray(data.items)] : ensureArray(data.items),\n\t\t\t\tpage: data.page ?? page,\n\t\t\t\tperPage,\n\t\t\t\thasMore: Boolean(data.has_more),\n\t\t\t\tloaded: true,\n\t\t\t\tloading: false,\n\t\t\t\terror: '',\n\t\t\t},\n\t\t}));\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\thistory: {\n\t\t\t\t...current.history,\n\t\t\t\tloading: false,\n\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t},\n\t\t}));\n\t}\n};\n\nconst ensureClientHistory = () => {\n\tconst state = store.getState();\n\tif (state.modal.history.loaded || state.modal.history.loading) {\n\t\treturn;\n\t}\n\n\tloadClientHistory({ page: 1, append: false });\n};\n\nconst updateModalFormField = (field, value) => {\n\tsetModalState((modal) => ({\n\t\t...modal,\n\t\tform: {\n\t\t\t...modal.form,\n\t\t\t[field]: value,\n\t\t},\n\t}));\n};\n\nconst toggleModalService = (serviceId, isChecked) => {\n\tsetModalState((modal) => {\n\t\tconst current = new Set(ensureArray(modal.form.services).map((id) => Number(id)));\n\t\tif (isChecked) {\n\t\t\tcurrent.add(serviceId);\n\t\t} else {\n\t\t\tcurrent.delete(serviceId);\n\t\t}\n\n\t\treturn {\n\t\t\t...modal,\n\t\t\tform: {\n\t\t\t\t...modal.form,\n\t\t\t\tservices: Array.from(current.values()),\n\t\t\t},\n\t\t};\n\t});\n};\n\nconst toggleClientFlag = (flagId, isChecked) => {\n\tsetModalState((modal) => {\n\t\tconst current = new Set(ensureArray(modal.clientFlags).map((id) => Number(id)));\n\t\tif (isChecked) {\n\t\t\tcurrent.add(flagId);\n\t\t} else {\n\t\t\tcurrent.delete(flagId);\n\t\t}\n\n\t\treturn {\n\t\t\t...modal,\n\t\t\tclientFlags: Array.from(current.values()),\n\t\t};\n\t});\n};\n\nconst saveClientFlags = async () => {\n\tconst state = store.getState();\n\tconst { modal, board } = state;\n\tif (!modal.visit?.client?.id || modal.readOnly || board?.readonly) {\n\t\treturn;\n\t}\n\n\tsetModalState((current) => ({\n\t\t...current,\n\t\tisSaving: true,\n\t\terror: '',\n\t}));\n\n\ttry {\n\t\tawait api.updateClient(modal.visit.client.id, { flags: modal.clientFlags });\n\t\tconst refreshed = await api.fetchVisit(modal.visitId, {\n\t\t\tview: getActiveViewSlug(store.getState()),\n\t\t});\n\n\t\tstore.setState((prev) => ({\n\t\t\tmodal: {\n\t\t\t\t...prev.modal,\n\t\t\t\tvisit: refreshed,\n\t\t\t\tclientFlags: ensureArray(refreshed?.client?.flags)\n\t\t\t\t\t.map((flag) => Number(flag?.id ?? flag))\n\t\t\t\t\t.filter((id) => Number.isFinite(id)),\n\t\t\t\terror: '',\n\t\t\t},\n\t\t}));\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t} finally {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t}));\n\t}\n};\n\nconst handleModalTabChange = (tabId) => {\n\tsetModalState((modal) => ({\n\t\t...modal,\n\t\tactiveTab: tabId,\n\t\terror: '',\n\t}));\n\n\tif (tabId === 'services') {\n\t\tensureServicesCatalog();\n\t}\n\n\tif (tabId === 'visit') {\n\t\tensureFlagsCatalog();\n\t}\n\n\tif (tabId === 'history') {\n\t\tensureClientHistory();\n\t}\n};\n\nconst handleModalMove = async (direction) => {\n\tconst state = store.getState();\n\tconst { modal, board } = state;\n\n\tif (!modal.visit || modal.isSaving || modal.readOnly || board?.readonly || !settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tconst neighbors = getStageNeighbors(board, modal.visit.current_stage);\n\tconst target = direction === 'prev' ? neighbors.prev?.key : neighbors.next?.key;\n\n\tif (!target || target === modal.visit.current_stage) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tawait moveVisitToStage(modal.visitId, target);\n\t\tawait openVisitModal(modal.visitId, { tab: modal.activeTab || 'summary' });\n\t} catch (error) {\n\t\tconst message = error?.message || strings.errorFetching || strings.loadingError;\n\t\tsetModalState({ error: message });\n\t\tannounce(message);\n\t} finally {\n\t\tsetModalState({ isSaving: false });\n\t}\n};\n\nconst handleModalCheckout = async () => {\n\tconst state = store.getState();\n\tconst { modal, board } = state;\n\n\tif (!modal.visitId || modal.isSaving || modal.readOnly || board?.readonly) {\n\t\treturn;\n\t}\n\n\tconst confirmed = window.confirm(strings.modalCheckoutConfirm || strings.modalCheckout);\n\tif (!confirmed) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tawait api.checkoutVisit(modal.visitId, {});\n\t\tcloseModal();\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tconst message = error?.message || strings.loadingError;\n\t\tsetModalState({ error: message, isSaving: false });\n\t\tannounce(message);\n\t\treturn;\n\t}\n\n\tsetModalState((current) => ({\n\t\t...current,\n\t\tisSaving: false,\n\t}));\n};\n\nconst refreshBoardAfterModalSave = () => {\n\tloadBoard({ reason: 'modal-save', forceFull: true });\n};\n\nconst handleModalPhotoUpload = async (button) => {\n\tconst container = button.closest('[data-role=\"bbgf-photo-upload\"]');\n\tconst fileInput = container?.querySelector('[data-role=\"bbgf-photo-file\"]');\n\tconst visibleCheckbox = container?.querySelector('[data-role=\"bbgf-photo-visible\"]');\n\tconst { modal } = store.getState();\n\tconst files = ensureArray(modal.pendingUploads);\n\tconst visible = visibleCheckbox ? Boolean(visibleCheckbox.checked) : true;\n\n\tif (modal.isPreparingUploads) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\terror: strings.modalPreparingUpload || strings.loadingError,\n\t\t}));\n\t\treturn;\n\t}\n\n\tif (!files.length || !modal.visitId) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tfor (const file of files) {\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait api.addPhoto(modal.visitId, file, visible);\n\t\t}\n\t\tif (fileInput) {\n\t\t\tfileInput.value = '';\n\t\t}\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tpendingUploads: [],\n\t\t\tisPreparingUploads: false,\n\t\t}));\n\t\tawait openVisitModal(modal.visitId, { tab: modal.activeTab || 'photos' });\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tconst message = error?.message || strings.loadingError;\n\t\tsetModalState({ error: message });\n\t\tannounce(message);\n\t} finally {\n\t\tsetModalState({ isSaving: false });\n\t}\n};\n\nconst handlePhotoVisibilityChange = async (photoId, visible) => {\n\tconst { modal } = store.getState();\n\tif (!modal.visitId) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\tsetModalState({ isSaving: true, error: '' });\n\t\tawait api.updatePhoto(modal.visitId, photoId, { visible_to_guardian: visible });\n\t\tawait openVisitModal(modal.visitId, { tab: modal.activeTab || 'photos' });\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tconst message = error?.message || strings.loadingError;\n\t\tsetModalState({ error: message });\n\t\tannounce(message);\n\t} finally {\n\t\tsetModalState({ isSaving: false });\n\t}\n};\n\nconst setPhotoAsPrimary = async (photoId) => {\n\tconst { modal } = store.getState();\n\tif (!modal.visitId) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\tsetModalState({ isSaving: true, error: '' });\n\t\tawait api.updatePhoto(modal.visitId, photoId, { is_primary: true });\n\t\tawait openVisitModal(modal.visitId, { tab: modal.activeTab || 'photos' });\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tconst message = error?.message || strings.loadingError;\n\t\tsetModalState({ error: message });\n\t\tannounce(message);\n\t} finally {\n\t\tsetModalState({ isSaving: false });\n\t}\n};\n\nconst openPhotoLightbox = (url) => {\n\tif (!url) {\n\t\treturn;\n\t}\n\n\tconst existing = document.querySelector('.bbgf-lightbox');\n\tif (existing) {\n\t\texisting.remove();\n\t}\n\n\tconst lightbox = document.createElement('div');\n\tlightbox.className = 'bbgf-lightbox';\n\tlightbox.innerHTML = `\n\t\t<div class=\"bbgf-lightbox__backdrop\" data-role=\"bbgf-lightbox-close\"></div>\n\t\t<div class=\"bbgf-lightbox__body\">\n\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-lightbox__close\" data-role=\"bbgf-lightbox-close\">${escapeHtml(strings.modalClose)}</button>\n\t\t\t<img src=\"${escapeHtml(url)}\" alt=\"\">\n\t\t</div>\n\t`;\n\n\tlightbox.addEventListener('click', (event) => {\n\t\tif (event.target.dataset.role === 'bbgf-lightbox-close') {\n\t\t\tlightbox.remove();\n\t\t}\n\t});\n\n\tdocument.body.appendChild(lightbox);\n};\n\nconst saveModalNotes = async () => {\n\tconst state = store.getState();\n\tconst { modal } = state;\n\tif (modal.readOnly || modal.isSaving) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tconst payload = {\n\t\t\tinstructions: modal.form.instructions,\n\t\t\tpublic_notes: modal.form.publicNotes,\n\t\t\tprivate_notes: modal.form.privateNotes,\n\t\t};\n\n\t\tconst updated = await api.updateVisit(modal.visitId, payload);\n\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\tvisit: updated,\n\t\t\tform: buildModalFormFromVisit(updated),\n\t\t\terror: '',\n\t\t}));\n\n\t\tannounce(strings.modalSave);\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t}\n};\n\nconst saveModalServices = async () => {\n\tconst state = store.getState();\n\tconst { modal } = state;\n\tif (modal.readOnly || modal.isSaving) {\n\t\treturn;\n\t}\n\n\tsetModalState({ isSaving: true, error: '' });\n\n\ttry {\n\t\tconst payload = {\n\t\t\tservices: ensureArray(modal.form.services).map((id) => Number(id)).filter((id) => Number.isFinite(id)),\n\t\t};\n\n\t\tconst updated = await api.updateVisit(modal.visitId, payload);\n\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\tvisit: updated,\n\t\t\tform: {\n\t\t\t\t...current.form,\n\t\t\t\tservices: ensureArray(updated.services)\n\t\t\t\t\t.map((service) => Number(service?.id))\n\t\t\t\t\t.filter((id) => Number.isFinite(id)),\n\t\t\t},\n\t\t\terror: '',\n\t\t}));\n\n\t\tannounce(strings.modalSave);\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetModalState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t}\n};\n\nconst handleModalSave = (section) => {\n\tswitch (section) {\n\t\tcase 'notes':\n\t\t\tsaveModalNotes();\n\t\t\tbreak;\n\t\tcase 'services':\n\t\t\tsaveModalServices();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t}\n};\n\nconst getPollIntervalMs = () => {\n\t// Fixed 30s polling for server-driven timers.\n\treturn 30 * 1000;\n};\n\nlet pollTimer = null;\nlet modalLastFocusedElement = null;\nlet boardRootElement = null;\nlet currentDragHoverStage = '';\nlet toastTimer = null;\nlet fullscreenButton = null;\nlet currentPresentation = { mode: 'interactive' };\nlet lastBoardStateRef = null;\nlet lastModalSnapshot = null;\nlet lastIntakeSnapshot = null;\nlet lastCatalogRef = null;\nlet lastErrorsRef = null;\nlet photoPreparationToken = 0;\nlet activeTouchDrag = null;\nlet intakeSearchTimer = null;\nlet layoutResizeTimer = null;\n\nconst updateFullscreenButton = () => {\n\tif (!fullscreenButton) {\n\t\treturn;\n\t}\n\n\tconst isFullscreen = Boolean(document.fullscreenElement);\n\tfullscreenButton.textContent = isFullscreen ? 'â¤¢' : 'â›¶';\n\tfullscreenButton.setAttribute('title', isFullscreen ? strings.exitFullscreen : strings.fullscreen);\n\tfullscreenButton.setAttribute('aria-pressed', isFullscreen ? 'true' : 'false');\n};\n\nconst toggleFullscreen = () => {\n\tconst root = boardRootElement;\n\tif (!root) {\n\t\treturn;\n\t}\n\n\tif (!document.fullscreenElement) {\n\t\troot.requestFullscreen?.();\n\t} else {\n\t\tdocument.exitFullscreen?.();\n\t}\n\n\tupdateFullscreenButton();\n};\n\nconst handleLayoutResize = () => {\n\tif (layoutResizeTimer) {\n\t\twindow.clearTimeout(layoutResizeTimer);\n\t}\n\n\tlayoutResizeTimer = window.setTimeout(() => {\n\t\tif (boardRootElement) {\n\t\t\tsyncLayoutMode(boardRootElement);\n\t\t}\n\t}, 120);\n};\n\nconst clearPollTimer = () => {\n\tif (pollTimer) {\n\t\twindow.clearTimeout(pollTimer);\n\t\tpollTimer = null;\n\t}\n};\n\nconst scheduleNextPoll = () => {\n\tclearPollTimer();\n\n\tconst delay = getPollIntervalMs();\n\tsetNextRefreshAt(Date.now() + delay);\n\tpollTimer = window.setTimeout(() => {\n\t\tloadBoard({ reason: 'poll' });\n\t}, delay);\n};\n\nconst loadBoard = async ({ reason = 'manual', forceFull = false, targetView } = {}) => {\n\tclearPollTimer();\n\tsetNextRefreshAt(null);\n\n\tconst currentState = store.getState();\n\tconst activeView = targetView || getActiveViewSlug(currentState);\n\tconst params = {};\n\n\tif (activeView) {\n\t\tparams.view = activeView;\n\t}\n\n\tconst useModifiedAfter = !forceFull && !!currentState.board?.last_updated;\n\tif (useModifiedAfter) {\n\t\tparams.modified_after = currentState.board.last_updated;\n\t}\n\n\tstore.setState({\n\t\tisLoading: true,\n\t});\n\n\ttry {\n\t\tconst response = await api.fetchBoard(params);\n\n\t\tstore.setState((state) => {\n\t\t\tconst mergedBoard = useModifiedAfter && state.board ? applyBoardPatch(state.board, response) : response;\n\t\t\tconst sortedBoard = sortBoardStages(mergedBoard);\n\n\t\t\treturn {\n\t\t\t\tboard: sortedBoard,\n\t\t\t\tisLoading: false,\n\t\t\t\terrors: [],\n\t\t\t\tlastFetchedAt: new Date().toISOString(),\n\t\t\t};\n\t\t});\n\t} catch (error) {\n\t\tconst message = error?.message || strings.errorFetching || strings.loadingError;\n\n\t\tstore.setState((state) => ({\n\t\t\tisLoading: false,\n\t\t\terrors: [...ensureArray(state.errors), message],\n\t\t}));\n\n\t\tannounce(strings.errorFetching || strings.loadingError);\n\t}\n\n\tscheduleNextPoll();\n};\n\nconst updatePendingMoves = (visitId, action = 'add') => {\n\tconst visitNumericId = Number(visitId);\n\tif (Number.isNaN(visitNumericId)) {\n\t\treturn;\n\t}\n\n\tstore.setState((state) => {\n\t\tconst existing = new Set(ensureArray(state.pendingMoves).map((id) => Number(id)));\n\n\t\tif (action === 'remove') {\n\t\t\texisting.delete(visitNumericId);\n\t\t} else {\n\t\t\texisting.add(visitNumericId);\n\t\t}\n\n\t\treturn {\n\t\t\tpendingMoves: Array.from(existing.values()),\n\t\t};\n\t});\n};\n\nconst moveVisitToStage = async (visitId, toStage) => {\n\tif (!toStage) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tif (state.pendingMoves?.includes(Number(visitId))) {\n\t\treturn;\n\t}\n\n\tupdatePendingMoves(visitId, 'add');\n\n\ttry {\n\t\tawait api.moveVisit(visitId, toStage);\n\t\tannounce(strings.moveSuccess);\n\t\tawait loadBoard({ reason: 'move', forceFull: true });\n\t} catch (error) {\n\t\tconst message = error?.message || strings.errorFetching || strings.loadingError;\n\t\tstore.setState((currentState) => ({\n\t\t\terrors: [...ensureArray(currentState.errors), message],\n\t\t}));\n\t\tannounce(message);\n\t} finally {\n\t\tupdatePendingMoves(visitId, 'remove');\n\t}\n};\n\nconst moveVisitWithDirection = (card, direction) => {\n\tconst visitId = Number(card.dataset.visitId);\n\tconst fromStage = safeString(card.dataset.stage);\n\tif (Number.isNaN(visitId) || !fromStage) {\n\t\treturn;\n\t}\n\n\tconst board = store.getState().board;\n\tconst { prev, next } = getStageNeighbors(board, fromStage);\n\tconst target = direction === 'prev' ? prev?.key : next?.key;\n\tif (!target || target === fromStage) {\n\t\treturn;\n\t}\n\n\tmoveVisitToStage(visitId, target);\n};\n\nconst handleQuickMove = async (button) => {\n\tconst card = button.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tconst visitId = Number(card.dataset.visitId);\n\tconst toStage = safeString(button.dataset.targetStage);\n\n\tif (Number.isNaN(visitId) || !toStage) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tbutton.disabled = true;\n\tbutton.classList.add('is-disabled');\n\n\tawait moveVisitToStage(visitId, toStage);\n\n\tbutton.disabled = false;\n\tbutton.classList.remove('is-disabled');\n};\n\nconst handleBoardClick = (event) => {\n\tconst columnToggle = event.target.closest('[data-role=\"bbgf-column-toggle\"]');\n\tif (columnToggle) {\n\t\tconst stageKey = safeString(columnToggle.dataset.stage);\n\t\tconst state = store.getState();\n\t\tconst layoutMode = state.layout?.mode || 'horizontal';\n\t\tconst stageKeys = ensureArray(state.board?.stages).map((stage) => safeString(stage?.key ?? stage?.stage_key ?? ''));\n\t\tif (layoutMode === 'vertical' && stageKey && stageKeys.includes(stageKey)) {\n\t\t\tsetLayoutState((current) => ({\n\t\t\t\t...current,\n\t\t\t\texpandedStage: current.expandedStage === stageKey ? '' : stageKey,\n\t\t\t}));\n\t\t}\n\t\treturn;\n\t}\n\n\tif (currentPresentation.mode === 'display') {\n\t\treturn;\n\t}\n\n\tconst intakeTrigger = event.target.closest('[data-role=\"bbgf-intake-open\"]');\n\tif (intakeTrigger) {\n\t\tevent.preventDefault();\n\t\topenIntakeModal();\n\t\treturn;\n\t}\n\n\tconst moveNext = event.target.closest('.bbgf-move-next');\n\tif (moveNext) {\n\t\tevent.preventDefault();\n\t\thandleQuickMove(moveNext);\n\t\treturn;\n\t}\n\n\tconst movePrev = event.target.closest('.bbgf-move-prev');\n\tif (movePrev) {\n\t\tevent.preventDefault();\n\t\thandleQuickMove(movePrev);\n\t\treturn;\n\t}\n\n\tconst card = event.target.closest('.bbgf-card');\n\tif (card) {\n\t\tconst visitId = Number(card.dataset.visitId);\n\t\tif (Number.isNaN(visitId)) {\n\t\t\treturn;\n\t\t}\n\n\t\tmodalLastFocusedElement = card;\n\t\topenVisitModal(visitId, { tab: 'summary' });\n\t}\n};\n\nconst resetIntakeState = () => {\n\tconst board = store.getState().board;\n\tsetIntakeState({ ...getDefaultIntakeState(board), isOpen: false });\n};\n\nconst openIntakeModal = () => {\n\tif (!settings.capabilities?.editVisits) {\n\t\treturn;\n\t}\n\tconst board = store.getState().board;\n\tsetIntakeState({ ...getDefaultIntakeState(board), isOpen: true, activeTab: 'search' });\n};\n\nconst closeIntakeModal = () => {\n\tsetIntakeState((current) => ({\n\t\t...current,\n\t\tisOpen: false,\n\t\tisSaving: false,\n\t\terror: '',\n\t}));\n};\n\nconst applyIntakeSelection = (item) => {\n\tconst board = store.getState().board;\n\tconst defaults = getDefaultIntakeState(board);\n\tconst guardian = item.guardian || {};\n\tconst client = item.client || {};\n\n\tsetIntakeState((current) => ({\n\t\t...current,\n\t\tselected: item,\n\t\tguardian: {\n\t\t\tid: guardian.id ?? null,\n\t\t\tfirst_name: guardian.first_name ?? '',\n\t\t\tlast_name: guardian.last_name ?? '',\n\t\t\temail: guardian.email ?? '',\n\t\t\tphone: guardian.phone_mobile ?? guardian.phone_alt ?? guardian.phone ?? '',\n\t\t\tpreferred_contact: guardian.preferred_contact ?? '',\n\t\t\tnotes: guardian.notes ?? '',\n\t\t},\n\t\tclient: {\n\t\t\t...current.client,\n\t\t\tid: client.id ?? null,\n\t\t\tname: client.name ?? '',\n\t\t\tbreed: client.breed ?? '',\n\t\t\tweight: client.weight ?? '',\n\t\t\ttemperament: client.temperament ?? '',\n\t\t\tnotes: client.notes ?? '',\n\t\t\tguardian_id: client.guardian_id ?? guardian.id ?? null,\n\t\t},\n\t\tvisit: {\n\t\t\t...current.visit,\n\t\t\tview_id: current.visit.view_id ?? defaults.visit.view_id,\n\t\t\tcurrent_stage: current.visit.current_stage || defaults.visit.current_stage,\n\t\t},\n\t\tactiveTab: 'guardian',\n\t}));\n};\n\nconst updateIntakeField = (section, field, value) => {\n\tif (!section || !field) {\n\t\treturn;\n\t}\n\tsetIntakeState((current) => ({\n\t\t...current,\n\t\t[section]: {\n\t\t\t...(current[section] || {}),\n\t\t\t[field]: value,\n\t\t},\n\t}));\n};\n\nconst handleIntakeSearch = (term) => {\n\tif (intakeSearchTimer) {\n\t\twindow.clearTimeout(intakeSearchTimer);\n\t}\n\n\tconst trimmed = safeString(term || '').trim();\n\n\tsetIntakeState((current) => ({\n\t\t...current,\n\t\tsearchQuery: term,\n\t\tsearchResults: trimmed.length < 2 ? [] : current.searchResults,\n\t}));\n\n\tif (trimmed.length < 2) {\n\t\treturn;\n\t}\n\n\tintakeSearchTimer = window.setTimeout(async () => {\n\t\ttry {\n\t\t\tconst results = await api.searchIntake(term);\n\t\t\tsetIntakeState((current) => ({\n\t\t\t\t...current,\n\t\t\t\tsearchResults: results,\n\t\t\t\terror: '',\n\t\t\t}));\n\t\t} catch (error) {\n\t\t\tsetIntakeState((current) => ({\n\t\t\t\t...current,\n\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t}));\n\t\t}\n\t}, 200);\n};\n\nconst handleIntakeSubmit = async () => {\n\tconst state = store.getState();\n\tconst board = state.board;\n\tconst intake = state.intake;\n\tconst guardian = intake.guardian || {};\n\tconst client = intake.client || {};\n\tconst visit = intake.visit || {};\n\n\tconst guardianFirst = safeString(guardian.first_name || '');\n\tconst guardianLast = safeString(guardian.last_name || '');\n\tconst clientName = safeString(client.name || '');\n\tconst stageKey = safeString(resolveDefaultStageKey(board));\n\tconst viewId = Number(visit.view_id || board?.view?.id || 0) || null;\n\n\tif (!guardianFirst || !guardianLast) {\n\t\tsetIntakeState((current) => ({ ...current, error: 'Guardian first and last name are required.' }));\n\t\treturn;\n\t}\n\n\tif (!clientName) {\n\t\tsetIntakeState((current) => ({ ...current, error: 'Client name is required.' }));\n\t\treturn;\n\t}\n\n\tif (!stageKey) {\n\t\tsetIntakeState((current) => ({ ...current, error: strings.stageLabel || 'Stage is required.' }));\n\t\treturn;\n\t}\n\n\tsetIntakeState((current) => ({ ...current, isSaving: true, error: '' }));\n\n\tconst guardianPayload = {\n\t\tid: guardian.id ?? intake.selected?.guardian?.id ?? null,\n\t\tfirst_name: guardianFirst,\n\t\tlast_name: guardianLast,\n\t\temail: safeString(guardian.email || ''),\n\t\tphone: safeString(guardian.phone || guardian.phone_mobile || ''),\n\t\tpreferred_contact: safeString(guardian.preferred_contact || ''),\n\t\tnotes: safeString(guardian.notes || ''),\n\t};\n\n\tconst weightValue = safeString(client.weight || '');\n\tconst clientPayload = {\n\t\tid: client.id ?? intake.selected?.client?.id ?? null,\n\t\tname: clientName,\n\t\tbreed: safeString(client.breed || ''),\n\t\tweight: weightValue,\n\t\ttemperament: safeString(client.temperament || ''),\n\t\tnotes: safeString(client.notes || ''),\n\t\tguardian_id: client.guardian_id ?? guardianPayload.id ?? null,\n\t};\n\n\tconst payload = {\n\t\tcurrent_stage: stageKey,\n\t\tview_id: viewId,\n\t\tstatus: 'in_progress',\n\t\tcheck_in_at: new Date().toISOString(),\n\t\tinstructions: safeString(visit.instructions || ''),\n\t\tpublic_notes: safeString(visit.public_notes || ''),\n\t\tclient: clientPayload,\n\t\tguardian: guardianPayload,\n\t};\n\n\ttry {\n\t\tawait api.createVisit(payload);\n\t\tannounce(strings.intakeSuccess);\n\t\tresetIntakeState();\n\t\trefreshBoardAfterModalSave();\n\t} catch (error) {\n\t\tsetIntakeState((current) => ({\n\t\t\t...current,\n\t\t\tisSaving: false,\n\t\t\terror: error?.message || strings.loadingError,\n\t\t}));\n\t\treturn;\n\t}\n\n\tsetIntakeState((current) => ({\n\t\t...getDefaultIntakeState(board),\n\t\tisOpen: false,\n\t}));\n};\n\nconst closeModal = () => {\n\tphotoPreparationToken += 1;\n\tstore.setState((state) => ({\n\t\tmodal: {\n\t\t\t...state.modal,\n\t\t\tisOpen: false,\n\t\t\tisSaving: false,\n\t\t\tisPreparingUploads: false,\n\t\t\tpendingUploads: [],\n\t\t},\n\t}));\n};\n\nconst handleModalContainerClick = (event) => {\n\tconst targetEl = event.target.closest('[data-role]');\n\tconst role = targetEl?.dataset.role;\n\tif (role === 'bbgf-modal-close') {\n\t\tcloseModal();\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-modal-tab') {\n\t\tconst tab = targetEl.dataset.tab;\n\t\tif (tab) {\n\t\t\thandleModalTabChange(tab);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-modal-save') {\n\t\tconst section = targetEl.dataset.section;\n\t\tif (section) {\n\t\t\thandleModalSave(section);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-modal-move') {\n\t\tconst direction = targetEl.dataset.direction;\n\t\tif (direction) {\n\t\t\thandleModalMove(direction);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-modal-checkout') {\n\t\thandleModalCheckout();\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-upload-photo') {\n\t\thandleModalPhotoUpload(targetEl);\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-photo-primary') {\n\t\tconst photoId = Number(targetEl.dataset.photoId);\n\t\tif (!Number.isNaN(photoId)) {\n\t\t\tsetPhotoAsPrimary(photoId);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-client-flags-save') {\n\t\tsaveClientFlags();\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-history-load-more') {\n\t\tconst nextPage = (store.getState().modal.history?.page || 1) + 1;\n\t\tloadClientHistory({ page: nextPage, append: true });\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-history-toggle') {\n\t\tconst dialog = targetEl.closest('.bbgf-modal__dialog');\n\t\tconst panelId = targetEl.dataset.target;\n\t\tconst panel = panelId ? dialog?.querySelector(`#${panelId}`) : targetEl.nextElementSibling;\n\t\tconst isExpanded = targetEl.getAttribute('aria-expanded') === 'true';\n\t\tconst nextState = !isExpanded;\n\t\ttargetEl.setAttribute('aria-expanded', nextState ? 'true' : 'false');\n\t\tif (panel) {\n\t\t\tpanel.hidden = !nextState;\n\t\t}\n\t\tconst parent = targetEl.closest('.bbgf-history-item');\n\t\tif (parent) {\n\t\t\tparent.classList.toggle('is-open', nextState);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-photo-cancel') {\n\t\tconst upload = event.target.closest('[data-role=\"bbgf-photo-upload\"]');\n\t\tconst fileInput = upload?.querySelector('[data-role=\"bbgf-photo-file\"]');\n\t\tif (fileInput) {\n\t\t\tfileInput.value = '';\n\t\t}\n\t\tphotoPreparationToken += 1;\n\t\tsetModalState((modal) => ({\n\t\t\t...modal,\n\t\t\tpendingUploads: [],\n\t\t\tisPreparingUploads: false,\n\t\t}));\n\t\treturn;\n\t}\n\n\tif (event.target.closest('[data-role=\"bbgf-photo-visibility\"]')) {\n\t\treturn;\n\t}\n\n\tif (event.target.closest('[data-role=\"bbgf-photo-file\"]')) {\n\t\treturn;\n\t}\n\n\tconst preview = event.target.closest('[data-role=\"bbgf-photo-preview\"]');\n\tif (preview) {\n\t\tconst url = preview.dataset?.photoUrl;\n\t\tif (url) {\n\t\t\topenPhotoLightbox(url);\n\t\t}\n\t}\n};\n\nconst handleModalContainerInput = (event) => {\n\tconst role = event.target.dataset?.role;\n\tif (role === 'bbgf-modal-input') {\n\t\tconst field = event.target.dataset.field;\n\t\tif (field) {\n\t\t\tupdateModalFormField(field, event.target.value);\n\t\t}\n\t}\n};\n\nconst handleModalContainerChange = (event) => {\n\tconst { dataset, checked } = event.target;\n\tif (dataset?.role === 'bbgf-modal-service') {\n\t\tconst serviceId = Number(dataset.serviceId);\n\t\tif (!Number.isNaN(serviceId)) {\n\t\t\ttoggleModalService(serviceId, checked);\n\t\t}\n\t}\n\n\tif (dataset?.role === 'bbgf-client-flag') {\n\t\tconst flagId = Number(dataset.flagId);\n\t\tif (!Number.isNaN(flagId)) {\n\t\t\ttoggleClientFlag(flagId, checked);\n\t\t}\n\t}\n\n\tif (dataset?.role === 'bbgf-photo-visibility') {\n\t\tevent.stopPropagation();\n\t\tconst photoId = Number(dataset.photoId);\n\t\tif (!Number.isNaN(photoId)) {\n\t\t\thandlePhotoVisibilityChange(photoId, checked);\n\t\t}\n\t}\n\n\tif (dataset?.role === 'bbgf-photo-file') {\n\t\tconst files = event.target.files ? Array.from(event.target.files) : [];\n\t\tpreparePhotoUploads(files);\n\t}\n};\n\nconst openVisitModal = async (visitId, options = {}) => {\n\tif (!Number.isFinite(Number(visitId))) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tconst boardVisit = findVisitById(state.board, visitId)?.visit ?? null;\n\tconst nextTab = options.tab || 'summary';\n\n\tstore.setState({\n\t\tmodal: {\n\t\t\tisOpen: true,\n\t\t\tvisitId,\n\t\t\tloading: true,\n\t\t\tvisit: boardVisit,\n\t\t\treadOnly: state.board?.readonly || !settings.capabilities?.editVisits,\n\t\t\tactiveTab: nextTab,\n\t\t\tisSaving: false,\n\t\t\tclientFlags: ensureArray(boardVisit?.client?.flags)\n\t\t\t\t.map((flag) => Number(flag?.id ?? flag))\n\t\t\t\t.filter((id) => Number.isFinite(id)),\n\t\t\tform: buildModalFormFromVisit(boardVisit),\n\t\t\terror: '',\n\t\t\tpendingUploads: [],\n\t\t\tisPreparingUploads: false,\n\t\t\thistory: {\n\t\t\t\titems: [],\n\t\t\t\tpage: 1,\n\t\t\t\tperPage: 5,\n\t\t\t\thasMore: false,\n\t\t\t\tloaded: false,\n\t\t\t\tloading: false,\n\t\t\t\terror: '',\n\t\t\t},\n\t\t},\n\t});\n\n\tensureServicesCatalog();\n\tensureFlagsCatalog();\n\n\ttry {\n\t\tconst visit = await api.fetchVisit(visitId, {\n\t\t\tview: getActiveViewSlug(store.getState()),\n\t\t});\n\n\t\tstore.setState((prev) => ({\n\t\t\tmodal: {\n\t\t\t\t...prev.modal,\n\t\t\t\tloading: false,\n\t\t\t\tvisit,\n\t\t\t\tform: buildModalFormFromVisit(visit),\n\t\t\t\tclientFlags: ensureArray(visit?.client?.flags)\n\t\t\t\t\t.map((flag) => Number(flag?.id ?? flag))\n\t\t\t\t\t.filter((id) => Number.isFinite(id)),\n\t\t\t\thistory: {\n\t\t\t\t\t...prev.modal.history,\n\t\t\t\t\titems: [],\n\t\t\t\t\tpage: 1,\n\t\t\t\t\thasMore: false,\n\t\t\t\t\tloaded: false,\n\t\t\t\t\tloading: false,\n\t\t\t\t\terror: '',\n\t\t\t\t},\n\t\t\t\terror: '',\n\t\t\t},\n\t\t}));\n\t} catch (error) {\n\t\tstore.setState((prev) => ({\n\t\t\terrors: [...ensureArray(prev.errors), error?.message || strings.loadingError],\n\t\t\tmodal: {\n\t\t\t\t...prev.modal,\n\t\t\t\tloading: false,\n\t\t\t\terror: error?.message || strings.loadingError,\n\t\t\t},\n\t\t}));\n\t}\n};\n\nconst highlightColumn = (stageKey) => {\n\tif (!boardRootElement) {\n\t\treturn;\n\t}\n\n\tif (!stageKey) {\n\t\tboardRootElement.querySelectorAll('.bbgf-column--drag-hover').forEach((column) => {\n\t\t\tcolumn.classList.remove('bbgf-column--drag-hover');\n\t\t});\n\t\tcurrentDragHoverStage = '';\n\t\treturn;\n\t}\n\n\tif (currentDragHoverStage === stageKey) {\n\t\treturn;\n\t}\n\n\tboardRootElement.querySelectorAll('.bbgf-column--drag-hover').forEach((column) => {\n\t\tcolumn.classList.remove('bbgf-column--drag-hover');\n\t});\n\n\tconst target = boardRootElement.querySelector(`.bbgf-column[data-stage=\"${stageKey}\"]`);\n\tif (target) {\n\t\ttarget.classList.add('bbgf-column--drag-hover');\n\t\tcurrentDragHoverStage = stageKey;\n\t}\n};\n\nconst handleDragStart = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tconst state = store.getState();\n\tif (state.board?.readonly || !settings.capabilities?.moveStages) {\n\t\tevent.preventDefault();\n\t\treturn;\n\t}\n\n\tconst visitId = Number(card.dataset.visitId);\n\tconst fromStage = safeString(card.dataset.stage);\n\tif (Number.isNaN(visitId) || !fromStage) {\n\t\tevent.preventDefault();\n\t\treturn;\n\t}\n\n\tsetDragState({ isDragging: true, visitId, fromStage });\n\n\tif (event.dataTransfer) {\n\t\tevent.dataTransfer.effectAllowed = 'move';\n\t\tevent.dataTransfer.setData('text/plain', String(visitId));\n\t}\n\n\tcard.classList.add('is-dragging');\n\tcard.setAttribute('aria-grabbed', 'true');\n};\n\nconst handleDragEnd = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (card) {\n\t\tcard.classList.remove('is-dragging');\n\t\tcard.setAttribute('aria-grabbed', 'false');\n\t}\n\n\tsetDragState({ isDragging: false, visitId: null, fromStage: '' });\n\thighlightColumn(null);\n};\n\nconst handleDragOver = (event) => {\n\tconst state = store.getState();\n\tif (!state.drag?.isDragging) {\n\t\treturn;\n\t}\n\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tif (event.dataTransfer) {\n\t\tevent.dataTransfer.dropEffect = 'move';\n\t}\n\n\tif (!state.board?.readonly && settings.capabilities?.moveStages) {\n\t\tevent.preventDefault();\n\t\tconst stageKey = column.dataset.stage;\n\t\tif (stageKey && stageKey !== state.drag.fromStage) {\n\t\t\thighlightColumn(stageKey);\n\t\t}\n\t}\n};\n\nconst handleDragLeave = (event) => {\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tif (!column.contains(event.relatedTarget)) {\n\t\thighlightColumn(null);\n\t}\n};\n\nconst handleDrop = (event) => {\n\tconst state = store.getState();\n\tif (!state.drag?.isDragging) {\n\t\treturn;\n\t}\n\n\tconst column = event.target.closest('.bbgf-column');\n\tif (!column) {\n\t\treturn;\n\t}\n\n\tevent.preventDefault();\n\n\tconst stageKey = column.dataset.stage;\n\tconst visitId = Number(event.dataTransfer?.getData('text/plain')) || state.drag.visitId;\n\n\tconst targetStage = stageKey;\n\tconst fromStage = state.drag.fromStage;\n\tif (!targetStage || targetStage === fromStage) {\n\t\treturn;\n\t}\n\n\thighlightColumn(null);\n\tsetDragState({ isDragging: false, visitId: null, fromStage: '' });\n\n\tif (!Number.isNaN(visitId)) {\n\t\tmoveVisitToStage(visitId, targetStage);\n\t}\n};\n\nconst getTouchTargetColumn = (touchEvent) => {\n\tconst point = touchEvent.changedTouches?.[0];\n\tif (!point) {\n\t\treturn null;\n\t}\n\tconst element = document.elementFromPoint(point.clientX, point.clientY);\n\treturn element ? element.closest('.bbgf-column') : null;\n};\n\nconst handleTouchStart = (event) => {\n\tif (!settings.capabilities?.moveStages) {\n\t\treturn;\n\t}\n\n\tconst card = event.target.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tconst visitId = Number(card.dataset.visitId);\n\tconst fromStage = safeString(card.dataset.stage);\n\tif (Number.isNaN(visitId) || !fromStage) {\n\t\treturn;\n\t}\n\n\tactiveTouchDrag = { visitId, fromStage };\n\thighlightColumn(null);\n};\n\nconst handleTouchMove = (event) => {\n\tif (!activeTouchDrag) {\n\t\treturn;\n\t}\n\tevent.preventDefault();\n\tconst column = getTouchTargetColumn(event);\n\tif (column) {\n\t\tconst stageKey = safeString(column.dataset.stage);\n\t\tif (stageKey && stageKey !== activeTouchDrag.fromStage) {\n\t\t\thighlightColumn(stageKey);\n\t\t}\n\t}\n};\n\nconst handleTouchEnd = (event) => {\n\tif (!activeTouchDrag) {\n\t\treturn;\n\t}\n\tconst column = getTouchTargetColumn(event);\n\tconst targetStage = safeString(column?.dataset.stage ?? '');\n\tif (targetStage && targetStage !== activeTouchDrag.fromStage) {\n\t\tmoveVisitToStage(activeTouchDrag.visitId, targetStage);\n\t}\n\thighlightColumn(null);\n\tactiveTouchDrag = null;\n};\n\nconst handleModalEvents = (root) => {\n\tconst container = root.querySelector('#bbgf-modal');\n\tif (!container || container.dataset.bound === 'true') {\n\t\treturn;\n\t}\n\n\tconst backdrop = container.querySelector('[data-role=\"bbgf-modal-backdrop\"]');\n\tconst closeButton = container.querySelector('[data-role=\"bbgf-modal-close\"]');\n\n\tif (backdrop) {\n\t\tbackdrop.addEventListener('click', closeModal);\n\t}\n\n\tif (closeButton) {\n\t\tcloseButton.addEventListener('click', closeModal);\n\t}\n\n\tdocument.addEventListener('keydown', (event) => {\n\t\tif (event.key === 'Escape') {\n\t\t\tconst { modal } = store.getState();\n\t\t\tif (modal.isOpen) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcloseModal();\n\t\t\t}\n\t\t}\n\t});\n\n\tconst dialog = container.querySelector('.bbgf-modal__dialog');\n\tif (dialog) {\n\t\tdialog.addEventListener('click', handleModalContainerClick);\n\t\tdialog.addEventListener('input', handleModalContainerInput, true);\n\t\tdialog.addEventListener('change', handleModalContainerChange);\n\t}\n\n\tcontainer.dataset.bound = 'true';\n};\n\nconst renderModal = (state, root, copy) => {\n\tconst container = root.querySelector('#bbgf-modal');\n\tif (!container) {\n\t\treturn;\n\t}\n\n\tconst { modal } = state;\n\tif (!modal.isOpen) {\n\t\tcontainer.setAttribute('hidden', 'hidden');\n\t\tconst previous = modalLastFocusedElement;\n\t\tif (previous && previous.focus) {\n\t\t\twindow.requestAnimationFrame(() => previous.focus());\n\t\t}\n\t\tmodalLastFocusedElement = null;\n\t\treturn;\n\t}\n\n\tcontainer.removeAttribute('hidden');\n\n\tconst body = container.querySelector('[data-role=\"bbgf-modal-body\"]');\n\tconst tabsNav = container.querySelector('[data-role=\"bbgf-modal-tabs\"]');\n\tconst title = container.querySelector('#bbgf-modal-title');\n\tconst closeButton = container.querySelector('[data-role=\"bbgf-modal-close\"]');\n\tconst nav = container.querySelector('[data-role=\"bbgf-modal-nav\"]');\n\n\tconst tabs = [\n\t\t{ id: 'summary', label: copy.modalSummary },\n\t\t{ id: 'notes', label: copy.modalNotes },\n\t\t{ id: 'services', label: copy.modalServices },\n\t\t{ id: 'visit', label: copy.modalVisit },\n\t\t{ id: 'history', label: copy.modalHistory },\n\t\t{ id: 'photos', label: copy.modalPhotos },\n\t];\n\n\tif (tabsNav) {\n\t\ttabsNav.innerHTML = tabs\n\t\t\t.map((tab) => {\n\t\t\t\tconst isActive = modal.activeTab === tab.id;\n\t\t\t\treturn `<button type=\"button\" class=\"bbgf-modal__tab${isActive ? ' is-active' : ''}\" data-role=\"bbgf-modal-tab\" data-tab=\"${tab.id}\" aria-selected=\"${isActive ? 'true' : 'false'}\">${escapeHtml(\n\t\t\t\t\ttab.label\n\t\t\t\t)}</button>`;\n\t\t\t})\n\t\t\t.join('');\n\t}\n\n\tif (nav) {\n\t\tif (modal.visit) {\n\t\t\tconst neighbors = getStageNeighbors(state.board, modal.visit.current_stage);\n\t\t\tconst stageLabel =\n\t\t\t\tensureArray(state.board?.stages).find((stage) => stage.key === modal.visit.current_stage)?.label ?? modal.visit.current_stage;\n\t\t\tconst canEdit = settings.capabilities?.editVisits && !state.board?.readonly && !modal.readOnly;\n\t\t\tconst canMove = settings.capabilities?.moveStages && !state.board?.readonly && !modal.readOnly && !modal.visit.check_out_at;\n\t\t\tconst prevButton =\n\t\t\t\tcanMove && neighbors.prev\n\t\t\t\t\t? `<button type=\"button\" class=\"bbgf-icon-button\" data-role=\"bbgf-modal-move\" data-direction=\"prev\" aria-label=\"${escapeHtml(copy.movePrev)}\" title=\"${escapeHtml(\n\t\t\t\t\t\t\tcopy.movePrev\n\t\t\t\t\t\t)}\">â†</button>`\n\t\t\t\t\t: '';\n\t\t\tconst nextButton =\n\t\t\t\tcanMove && neighbors.next\n\t\t\t\t\t? `<button type=\"button\" class=\"bbgf-icon-button\" data-role=\"bbgf-modal-move\" data-direction=\"next\" aria-label=\"${escapeHtml(copy.moveNext)}\" title=\"${escapeHtml(\n\t\t\t\t\t\t\tcopy.moveNext\n\t\t\t\t\t\t)}\">â†’</button>`\n\t\t\t\t\t: '';\n\t\t\tconst checkoutButton =\n\t\t\t\tcanEdit && !modal.visit.check_out_at\n\t\t\t\t\t? `<button type=\"button\" class=\"bbgf-icon-button bbgf-icon-button--critical\" data-role=\"bbgf-modal-checkout\" aria-label=\"${escapeHtml(copy.modalCheckout)}\" title=\"${escapeHtml(\n\t\t\t\t\t\t\tcopy.modalCheckout\n\t\t\t\t\t\t)}\" ${modal.isSaving ? 'disabled' : ''}>âœ“</button>`\n\t\t\t\t\t: '';\n\t\t\tconst checkoutTime = modal.visit.check_out_at ? formatDateTime(modal.visit.check_out_at) : '';\n\t\t\tconst checkoutMeta =\n\t\t\t\tmodal.visit.check_out_at\n\t\t\t\t\t? `<span class=\"bbgf-modal__nav-status\">${escapeHtml(copy.modalCheckedOut || copy.modalCheckoutAt)}${\n\t\t\t\t\t\t\tcheckoutTime ? ` â€¢ ${escapeHtml(checkoutTime)}` : ''\n\t\t\t\t\t\t}</span>`\n\t\t\t\t\t: '';\n\t\t\tnav.innerHTML = `\n\t\t\t\t<div class=\"bbgf-modal__nav-actions\">\n\t\t\t\t\t${prevButton}\n\t\t\t\t\t${nextButton}\n\t\t\t\t\t${checkoutButton}\n\t\t\t\t</div>\n\t\t\t\t${checkoutMeta ? `<div class=\"bbgf-modal__nav-info\">${checkoutMeta}</div>` : ''}\n\t\t\t`;\n\t\t} else {\n\t\t\tnav.innerHTML = '';\n\t\t}\n\t}\n\n\tlet contentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\n\tif (modal.loading) {\n\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\t} else if (!modal.visit) {\n\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.loadingError}</p>`;\n\t} else {\n\t\tconst visit = modal.visit;\n\t\tconst stageLabel = ensureArray(state.board?.stages).find((stage) => stage.key === visit.current_stage)?.label ?? visit.current_stage;\n\t\tconst clientName = escapeHtml(visit.client?.name ?? copy.unknownClient);\n\t\tconst guardian = visit.guardian || {};\n\t\tconst maskGuardian = Boolean(state.board?.visibility?.mask_guardian);\n\t\tconst servicesSelection = new Set(ensureArray(modal.form.services).map((id) => Number(id)));\n\t\tconst catalogServices = state.catalog.services;\n\n\t\tif (modal.activeTab === 'summary') {\n\t\t\tconst photoData = getVisitPhoto(visit);\n\t\t\tconst photoMarkup =\n\t\t\t\tphotoData && photoData.url\n\t\t\t\t\t? `<img src=\"${escapeHtml(photoData.url)}\" alt=\"${escapeHtml(photoData.alt ?? clientName)}\">`\n\t\t\t\t\t: `<span>${(safeString(visit.client?.name ?? copy.unknownClient).charAt(0) || 'ðŸ¾').toUpperCase()}</span>`;\n\n\t\t\tconst serviceChips = ensureArray(visit.services)\n\t\t\t\t.map((service) => {\n\t\t\t\t\tconst icon = safeString(service?.icon ?? '');\n\t\t\t\t\tconst label = safeString(service?.name ?? '');\n\t\t\t\t\tconst text = label ? (icon && icon !== label ? `${icon} ${label}` : label) : icon;\n\t\t\t\t\treturn text ? `<span class=\"bbgf-modal-chip\">${escapeHtml(text)}</span>` : '';\n\t\t\t\t})\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.join('');\n\t\t\tconst allFlags = [];\n\t\t\tconst seenFlagIds = new Set();\n\t\t\tensureArray(visit.flags)\n\t\t\t\t.concat(ensureArray(visit.client?.flags))\n\t\t\t\t.forEach((flag) => {\n\t\t\t\t\tconst id = Number(flag?.id ?? flag);\n\t\t\t\t\tif (!Number.isFinite(id) || seenFlagIds.has(id)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tseenFlagIds.add(id);\n\t\t\t\t\tallFlags.push(flag);\n\t\t\t\t});\n\t\t\tconst flagChips = allFlags\n\t\t\t\t.map((flag) => {\n\t\t\t\t\tconst emoji = safeString(flag?.emoji ?? '');\n\t\t\t\t\tconst label = safeString(flag?.name ?? '');\n\t\t\t\t\tconst text = label ? `${emoji ? `${emoji} ` : ''}${label}` : emoji;\n\t\t\t\t\treturn text ? `<span class=\"bbgf-modal-chip bbgf-modal-chip--flag\">${escapeHtml(text)}</span>` : '';\n\t\t\t\t})\n\t\t\t\t.filter(Boolean)\n\t\t\t\t.join('');\n\t\t\tconst tagsHtml = [serviceChips, flagChips].filter(Boolean).join('');\n\t\t\tconst guardianNameParts = [safeString(guardian.first_name ?? ''), safeString(guardian.last_name ?? '')].filter(Boolean);\n\t\t\tconst guardianName = guardianNameParts.join(' ').trim();\n\t\t\tconst contactPieces = [safeString(guardian.phone ?? ''), safeString(guardian.email ?? '')].filter(Boolean);\n\t\t\tconst guardianMetaPieces = [];\n\t\t\tif (maskGuardian) {\n\t\t\t\tguardianMetaPieces.push(escapeHtml(copy.maskedGuardian));\n\t\t\t} else {\n\t\t\t\tif (guardianName) {\n\t\t\t\t\tguardianMetaPieces.push(escapeHtml(guardianName));\n\t\t\t\t}\n\t\t\t\tif (contactPieces.length) {\n\t\t\t\t\tguardianMetaPieces.push(contactPieces.map((piece) => escapeHtml(piece)).join(' â€¢ '));\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst guardianMeta =\n\t\t\t\tguardianMetaPieces.length > 0 ? `<p class=\"bbgf-modal-summary__meta\">${guardianMetaPieces.join(' â€¢ ')}</p>` : '';\n\t\t\tconst checkIn = escapeHtml(formatDateTime(visit.check_in_at) || '');\n\t\t\tconst checkOut = escapeHtml(formatDateTime(visit.check_out_at) || '');\n\t\t\tconst timerSeconds = toNumber(visit.timer_elapsed_seconds) ?? 0;\n\t\t\tconst elapsedDisplay = timerSeconds > 0 ? escapeHtml(formatDuration(timerSeconds)) : '';\n\t\t\tconst breed = escapeHtml(visit.client?.breed ?? '');\n\t\t\tconst instructions = escapeHtml(visit.instructions ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst publicNotes = escapeHtml(visit.public_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst privateNotes = escapeHtml(visit.private_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\tconst summaryItems = [];\n\t\t\tsummaryItems.push({ label: copy.checkIn, value: checkIn || '-' });\n\t\t\tsummaryItems.push({ label: copy.modalCheckoutAt || 'Check-out', value: checkOut || '-' });\n\t\t\tconst summaryGridHtml = summaryItems\n\t\t\t\t.map(\n\t\t\t\t\t(item) =>\n\t\t\t\t\t\t`<div class=\"bbgf-summary-item\"><span class=\"bbgf-summary-item__label\">${escapeHtml(item.label)}</span><span class=\"bbgf-summary-item__value\">${item.value}</span></div>`\n\t\t\t\t)\n\t\t\t\t.join('');\n\t\t\tconst noteBlocks = [];\n\t\t\tif (instructions) {\n\t\t\t\tnoteBlocks.push({ heading: 'Instructions', body: instructions });\n\t\t\t}\n\t\t\tif (publicNotes) {\n\t\t\t\tnoteBlocks.push({ heading: 'Public notes', body: publicNotes });\n\t\t\t}\n\t\t\tif (!modal.readOnly && privateNotes) {\n\t\t\t\tnoteBlocks.push({ heading: 'Private notes', body: privateNotes });\n\t\t\t}\n\t\t\tconst notesHtml = noteBlocks.length\n\t\t\t\t? `<div class=\"bbgf-modal-summary__notes\">${noteBlocks\n\t\t\t\t\t\t.map((note) => `<article class=\"bbgf-modal-note\"><h4>${escapeHtml(note.heading)}</h4><p>${note.body}</p></article>`)\n\t\t\t\t\t\t.join('')}</div>`\n\t\t\t\t: '';\n\n\t\t\tcontentHtml = `\n\t\t\t\t<section class=\"bbgf-modal-summary\">\n\t\t\t\t\t<header class=\"bbgf-modal-summary__header\">\n\t\t\t\t\t\t<div class=\"bbgf-modal-summary__photo\">${photoMarkup}</div>\n\t\t\t\t\t\t<div class=\"bbgf-modal-summary__primary\">\n\t\t\t\t\t\t\t<h3 class=\"bbgf-modal-summary__name\">${clientName}</h3>\n\t\t\t\t\t\t\t${breed ? `<p class=\"bbgf-modal-summary__breed\">${breed}</p>` : ''}\n\t\t\t\t\t\t\t<p class=\"bbgf-modal-summary__subtitle\">\n\t\t\t\t\t\t\t\t<span class=\"bbgf-modal-summary__stage\">${escapeHtml(stageLabel || visit.current_stage || '')}</span>\n\t\t\t\t\t\t\t\t${elapsedDisplay ? `<span class=\"bbgf-modal-summary__elapsed\">${elapsedDisplay}</span>` : ''}\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t${guardianMeta}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</header>\n\t\t\t\t\t${tagsHtml ? `<div class=\"bbgf-modal-summary__tags\">${tagsHtml}</div>` : ''}\n\t\t\t\t\t${summaryGridHtml ? `<div class=\"bbgf-modal-summary__grid\">${summaryGridHtml}</div>` : ''}\n\t\t\t\t\t${notesHtml}\n\t\t\t\t</section>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'notes') {\n\t\t\tcontentHtml = `\n\t\t\t\t<form class=\"bbgf-modal-form\" data-role=\"bbgf-modal-notes-form\">\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-instructions\">${escapeHtml(copy.notes)} (${escapeHtml('Instructions')})</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-instructions\" data-role=\"bbgf-modal-input\" data-field=\"instructions\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-public-notes\">${escapeHtml('Public notes')}</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-public-notes\" data-role=\"bbgf-modal-input\" data-field=\"publicNotes\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-modal-field\">\n\t\t\t\t\t\t<label for=\"bbgf-modal-private-notes\">${escapeHtml('Private notes')}</label>\n\t\t\t\t\t\t<textarea id=\"bbgf-modal-private-notes\" data-role=\"bbgf-modal-input\" data-field=\"privateNotes\" ${modal.readOnly ? 'disabled' : ''}></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t${modal.readOnly ? '' : `<div class=\"bbgf-modal__actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-modal-save\" data-section=\"notes\" ${modal.isSaving ? 'disabled' : ''}>${escapeHtml(modal.isSaving ? copy.modalSaving : copy.modalSave)}</button></div>`}\n\t\t\t\t</form>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'services') {\n\t\t\tif (!settings.capabilities?.manageServices) {\n\t\t\t\tconst serviceList = ensureArray(visit.services)\n\t\t\t\t\t.map((service) => `<li>${escapeHtml(service.name)}</li>`)\n\t\t\t\t\t.join('');\n\n\t\t\t\tcontentHtml = `\n\t\t\t\t\t<div class=\"bbgf-modal-section\">\n\t\t\t\t\t\t<p>${escapeHtml('You do not have permission to modify services. Contact an administrator if you need changes.')}</p>\n\t\t\t\t\t\t<ul class=\"bbgf-modal-list\">${serviceList || `<li>${escapeHtml(copy.emptyColumn)}</li>`}</ul>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t} else if (catalogServices.isLoading && !catalogServices.loaded) {\n\t\t\t\tcontentHtml = `<p class=\"bbgf-modal__loading\">${copy.modalLoading}</p>`;\n\t\t\t} else if (catalogServices.error) {\n\t\t\t\tcontentHtml = `<p class=\"bbgf-modal__error\">${escapeHtml(catalogServices.error)}</p>`;\n\t\t\t} else {\n\t\t\t\tconst serviceItems = ensureArray(catalogServices.items)\n\t\t\t\t\t.map((service) => {\n\t\t\t\t\t\tconst id = Number(service?.id);\n\t\t\t\t\t\tconst checked = servicesSelection.has(id) ? 'checked' : '';\n\t\t\t\t\t\treturn `\n\t\t\t\t\t\t\t<label class=\"bbgf-modal-service\">\n\t\t\t\t\t\t\t\t<input type=\"checkbox\" data-role=\"bbgf-modal-service\" data-service-id=\"${id}\" ${checked} ${modal.readOnly ? 'disabled' : ''}>\n\t\t\t\t\t\t\t\t<span>${escapeHtml(service?.name ?? '')}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t`;\n\t\t\t\t\t})\n\t\t\t\t\t.join('');\n\n\t\t\t\tcontentHtml = `\n\t\t\t\t\t<div class=\"bbgf-modal-service-list\">\n\t\t\t\t\t\t${serviceItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.emptyColumn)}</p>`}\n\t\t\t\t\t</div>\n\t\t\t\t\t${modal.readOnly ? '' : `<div class=\"bbgf-modal__actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-modal-save\" data-section=\"services\" ${modal.isSaving ? 'disabled' : ''}>${escapeHtml(modal.isSaving ? copy.modalSaving : copy.modalSave)}</button></div>`}\n\t\t\t\t`;\n\t\t\t}\n\t\t} else if (modal.activeTab === 'visit') {\n\t\t\tconst historyItems = ensureArray(visit.history)\n\t\t\t\t.map((entry) => {\n\t\t\t\t\tconst when = formatDateTime(entry.changed_at);\n\t\t\t\t\tconst from = escapeHtml(entry.from_stage?.label ?? entry.from_stage?.key ?? '');\n\t\t\t\t\tconst to = escapeHtml(entry.to_stage?.label ?? entry.to_stage?.key ?? '');\n\t\t\t\t\tconst comment = escapeHtml(entry.comment ?? '').replace(/\\n/g, '<br>');\n\t\t\t\t\tconst duration = entry.elapsed_seconds ? formatDuration(entry.elapsed_seconds) : '';\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<div class=\"bbgf-history-entry\">\n\t\t\t\t\t\t\t\t<strong>${when}</strong>\n\t\t\t\t\t\t\t\t<p>${from} â†’ ${to}</p>\n\t\t\t\t\t\t\t\t${duration ? `<p class=\"bbgf-history-duration\">${escapeHtml(duration)}</p>` : ''}\n\t\t\t\t\t\t\t\t${comment ? `<p>${comment}</p>` : ''}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join('');\n\n\t\t\tconst flagOptions = ensureArray(state.catalog.flags.items);\n\t\t\tconst selectedClientFlags = new Set(ensureArray(modal.clientFlags).map((id) => Number(id)));\n\n\t\t\tlet flagList = '';\n\t\t\tif (state.catalog.flags.isLoading && !flagOptions.length) {\n\t\t\t\tflagList = `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalLoading)}</p>`;\n\t\t\t} else if (state.catalog.flags.error) {\n\t\t\t\tflagList = `<p class=\"bbgf-modal__error\">${escapeHtml(state.catalog.flags.error)}</p>`;\n\t\t\t} else {\n\t\t\t\tflagList =\n\t\t\t\t\tflagOptions\n\t\t\t\t\t\t.map((flag) => {\n\t\t\t\t\t\t\tconst id = Number(flag?.id);\n\t\t\t\t\t\t\tif (!Number.isFinite(id)) {\n\t\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tconst checked = selectedClientFlags.has(id) ? 'checked' : '';\n\t\t\t\t\t\t\tconst label = safeString(flag?.name ?? '');\n\t\t\t\t\t\t\tconst emoji = safeString(flag?.emoji ?? '');\n\t\t\t\t\t\t\tconst text = `${emoji ? `${emoji} ` : ''}${label}`;\n\t\t\t\t\t\t\treturn `<label class=\"bbgf-flag-option\"><input type=\"checkbox\" data-role=\"bbgf-client-flag\" data-flag-id=\"${id}\" ${checked} ${modal.readOnly ? 'disabled' : ''}>${escapeHtml(text)}</label>`;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.join('') || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalNoPrevious)}</p>`;\n\t\t\t}\n\n\t\t\tconst flagsSection = `\n\t\t\t\t<section class=\"bbgf-modal-section bbgf-client-flags\">\n\t\t\t\t\t<div class=\"bbgf-modal-section__header\">\n\t\t\t\t\t\t<h3>${escapeHtml(strings.flags)}</h3>\n\t\t\t\t\t\t<p class=\"bbgf-modal__hint\">Persisted at the client level.</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-flag-grid\">\n\t\t\t\t\t\t${flagList}\n\t\t\t\t\t</div>\n\t\t\t\t\t${modal.readOnly ? '' : `<div class=\"bbgf-modal__actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-client-flags-save\" ${modal.isSaving ? 'disabled' : ''}>${escapeHtml(modal.isSaving ? copy.modalSaving : copy.modalSave)}</button></div>`}\n\t\t\t\t</section>\n\t\t\t`;\n\n\t\t\tcontentHtml = `\n\t\t\t\t<div class=\"bbgf-visit-tab\">\n\t\t\t\t\t<section class=\"bbgf-modal-section\">\n\t\t\t\t\t\t<ul class=\"bbgf-modal-history\">\n\t\t\t\t\t\t\t${historyItems || `<li>${escapeHtml(copy.modalNoHistory)}</li>`}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</section>\n\t\t\t\t\t${flagsSection}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'history') {\n\t\t\tconst historyState = modal.history || {};\n\t\t\tconst historyItems = ensureArray(historyState.items)\n\t\t\t\t.map((entry, index) => {\n\t\t\t\t\tconst when = formatDateTime(entry.check_in_at || entry.created_at || entry.check_out_at) || copy.modalHistory;\n\t\t\t\t\tconst stage = escapeHtml(entry.stage_label || entry.stage || '');\n\t\t\t\t\tconst instructions = escapeHtml(entry.instructions ?? '').replace(/\\n/g, '<br>');\n\t\t\t\t\tconst publicNotes = escapeHtml(entry.public_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\t\t\tconst privateNotes = escapeHtml(entry.private_notes ?? '').replace(/\\n/g, '<br>');\n\t\t\t\t\tconst servicesSummary = buildServiceSummary(entry.services);\n\t\t\t\t\tconst photos = ensureArray(entry.photos)\n\t\t\t\t\t\t.slice(0, 6)\n\t\t\t\t\t\t.map((photo) => {\n\t\t\t\t\t\t\tconst url = safeString(photo?.thumbnail?.url || photo?.url || '');\n\t\t\t\t\t\t\tif (!url) {\n\t\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn `<img src=\"${escapeHtml(url)}\" alt=\"${escapeHtml(photo.alt ?? clientName)}\">`;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t.join('');\n\t\t\t\t\tconst targetId = `bbgf-history-${entry.id || index}`;\n\t\t\t\t\tconst isFirst = index === 0;\n\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<article class=\"bbgf-history-item${isFirst ? ' is-open' : ''}\">\n\t\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-history-toggle\" data-role=\"bbgf-history-toggle\" data-target=\"${targetId}\" aria-expanded=\"${isFirst ? 'true' : 'false'}\">\n\t\t\t\t\t\t\t\t<span class=\"bbgf-history-title\">${escapeHtml(when)}</span>\n\t\t\t\t\t\t\t\t${stage ? `<span class=\"bbgf-history-stage\">${stage}</span>` : ''}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class=\"bbgf-history-panel\"${isFirst ? '' : ' hidden'} id=\"${targetId}\">\n\t\t\t\t\t\t\t\t${servicesSummary ? `<p class=\"bbgf-history-services\"><strong>${escapeHtml(strings.services)}:</strong> ${escapeHtml(servicesSummary)}</p>` : ''}\n\t\t\t\t\t\t\t\t${instructions ? `<p class=\"bbgf-history-note\"><strong>Instructions:</strong> ${instructions}</p>` : ''}\n\t\t\t\t\t\t\t\t${publicNotes ? `<p class=\"bbgf-history-note\"><strong>Public:</strong> ${publicNotes}</p>` : ''}\n\t\t\t\t\t\t\t\t${privateNotes ? `<p class=\"bbgf-history-note\"><strong>Private:</strong> ${privateNotes}</p>` : ''}\n\t\t\t\t\t\t\t\t${photos ? `<div class=\"bbgf-history-photos\">${photos}</div>` : ''}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</article>\n\t\t\t\t\t`;\n\t\t\t\t})\n\t\t\t\t.join('');\n\n\t\t\tconst historyFooter =\n\t\t\t\thistoryState.hasMore && !historyState.loading\n\t\t\t\t\t? `<div class=\"bbgf-history-actions\"><button type=\"button\" class=\"bbgf-button bbgf-button--ghost\" data-role=\"bbgf-history-load-more\">Load more</button></div>`\n\t\t\t\t\t: '';\n\t\t\tconst historyStatus = historyState.loading\n\t\t\t\t? `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalLoading)}</p>`\n\t\t\t\t: '';\n\t\t\tconst hasHistoryItems = Boolean(historyItems);\n\t\t\tconst historyContent = historyState.error\n\t\t\t\t? `<p class=\"bbgf-modal__error\">${escapeHtml(historyState.error)}</p>`\n\t\t\t\t: historyState.loading && !hasHistoryItems\n\t\t\t\t\t? `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalLoading)}</p>`\n\t\t\t\t\t: historyItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalNoPrevious)}</p>`;\n\n\t\t\tcontentHtml = `\n\t\t\t\t<div class=\"bbgf-history-accordion\">\n\t\t\t\t\t${historyContent}\n\t\t\t\t</div>\n\t\t\t\t${historyStatus && hasHistoryItems ? historyStatus : ''}\n\t\t\t\t${historyFooter}\n\t\t\t`;\n\t\t} else if (modal.activeTab === 'photos') {\n\t\t\tconst photos = ensureArray(visit.photos);\n\t\t\tconst pendingUploads = ensureArray(modal.pendingUploads);\n\t\t\tconst isPreparingUploads = Boolean(modal.isPreparingUploads);\n\t\t\tconst pendingList = pendingUploads.length\n\t\t\t\t? `<ul class=\"bbgf-photo-upload__list\">${pendingUploads\n\t\t\t\t\t\t.map((file) => `<li>${escapeHtml(file.name || 'Untitled file')}</li>`)\n\t\t\t\t\t\t.join('')}</ul>`\n\t\t\t\t: `<p class=\"bbgf-photo-upload__hint\">${escapeHtml(\n\t\t\t\t\t\tisPreparingUploads ? copy.modalPreparingUpload : 'Select images to preview filenames before uploading.'\n\t\t\t\t\t)}</p>`;\n\t\t\tlet photoItems = photos\n\t\t\t\t.map((photo) => {\n\t\t\t\t\tconst url = escapeHtml(photo.url ?? '');\n\t\t\t\t\tconst alt = escapeHtml(photo.alt ?? clientName);\n\t\t\t\t\tconst visible = photo.visible_to_guardian !== false;\n\t\t\t\t\tconst photoId = Number(photo.id);\n\t\t\t\t\tconst isPrimary = photo.is_primary === true;\n\t\t\t\t\tconst visibilityToggle =\n\t\t\t\t\t\tsettings.capabilities?.editVisits && !state.board?.readonly && !modal.readOnly && Number.isFinite(photoId)\n\t\t\t\t\t\t\t? `<label class=\"bbgf-photo-visibility\"><input type=\"checkbox\" data-role=\"bbgf-photo-visibility\" data-photo-id=\"${photoId}\" ${visible ? 'checked' : ''}>${escapeHtml(copy.modalVisibleToGuardian)}</label>`\n\t\t\t\t\t\t\t: '';\n\t\t\t\t\tconst primaryAction =\n\t\t\t\t\t\tsettings.capabilities?.editVisits && !state.board?.readonly && !modal.readOnly && Number.isFinite(photoId)\n\t\t\t\t\t\t\t? `<button type=\"button\" class=\"bbgf-button bbgf-button--ghost bbgf-photo-primary\" data-role=\"bbgf-photo-primary\" data-photo-id=\"${photoId}\" ${isPrimary ? 'disabled' : ''}>${escapeHtml(\n\t\t\t\t\t\t\t\t\tisPrimary ? 'Main photo' : 'Set as main photo'\n\t\t\t\t\t\t\t  )}</button>`\n\t\t\t\t\t\t\t: '';\n\n\t\t\t\t\treturn `<figure class=\"bbgf-modal-photo\" data-role=\"bbgf-photo-preview\" data-photo-id=\"${photoId}\" data-photo-url=\"${url}\" aria-label=\"${escapeHtml(copy.modalViewPhoto)}\">\n\t\t\t\t\t\t<div class=\"bbgf-modal-photo__thumb\">\n\t\t\t\t\t\t\t<img src=\"${url}\" alt=\"${alt}\">\n\t\t\t\t\t\t\t${isPrimary ? '<span class=\"bbgf-photo-badge bbgf-photo-badge--primary\">Main</span>' : ''}\n\t\t\t\t\t\t\t${visible ? '' : '<span class=\"bbgf-photo-badge\">Hidden</span>'}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<figcaption>${alt}${visibilityToggle || primaryAction ? `<div class=\"bbgf-photo-actions\">${primaryAction}${visibilityToggle}</div>` : ''}</figcaption>\n\t\t\t\t\t</figure>`;\n\t\t\t\t})\n\t\t\t\t.join('');\n\n\t\t\tif (!photoItems) {\n\t\t\t\tconst placeholder = getPlaceholderPhoto(visit);\n\t\t\t\tif (placeholder && placeholder.url) {\n\t\t\t\t\tconst alt = escapeHtml(placeholder.alt ?? clientName);\n\t\t\t\t\tphotoItems = `<figure class=\"bbgf-modal-photo\"><img src=\"${escapeHtml(placeholder.url)}\" alt=\"${alt}\"><figcaption>${alt}</figcaption></figure>`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst photosFooter = `\n\t\t\t\t<div class=\"bbgf-modal__actions bbgf-modal__actions--photos\">\n\t\t\t\t\t<span class=\"bbgf-modal__hint\">Changes save automatically.</span>\n\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--ghost\" data-role=\"bbgf-modal-close\">${escapeHtml(copy.modalClose)}</button>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tcontentHtml = `\n\t\t\t\t${settings.capabilities?.editVisits && !state.board?.readonly && !modal.readOnly ? `\n\t\t\t\t<div class=\"bbgf-photo-upload\" data-role=\"bbgf-photo-upload\">\n\t\t\t\t\t<label class=\"bbgf-photo-upload__file\">\n\t\t\t\t\t\t<input type=\"file\" accept=\"image/*\" data-role=\"bbgf-photo-file\" multiple>\n\t\t\t\t\t\t<span>${escapeHtml(copy.modalUploadPhoto)}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<label class=\"bbgf-photo-upload__visibility\">\n\t\t\t\t\t\t<input type=\"checkbox\" data-role=\"bbgf-photo-visible\" checked>\n\t\t\t\t\t\t<span>${escapeHtml(copy.modalVisibleToGuardian)}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<div class=\"bbgf-photo-upload__pending\">\n\t\t\t\t\t\t${pendingList}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bbgf-photo-upload__actions\">\n\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--ghost\" data-role=\"bbgf-photo-cancel\" ${\n\t\t\t\t\t\t\tmodal.isSaving || isPreparingUploads ? 'disabled' : pendingUploads.length ? '' : 'disabled'\n\t\t\t\t\t\t}>Clear</button>\n\t\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--primary\" data-role=\"bbgf-upload-photo\" ${\n\t\t\t\t\t\t\tisPreparingUploads || modal.isSaving || !pendingUploads.length ? 'disabled' : ''\n\t\t\t\t\t\t}>${escapeHtml(\n\t\t\t\t\t\t\tisPreparingUploads\n\t\t\t\t\t\t\t\t? copy.modalPreparingUpload\n\t\t\t\t\t\t\t\t: pendingUploads.length\n\t\t\t\t\t\t\t\t\t? `Upload ${pendingUploads.length} file${pendingUploads.length === 1 ? '' : 's'}`\n\t\t\t\t\t\t\t\t\t: copy.modalUploadPhoto\n\t\t\t\t\t\t)}</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>` : ''}\n\t\t\t\t<div class=\"bbgf-modal-photos\">\n\t\t\t\t\t${photoItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.modalNoPhotos)}</p>`}\n\t\t\t\t</div>\n\t\t\t\t${photosFooter}\n\t\t\t`;\n\t\t}\n\n\t\tif (modal.error) {\n\t\t\tcontentHtml = `<div class=\"bbgf-modal__error\">${escapeHtml(modal.error)}</div>${contentHtml}`;\n\t\t}\n\t}\n\n\tbody.innerHTML = contentHtml;\n\n\tif (modal.activeTab === 'notes') {\n\t\tconst instructionsField = body.querySelector('[data-field=\"instructions\"]');\n\t\tconst publicField = body.querySelector('[data-field=\"publicNotes\"]');\n\t\tconst privateField = body.querySelector('[data-field=\"privateNotes\"]');\n\t\tif (instructionsField) {\n\t\t\tinstructionsField.value = modal.form.instructions ?? '';\n\t\t}\n\t\tif (publicField) {\n\t\t\tpublicField.value = modal.form.publicNotes ?? '';\n\t\t}\n\t\tif (privateField) {\n\t\t\tprivateField.value = modal.form.privateNotes ?? '';\n\t\t}\n\t}\n\n\tif (modal.activeTab === 'services') {\n\t\tconst checkboxes = body.querySelectorAll('[data-role=\"bbgf-modal-service\"]');\n\t\tcheckboxes.forEach((input) => {\n\t\t\tconst id = Number(input.dataset.serviceId);\n\t\t\tinput.checked = servicesSelection.has(id);\n\t\t\tif (modal.isSaving) {\n\t\t\t\tinput.setAttribute('disabled', 'disabled');\n\t\t\t}\n\t\t});\n\t}\n\n\tif (title) {\n\t\tconst name = modal.visit?.client?.name ? `: ${modal.visit.client.name}` : '';\n\t\ttitle.textContent = `${copy.modalTitle}${name}`;\n\t}\n\n\tif (modal.readOnly) {\n\t\tcontainer.classList.add('bbgf-modal--readonly');\n\t} else {\n\t\tcontainer.classList.remove('bbgf-modal--readonly');\n\t}\n\n\tconst badge = container.querySelector('[data-role=\"bbgf-modal-readonly\"]');\n\tif (badge) {\n\t\tif (modal.readOnly) {\n\t\t\tbadge.removeAttribute('hidden');\n\t\t} else {\n\t\t\tbadge.setAttribute('hidden', 'hidden');\n\t\t}\n\t}\n\n\tconst activeElement = document.activeElement;\n\tif (closeButton && (!container.contains(activeElement) || activeElement === container)) {\n\t\twindow.requestAnimationFrame(() => closeButton.focus());\n\t}\n};\n\nconst renderIntakeModal = (state, root, copy) => {\n\tconst container = root.querySelector('#bbgf-intake-modal');\n\tif (!container) {\n\t\treturn;\n\t}\n\n\tconst { intake, board } = state;\n\tif (!intake.isOpen) {\n\t\tcontainer.setAttribute('hidden', 'hidden');\n\t\treturn;\n\t}\n\n\tcontainer.removeAttribute('hidden');\n\n\tconst body = container.querySelector('[data-role=\"bbgf-intake-body\"]');\n\tconst actions = container.querySelector('[data-role=\"bbgf-intake-actions\"]');\n\tif (!body || !actions) {\n\t\treturn;\n\t}\n\n\tconst activeElement = container.contains(document.activeElement) ? document.activeElement : null;\n\tconst focusMeta = activeElement\n\t\t? {\n\t\t\t\trole: activeElement.dataset?.role,\n\t\t\t\tsection: activeElement.dataset?.section,\n\t\t\t\tfield: activeElement.dataset?.field,\n\t\t\t\tselection:\n\t\t\t\t\ttypeof activeElement.selectionStart === 'number'\n\t\t\t\t\t\t? { start: activeElement.selectionStart, end: activeElement.selectionEnd }\n\t\t\t\t\t\t: null,\n\t\t  }\n\t\t: null;\n\n\tconst stages = ensureArray(board?.stages);\n\tconst viewLabel = safeString(board?.view?.name ?? board?.view?.slug ?? '');\n\tconst startingStageKey = resolveDefaultStageKey(board);\n\tconst startingStageLabel =\n\t\tstages.find((stage) => safeString(stage.key ?? stage.stage_key ?? '') === startingStageKey)?.label ?? startingStageKey;\n\n\tconst results = ensureArray(intake.searchResults);\n\tconst resultItems = results\n\t\t.map((item, index) => {\n\t\t\tconst client = item.client || {};\n\t\t\tconst guardian = item.guardian || {};\n\t\t\tconst clientName = safeString(client.name || '');\n\t\t\tconst guardianName =\n\t\t\t\tguardian && (guardian.first_name || guardian.last_name)\n\t\t\t\t\t? `${safeString(guardian.first_name)} ${safeString(guardian.last_name)}`.trim()\n\t\t\t\t\t: '';\n\t\t\tconst contactPieces = [guardian.phone_mobile || guardian.phone_alt || '', guardian.email || ''].filter(Boolean);\n\t\t\tconst meta = [client.breed || '', guardianName].filter(Boolean).join(' â€¢ ');\n\t\t\tconst contact = contactPieces.join(' â€¢ ');\n\t\t\treturn `\n\t\t\t\t<article class=\"bbgf-intake-result\">\n\t\t\t\t\t<div class=\"bbgf-intake-result__body\">\n\t\t\t\t\t\t<p class=\"bbgf-intake-result__title\">${escapeHtml(clientName || copy.unknownClient)}</p>\n\t\t\t\t\t\t${meta ? `<p class=\"bbgf-intake-result__meta\">${escapeHtml(meta)}</p>` : ''}\n\t\t\t\t\t\t${contact ? `<p class=\"bbgf-intake-result__contact\">${escapeHtml(contact)}</p>` : ''}\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type=\"button\" class=\"bbgf-button bbgf-button--ghost\" data-role=\"bbgf-intake-select\" data-result-index=\"${index}\">${escapeHtml(\n\t\t\t\t\t\tcopy.intakeSelect\n\t\t\t\t\t)}</button>\n\t\t\t\t</article>\n\t\t\t`;\n\t\t})\n\t\t.join('');\n\n\tconst guardian = intake.guardian || {};\n\tconst client = intake.client || {};\n\tconst visit = intake.visit || {};\n\tconst trimmedQuery = safeString(intake.searchQuery || '').trim();\n\tconst searchReady = trimmedQuery.length >= 2;\n\tconst tabs = [\n\t\t{ id: 'search', label: copy.intakeSearchLabel },\n\t\t{ id: 'guardian', label: copy.intakeGuardian },\n\t\t{ id: 'client', label: copy.intakeClient },\n\t\t{ id: 'visit', label: copy.intakeVisit },\n\t];\n\tconst activeTab = tabs.some((tab) => tab.id === intake.activeTab) ? intake.activeTab : 'search';\n\tconst tabsHtml = tabs\n\t\t.map((tab) => {\n\t\t\tconst isActive = tab.id === activeTab;\n\t\t\treturn `<button type=\"button\" class=\"bbgf-modal__tab${isActive ? ' is-active' : ''}\" data-role=\"bbgf-intake-tab\" data-tab=\"${tab.id}\" aria-selected=\"${isActive ? 'true' : 'false'}\">${escapeHtml(\n\t\t\t\ttab.label\n\t\t\t)}</button>`;\n\t\t})\n\t\t.join('');\n\n\tconst selectedBadge = intake.selected\n\t\t? `<div class=\"bbgf-intake-selected\">Using ${escapeHtml(intake.selected.client?.name ?? copy.unknownClient)}${\n\t\t\t\tintake.selected.guardian ? ` â€¢ ${escapeHtml(intake.selected.guardian?.first_name ?? '')} ${escapeHtml(intake.selected.guardian?.last_name ?? '')}` : ''\n\t\t  } <button type=\"button\" class=\"bbgf-chip-clear\" data-role=\"bbgf-intake-clear\" aria-label=\"${escapeHtml(copy.clearFilters || 'Clear')}\">Ã—</button></div>`\n\t\t: '';\n\n\tconst resultsBlock = searchReady\n\t\t? resultItems || `<p class=\"bbgf-modal__loading\">${escapeHtml(copy.intakeNoResults)}</p>`\n\t\t: `<p class=\"bbgf-modal__hint\">${escapeHtml('Start typing at least 2 characters to search.')}</p>`;\n\n\tconst searchPanel = `\n\t\t<section class=\"bbgf-intake-panel bbgf-intake-panel--search\" role=\"tabpanel\" aria-label=\"${escapeHtml(copy.intakeSearchLabel)}\">\n\t\t\t<label class=\"bbgf-field-label\">${escapeHtml(copy.intakeSearchLabel)}</label>\n\t\t\t<div class=\"bbgf-intake-search\">\n\t\t\t\t<input type=\"search\" data-role=\"bbgf-intake-search\" value=\"${escapeHtml(intake.searchQuery)}\" placeholder=\"${escapeHtml(copy.intakeSearchHint)}\" aria-label=\"${escapeHtml(\n\t\tcopy.intakeSearchLabel\n\t)}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-results\">\n\t\t\t\t${resultsBlock}\n\t\t\t</div>\n\t\t</section>\n\t`;\n\n\tconst guardianPanel = `\n\t\t<section class=\"bbgf-intake-panel\" role=\"tabpanel\" aria-label=\"${escapeHtml(copy.intakeGuardian)}\">\n\t\t\t<h3>${escapeHtml(copy.intakeGuardian)}</h3>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('First name')}</label>\n\t\t\t\t<input type=\"text\" data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"first_name\" value=\"${escapeHtml(guardian.first_name ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Last name')}</label>\n\t\t\t\t<input type=\"text\" data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"last_name\" value=\"${escapeHtml(guardian.last_name ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Email')}</label>\n\t\t\t\t<input type=\"email\" data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"email\" value=\"${escapeHtml(guardian.email ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Mobile')}</label>\n\t\t\t\t<input type=\"tel\" data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"phone\" value=\"${escapeHtml(guardian.phone ?? guardian.phone_mobile ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Preferred contact')}</label>\n\t\t\t\t<select data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"preferred_contact\">\n\t\t\t\t\t${['', 'email', 'phone_mobile', 'sms']\n\t\t\t\t\t\t.map((option) => {\n\t\t\t\t\t\t\tconst selected = safeString(option) === safeString(guardian.preferred_contact ?? '') ? 'selected' : '';\n\t\t\t\t\t\t\tconst label = option ? option.replace('_', ' ') : 'None';\n\t\t\t\t\t\t\treturn `<option value=\"${escapeHtml(option)}\" ${selected}>${escapeHtml(label)}</option>`;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.join('')}\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Notes')}</label>\n\t\t\t\t<textarea data-role=\"bbgf-intake-field\" data-section=\"guardian\" data-field=\"notes\">${escapeHtml(guardian.notes ?? '')}</textarea>\n\t\t\t</div>\n\t\t</section>\n\t`;\n\n\tconst clientPanel = `\n\t\t<section class=\"bbgf-intake-panel\" role=\"tabpanel\" aria-label=\"${escapeHtml(copy.intakeClient)}\">\n\t\t\t<h3>${escapeHtml(copy.intakeClient)}</h3>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Name')}</label>\n\t\t\t\t<input type=\"text\" data-role=\"bbgf-intake-field\" data-section=\"client\" data-field=\"name\" value=\"${escapeHtml(client.name ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Breed')}</label>\n\t\t\t\t<input type=\"text\" data-role=\"bbgf-intake-field\" data-section=\"client\" data-field=\"breed\" value=\"${escapeHtml(client.breed ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Weight')}</label>\n\t\t\t\t<input type=\"text\" inputmode=\"decimal\" data-role=\"bbgf-intake-field\" data-section=\"client\" data-field=\"weight\" value=\"${escapeHtml(client.weight ?? '')}\" placeholder=\"lbs\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Temperament')}</label>\n\t\t\t\t<input type=\"text\" data-role=\"bbgf-intake-field\" data-section=\"client\" data-field=\"temperament\" value=\"${escapeHtml(client.temperament ?? '')}\">\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml(copy.notes)}</label>\n\t\t\t\t<textarea data-role=\"bbgf-intake-field\" data-section=\"client\" data-field=\"notes\">${escapeHtml(client.notes ?? '')}</textarea>\n\t\t\t</div>\n\t\t</section>\n\t`;\n\n\tconst visitPanel = `\n\t\t<section class=\"bbgf-intake-panel\" role=\"tabpanel\" aria-label=\"${escapeHtml(copy.intakeVisit)}\">\n\t\t\t<h3>${escapeHtml(copy.intakeVisit)}</h3>\n\t\t\t${startingStageLabel ? `<p class=\"bbgf-modal__hint\">${escapeHtml(`Starts in ${startingStageLabel}`)}</p>` : ''}\n\t\t\t${viewLabel ? `<p class=\"bbgf-intake-view-hint\">${escapeHtml(`Will appear on the ${viewLabel} board`)}</p>` : ''}\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Instructions')}</label>\n\t\t\t\t<textarea data-role=\"bbgf-intake-field\" data-section=\"visit\" data-field=\"instructions\">${escapeHtml(visit.instructions ?? '')}</textarea>\n\t\t\t</div>\n\t\t\t<div class=\"bbgf-intake-field\">\n\t\t\t\t<label>${escapeHtml('Public notes')}</label>\n\t\t\t\t<textarea data-role=\"bbgf-intake-field\" data-section=\"visit\" data-field=\"public_notes\">${escapeHtml(visit.public_notes ?? '')}</textarea>\n\t\t\t</div>\n\t\t</section>\n\t`;\n\n\tconst panels = {\n\t\tsearch: searchPanel,\n\t\tguardian: guardianPanel,\n\t\tclient: clientPanel,\n\t\tvisit: visitPanel,\n\t};\n\n\tbody.innerHTML = `\n\t\t<div class=\"bbgf-modal__tabs bbgf-intake-tabs\" role=\"tablist\">\n\t\t\t${tabsHtml}\n\t\t</div>\n\t\t<div class=\"bbgf-intake-panel-wrap\" id=\"bbgf-intake-panel-${escapeHtml(activeTab)}\">\n\t\t\t${panels[activeTab] ?? ''}\n\t\t</div>\n\t`;\n\n\tactions.innerHTML = `${intake.error ? `<div class=\"bbgf-modal__error\">${escapeHtml(intake.error)}</div>` : ''}`;\n\n\tconst selectedSlot = container.querySelector('[data-role=\"bbgf-intake-selected-slot\"]');\n\tif (selectedSlot) {\n\t\tif (selectedBadge) {\n\t\t\tselectedSlot.innerHTML = selectedBadge;\n\t\t\tselectedSlot.removeAttribute('hidden');\n\t\t} else {\n\t\t\tselectedSlot.innerHTML = '';\n\t\t\tselectedSlot.setAttribute('hidden', 'hidden');\n\t\t}\n\t}\n\n\tconst headerActions = container.querySelector('[data-role=\"bbgf-intake-header-actions\"]');\n\tif (headerActions) {\n\t\tconst submitButton = headerActions.querySelector('[data-role=\"bbgf-intake-submit\"]');\n\t\tif (submitButton) {\n\t\t\tsubmitButton.textContent = intake.isSaving ? copy.intakeSaving : copy.intakeSubmit;\n\t\t\tsubmitButton.disabled = Boolean(intake.isSaving);\n\t\t}\n\t}\n\n\tconst restoreIntakeFocus = () => {\n\t\tif (focusMeta?.role) {\n\t\t\tlet selector = `[data-role=\"${focusMeta.role}\"]`;\n\t\t\tif (focusMeta.section) {\n\t\t\t\tselector += `[data-section=\"${focusMeta.section}\"]`;\n\t\t\t}\n\t\t\tif (focusMeta.field) {\n\t\t\t\tselector += `[data-field=\"${focusMeta.field}\"]`;\n\t\t\t}\n\t\t\tlet target = body.querySelector(selector);\n\t\t\tif (!target) {\n\t\t\t\ttarget = body.querySelector(`[data-role=\"${focusMeta.role}\"]`);\n\t\t\t}\n\n\t\t\tif (target && typeof target.focus === 'function') {\n\t\t\t\ttarget.focus({ preventScroll: true });\n\t\t\t\tif (focusMeta.selection && typeof target.setSelectionRange === 'function') {\n\t\t\t\t\tconst { start, end } = focusMeta.selection;\n\t\t\t\t\ttarget.setSelectionRange(start, end);\n\t\t\t\t} else if (typeof target.setSelectionRange === 'function' && typeof target.value === 'string') {\n\t\t\t\t\tconst end = target.value.length;\n\t\t\t\t\ttarget.setSelectionRange(end, end);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (intake.activeTab === 'search') {\n\t\t\tconst searchInput = body.querySelector('[data-role=\"bbgf-intake-search\"]');\n\t\t\tif (searchInput && typeof searchInput.focus === 'function') {\n\t\t\t\tsearchInput.focus({ preventScroll: true });\n\t\t\t\tif (typeof searchInput.setSelectionRange === 'function') {\n\t\t\t\t\tconst end = searchInput.value.length;\n\t\t\t\t\tsearchInput.setSelectionRange(end, end);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\trestoreIntakeFocus();\n};\n\nconst handleIntakeClick = (event) => {\n\tconst role = event.target.dataset?.role;\n\tif (role === 'bbgf-intake-tab') {\n\t\tconst tab = safeString(event.target.dataset.tab);\n\t\tconst allowedTabs = ['search', 'guardian', 'client', 'visit'];\n\t\tconst nextTab = allowedTabs.includes(tab) ? tab : 'search';\n\t\tsetIntakeState((current) => ({\n\t\t\t...current,\n\t\t\tactiveTab: nextTab,\n\t\t}));\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-intake-close') {\n\t\tcloseIntakeModal();\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-intake-select') {\n\t\tconst index = Number(event.target.dataset.resultIndex);\n\t\tconst results = store.getState().intake.searchResults || [];\n\t\tconst selected = Number.isInteger(index) ? results[index] : null;\n\t\tif (selected) {\n\t\t\tapplyIntakeSelection(selected);\n\t\t}\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-intake-clear') {\n\t\tsetIntakeState((current) => ({\n\t\t\t...current,\n\t\t\tselected: null,\n\t\t\tclient: { ...(current.client || {}), id: null, guardian_id: null },\n\t\t\tguardian: { ...(current.guardian || {}), id: null },\n\t\t}));\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-intake-submit') {\n\t\thandleIntakeSubmit();\n\t}\n};\n\nconst handleIntakeInput = (event) => {\n\tconst role = event.target.dataset?.role;\n\tif (role === 'bbgf-intake-search') {\n\t\thandleIntakeSearch(event.target.value || '');\n\t\treturn;\n\t}\n\n\tif (role === 'bbgf-intake-field') {\n\t\tconst section = event.target.dataset.section;\n\t\tconst field = event.target.dataset.field;\n\t\tupdateIntakeField(section, field, event.target.value);\n\t}\n};\n\nconst handleIntakeChange = (event) => {\n\tconst role = event.target.dataset?.role;\n\tif (role === 'bbgf-intake-field') {\n\t\tconst section = event.target.dataset.section;\n\t\tconst field = event.target.dataset.field;\n\t\tupdateIntakeField(section, field, event.target.value);\n\t}\n};\n\nconst handleIntakeEvents = (root) => {\n\tconst container = root.querySelector('#bbgf-intake-modal');\n\tif (!container || container.dataset.bound === 'true') {\n\t\treturn;\n\t}\n\n\tcontainer.addEventListener('click', handleIntakeClick);\n\tcontainer.addEventListener('input', handleIntakeInput, true);\n\tcontainer.addEventListener('change', handleIntakeChange);\n\n\tdocument.addEventListener('keydown', (event) => {\n\t\tif (event.key === 'Escape') {\n\t\t\tconst { intake } = store.getState();\n\t\t\tif (intake.isOpen) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tcloseIntakeModal();\n\t\t\t}\n\t\t}\n\t});\n\n\tcontainer.dataset.bound = 'true';\n};\n\nconst setupDragAndDrop = (root, state) => {\n\tif (currentPresentation.mode === 'display') {\n\t\treturn;\n\t}\n\n\tconst cards = root.querySelectorAll('.bbgf-card');\n\tconst readonly = state.board?.readonly;\n\n\tcards.forEach((card) => {\n\t\tif (readonly || !settings.capabilities?.moveStages) {\n\t\t\tcard.removeAttribute('draggable');\n\t\t\tcard.setAttribute('aria-grabbed', 'false');\n\t\t} else {\n\t\t\tcard.setAttribute('draggable', 'true');\n\t\t\tif (!card.hasAttribute('aria-grabbed')) {\n\t\t\t\tcard.setAttribute('aria-grabbed', 'false');\n\t\t\t}\n\t\t}\n\t});\n};\n\nconst handleBoardKeyDown = (event) => {\n\tconst card = event.target.closest('.bbgf-card');\n\tif (!card) {\n\t\treturn;\n\t}\n\n\tif (event.target.closest('.bbgf-card-actions button')) {\n\t\treturn;\n\t}\n\n\tif (event.key === 'Enter' || event.key === ' ') {\n\t\tevent.preventDefault();\n\t\tcard.click();\n\t\treturn;\n\t}\n\n\tif (event.key === 'ArrowLeft') {\n\t\tevent.preventDefault();\n\t\tmoveVisitWithDirection(card, 'prev');\n\t\treturn;\n\t}\n\n\tif (event.key === 'ArrowRight') {\n\t\tevent.preventDefault();\n\t\tmoveVisitWithDirection(card, 'next');\n\t}\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\tconst root = document.getElementById('bbgf-board-root');\n\tif (!root) {\n\t\treturn;\n\t}\n\n\tboardRootElement = root;\n\tboardRootElement.style.overflow = 'visible';\n\tboardRootElement.style.overflowX = 'visible';\n\tboardRootElement.style.overflowY = 'visible';\n\tapplyAppearanceTheme(boardRootElement);\n\tdocument.addEventListener('fullscreenchange', updateFullscreenButton);\n\tsyncLayoutMode(root);\n\n\tif (settings.context?.view) {\n\t\troot.dataset.activeView = settings.context.view;\n\t}\n\n\tconst initialStateSnapshot = store.getState();\n\trenderBoard(initialStateSnapshot, root, settings, strings);\n\tupdateToolbarStates(root, initialStateSnapshot);\n\tattachToolbarHandlers(root);\n\tsetupLastUpdatedTicker(root);\n\trenderModal(initialStateSnapshot, root, strings);\n\thandleModalEvents(root);\n\trenderIntakeModal(initialStateSnapshot, root, strings);\n\thandleIntakeEvents(root);\n\tsetupDragAndDrop(root, initialStateSnapshot);\n\tlastBoardStateRef = {\n\t\tboard: initialStateSnapshot.board,\n\t\tisLoading: initialStateSnapshot.isLoading,\n\t\tpendingMoves: initialStateSnapshot.pendingMoves,\n\t\tfilters: initialStateSnapshot.filters,\n\t\tviewOverride: initialStateSnapshot.viewOverride,\n\t\tnextRefreshAt: initialStateSnapshot.nextRefreshAt,\n\t\tlastFetchedAt: initialStateSnapshot.lastFetchedAt,\n\t\tlayout: initialStateSnapshot.layout,\n\t};\n\tlastModalSnapshot = {\n\t\tisOpen: initialStateSnapshot.modal.isOpen,\n\t\tactiveTab: initialStateSnapshot.modal.activeTab,\n\t\tloading: initialStateSnapshot.modal.loading,\n\t\treadOnly: initialStateSnapshot.modal.readOnly,\n\t\tisSaving: initialStateSnapshot.modal.isSaving,\n\t\terror: initialStateSnapshot.modal.error,\n\t\tvisitId: initialStateSnapshot.modal.visit?.id || null,\n\t\tpendingUploads: initialStateSnapshot.modal.pendingUploads,\n\t\tisPreparingUploads: initialStateSnapshot.modal.isPreparingUploads,\n\t};\n\tlastIntakeSnapshot = initialStateSnapshot.intake;\n\tlastCatalogRef = initialStateSnapshot.catalog;\n\tlastErrorsRef = initialStateSnapshot.errors;\n\n\tstore.subscribe((state) => {\n\t\tconst boardChanged =\n\t\t\t!lastBoardStateRef ||\n\t\t\tstate.board !== lastBoardStateRef.board ||\n\t\t\tstate.isLoading !== lastBoardStateRef.isLoading ||\n\t\t\tstate.pendingMoves !== lastBoardStateRef.pendingMoves ||\n\t\t\tstate.filters !== lastBoardStateRef.filters ||\n\t\t\tstate.viewOverride !== lastBoardStateRef.viewOverride ||\n\t\t\tstate.nextRefreshAt !== lastBoardStateRef.nextRefreshAt ||\n\t\t\tstate.lastFetchedAt !== lastBoardStateRef.lastFetchedAt ||\n\t\t\tstate.layout !== lastBoardStateRef.layout;\n\n\t\tconst errorsChanged = state.errors !== lastErrorsRef;\n\t\tif (boardChanged) {\n\t\t\trenderBoard(state, root, settings, strings);\n\t\t\tupdateToolbarStates(root, state);\n\t\t\tattachToolbarHandlers(root);\n\t\t\tsetupLastUpdatedTicker(root);\n\t\t\thandleModalEvents(root);\n\t\t\tsetupDragAndDrop(root, state);\n\t\t\thandleIntakeEvents(root);\n\t\t\tlastBoardStateRef = {\n\t\t\t\tboard: state.board,\n\t\t\t\tisLoading: state.isLoading,\n\t\t\t\tpendingMoves: state.pendingMoves,\n\t\t\t\tfilters: state.filters,\n\t\t\t\tviewOverride: state.viewOverride,\n\t\t\t\tnextRefreshAt: state.nextRefreshAt,\n\t\t\t\tlastFetchedAt: state.lastFetchedAt,\n\t\t\t\tlayout: state.layout,\n\t\t\t};\n\t\t} else if (errorsChanged) {\n\t\t\trenderErrors(state, root, strings);\n\t\t}\n\n\t\tconst modalStructuralChanged =\n\t\t\t!lastModalSnapshot ||\n\t\t\tstate.modal.isOpen !== lastModalSnapshot.isOpen ||\n\t\t\tstate.modal.activeTab !== lastModalSnapshot.activeTab ||\n\t\t\tstate.modal.loading !== lastModalSnapshot.loading ||\n\t\t\tstate.modal.readOnly !== lastModalSnapshot.readOnly ||\n\t\t\tstate.modal.isSaving !== lastModalSnapshot.isSaving ||\n\t\t\tstate.modal.error !== lastModalSnapshot.error ||\n\t\t\tstate.modal.pendingUploads !== lastModalSnapshot.pendingUploads ||\n\t\t\tstate.modal.isPreparingUploads !== lastModalSnapshot.isPreparingUploads ||\n\t\t\t(state.modal.visit?.id || null) !== (lastModalSnapshot.visitId || null) ||\n\t\t\tstate.catalog !== lastCatalogRef;\n\n\t\tif (modalStructuralChanged) {\n\t\t\trenderModal(state, root, strings);\n\t\t\thandleModalEvents(root);\n\t\t\tlastModalSnapshot = {\n\t\t\t\tisOpen: state.modal.isOpen,\n\t\t\t\tactiveTab: state.modal.activeTab,\n\t\t\t\tloading: state.modal.loading,\n\t\t\t\treadOnly: state.modal.readOnly,\n\t\t\t\tisSaving: state.modal.isSaving,\n\t\t\t\terror: state.modal.error,\n\t\t\t\tvisitId: state.modal.visit?.id || null,\n\t\t\t\tpendingUploads: state.modal.pendingUploads,\n\t\t\t\tisPreparingUploads: state.modal.isPreparingUploads,\n\t\t\t};\n\t\t\tlastCatalogRef = state.catalog;\n\t\t}\n\n\t\tconst intakeChanged = state.intake !== lastIntakeSnapshot;\n\t\tif (intakeChanged) {\n\t\t\trenderIntakeModal(state, root, strings);\n\t\t\thandleIntakeEvents(root);\n\t\t\tlastIntakeSnapshot = state.intake;\n\t\t}\n\n\t\tlastErrorsRef = state.errors;\n\t});\n\n\twindow.bbgfBoardSettings = settings;\n\twindow.bbgfBoardStore = store;\n\twindow.bbgfBoardApi = api;\n\twindow.bbgfBoardRefresh = () => loadBoard({ reason: 'manual', forceFull: true });\n\n\troot.addEventListener('click', handleBoardClick);\n\troot.addEventListener('keydown', handleBoardKeyDown);\n\troot.addEventListener('dragstart', handleDragStart);\n\troot.addEventListener('dragend', handleDragEnd);\n\troot.addEventListener('dragover', handleDragOver);\n\troot.addEventListener('dragleave', handleDragLeave);\n\troot.addEventListener('drop', handleDrop);\n\troot.addEventListener('touchstart', handleTouchStart, { passive: true });\n\troot.addEventListener('touchmove', handleTouchMove, { passive: false });\n\troot.addEventListener('touchend', handleTouchEnd, { passive: true });\n\twindow.addEventListener('resize', handleLayoutResize, { passive: true });\n\twindow.addEventListener('orientationchange', handleLayoutResize, { passive: true });\n\n\tloadBoard({ reason: 'initial', forceFull: !settings.initialBoard });\n});\n"],"names":["settings","strings","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","_y","_z","_A","_B","_C","_D","_E","_F","_G","_H","_I","_J","_K","_L","_M","_N","_O","_P","_Q","_R","_S","_T","_U","_V","_W","_X","_Y","_Z","__","_$","_aa","_ba","_ca","_da","_ea","_fa","_ga","_ha","_ia","_ja","_ka","presentation","appearance","appearanceColors","showServicesSetting","showFlagsSetting","ensureArray","value","safeString","toNumber","parsed","placeholderPhotos","_la","url","resolvePresentationConfig","board","modeCandidate","mode","pickFlag","key","fallback","defaultMaskBadge","viewSwitcherValue","allowSwitcher","viewSwitcher","cloneVisit","visit","cloneStage","stage","parseTimestamp","ts","getVisitSortTimestamp","checkIn","created","updated","sortVisitsFifo","visits","a","b","timeDiff","sortBoardStages","sortedStages","getDefaultExpandedStage","stages","firstWithVisits","evaluateLayoutMode","root","requiredForThree","syncLayoutMode","state","store","requestedMode","stageKeys","wasVertical","expandedStage","setLayoutState","buildStageMap","map","applyBoardPatch","currentBoard","patchBoard","currentStageMap","patchStageMap","changedVisitIds","filtered","existing","existingVisits","patchVisits","mergedStage","mergedStages","aOrder","bOrder","findVisitById","visitId","normalizedId","formatDuration","totalSeconds","seconds","hours","minutes","remainingSeconds","formatTime","isoString","date","formatDateForLastUpdated","formatDateTime","humanizeRelativeTime","target","deltaSeconds","days","getTimerState","thresholds","yellow","red","extractPrimaryPhoto","photos","list","first","candidate","getPlaceholderPhoto","index","clientName","getVisitPhoto","loadImageForCanvas","file","bitmap","resolve","reject","image","error","normalizeImageFile","options","maxDimension","maxBytes","baseQuality","largestSide","scale","targetWidth","targetHeight","canvas","ctx","mimeType","toBlob","quality","blob","attempts","compressionScale","scaledWidth","scaledHeight","baseName","extension","buildServiceSummary","services","service","applyAppearanceTheme","setColor","token","escapeHtml","char","buildModalFormFromVisit","id","getStageNeighbors","stageKey","formatCountdownSeconds","targetTimestamp","delta","overflowResizeHandler","applyBoardOverflowState","wrapper","layoutMode","boardMode","overflowing","shouldCenter","formatCheckIn","time","resolveTimerSeconds","raw","maxReasonableSeconds","startIso","startDate","createStore","initialState","listeners","updater","nextState","listener","createApiClient","rest","context","fallbackNonce","buildHeaders","headers","buildUrl","endpoint","params","query","response","toStage","payload","message","data","visibleToGuardian","formData","photoId","clientId","createCardElement","copy","pendingMoves","readonly","draggingVisitId","card","visitIdNumber","isPending","isDragging","timerSeconds","timerState","photoWrapper","photoData","img","body","topRow","info","name","breed","breedLine","visitFlags","clientFlags","combinedFlags","seenFlagIds","flag","flagsWrapper","chip","emoji","nameSpan","timerRow","timer","checkInText","checkInSpan","servicesWrapper","icon","label","createColumnElement","count","isVertical","isExpanded","column","header","title","labelSpan","countSpan","toggle","empty","getActiveViewSlug","renderBoard","config","layoutState","loading","ui","currentPresentation","preservedModal","preservedIntakeModal","viewType","renderErrors","columnsWrapper","baseStages","filterVisit","pendingSet","reapplyOverflow","startTimerTicker","controls","intakeButton","refreshButton","fullscreenToggle","existingModal","modal","intakeModalExisting","intakeModal","lastUpdatedNode","dismissError","toastTimer","container","boardRootElement","messageNode","attachToolbarHandlers","loadBoard","fullscreenButton","toggleFullscreen","updateFullscreenButton","updateToolbarStates","setupLastUpdatedTicker","targets","update","node","base","humanized","refreshNode","countdown","total","announce","resolveDefaultStageKey","getDefaultIntakeState","api","setModalState","preparePhotoUploads","files","photoPreparationToken","normalized","setIntakeState","intake","layout","setDragState","drag","setNextRefreshAt","timestamp","ensureServicesCatalog","current","ensureFlagsCatalog","flags","loadClientHistory","page","append","perPage","ensureClientHistory","updateModalFormField","field","toggleModalService","serviceId","isChecked","toggleClientFlag","flagId","saveClientFlags","refreshed","prev","refreshBoardAfterModalSave","handleModalTabChange","tabId","handleModalMove","direction","neighbors","moveVisitToStage","openVisitModal","handleModalCheckout","closeModal","handleModalPhotoUpload","button","fileInput","visibleCheckbox","visible","handlePhotoVisibilityChange","setPhotoAsPrimary","openPhotoLightbox","lightbox","event","saveModalNotes","saveModalServices","handleModalSave","section","getPollIntervalMs","pollTimer","modalLastFocusedElement","currentDragHoverStage","lastBoardStateRef","lastModalSnapshot","lastIntakeSnapshot","lastCatalogRef","lastErrorsRef","activeTouchDrag","intakeSearchTimer","layoutResizeTimer","isFullscreen","handleLayoutResize","clearPollTimer","scheduleNextPoll","delay","reason","forceFull","targetView","currentState","activeView","useModifiedAfter","mergedBoard","updatePendingMoves","action","visitNumericId","moveVisitWithDirection","fromStage","next","handleQuickMove","handleBoardClick","columnToggle","openIntakeModal","moveNext","movePrev","resetIntakeState","closeIntakeModal","applyIntakeSelection","item","defaults","guardian","client","updateIntakeField","handleIntakeSearch","term","trimmed","results","handleIntakeSubmit","guardianFirst","guardianLast","viewId","guardianPayload","weightValue","clientPayload","handleModalContainerClick","targetEl","role","tab","nextPage","dialog","panelId","panel","parent","upload","preview","handleModalContainerInput","handleModalContainerChange","dataset","checked","boardVisit","nextTab","highlightColumn","handleDragStart","handleDragEnd","handleDragOver","handleDragLeave","handleDrop","targetStage","getTouchTargetColumn","touchEvent","point","element","handleTouchStart","handleTouchMove","handleTouchEnd","handleModalEvents","backdrop","closeButton","renderModal","previous","tabsNav","nav","tabs","isActive","canEdit","canMove","prevButton","nextButton","checkoutButton","checkoutTime","checkoutMeta","contentHtml","stageLabel","maskGuardian","servicesSelection","catalogServices","photoMarkup","serviceChips","text","allFlags","flagChips","tagsHtml","guardianName","contactPieces","guardianMetaPieces","piece","guardianMeta","checkOut","elapsedDisplay","instructions","publicNotes","privateNotes","summaryItems","summaryGridHtml","noteBlocks","notesHtml","note","serviceList","historyItems","entry","when","from","to","comment","duration","flagOptions","selectedClientFlags","flagList","flagsSection","historyState","servicesSummary","photo","targetId","isFirst","historyFooter","historyStatus","hasHistoryItems","pendingUploads","isPreparingUploads","pendingList","photoItems","alt","isPrimary","visibilityToggle","primaryAction","placeholder","photosFooter","instructionsField","publicField","privateField","input","badge","activeElement","renderIntakeModal","actions","focusMeta","viewLabel","startingStageKey","startingStageLabel","resultItems","meta","contact","searchReady","activeTab","tabsHtml","selectedBadge","resultsBlock","searchPanel","guardianPanel","option","selected","clientPanel","visitPanel","panels","selectedSlot","headerActions","submitButton","selector","start","end","searchInput","handleIntakeClick","handleIntakeInput","handleIntakeChange","handleIntakeEvents","setupDragAndDrop","cards","handleBoardKeyDown","initialStateSnapshot","boardChanged","errorsChanged"],"mappings":"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"}