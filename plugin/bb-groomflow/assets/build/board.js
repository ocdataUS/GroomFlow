(function(){"use strict";var _t,kt,$t,Nt,Ct,Et,Lt,Tt,xt,It,At,Mt,Pt,Vt,Ot,Ft,Dt,qt,jt,Ut,Bt,Rt,Ht,Gt,zt,Qt,Wt,Jt,Kt,Xt,Yt,Zt,ea,ta,aa,sa,na,ia,oa,ra,la,da,ca,ba,ua,ga,fa,ma,pa,ha,va,ya,Sa,wa,_a,ka,$a,Na,Ca;const l=window.bbgfBoardSettings||{},y={loading:((_t=l.strings)==null?void 0:_t.loading)??"Loading GroomFlow board‚Ä¶",emptyColumn:((kt=l.strings)==null?void 0:kt.emptyColumn)??"No visits in this stage yet",noVisits:(($t=l.strings)==null?void 0:$t.noVisits)??"No visits available.",refresh:((Nt=l.strings)==null?void 0:Nt.refresh)??"Refresh",lastUpdated:((Ct=l.strings)==null?void 0:Ct.lastUpdated)??"Last updated",viewSwitcher:((Et=l.strings)==null?void 0:Et.viewSwitcher)??"Board views",services:((Lt=l.strings)==null?void 0:Lt.services)??"Services",flags:((Tt=l.strings)==null?void 0:Tt.flags)??"Behavior flags",notes:((xt=l.strings)==null?void 0:xt.notes)??"Notes",checkIn:((It=l.strings)==null?void 0:It.checkIn)??"Check-in",movePrev:((At=l.strings)==null?void 0:At.movePrev)??"Back",moveNext:((Mt=l.strings)==null?void 0:Mt.moveNext)??"Next",unknownClient:((Pt=l.strings)==null?void 0:Pt.unknownClient)??"Client",stageControls:((Vt=l.strings)==null?void 0:Vt.stageControls)??"Stage controls",loadingError:((Ot=l.strings)==null?void 0:Ot.loadingError)??"Unable to load the board. Please refresh.",modalTitle:((Ft=l.strings)==null?void 0:Ft.modalTitle)??"Visit details",modalLoading:((Dt=l.strings)==null?void 0:Dt.modalLoading)??"Loading visit‚Ä¶",modalClose:((qt=l.strings)==null?void 0:qt.modalClose)??"Close",modalReadOnly:((jt=l.strings)==null?void 0:jt.modalReadOnly)??"Read-only view",modalSummary:((Ut=l.strings)==null?void 0:Ut.modalSummary)??"Summary",modalNotes:((Bt=l.strings)==null?void 0:Bt.modalNotes)??"Notes",modalServices:((Rt=l.strings)==null?void 0:Rt.modalServices)??"Services",modalVisit:((Ht=l.strings)==null?void 0:Ht.modalVisit)??"Visit",modalHistory:((Gt=l.strings)==null?void 0:Gt.modalHistory)??"History",modalPhotos:((zt=l.strings)==null?void 0:zt.modalPhotos)??"Photos",modalNoPrevious:((Qt=l.strings)==null?void 0:Qt.modalNoPrevious)??"No previous visits found.",modalUploadPhoto:((Wt=l.strings)==null?void 0:Wt.modalUploadPhoto)??"Upload photo",modalVisibleToGuardian:((Jt=l.strings)==null?void 0:Jt.modalVisibleToGuardian)??"Visible to guardian",modalViewPhoto:((Kt=l.strings)==null?void 0:Kt.modalViewPhoto)??"View full size",modalSave:((Xt=l.strings)==null?void 0:Xt.modalSave)??"Save changes",modalSaving:((Yt=l.strings)==null?void 0:Yt.modalSaving)??"Saving‚Ä¶",modalNoHistory:((Zt=l.strings)==null?void 0:Zt.modalNoHistory)??"No history recorded yet.",modalNoPhotos:((ea=l.strings)==null?void 0:ea.modalNoPhotos)??"No photos uploaded for this visit.",searchPlaceholder:((ta=l.strings)==null?void 0:ta.searchPlaceholder)??"Search clients, guardians, services‚Ä¶",moveSuccess:((aa=l.strings)==null?void 0:aa.moveSuccess)??"Visit moved.",fullscreen:((sa=l.strings)==null?void 0:sa.fullscreen)??"Fullscreen",exitFullscreen:((na=l.strings)==null?void 0:na.exitFullscreen)??"Exit fullscreen",autoRefresh:((ia=l.strings)==null?void 0:ia.autoRefresh)??"Auto-refresh in",maskedGuardian:((oa=l.strings)==null?void 0:oa.maskedGuardian)??"Guardian hidden for lobby view",errorFetching:((ra=l.strings)==null?void 0:ra.errorFetching)??"Unable to refresh the board. Please try again.",activeVisits:((la=l.strings)==null?void 0:la.activeVisits)??"Active visits",overdueVisits:((da=l.strings)==null?void 0:da.overdueVisits)??"Overdue",flaggedVisits:((ca=l.strings)==null?void 0:ca.flaggedVisits)??"Flagged",filtersActive:((ba=l.strings)==null?void 0:ba.filtersActive)??"Filters applied",clearFilters:((ua=l.strings)==null?void 0:ua.clearFilters)??"Clear filters",guardianLabel:((ga=l.strings)==null?void 0:ga.guardianLabel)??"Guardian",stageLabel:((fa=l.strings)==null?void 0:fa.stageLabel)??"Stage",stagesLabel:((ma=l.strings)==null?void 0:ma.stagesLabel)??"Stages",intakeTitle:((pa=l.strings)==null?void 0:pa.intakeTitle)??"Check in a client",intakeSearchLabel:((ha=l.strings)==null?void 0:ha.intakeSearchLabel)??"Search clients or guardians",intakeNoResults:((va=l.strings)==null?void 0:va.intakeNoResults)??"No matches found. Add a new client below.",intakeGuardian:((ya=l.strings)==null?void 0:ya.intakeGuardian)??"Guardian",intakeClient:((Sa=l.strings)==null?void 0:Sa.intakeClient)??"Client",intakeVisit:((wa=l.strings)==null?void 0:wa.intakeVisit)??"Visit details",intakeSubmit:((_a=l.strings)==null?void 0:_a.intakeSubmit)??"Create visit",intakeSaving:((ka=l.strings)==null?void 0:ka.intakeSaving)??"Creating visit‚Ä¶",intakeSuccess:(($a=l.strings)==null?void 0:$a.intakeSuccess)??"Visit created and added to the board.",intakeSearchHint:((Na=l.strings)==null?void 0:Na.intakeSearchHint)??"Search by client, guardian, phone, or email."},Ve=l.presentation||{},Ee=l.appearance||{},G=Ee.colors||{},La=Ee.show_services!==!1,Ta=Ee.show_flags!==!1;Ee.show_notes;const S=e=>Array.isArray(e)?e:[],g=e=>typeof e=="string"?e:"",Z=e=>{const t=Number(e);return Number.isFinite(t)?t:null},Oe=S((Ca=l.placeholders)==null?void 0:Ca.photos).filter(e=>typeof e=="string"&&e.length>0),xa=e=>{var c,v;const t=g(Ve.mode??"");let a=t==="display"||t==="interactive"?t:"";a||(a=e.readonly||e.is_public?"display":"interactive");const n=(C,N)=>{const A=Ve[C];return typeof A=="boolean"?A:N},s=a==="display"?!1:!!((c=e.visibility)!=null&&c.mask_guardian),i=g(Ve.view_switcher??""),r=((v=e==null?void 0:e.view)==null?void 0:v.allow_switcher)!==!1;let b=["dropdown","buttons","none"].includes(i)?i:a==="display"?"none":"dropdown";return(!r||a==="display")&&(b="none"),{mode:a,showToolbar:n("show_toolbar",a!=="display"),showSearch:n("show_search",a!=="display"),showFilters:n("show_filters",a!=="display"),showRefresh:n("show_refresh",a!=="display"),showLastUpdated:n("show_last_updated",a!=="display"),showCountdown:n("show_countdown",a!=="display"),showFullscreen:n("show_fullscreen",!0),showMaskBadge:n("show_mask_badge",s),showNotes:n("show_notes",a!=="display"),viewSwitcher:b}},Fe=e=>e&&typeof e=="object"?JSON.parse(JSON.stringify(e)):e,Xe=e=>!e||typeof e!="object"?e:{...e,visits:S(e.visits).map(t=>Fe(t))},Ye=e=>{const t=new Map;return S(e).forEach(a=>{const n=g((a==null?void 0:a.key)??(a==null?void 0:a.stage_key));n&&t.set(n,Xe(a))}),t},Ia=(e,t)=>{if(!t||typeof t!="object")return e;if(!e||typeof e!="object")return t;const a=Ye(e.stages),n=Ye(t.stages);if(!n.size)return{...e,...t,stages:S(e.stages).map(r=>Xe(r))};const s=new Set;n.forEach(r=>{S(r.visits).forEach(b=>{b&&(b.id||b.id===0)&&s.add(Number(b.id))})}),s.size&&a.forEach((r,b)=>{if(!r)return;const c=S(r.visits).filter(v=>!v||v.id===void 0||v.id===null?!0:!s.has(Number(v.id)));a.set(b,{...r,visits:c})}),n.forEach((r,b)=>{const c=a.get(b),v=S(c==null?void 0:c.visits).map(A=>Fe(A)),C=S(r.visits).map(A=>Fe(A)),N={...c??{},...r,visits:[...v,...C]};a.set(b,N)});const i=Array.from(a.values());return i.sort((r,b)=>{const c=Z(r==null?void 0:r.sort_order)??0,v=Z(b==null?void 0:b.sort_order)??0;return c-v}),{...e,...t,stages:i}},Aa=(e,t)=>{const a=Number(t);if(!e||Number.isNaN(a))return null;for(const n of S(e.stages))for(const s of S(n.visits))if(Number(s==null?void 0:s.id)===a)return{stage:n,visit:s};return null},Le=e=>{if(!Number.isFinite(e))return">1m";const t=Math.max(0,Math.floor(e)),a=Math.floor(t/3600),n=Math.floor(t%3600/60),s=t%60;return t<60?">1m":a>=1?`${a}h ${n.toString().padStart(2,"0")}m`:n>=1?`${n}m`:`${s}s`},Ze=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})},Ma=e=>Ze(e),Te=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString([],{hour:"numeric",minute:"2-digit",month:"short",day:"numeric",year:"numeric"})},Pa=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n=Math.round((new Date().getTime()-t.getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const s=Math.round(n/60);if(s<60)return`${s} min${s===1?"":"s"} ago`;const i=Math.round(s/60);if(i<24)return`${i} hr${i===1?"":"s"} ago`;const r=Math.round(i/24);return`${r} day${r===1?"":"s"} ago`},et=(e,t={})=>{const a=Z(t.yellow)??0,n=Z(t.red)??0;return n>0&&e>=n?"critical":a>0&&e>=a?"warning":"on-track"},Va=e=>{var n,s,i;const t=S(e);if(!t.length)return null;const a=t[0];if(!a||typeof a!="object")return null;if(a.url)return{url:a.url,alt:g(a.alt)};if(a.sizes){const r=((n=a.sizes.thumbnail)==null?void 0:n.url)||((s=a.sizes.medium)==null?void 0:s.url)||((i=a.sizes.full)==null?void 0:i.url);if(r)return{url:r,alt:g(a.alt)}}return null},tt=e=>{var i;if(!Oe.length)return null;const t=Number(e==null?void 0:e.id),a=Number.isFinite(t)?Math.abs(t)%Oe.length:0,n=Oe[a],s=g(((i=e==null?void 0:e.client)==null?void 0:i.name)??y.unknownClient);return{url:n,alt:s?`${s} placeholder photo`:y.unknownClient}},at=e=>Va(e==null?void 0:e.photos)??tt(e),Oa=e=>{if(!e)return;const t=(a,n)=>{typeof n=="string"&&n&&e.style.setProperty(a,n)};t("--bbgf-accent",G.accent),t("--bbgf-card-bg",G.card),t("--bbgf-column-bg",G.column),t("--bbgf-background-start",G.background_start),t("--bbgf-background-end",G.background_end),t("--bbgf-text",G.text),G.text&&(t("--bbgf-muted",G.text),t("--bbgf-muted-soft",G.text)),t("--bbgf-warning",G.timer_warning),t("--bbgf-critical",G.timer_critical),t("--bbgf-flag",G.flag)},o=e=>g(e).replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}),De=e=>!e||typeof e!="object"?{instructions:"",publicNotes:"",privateNotes:"",services:[]}:{instructions:g(e.instructions??""),publicNotes:g(e.public_notes??""),privateNotes:g(e.private_notes??""),services:S(e.services).map(t=>Number(t==null?void 0:t.id)).filter(t=>Number.isFinite(t))},qe=(e,t)=>{const a=S(e==null?void 0:e.stages),n=a.findIndex(s=>s.key===t);return n===-1?{prev:null,next:null}:{prev:n>0?a[n-1]:null,next:n<a.length-1?a[n+1]:null}},Fa=e=>{if(!e)return"";const t=Math.round((e-Date.now())/1e3);if(t<=0)return"0s";if(t<60)return`${t}s`;const a=Math.floor(t/60),n=t%60;return`${a}m ${n.toString().padStart(2,"0")}s`},Da=e=>{const t=Ze(e);return t?`${y.checkIn} ${t}`:""},qa=e=>{const t=Z(e==null?void 0:e.timer_elapsed_seconds),a=60*60*24*14;if(Number.isFinite(t)&&t>=0&&t<=a)return t;const n=(e==null?void 0:e.timer_started_at)||(e==null?void 0:e.check_in_at);if(n){const s=new Date(n);if(!Number.isNaN(s.getTime()))return Math.max(0,Math.round((Date.now()-s.getTime())/1e3))}return Number.isFinite(t)&&t>=0?t:0},ja=(e={})=>{let t={...e};const a=new Set;return{getState:()=>t,setState:n=>{const s=typeof n=="function"?n(t):n;!s||typeof s!="object"||(t={...t,...s},a.forEach(i=>{try{i(t)}catch(r){console.error("[BBGF] store listener error",r)}}))},subscribe:n=>typeof n!="function"?()=>{}:(a.add(n),()=>a.delete(n))}},Ua=(e={},t={})=>{var V;const a=((V=window==null?void 0:window.wpApiSettings)==null?void 0:V.nonce)||"",n=()=>{const f={Accept:"application/json"};return(e.nonce||a)&&(f["X-WP-Nonce"]=e.nonce||a),f},s=(f,p={})=>{if(!f)return"";const _=new URL(f,window.location.origin);return Object.entries(p).forEach(([d,h])=>{h==null||h===""||_.searchParams.append(d,h)}),_.toString()};return{fetchBoard:async(f={})=>{var h;const p={...f};t.publicToken&&(p.public_token=t.publicToken);const _=s((h=e.endpoints)==null?void 0:h.board,p);if(!_)throw new Error("Board endpoint unavailable");const d=await fetch(_,{method:"GET",headers:n(),credentials:"same-origin"});if(!d.ok)throw new Error(`Board request failed with status ${d.status}`);return d.json()},fetchVisit:async(f,p={})=>{var $;const _=($=e.endpoints)==null?void 0:$.visits;if(!_)throw new Error("Visit endpoint unavailable");const d={...p};t.publicToken&&!d.public_token&&(d.public_token=t.publicToken),t.view&&!d.view&&(d.view=t.view);const h=s(`${_}/${encodeURIComponent(f)}`,d),u=await fetch(h,{method:"GET",headers:n(),credentials:"same-origin"});if(!u.ok)throw new Error(`Visit request failed with status ${u.status}`);return u.json()},moveVisit:async(f,p,_={})=>{var $;const d=($=e.endpoints)==null?void 0:$.visits;if(!d)throw new Error("Visit endpoint unavailable");const h=s(`${d}/${encodeURIComponent(f)}/move`),u=await fetch(h,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({to_stage:p,comment:_.comment??""})});if(!u.ok){let T=`Move failed with status ${u.status}`;try{const P=await u.json();P!=null&&P.message&&(T=P.message)}catch{}throw new Error(T)}return u.json()},updateVisit:async(f,p={})=>{var u;const _=(u=e.endpoints)==null?void 0:u.visits;if(!_)throw new Error("Visit endpoint unavailable");const d=s(`${_}/${encodeURIComponent(f)}`),h=await fetch(d,{method:"PATCH",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(p)});if(!h.ok){let $=`Update failed with status ${h.status}`;try{const T=await h.json();T!=null&&T.message&&($=T.message)}catch{}throw new Error($)}return h.json()},createVisit:async(f={})=>{var h;const p=(h=e.endpoints)==null?void 0:h.visits;if(!p)throw new Error("Visit endpoint unavailable");const _=s(p),d=await fetch(_,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(f)});if(!d.ok){let u=`Create failed with status ${d.status}`;try{const $=await d.json();$!=null&&$.message&&(u=$.message)}catch{}throw new Error(u)}return d.json()},searchIntake:async(f="")=>{var u;const p=(u=e.endpoints)==null?void 0:u.intakeSearch;if(!p)throw new Error("Intake search endpoint unavailable");const _=s(p,{query:f}),d=await fetch(_,{method:"GET",headers:n(),credentials:"same-origin"});if(!d.ok)throw new Error(`Search failed with status ${d.status}`);const h=await d.json();return(h==null?void 0:h.items)??[]},addPhoto:async(f,p,_=!0)=>{var T;const d=(T=e.endpoints)==null?void 0:T.visits;if(!d)throw new Error("Visit endpoint unavailable");const h=s(`${d}/${encodeURIComponent(f)}/photo`),u=new FormData;u.append("visible_to_guardian",_?"1":"0"),u.append("file",p);const $=await fetch(h,{method:"POST",headers:n(),credentials:"same-origin",body:u});if(!$.ok){let P=`Photo upload failed with status ${$.status}`;try{const R=await $.json();R!=null&&R.message&&(P=R.message)}catch{}throw new Error(P)}return $.json()},updatePhoto:async(f,p,_={})=>{var $;const d=($=e.endpoints)==null?void 0:$.visits;if(!d)throw new Error("Visit endpoint unavailable");const h=s(`${d}/${encodeURIComponent(f)}/photo/${encodeURIComponent(p)}`),u=await fetch(h,{method:"PATCH",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(_)});if(!u.ok){let T=`Photo update failed with status ${u.status}`;try{const P=await u.json();P!=null&&P.message&&(T=P.message)}catch{}throw new Error(T)}return u.json()},fetchServices:async()=>{var d;const f=(d=e.endpoints)==null?void 0:d.services;if(!f)throw new Error("Services endpoint unavailable");const p=s(f,{per_page:100,context:"view"}),_=await fetch(p,{method:"GET",headers:n(),credentials:"same-origin"});if(!_.ok)throw new Error(`Services request failed with status ${_.status}`);return _.json()}}},Ba=(e,t,a)=>{var be,ue,ge,k,D,q,W;const{copy:n,pendingMoves:s,readonly:i,draggingVisitId:r}=a,b=g(t.key??t.stage_key??""),c=document.createElement("article");c.className="bbgf-card",c.dataset.visitId=String(e.id??""),c.dataset.stage=b,c.dataset.updatedAt=g(e.updated_at??""),c.setAttribute("role","listitem"),c.setAttribute("aria-label",g(((be=e.client)==null?void 0:be.name)??n.unknownClient)),!i&&((ue=l.capabilities)!=null&&ue.moveStages)?(c.setAttribute("draggable","true"),c.classList.add("bbgf-card--draggable")):(c.removeAttribute("draggable"),c.classList.remove("bbgf-card--draggable"));const v=Number(e.id),C=s==null?void 0:s.has(v),N=r!==null&&v===Number(r);c.classList.toggle("bbgf-card--pending",!!C),c.classList.toggle("is-dragging",!!N),c.setAttribute("aria-grabbed",N?"true":"false");const A=qa(e),B=et(A,t.timer_thresholds??{});c.classList.add(`bbgf-card--timer-${B}`);const V=document.createElement("div");V.className="bbgf-card-photo",V.setAttribute("aria-hidden","true");const f=at(e);if(f&&f.url){const I=document.createElement("img");I.src=f.url,I.alt=f.alt||g(((ge=e.client)==null?void 0:ge.name)??n.unknownClient),V.appendChild(I)}else{const I=document.createElement("span");I.textContent=(g(((k=e.client)==null?void 0:k.name)??n.unknownClient).charAt(0)||"üêæ").toUpperCase(),V.appendChild(I)}const p=document.createElement("div");p.className="bbgf-card-body";const _=document.createElement("div");_.className="bbgf-card-top",_.appendChild(V);const d=document.createElement("div");d.className="bbgf-card-info";const h=document.createElement("p");h.className="bbgf-card-name",h.textContent=g(((D=e.client)==null?void 0:D.name)??n.unknownClient),d.appendChild(h);const u=S(e.flags);if(u.length&&Ta){const I=document.createElement("div");I.className="bbgf-card-flags",I.setAttribute("aria-label",n.flags),u.forEach(x=>{const L=document.createElement("span");L.className="bbgf-flag-chip";const E=document.createElement("span");E.setAttribute("aria-hidden","true"),E.textContent=g(x.emoji),L.appendChild(E);const m=document.createElement("span");m.textContent=g(x.name),L.appendChild(m),I.appendChild(L)}),d.appendChild(I)}_.appendChild(d),p.appendChild(_);const $=document.createElement("div");$.className="bbgf-card-meta";const T=document.createElement("span");T.className="bbgf-card-timer",T.dataset.state=B,T.dataset.seconds=String(A),T.dataset.baseSeconds=String(A),T.dataset.yellow=String(Z((q=t.timer_thresholds)==null?void 0:q.yellow)??""),T.dataset.red=String(Z((W=t.timer_thresholds)==null?void 0:W.red)??""),T.textContent=Le(A),$.appendChild(T);const P=S(e.services);if(P.length&&La){const I=document.createElement("div");I.className="bbgf-card-services",I.setAttribute("aria-label",n.services),P.forEach(x=>{const L=document.createElement("span");L.className="bbgf-service-chip",L.setAttribute("aria-hidden","true");const E=g(x.icon),m=g(x.name);L.textContent=E&&E!==m?`${E} ${m}`:m,I.appendChild(L)}),p.appendChild(I)}const R=document.createElement("div");R.className="bbgf-card-footer",R.appendChild($);const ce=Da(e.check_in_at);if(ce){const I=document.createElement("span");I.className="bbgf-card-checkin",I.textContent=ce,R.appendChild(I)}return p.appendChild(R),c.appendChild(p),c},Ra=(e,t)=>{const{copy:a,pendingMoves:n,readonly:s,draggingVisitId:i}=t,r=g(e.key??e.stage_key??""),b=g(e.label??r),c=S(e.visits),v=c.length,C=document.createElement("section");C.className="bbgf-column",C.dataset.stage=r,C.dataset.visitCount=String(v),C.setAttribute("role","listitem"),C.setAttribute("aria-label",b),C.setAttribute("aria-dropeffect",s?"none":"move");const N=document.createElement("header");N.className="bbgf-column-header";const A=document.createElement("div");A.className="bbgf-column-title";const B=document.createElement("span");B.className="bbgf-column-label",B.textContent=b,A.appendChild(B);const V=document.createElement("span");V.className="bbgf-column-count",V.textContent=String(v),V.setAttribute("aria-label",String(v)),A.appendChild(V),N.appendChild(A),C.appendChild(N);const f=document.createElement("div");if(f.className="bbgf-column-body",f.setAttribute("role","list"),f.setAttribute("aria-label",`${b} column cards`),c.length)c.forEach(p=>{const _=Ba(p,e,{copy:a,pendingMoves:n,readonly:s,draggingVisitId:i});f.appendChild(_)});else{const p=document.createElement("p");p.className="bbgf-column-empty",p.textContent=a.emptyColumn,f.appendChild(p)}return C.appendChild(f),C},je=e=>{var t,a,n,s;return e.viewOverride||((a=(t=e.board)==null?void 0:t.view)==null?void 0:a.slug)||((n=l.context)==null?void 0:n.view)||((s=l.view)==null?void 0:s.slug)||""},st=(e,t,a,n)=>{var f,p,_;t.classList.add("bbgf-board--bootstrapped");const s=e.board;if(!s){t.innerHTML="";const d=document.createElement("div");d.className="bbgf-board-loading",d.textContent=n.loading,t.appendChild(d);return}const i=xa(s);Ie=i;const r=t.querySelector("#bbgf-modal");t.dataset.readonly=s.readonly?"true":"false",t.dataset.isPublic=s.is_public?"true":"false",t.dataset.activeView=je(e);const b=g(((f=s.view)==null?void 0:f.type)??"");t.dataset.viewType=b,t.dataset.boardMode=i.mode,s.readonly?t.classList.add("bbgf-board--readonly"):t.classList.remove("bbgf-board--readonly"),i.mode==="display"?t.classList.add("bbgf-board-wrapper--display"):t.classList.remove("bbgf-board-wrapper--display"),t.innerHTML="",it(e,t,n);const c=document.createElement("div");c.className="bbgf-board",c.setAttribute("role","list");const v=S(s.stages),C=d=>!!d,N=v.map(d=>({...d,visits:S(d.visits).filter(C)}));if(t.dataset.searchActive="false",N.length){const d=new Set(S(e.pendingMoves).map(u=>Number(u))),h=(p=e.drag)!=null&&p.isDragging?e.drag.visitId:null;N.forEach((u,$)=>{var P;N[$-1],N[$+1];const T=Ra(u,{copy:n,canMove:!!((P=a.capabilities)!=null&&P.moveStages)&&!s.readonly,pendingMoves:d,readonly:s.readonly,draggingVisitId:h});c.appendChild(T)})}else{const d=document.createElement("p");d.className="bbgf-board-empty",d.textContent=n.noVisits,c.appendChild(d)}if(t.appendChild(c),Ha(t),!t.querySelector(".bbgf-floating-controls")){const d=document.createElement("div");if(d.className="bbgf-floating-controls",(_=l.capabilities)!=null&&_.editVisits&&Ie.mode!=="display"){const u=document.createElement("button");u.type="button",u.className="bbgf-icon-button bbgf-intake-button",u.dataset.role="bbgf-intake-open",u.setAttribute("aria-label",y.intakeTitle),u.innerHTML=`<span aria-hidden="true">Ôºã</span><span class="bbgf-intake-button__label">${o(y.checkIn)}</span>`,d.appendChild(u)}const h=document.createElement("button");if(h.type="button",h.className="bbgf-icon-button bbgf-refresh-button",h.setAttribute("aria-label",n.refresh),h.textContent="‚ü≥",e.isLoading&&(h.setAttribute("disabled","disabled"),h.classList.add("is-disabled")),d.appendChild(h),i.showFullscreen){const u=document.createElement("button");u.type="button",u.className="bbgf-icon-button bbgf-toolbar-fullscreen",u.dataset.role="bbgf-fullscreen-toggle",u.setAttribute("aria-label",n.fullscreen),u.textContent="‚õ∂",d.appendChild(u)}t.appendChild(d)}const B=r||t.querySelector("#bbgf-modal");if(B)t.appendChild(B);else{const d=document.createElement("div");d.id="bbgf-modal",d.setAttribute("hidden","hidden"),d.className="bbgf-modal",d.innerHTML=`
			<div class="bbgf-modal__backdrop" data-role="bbgf-modal-backdrop"></div>
			<div class="bbgf-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="bbgf-modal-title">
				<header class="bbgf-modal__header">
					<h2 id="bbgf-modal-title" class="bbgf-modal__title">${n.modalTitle}</h2>
					<div class="bbgf-modal__nav" data-role="bbgf-modal-nav"></div>
					<span class="bbgf-modal__badge" data-role="bbgf-modal-readonly" hidden>${n.modalReadOnly}</span>
					<button type="button" class="bbgf-button bbgf-modal-close" data-role="bbgf-modal-close">${n.modalClose}</button>
				</header>
				<nav class="bbgf-modal__tabs" data-role="bbgf-modal-tabs"></nav>
				<div class="bbgf-modal__body" data-role="bbgf-modal-body">
					<p class="bbgf-modal__loading">${n.modalLoading}</p>
				</div>
			</div>
		`.trim(),t.appendChild(d)}if(!t.querySelector("#bbgf-intake-modal")){const d=document.createElement("div");d.id="bbgf-intake-modal",d.setAttribute("hidden","hidden"),d.className="bbgf-modal bbgf-intake-modal",d.innerHTML=`
			<div class="bbgf-modal__backdrop" data-role="bbgf-intake-close"></div>
			<div class="bbgf-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="bbgf-intake-title">
				<header class="bbgf-modal__header">
					<h2 id="bbgf-intake-title" class="bbgf-modal__title">${o(y.intakeTitle)}</h2>
					<button type="button" class="bbgf-button bbgf-modal-close" data-role="bbgf-intake-close">${o(y.modalClose)}</button>
				</header>
				<div class="bbgf-modal__body bbgf-intake-body" data-role="bbgf-intake-body">
					<p class="bbgf-modal__loading">${o(y.loading)}</p>
				</div>
				<div class="bbgf-modal__actions bbgf-intake-actions" data-role="bbgf-intake-actions"></div>
			</div>
		`.trim(),t.appendChild(d)}const V=t.querySelector('[data-role="bbgf-last-updated"]');V&&(V.dataset.timestamp=g(s.last_updated??e.lastFetchedAt??""))},nt=()=>{w.setState(t=>({...t,errors:S(t.errors).slice(0,-1)})),ne&&(window.clearTimeout(ne),ne=null);const e=te==null?void 0:te.querySelector("#bbgf-board-errors");e&&e.classList.remove("is-active")},it=(e,t,a)=>{const n=t.querySelector("#bbgf-board-errors"),s=S(e.errors).slice(-1)[0];if(!s){n&&n.remove(),ne&&(window.clearTimeout(ne),ne=null);return}let i=n;i||(i=document.createElement("div"),i.id="bbgf-board-errors",i.className="bbgf-toast",i.innerHTML=`
			<p class="bbgf-toast__message"></p>
			<button type="button" class="bbgf-button bbgf-button--ghost bbgf-toast__dismiss" data-role="bbgf-toast-dismiss" aria-label="${o(a.modalClose)}">√ó</button>
		`,i.querySelector('[data-role="bbgf-toast-dismiss"]').addEventListener("click",nt),t.appendChild(i));const r=i.querySelector(".bbgf-toast__message");r&&(r.textContent=s),i.classList.add("is-active"),ne&&window.clearTimeout(ne),ne=window.setTimeout(()=>{i==null||i.classList.remove("is-active"),nt()},6e3)},ot=e=>{const t=e.querySelector(".bbgf-refresh-button");t&&!t.dataset.bound&&(t.addEventListener("click",()=>{t.disabled||pe({reason:"manual",forceFull:!0})}),t.dataset.bound="true"),Q=e.querySelector('[data-role="bbgf-fullscreen-toggle"]')||Q,Q&&Q.dataset.bound!=="true"&&(Q.addEventListener("click",ns),Q.dataset.bound="true",Ae())},rt=(e,t)=>{const a=e.querySelector(".bbgf-refresh-button");a&&(t.isLoading?(a.setAttribute("disabled","disabled"),a.classList.add("is-disabled")):(a.removeAttribute("disabled"),a.classList.remove("is-disabled"))),Q=e.querySelector('[data-role="bbgf-fullscreen-toggle"]')||Q,Ae()},lt=e=>{const t=Array.from(e.querySelectorAll('[data-role="bbgf-last-updated"]'));if(!t.length){e._bbgfLastUpdatedInterval&&(window.clearInterval(e._bbgfLastUpdatedInterval),e._bbgfLastUpdatedInterval=null);return}const a=()=>{t.forEach(s=>{const i=s.dataset.timestamp,r=Pa(i);s.textContent=i?`${y.lastUpdated} ${r||Ma(i)}`:y.lastUpdated});const n=e.querySelector('[data-role="bbgf-next-refresh"]');if(n){const s=Fa(w.getState().nextRefreshAt);n.textContent=s?`${y.autoRefresh} ${s}`:`${y.autoRefresh} ‚Ä¶`}};e._bbgfLastUpdatedInterval&&window.clearInterval(e._bbgfLastUpdatedInterval),a(),e._bbgfLastUpdatedInterval=window.setInterval(a,15e3)},Ha=e=>{e.querySelectorAll(".bbgf-card-timer").forEach(a=>{const n=Math.max(0,Number(a.dataset.baseSeconds??a.dataset.seconds??0));a.textContent=Le(n);const s=Z(a.dataset.yellow),i=Z(a.dataset.red),r=et(n,{yellow:s,red:i});a.dataset.state=r;const b=a.closest(".bbgf-card");b&&(b.classList.remove("bbgf-card--timer-on-track","bbgf-card--timer-warning","bbgf-card--timer-critical"),b.classList.remove("bbgf-card--overdue","bbgf-card--capacity-warning"),b.classList.add(`bbgf-card--timer-${r}`),r==="critical"?b.classList.add("bbgf-card--overdue"):r==="warning"&&b.classList.add("bbgf-card--capacity-warning"))})},ee=e=>{var t,a;e&&((a=(t=window.wp)==null?void 0:t.a11y)!=null&&a.speak)&&window.wp.a11y.speak(e,"polite")},dt=e=>{var n,s,i;const t=S(e==null?void 0:e.stages);if(!t.length)return"";const a=((n=t[0])==null?void 0:n.key)??((s=t[0])==null?void 0:s.stage_key)??((i=t[0])==null?void 0:i.id)??"";return g(a).toLowerCase()},he=e=>{var t;return{isOpen:!1,isSaving:!1,error:"",activeTab:"search",searchQuery:"",searchResults:[],selected:null,guardian:{id:null,first_name:"",last_name:"",email:"",phone:"",preferred_contact:"",notes:""},client:{id:null,name:"",breed:"",weight:"",temperament:"",notes:"",guardian_id:null},visit:{view_id:((t=e==null?void 0:e.view)==null?void 0:t.id)??null,current_stage:dt(e),instructions:"",public_notes:""}}},Ga={board:l.initialBoard||null,isLoading:!1,errors:[],lastFetchedAt:null,viewOverride:"",pendingMoves:[],filters:{query:"",services:[],flags:[]},nextRefreshAt:null,drag:{isDragging:!1,visitId:null,fromStage:""},modal:{isOpen:!1,visitId:null,loading:!1,visit:null,readOnly:!1,activeTab:"summary",isSaving:!1,form:{instructions:"",publicNotes:"",privateNotes:"",services:[]},error:"",pendingUploads:[]},intake:he(l.initialBoard||null),catalog:{services:{items:[],isLoading:!1,loaded:!1,error:""}}},w=ja(Ga),z=Ua(l.rest||{},l.context||{}),M=e=>{w.setState(t=>{const a=typeof e=="function"?e(t.modal,t):{...t.modal,...e};return{...t,modal:a}})},U=e=>{w.setState(t=>{const a=typeof e=="function"?e(t.intake,t):{...t.intake,...e};return{...t,intake:a}})},Ue=e=>{w.setState(t=>{const a=typeof e=="function"?e(t.drag,t):{...t.drag,...e};return{...t,drag:a}})},ct=e=>{w.setState(t=>({...t,nextRefreshAt:e}))},bt=async()=>{var t;if(!((t=l.capabilities)!=null&&t.manageServices))return;const e=w.getState();if(!(e.catalog.services.loaded||e.catalog.services.isLoading)){w.setState(a=>({catalog:{...a.catalog,services:{...a.catalog.services,isLoading:!0,error:""}}}));try{const a=await z.fetchServices();w.setState(n=>({catalog:{...n.catalog,services:{items:a,isLoading:!1,loaded:!0,error:""}}}))}catch(a){w.setState(n=>({catalog:{...n.catalog,services:{items:S(n.catalog.services.items),isLoading:!1,loaded:!1,error:(a==null?void 0:a.message)||y.loadingError}}}))}}},za=(e,t)=>{M(a=>({...a,form:{...a.form,[e]:t}}))},Qa=(e,t)=>{M(a=>{const n=new Set(S(a.form.services).map(s=>Number(s)));return t?n.add(e):n.delete(e),{...a,form:{...a.form,services:Array.from(n.values())}}})},Wa=e=>{M(t=>({...t,activeTab:e,error:""})),e==="services"&&bt()},Ja=async e=>{var r,b,c;const t=w.getState(),{modal:a,board:n}=t;if(!a.visit||a.isSaving||a.readOnly||n!=null&&n.readonly||!((r=l.capabilities)!=null&&r.moveStages))return;const s=qe(n,a.visit.current_stage),i=e==="prev"?(b=s.prev)==null?void 0:b.key:(c=s.next)==null?void 0:c.key;if(!(!i||i===a.visit.current_stage)){M({isSaving:!0,error:""});try{await ve(a.visitId,i),await ye(a.visitId,{tab:a.activeTab||"summary"})}catch(v){const C=(v==null?void 0:v.message)||y.errorFetching||y.loadingError;M({error:C}),ee(C)}finally{M({isSaving:!1})}}},me=()=>{pe({reason:"modal-save",forceFull:!0})},Ka=async e=>{const t=e.closest('[data-role="bbgf-photo-upload"]'),a=t==null?void 0:t.querySelector('[data-role="bbgf-photo-file"]'),n=t==null?void 0:t.querySelector('[data-role="bbgf-photo-visible"]'),{modal:s}=w.getState(),i=S(s.pendingUploads),r=n?!!n.checked:!0;if(!(!i.length||!s.visitId)){M({isSaving:!0,error:""});try{for(const b of i)await z.addPhoto(s.visitId,b,r);a&&(a.value=""),M(b=>({...b,pendingUploads:[]})),await ye(s.visitId,{tab:s.activeTab||"photos"}),me()}catch(b){const c=(b==null?void 0:b.message)||y.loadingError;M({error:c}),ee(c)}finally{M({isSaving:!1})}}},Xa=async(e,t)=>{const{modal:a}=w.getState();if(a.visitId)try{M({isSaving:!0,error:""}),await z.updatePhoto(a.visitId,e,{visible_to_guardian:t}),await ye(a.visitId,{tab:a.activeTab||"photos"}),me()}catch(n){const s=(n==null?void 0:n.message)||y.loadingError;M({error:s}),ee(s)}finally{M({isSaving:!1})}},Ya=async e=>{const{modal:t}=w.getState();if(t.visitId)try{M({isSaving:!0,error:""}),await z.updatePhoto(t.visitId,e,{is_primary:!0}),await ye(t.visitId,{tab:t.activeTab||"photos"}),me()}catch(a){const n=(a==null?void 0:a.message)||y.loadingError;M({error:n}),ee(n)}finally{M({isSaving:!1})}},Za=e=>{if(!e)return;const t=document.querySelector(".bbgf-lightbox");t&&t.remove();const a=document.createElement("div");a.className="bbgf-lightbox",a.innerHTML=`
		<div class="bbgf-lightbox__backdrop" data-role="bbgf-lightbox-close"></div>
		<div class="bbgf-lightbox__body">
			<button type="button" class="bbgf-button bbgf-lightbox__close" data-role="bbgf-lightbox-close">${o(y.modalClose)}</button>
			<img src="${o(e)}" alt="">
		</div>
	`,a.addEventListener("click",n=>{n.target.dataset.role==="bbgf-lightbox-close"&&a.remove()}),document.body.appendChild(a)},es=async()=>{const e=w.getState(),{modal:t}=e;if(!(t.readOnly||t.isSaving)){M({isSaving:!0,error:""});try{const a={instructions:t.form.instructions,public_notes:t.form.publicNotes,private_notes:t.form.privateNotes},n=await z.updateVisit(t.visitId,a);M(s=>({...s,isSaving:!1,visit:n,form:De(n),error:""})),ee(y.modalSave),me()}catch(a){M(n=>({...n,isSaving:!1,error:(a==null?void 0:a.message)||y.loadingError}))}}},ts=async()=>{const e=w.getState(),{modal:t}=e;if(!(t.readOnly||t.isSaving)){M({isSaving:!0,error:""});try{const a={services:S(t.form.services).map(s=>Number(s)).filter(s=>Number.isFinite(s))},n=await z.updateVisit(t.visitId,a);M(s=>({...s,isSaving:!1,visit:n,form:{...s.form,services:S(n.services).map(i=>Number(i==null?void 0:i.id)).filter(i=>Number.isFinite(i))},error:""})),ee(y.modalSave),me()}catch(a){M(n=>({...n,isSaving:!1,error:(a==null?void 0:a.message)||y.loadingError}))}}},as=e=>{switch(e){case"notes":es();break;case"services":ts();break}},ss=()=>30*1e3;let xe=null,Be=null,te=null,Re="",ne=null,Q=null,Ie={mode:"interactive"},ae=null,K=null,He=null,Ge=null,ze=null,le=null,Qe=null;const Ae=()=>{if(!Q)return;const e=!!document.fullscreenElement;Q.textContent=e?"‚§¢":"‚õ∂",Q.setAttribute("title",e?y.exitFullscreen:y.fullscreen),Q.setAttribute("aria-pressed",e?"true":"false")},ns=()=>{var t,a;const e=te;e&&(document.fullscreenElement?(a=document.exitFullscreen)==null||a.call(document):(t=e.requestFullscreen)==null||t.call(e),Ae())},ut=()=>{xe&&(window.clearTimeout(xe),xe=null)},is=()=>{ut();const e=ss();ct(Date.now()+e),xe=window.setTimeout(()=>{pe({reason:"poll"})},e)},pe=async({reason:e="manual",forceFull:t=!1,targetView:a}={})=>{var b;ut(),ct(null);const n=w.getState(),s=a||je(n),i={};s&&(i.view=s);const r=!t&&!!((b=n.board)!=null&&b.last_updated);r&&(i.modified_after=n.board.last_updated),w.setState({isLoading:!0});try{const c=await z.fetchBoard(i);w.setState(v=>({board:r&&v.board?Ia(v.board,c):c,isLoading:!1,errors:[],lastFetchedAt:new Date().toISOString()}))}catch(c){const v=(c==null?void 0:c.message)||y.errorFetching||y.loadingError;w.setState(C=>({isLoading:!1,errors:[...S(C.errors),v]})),ee(y.errorFetching||y.loadingError)}is()},gt=(e,t="add")=>{const a=Number(e);Number.isNaN(a)||w.setState(n=>{const s=new Set(S(n.pendingMoves).map(i=>Number(i)));return t==="remove"?s.delete(a):s.add(a),{pendingMoves:Array.from(s.values())}})},ve=async(e,t)=>{var n,s,i;if(!t)return;const a=w.getState();if(!((n=a.board)!=null&&n.readonly||!((s=l.capabilities)!=null&&s.moveStages))&&!((i=a.pendingMoves)!=null&&i.includes(Number(e)))){gt(e,"add");try{await z.moveVisit(e,t),ee(y.moveSuccess),await pe({reason:"move",forceFull:!0})}catch(r){const b=(r==null?void 0:r.message)||y.errorFetching||y.loadingError;w.setState(c=>({errors:[...S(c.errors),b]})),ee(b)}finally{gt(e,"remove")}}},ft=(e,t)=>{const a=Number(e.dataset.visitId),n=g(e.dataset.stage);if(Number.isNaN(a)||!n)return;const s=w.getState().board,{prev:i,next:r}=qe(s,n),b=t==="prev"?i==null?void 0:i.key:r==null?void 0:r.key;!b||b===n||ve(a,b)},mt=async e=>{var i,r;const t=e.closest(".bbgf-card");if(!t)return;const a=Number(t.dataset.visitId),n=g(e.dataset.targetStage);Number.isNaN(a)||!n||(i=w.getState().board)!=null&&i.readonly||!((r=l.capabilities)!=null&&r.moveStages)||(e.disabled=!0,e.classList.add("is-disabled"),await ve(a,n),e.disabled=!1,e.classList.remove("is-disabled"))},os=e=>{if(Ie.mode==="display")return;if(e.target.closest('[data-role="bbgf-intake-open"]')){e.preventDefault(),ls();return}const a=e.target.closest(".bbgf-move-next");if(a){e.preventDefault(),mt(a);return}const n=e.target.closest(".bbgf-move-prev");if(n){e.preventDefault(),mt(n);return}const s=e.target.closest(".bbgf-card");if(s){const i=Number(s.dataset.visitId);if(Number.isNaN(i))return;Be=s,ye(i,{tab:"summary"})}},rs=()=>{const e=w.getState().board;U({...he(e),isOpen:!1})},ls=()=>{var t;if(!((t=l.capabilities)!=null&&t.editVisits))return;const e=w.getState().board;U({...he(e),isOpen:!0,activeTab:"search"})},pt=()=>{U(e=>({...e,isOpen:!1,isSaving:!1,error:""}))},ds=e=>{const t=w.getState().board,a=he(t),n=e.guardian||{},s=e.client||{};U(i=>({...i,selected:e,guardian:{id:n.id??null,first_name:n.first_name??"",last_name:n.last_name??"",email:n.email??"",phone:n.phone_mobile??n.phone_alt??n.phone??"",preferred_contact:n.preferred_contact??"",notes:n.notes??""},client:{...i.client,id:s.id??null,name:s.name??"",breed:s.breed??"",weight:s.weight??"",temperament:s.temperament??"",notes:s.notes??"",guardian_id:s.guardian_id??n.id??null},visit:{...i.visit,view_id:i.visit.view_id??a.visit.view_id,current_stage:i.visit.current_stage||a.visit.current_stage},activeTab:"guardian"}))},ht=(e,t,a)=>{!e||!t||U(n=>({...n,[e]:{...n[e]||{},[t]:a}}))},cs=e=>{Qe&&window.clearTimeout(Qe);const t=g(e||"").trim();U(a=>({...a,searchQuery:e,searchResults:t.length<2?[]:a.searchResults})),!(t.length<2)&&(Qe=window.setTimeout(async()=>{try{const a=await z.searchIntake(e);U(n=>({...n,searchResults:a,error:""}))}catch(a){U(n=>({...n,error:(a==null?void 0:a.message)||y.loadingError}))}},200))},bs=async()=>{var f,p,_,d,h;const e=w.getState(),t=e.board,a=e.intake,n=a.guardian||{},s=a.client||{},i=a.visit||{},r=g(n.first_name||""),b=g(n.last_name||""),c=g(s.name||""),v=g(i.current_stage||dt(t)),C=Number(i.view_id||((f=t==null?void 0:t.view)==null?void 0:f.id)||0)||null;if(!r||!b){U(u=>({...u,error:"Guardian first and last name are required."}));return}if(!c){U(u=>({...u,error:"Client name is required."}));return}if(!v){U(u=>({...u,error:y.stageLabel||"Stage is required."}));return}U(u=>({...u,isSaving:!0,error:""}));const N={id:n.id??((_=(p=a.selected)==null?void 0:p.guardian)==null?void 0:_.id)??null,first_name:r,last_name:b,email:g(n.email||""),phone:g(n.phone||n.phone_mobile||""),preferred_contact:g(n.preferred_contact||""),notes:g(n.notes||"")},A=g(s.weight||""),B={id:s.id??((h=(d=a.selected)==null?void 0:d.client)==null?void 0:h.id)??null,name:c,breed:g(s.breed||""),weight:A,temperament:g(s.temperament||""),notes:g(s.notes||""),guardian_id:s.guardian_id??N.id??null},V={current_stage:v,view_id:C,status:"in_progress",check_in_at:new Date().toISOString(),instructions:g(i.instructions||""),public_notes:g(i.public_notes||""),client:B,guardian:N};try{await z.createVisit(V),ee(y.intakeSuccess),rs(),me()}catch(u){U($=>({...$,isSaving:!1,error:(u==null?void 0:u.message)||y.loadingError}));return}U(u=>({...he(t),isOpen:!1}))},Me=()=>{w.setState(e=>({modal:{...e.modal,isOpen:!1}}))},us=e=>{var n;const t=e.target.dataset.role;if(t==="bbgf-modal-close"){Me();return}if(t==="bbgf-modal-tab"){const s=e.target.dataset.tab;s&&Wa(s);return}if(t==="bbgf-modal-save"){const s=e.target.dataset.section;s&&as(s);return}if(t==="bbgf-modal-move"){const s=e.target.dataset.direction;s&&Ja(s);return}if(t==="bbgf-upload-photo"){Ka(e.target);return}if(t==="bbgf-photo-primary"){const s=Number(e.target.dataset.photoId);Number.isNaN(s)||Ya(s);return}if(t==="bbgf-photo-cancel"){const s=e.target.closest('[data-role="bbgf-photo-upload"]'),i=s==null?void 0:s.querySelector('[data-role="bbgf-photo-file"]');i&&(i.value=""),M(r=>({...r,pendingUploads:[]}));return}if(e.target.closest('[data-role="bbgf-photo-visibility"]')||e.target.closest('[data-role="bbgf-photo-file"]'))return;const a=e.target.closest('[data-role="bbgf-photo-preview"]');if(a){const s=(n=a.dataset)==null?void 0:n.photoUrl;s&&Za(s)}},gs=e=>{var a;if(((a=e.target.dataset)==null?void 0:a.role)==="bbgf-modal-input"){const n=e.target.dataset.field;n&&za(n,e.target.value)}},fs=e=>{const{dataset:t,checked:a}=e.target;if((t==null?void 0:t.role)==="bbgf-modal-service"){const n=Number(t.serviceId);Number.isNaN(n)||Qa(n,a)}if((t==null?void 0:t.role)==="bbgf-photo-visibility"){e.stopPropagation();const n=Number(t.photoId);Number.isNaN(n)||Xa(n,a)}if((t==null?void 0:t.role)==="bbgf-photo-file"){const n=e.target.files?Array.from(e.target.files):[];M(s=>({...s,pendingUploads:n}))}},ye=async(e,t={})=>{var i,r,b;if(!Number.isFinite(Number(e)))return;const a=w.getState(),n=((i=Aa(a.board,e))==null?void 0:i.visit)??null,s=t.tab||"summary";w.setState({modal:{isOpen:!0,visitId:e,loading:!0,visit:n,readOnly:((r=a.board)==null?void 0:r.readonly)||!((b=l.capabilities)!=null&&b.editVisits),activeTab:s,isSaving:!1,form:De(n),error:"",pendingUploads:[]}}),bt();try{const c=await z.fetchVisit(e,{view:je(w.getState())});w.setState(v=>({modal:{...v.modal,loading:!1,visit:c,form:De(c),error:""}}))}catch(c){w.setState(v=>({errors:[...S(v.errors),(c==null?void 0:c.message)||y.loadingError],modal:{...v.modal,loading:!1,error:(c==null?void 0:c.message)||y.loadingError}}))}},de=e=>{if(!te)return;if(!e){te.querySelectorAll(".bbgf-column--drag-hover").forEach(a=>{a.classList.remove("bbgf-column--drag-hover")}),Re="";return}if(Re===e)return;te.querySelectorAll(".bbgf-column--drag-hover").forEach(a=>{a.classList.remove("bbgf-column--drag-hover")});const t=te.querySelector(`.bbgf-column[data-stage="${e}"]`);t&&(t.classList.add("bbgf-column--drag-hover"),Re=e)},ms=e=>{var i,r;const t=e.target.closest(".bbgf-card");if(!t)return;if((i=w.getState().board)!=null&&i.readonly||!((r=l.capabilities)!=null&&r.moveStages)){e.preventDefault();return}const n=Number(t.dataset.visitId),s=g(t.dataset.stage);if(Number.isNaN(n)||!s){e.preventDefault();return}Ue({isDragging:!0,visitId:n,fromStage:s}),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(n))),t.classList.add("is-dragging"),t.setAttribute("aria-grabbed","true")},ps=e=>{const t=e.target.closest(".bbgf-card");t&&(t.classList.remove("is-dragging"),t.setAttribute("aria-grabbed","false")),Ue({isDragging:!1,visitId:null,fromStage:""}),de(null)},hs=e=>{var n,s,i;const t=w.getState();if(!((n=t.drag)!=null&&n.isDragging))return;const a=e.target.closest(".bbgf-column");if(a&&(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!((s=t.board)!=null&&s.readonly)&&((i=l.capabilities)!=null&&i.moveStages))){e.preventDefault();const r=a.dataset.stage;r&&r!==t.drag.fromStage&&de(r)}},vs=e=>{const t=e.target.closest(".bbgf-column");t&&(t.contains(e.relatedTarget)||de(null))},ys=e=>{var b,c;const t=w.getState();if(!((b=t.drag)!=null&&b.isDragging))return;const a=e.target.closest(".bbgf-column");if(!a)return;e.preventDefault();const n=a.dataset.stage,s=Number((c=e.dataTransfer)==null?void 0:c.getData("text/plain"))||t.drag.visitId,i=n,r=t.drag.fromStage;!i||i===r||(de(null),Ue({isDragging:!1,visitId:null,fromStage:""}),Number.isNaN(s)||ve(s,i))},vt=e=>{var n;const t=(n=e.changedTouches)==null?void 0:n[0];if(!t)return null;const a=document.elementFromPoint(t.clientX,t.clientY);return a?a.closest(".bbgf-column"):null},Ss=e=>{var s;if(!((s=l.capabilities)!=null&&s.moveStages))return;const t=e.target.closest(".bbgf-card");if(!t)return;const a=Number(t.dataset.visitId),n=g(t.dataset.stage);Number.isNaN(a)||!n||(le={visitId:a,fromStage:n},de(null))},ws=e=>{if(!le)return;e.preventDefault();const t=vt(e);if(t){const a=g(t.dataset.stage);a&&a!==le.fromStage&&de(a)}},_s=e=>{if(!le)return;const t=vt(e),a=g((t==null?void 0:t.dataset.stage)??"");a&&a!==le.fromStage&&ve(le.visitId,a),de(null),le=null},We=e=>{const t=e.querySelector("#bbgf-modal");if(!t||t.dataset.bound==="true")return;const a=t.querySelector('[data-role="bbgf-modal-backdrop"]'),n=t.querySelector('[data-role="bbgf-modal-close"]');a&&a.addEventListener("click",Me),n&&n.addEventListener("click",Me),document.addEventListener("keydown",i=>{if(i.key==="Escape"){const{modal:r}=w.getState();r.isOpen&&(i.preventDefault(),Me())}});const s=t.querySelector(".bbgf-modal__dialog");s&&(s.addEventListener("click",us),s.addEventListener("input",gs,!0),s.addEventListener("change",fs)),t.dataset.bound="true"},yt=(e,t,a)=>{var V,f,p,_,d,h,u,$,T,P,R,ce,be,ue,ge;const n=t.querySelector("#bbgf-modal");if(!n)return;const{modal:s}=e;if(!s.isOpen){n.setAttribute("hidden","hidden");const k=Be;k&&k.focus&&window.requestAnimationFrame(()=>k.focus()),Be=null;return}n.removeAttribute("hidden");const i=n.querySelector('[data-role="bbgf-modal-body"]'),r=n.querySelector('[data-role="bbgf-modal-tabs"]'),b=n.querySelector("#bbgf-modal-title"),c=n.querySelector('[data-role="bbgf-modal-close"]'),v=n.querySelector('[data-role="bbgf-modal-nav"]'),C=[{id:"summary",label:a.modalSummary},{id:"notes",label:a.modalNotes},{id:"services",label:a.modalServices},{id:"visit",label:a.modalVisit},{id:"history",label:a.modalHistory},{id:"photos",label:a.modalPhotos}];if(r&&(r.innerHTML=C.map(k=>{const D=s.activeTab===k.id;return`<button type="button" class="bbgf-modal__tab${D?" is-active":""}" data-role="bbgf-modal-tab" data-tab="${k.id}" aria-selected="${D?"true":"false"}">${o(k.label)}</button>`}).join("")),v)if(s.visit&&((V=l.capabilities)!=null&&V.moveStages)&&!((f=e.board)!=null&&f.readonly)&&!s.readOnly){const k=qe(e.board,s.visit.current_stage),D=((_=S((p=e.board)==null?void 0:p.stages).find(I=>I.key===s.visit.current_stage))==null?void 0:_.label)??s.visit.current_stage,q=k.prev?`<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-modal-move" data-direction="prev">${o(a.movePrev)}</button>`:"",W=k.next?`<button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-modal-move" data-direction="next">${o(a.moveNext)}</button>`:"";v.innerHTML=`
				${q}
				${W}
				<div class="bbgf-modal__nav-info">
					<span>${o(D||a.stageLabel)}</span>
				</div>
			`}else v.innerHTML="";let N=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`;if(s.loading)N=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`;else if(!s.visit)N=`<p class="bbgf-modal__loading">${a.loadingError}</p>`;else{const k=s.visit,D=((h=S((d=e.board)==null?void 0:d.stages).find(E=>E.key===k.current_stage))==null?void 0:h.label)??k.current_stage,q=o(((u=k.client)==null?void 0:u.name)??a.unknownClient),W=k.guardian||{},I=!!((T=($=e.board)==null?void 0:$.visibility)!=null&&T.mask_guardian),x=new Set(S(s.form.services).map(E=>Number(E))),L=e.catalog.services;if(s.activeTab==="summary"){const E=at(k),m=E&&E.url?`<img src="${o(E.url)}" alt="${o(E.alt??q)}">`:`<span>${(g(((P=k.client)==null?void 0:P.name)??a.unknownClient).charAt(0)||"üêæ").toUpperCase()}</span>`,J=S(k.services).map(F=>{const re=g((F==null?void 0:F.icon)??""),fe=g((F==null?void 0:F.name)??""),Ce=fe?re&&re!==fe?`${re} ${fe}`:fe:re;return Ce?`<span class="bbgf-modal-chip">${o(Ce)}</span>`:""}).filter(Boolean).join(""),H=S(k.flags).map(F=>{const re=g((F==null?void 0:F.emoji)??""),fe=g((F==null?void 0:F.name)??""),Ce=fe?`${re?`${re} `:""}${fe}`:re;return Ce?`<span class="bbgf-modal-chip bbgf-modal-chip--flag">${o(Ce)}</span>`:""}).filter(Boolean).join(""),X=[J,H].filter(Boolean).join(""),j=[g(W.first_name??""),g(W.last_name??"")].filter(Boolean).join(" ").trim(),ie=[g(W.phone??""),g(W.email??"")].filter(Boolean),Y=[];I?Y.push(o(a.maskedGuardian)):(j&&Y.push(o(j)),ie.length&&Y.push(ie.map(F=>o(F)).join(" ‚Ä¢ ")));const se=Y.length>0?`<p class="bbgf-modal-summary__meta">${Y.join(" ‚Ä¢ ")}</p>`:"",oe=o(Te(k.check_in_at)||""),Pe=o(Te(k.check_out_at)||""),Se=Z(k.timer_elapsed_seconds)??0,we=Se>0?o(Le(Se)):"",_e=o(k.instructions??"").replace(/\n/g,"<br>"),ke=o(k.public_notes??"").replace(/\n/g,"<br>"),$e=o(k.private_notes??"").replace(/\n/g,"<br>"),Ke=[];Ke.push({label:a.checkIn,value:oe||"-"}),Ke.push({label:"Check-out",value:Pe||"-"});const Ea=Ke.map(F=>`<div class="bbgf-summary-item"><span class="bbgf-summary-item__label">${o(F.label)}</span><span class="bbgf-summary-item__value">${F.value}</span></div>`).join(""),Ne=[];_e&&Ne.push({heading:"Instructions",body:_e}),ke&&Ne.push({heading:"Public notes",body:ke}),!s.readOnly&&$e&&Ne.push({heading:"Private notes",body:$e});const Es=Ne.length?`<div class="bbgf-modal-summary__notes">${Ne.map(F=>`<article class="bbgf-modal-note"><h4>${o(F.heading)}</h4><p>${F.body}</p></article>`).join("")}</div>`:"";N=`
				<section class="bbgf-modal-summary">
					<header class="bbgf-modal-summary__header">
						<div class="bbgf-modal-summary__photo">${m}</div>
						<div class="bbgf-modal-summary__primary">
							<h3 class="bbgf-modal-summary__name">${q}</h3>
							<p class="bbgf-modal-summary__subtitle">
								<span class="bbgf-modal-summary__stage">${o(D||k.current_stage||"")}</span>
								${we?`<span class="bbgf-modal-summary__elapsed">${we}</span>`:""}
							</p>
							${se}
						</div>
					</header>
					${X?`<div class="bbgf-modal-summary__tags">${X}</div>`:""}
					${Ea?`<div class="bbgf-modal-summary__grid">${Ea}</div>`:""}
					${Es}
				</section>
			`}else if(s.activeTab==="notes")N=`
				<form class="bbgf-modal-form" data-role="bbgf-modal-notes-form">
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-instructions">${o(a.notes)} (${o("Instructions")})</label>
						<textarea id="bbgf-modal-instructions" data-role="bbgf-modal-input" data-field="instructions" ${s.readOnly?"disabled":""}></textarea>
					</div>
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-public-notes">${o("Public notes")}</label>
						<textarea id="bbgf-modal-public-notes" data-role="bbgf-modal-input" data-field="publicNotes" ${s.readOnly?"disabled":""}></textarea>
					</div>
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-private-notes">${o("Private notes")}</label>
						<textarea id="bbgf-modal-private-notes" data-role="bbgf-modal-input" data-field="privateNotes" ${s.readOnly?"disabled":""}></textarea>
					</div>
					${s.readOnly?"":`<div class="bbgf-modal__actions"><button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-modal-save" data-section="notes" ${s.isSaving?"disabled":""}>${o(s.isSaving?a.modalSaving:a.modalSave)}</button></div>`}
				</form>
			`;else if(s.activeTab==="services")if((R=l.capabilities)!=null&&R.manageServices)L.isLoading&&!L.loaded?N=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`:L.error?N=`<p class="bbgf-modal__error">${o(L.error)}</p>`:N=`
					<div class="bbgf-modal-service-list">
						${S(L.items).map(m=>{const J=Number(m==null?void 0:m.id),H=x.has(J)?"checked":"";return`
							<label class="bbgf-modal-service">
								<input type="checkbox" data-role="bbgf-modal-service" data-service-id="${J}" ${H} ${s.readOnly?"disabled":""}>
								<span>${o((m==null?void 0:m.name)??"")}</span>
							</label>
						`}).join("")||`<p class="bbgf-modal__loading">${o(a.emptyColumn)}</p>`}
					</div>
					${s.readOnly?"":`<div class="bbgf-modal__actions"><button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-modal-save" data-section="services" ${s.isSaving?"disabled":""}>${o(s.isSaving?a.modalSaving:a.modalSave)}</button></div>`}
				`;else{const E=S(k.services).map(m=>`<li>${o(m.name)}</li>`).join("");N=`
					<div class="bbgf-modal-section">
						<p>${o("You do not have permission to modify services. Contact an administrator if you need changes.")}</p>
						<ul class="bbgf-modal-list">${E||`<li>${o(a.emptyColumn)}</li>`}</ul>
					</div>
				`}else if(s.activeTab==="visit")N=`
				<ul class="bbgf-modal-history">
					${S(k.history).map(m=>{var ie,Y,se,oe;const J=Te(m.changed_at),H=o(((ie=m.from_stage)==null?void 0:ie.label)??((Y=m.from_stage)==null?void 0:Y.key)??""),X=o(((se=m.to_stage)==null?void 0:se.label)??((oe=m.to_stage)==null?void 0:oe.key)??""),O=o(m.comment??"").replace(/\n/g,"<br>"),j=m.elapsed_seconds?Le(m.elapsed_seconds):"";return`
						<li>
							<div class="bbgf-history-entry">
								<strong>${J}</strong>
								<p>${H} ‚Üí ${X}</p>
								${j?`<p class="bbgf-history-duration">${o(j)}</p>`:""}
								${O?`<p>${O}</p>`:""}
							</div>
						</li>
					`}).join("")||`<li>${o(a.modalNoHistory)}</li>`}
				</ul>
			`;else if(s.activeTab==="history")N=`
				<ul class="bbgf-modal-history">
					${S(k.previous_visits).map(m=>{const J=Te(m.check_in_at||m.created_at),H=o(m.stage??""),X=o(m.instructions??"").replace(/\n/g,"<br>"),O=o(m.public_notes??"").replace(/\n/g,"<br>"),j=o(m.private_notes??"").replace(/\n/g,"<br>");return`
						<li>
							<div class="bbgf-history-entry">
								<strong>${J||a.modalHistory}</strong>
								${H?`<p>${H}</p>`:""}
								${X?`<p class="bbgf-history-duration">${X}</p>`:""}
								${O?`<p>${O}</p>`:""}
								${j?`<p><em>${j}</em></p>`:""}
							</div>
						</li>
					`}).join("")||`<li>${o(a.modalNoPrevious)}</li>`}
				</ul>
			`;else if(s.activeTab==="photos"){const E=S(k.photos),m=S(s.pendingUploads),J=m.length?`<ul class="bbgf-photo-upload__list">${m.map(O=>`<li>${o(O.name||"Untitled file")}</li>`).join("")}</ul>`:`<p class="bbgf-photo-upload__hint">${o("Select images to preview filenames before uploading.")}</p>`;let H=E.map(O=>{var we,_e,ke,$e;const j=o(O.url??""),ie=o(O.alt??q),Y=O.visible_to_guardian!==!1,se=Number(O.id),oe=O.is_primary===!0,Pe=(we=l.capabilities)!=null&&we.editVisits&&!((_e=e.board)!=null&&_e.readonly)&&!s.readOnly&&Number.isFinite(se)?`<label class="bbgf-photo-visibility"><input type="checkbox" data-role="bbgf-photo-visibility" data-photo-id="${se}" ${Y?"checked":""}>${o(a.modalVisibleToGuardian)}</label>`:"",Se=(ke=l.capabilities)!=null&&ke.editVisits&&!(($e=e.board)!=null&&$e.readonly)&&!s.readOnly&&Number.isFinite(se)?`<button type="button" class="bbgf-button bbgf-button--ghost bbgf-photo-primary" data-role="bbgf-photo-primary" data-photo-id="${se}" ${oe?"disabled":""}>${o(oe?"Main photo":"Set as main photo")}</button>`:"";return`<figure class="bbgf-modal-photo" data-role="bbgf-photo-preview" data-photo-id="${se}" data-photo-url="${j}" aria-label="${o(a.modalViewPhoto)}">
						<div class="bbgf-modal-photo__thumb">
							<img src="${j}" alt="${ie}">
							${oe?'<span class="bbgf-photo-badge bbgf-photo-badge--primary">Main</span>':""}
							${Y?"":'<span class="bbgf-photo-badge">Hidden</span>'}
						</div>
						<figcaption>${ie}${Pe||Se?`<div class="bbgf-photo-actions">${Se}${Pe}</div>`:""}</figcaption>
					</figure>`}).join("");if(!H){const O=tt(k);if(O&&O.url){const j=o(O.alt??q);H=`<figure class="bbgf-modal-photo"><img src="${o(O.url)}" alt="${j}"><figcaption>${j}</figcaption></figure>`}}const X=`
				<div class="bbgf-modal__actions bbgf-modal__actions--photos">
					<span class="bbgf-modal__hint">Changes save automatically.</span>
					<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-modal-close">${o(a.modalClose)}</button>
				</div>
			`;N=`
				${(ce=l.capabilities)!=null&&ce.editVisits&&!((be=e.board)!=null&&be.readonly)&&!s.readOnly?`
				<div class="bbgf-photo-upload" data-role="bbgf-photo-upload">
					<label class="bbgf-photo-upload__file">
						<input type="file" accept="image/*" data-role="bbgf-photo-file" multiple>
						<span>${o(a.modalUploadPhoto)}</span>
					</label>
					<label class="bbgf-photo-upload__visibility">
						<input type="checkbox" data-role="bbgf-photo-visible" checked>
						<span>${o(a.modalVisibleToGuardian)}</span>
					</label>
					<div class="bbgf-photo-upload__pending">
						${J}
					</div>
					<div class="bbgf-photo-upload__actions">
						<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-photo-cancel" ${m.length?"":"disabled"}>Clear</button>
						<button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-upload-photo" ${m.length?"":"disabled"}>${o(m.length?`Upload ${m.length} file${m.length===1?"":"s"}`:a.modalUploadPhoto)}</button>
					</div>
				</div>`:""}
				<div class="bbgf-modal-photos">
					${H||`<p class="bbgf-modal__loading">${o(a.modalNoPhotos)}</p>`}
				</div>
				${X}
			`}s.error&&(N=`<div class="bbgf-modal__error">${o(s.error)}</div>${N}`)}if(i.innerHTML=N,s.activeTab==="notes"){const k=i.querySelector('[data-field="instructions"]'),D=i.querySelector('[data-field="publicNotes"]'),q=i.querySelector('[data-field="privateNotes"]');k&&(k.value=s.form.instructions??""),D&&(D.value=s.form.publicNotes??""),q&&(q.value=s.form.privateNotes??"")}if(s.activeTab==="services"&&i.querySelectorAll('[data-role="bbgf-modal-service"]').forEach(D=>{const q=Number(D.dataset.serviceId);D.checked=servicesSelection.has(q),s.isSaving&&D.setAttribute("disabled","disabled")}),b){const k=(ge=(ue=s.visit)==null?void 0:ue.client)!=null&&ge.name?`: ${s.visit.client.name}`:"";b.textContent=`${a.modalTitle}${k}`}s.readOnly?n.classList.add("bbgf-modal--readonly"):n.classList.remove("bbgf-modal--readonly");const A=n.querySelector('[data-role="bbgf-modal-readonly"]');A&&(s.readOnly?A.removeAttribute("hidden"):A.setAttribute("hidden","hidden"));const B=document.activeElement;c&&(!n.contains(B)||B===n)&&window.requestAnimationFrame(()=>c.focus())},St=(e,t,a)=>{var D,q,W,I;const n=t.querySelector("#bbgf-intake-modal");if(!n)return;const{intake:s,board:i}=e;if(!s.isOpen){n.setAttribute("hidden","hidden");return}n.removeAttribute("hidden");const r=n.querySelector('[data-role="bbgf-intake-body"]'),b=n.querySelector('[data-role="bbgf-intake-actions"]');if(!r||!b)return;const c=S(i==null?void 0:i.stages),v=S(l.views),C=s.visit.view_id??((D=i==null?void 0:i.view)==null?void 0:D.id)??null,N=c.map(x=>{const L=g(x.key??x.stage_key??""),E=g(x.label??L),m=s.visit.current_stage===L?"selected":"";return`<option value="${o(L)}" ${m}>${o(E)}</option>`}).join(""),A=v.map(x=>{const L=Number(x.id),E=L===Number(C)?"selected":"";return`<option value="${L}" ${E}>${o(x.name??x.slug??L)}</option>`}).join(""),V=S(s.searchResults).map((x,L)=>{const E=x.client||{},m=x.guardian||{},J=g(E.name||""),H=m&&(m.first_name||m.last_name)?`${g(m.first_name)} ${g(m.last_name)}`.trim():"",X=[m.phone_mobile||m.phone_alt||"",m.email||""].filter(Boolean),O=[E.breed||"",H].filter(Boolean).join(" ‚Ä¢ "),j=X.join(" ‚Ä¢ ");return`
				<article class="bbgf-intake-result">
					<div class="bbgf-intake-result__body">
						<p class="bbgf-intake-result__title">${o(J||a.unknownClient)}</p>
						${O?`<p class="bbgf-intake-result__meta">${o(O)}</p>`:""}
						${j?`<p class="bbgf-intake-result__contact">${o(j)}</p>`:""}
					</div>
					<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-intake-select" data-result-index="${L}">${o(a.checkIn)}</button>
				</article>
			`}).join(""),f=s.guardian||{},p=s.client||{},_=s.visit||{},h=g(s.searchQuery||"").trim().length>=2,u=[{id:"search",label:a.intakeSearchLabel},{id:"guardian",label:a.intakeGuardian},{id:"client",label:a.intakeClient},{id:"visit",label:a.intakeVisit}],$=u.some(x=>x.id===s.activeTab)?s.activeTab:"search",T=u.map(x=>{const L=x.id===$;return`<button type="button" class="bbgf-modal__tab${L?" is-active":""}" data-role="bbgf-intake-tab" data-tab="${x.id}" aria-selected="${L?"true":"false"}">${o(x.label)}</button>`}).join(""),P=s.selected?`<div class="bbgf-intake-selected">Using ${o(((q=s.selected.client)==null?void 0:q.name)??a.unknownClient)}${s.selected.guardian?` ‚Ä¢ ${o(((W=s.selected.guardian)==null?void 0:W.first_name)??"")} ${o(((I=s.selected.guardian)==null?void 0:I.last_name)??"")}`:""} <button type="button" class="bbgf-chip-clear" data-role="bbgf-intake-clear" aria-label="${o(a.clearFilters||"Clear")}">√ó</button></div>`:"",R=h?V||`<p class="bbgf-modal__loading">${o(a.intakeNoResults)}</p>`:`<p class="bbgf-modal__hint">${o("Start typing at least 2 characters to search.")}</p>`,ce=`
		<section class="bbgf-intake-panel bbgf-intake-panel--search" role="tabpanel" aria-label="${o(a.intakeSearchLabel)}">
			<label class="bbgf-field-label">${o(a.intakeSearchLabel)}</label>
			<div class="bbgf-intake-search">
				<input type="search" data-role="bbgf-intake-search" value="${o(s.searchQuery)}" placeholder="${o(a.intakeSearchHint)}" aria-label="${o(a.intakeSearchLabel)}">
			</div>
			<div class="bbgf-intake-results">
				${R}
			</div>
		</section>
	`,be=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${o(a.intakeGuardian)}">
			<h3>${o(a.intakeGuardian)}</h3>
			<div class="bbgf-intake-field">
				<label>${o("First name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="guardian" data-field="first_name" value="${o(f.first_name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Last name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="guardian" data-field="last_name" value="${o(f.last_name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Email")}</label>
				<input type="email" data-role="bbgf-intake-field" data-section="guardian" data-field="email" value="${o(f.email??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Mobile")}</label>
				<input type="tel" data-role="bbgf-intake-field" data-section="guardian" data-field="phone" value="${o(f.phone??f.phone_mobile??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Preferred contact")}</label>
				<select data-role="bbgf-intake-field" data-section="guardian" data-field="preferred_contact">
					${["","email","phone_mobile","sms"].map(x=>{const L=g(x)===g(f.preferred_contact??"")?"selected":"",E=x?x.replace("_"," "):"None";return`<option value="${o(x)}" ${L}>${o(E)}</option>`}).join("")}
				</select>
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Notes")}</label>
				<textarea data-role="bbgf-intake-field" data-section="guardian" data-field="notes">${o(f.notes??"")}</textarea>
			</div>
		</section>
	`,ue=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${o(a.intakeClient)}">
			<h3>${o(a.intakeClient)}</h3>
			<div class="bbgf-intake-field">
				<label>${o("Name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="name" value="${o(p.name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Breed")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="breed" value="${o(p.breed??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Weight")}</label>
				<input type="text" inputmode="decimal" data-role="bbgf-intake-field" data-section="client" data-field="weight" value="${o(p.weight??"")}" placeholder="lbs">
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Temperament")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="temperament" value="${o(p.temperament??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${o(a.notes)}</label>
				<textarea data-role="bbgf-intake-field" data-section="client" data-field="notes">${o(p.notes??"")}</textarea>
			</div>
		</section>
	`,ge=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${o(a.intakeVisit)}">
			<h3>${o(a.intakeVisit)}</h3>
			<div class="bbgf-intake-field">
				<label>${o(a.stageLabel)}</label>
				<select data-role="bbgf-intake-field" data-section="visit" data-field="current_stage">
					${N||`<option value="">${o(a.stageLabel)}</option>`}
				</select>
			</div>
			<div class="bbgf-intake-field">
				<label>${o(a.viewSwitcher)}</label>
				<select data-role="bbgf-intake-field" data-section="visit" data-field="view_id">
					${A||`<option value="">${o(a.viewSwitcher)}</option>`}
				</select>
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Instructions")}</label>
				<textarea data-role="bbgf-intake-field" data-section="visit" data-field="instructions">${o(_.instructions??"")}</textarea>
			</div>
			<div class="bbgf-intake-field">
				<label>${o("Public notes")}</label>
				<textarea data-role="bbgf-intake-field" data-section="visit" data-field="public_notes">${o(_.public_notes??"")}</textarea>
			</div>
		</section>
	`,k={search:ce,guardian:be,client:ue,visit:ge};r.innerHTML=`
		<div class="bbgf-modal__tabs bbgf-intake-tabs" role="tablist">
			${T}
		</div>
		${P?`<div class="bbgf-intake-selected-wrap">${P}</div>`:""}
		<div class="bbgf-intake-panel-wrap" id="bbgf-intake-panel-${o($)}">
			${k[$]??""}
		</div>
	`,b.innerHTML=`
		${s.error?`<div class="bbgf-modal__error">${o(s.error)}</div>`:""}
		<div class="bbgf-modal__actions">
			<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-intake-close" ${s.isSaving?"disabled":""}>${o(a.modalClose)}</button>
			<button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-intake-submit" ${s.isSaving?"disabled":""}>${o(s.isSaving?a.intakeSaving:a.intakeSubmit)}</button>
		</div>
	`},ks=e=>{var a;const t=(a=e.target.dataset)==null?void 0:a.role;if(t==="bbgf-intake-tab"){const n=g(e.target.dataset.tab),i=["search","guardian","client","visit"].includes(n)?n:"search";U(r=>({...r,activeTab:i}));return}if(t==="bbgf-intake-close"){pt();return}if(t==="bbgf-intake-select"){const n=Number(e.target.dataset.resultIndex),s=w.getState().intake.searchResults||[],i=Number.isInteger(n)?s[n]:null;i&&ds(i);return}if(t==="bbgf-intake-clear"){U(n=>({...n,selected:null,client:{...n.client||{},id:null,guardian_id:null},guardian:{...n.guardian||{},id:null}}));return}t==="bbgf-intake-submit"&&bs()},$s=e=>{var a;const t=(a=e.target.dataset)==null?void 0:a.role;if(t==="bbgf-intake-search"){cs(e.target.value||"");return}if(t==="bbgf-intake-field"){const n=e.target.dataset.section,s=e.target.dataset.field;ht(n,s,e.target.value)}},Ns=e=>{var a;if(((a=e.target.dataset)==null?void 0:a.role)==="bbgf-intake-field"){const n=e.target.dataset.section,s=e.target.dataset.field;ht(n,s,e.target.value)}},Je=e=>{const t=e.querySelector("#bbgf-intake-modal");!t||t.dataset.bound==="true"||(t.addEventListener("click",ks),t.addEventListener("input",$s,!0),t.addEventListener("change",Ns),document.addEventListener("keydown",a=>{if(a.key==="Escape"){const{intake:n}=w.getState();n.isOpen&&(a.preventDefault(),pt())}}),t.dataset.bound="true")},wt=(e,t)=>{var s;if(Ie.mode==="display")return;const a=e.querySelectorAll(".bbgf-card"),n=(s=t.board)==null?void 0:s.readonly;a.forEach(i=>{var r;n||!((r=l.capabilities)!=null&&r.moveStages)?(i.removeAttribute("draggable"),i.setAttribute("aria-grabbed","false")):(i.setAttribute("draggable","true"),i.hasAttribute("aria-grabbed")||i.setAttribute("aria-grabbed","false"))})},Cs=e=>{const t=e.target.closest(".bbgf-card");if(t&&!e.target.closest(".bbgf-card-actions button")){if(e.key==="Enter"||e.key===" "){e.preventDefault(),t.click();return}if(e.key==="ArrowLeft"){e.preventDefault(),ft(t,"prev");return}e.key==="ArrowRight"&&(e.preventDefault(),ft(t,"next"))}};document.addEventListener("DOMContentLoaded",()=>{var a,n;const e=document.getElementById("bbgf-board-root");if(!e)return;te=e,Oa(te),document.addEventListener("fullscreenchange",Ae),(a=l.context)!=null&&a.view&&(e.dataset.activeView=l.context.view);const t=w.getState();st(t,e,l,y),rt(e,t),ot(e),lt(e),yt(t,e,y),We(e),St(t,e,y),Je(e),wt(e,t),ae={board:t.board,isLoading:t.isLoading,pendingMoves:t.pendingMoves,filters:t.filters,viewOverride:t.viewOverride,nextRefreshAt:t.nextRefreshAt,lastFetchedAt:t.lastFetchedAt},K={isOpen:t.modal.isOpen,activeTab:t.modal.activeTab,loading:t.modal.loading,readOnly:t.modal.readOnly,isSaving:t.modal.isSaving,error:t.modal.error,visitId:((n=t.modal.visit)==null?void 0:n.id)||null,pendingUploads:t.modal.pendingUploads},He=t.intake,Ge=t.catalog,ze=t.errors,w.subscribe(s=>{var v,C;const i=!ae||s.board!==ae.board||s.isLoading!==ae.isLoading||s.pendingMoves!==ae.pendingMoves||s.filters!==ae.filters||s.viewOverride!==ae.viewOverride||s.nextRefreshAt!==ae.nextRefreshAt||s.lastFetchedAt!==ae.lastFetchedAt,r=s.errors!==ze;i?(st(s,e,l,y),rt(e,s),ot(e),lt(e),We(e),wt(e,s),Je(e),ae={board:s.board,isLoading:s.isLoading,pendingMoves:s.pendingMoves,filters:s.filters,viewOverride:s.viewOverride,nextRefreshAt:s.nextRefreshAt,lastFetchedAt:s.lastFetchedAt}):r&&it(s,e,y),(!K||s.modal.isOpen!==K.isOpen||s.modal.activeTab!==K.activeTab||s.modal.loading!==K.loading||s.modal.readOnly!==K.readOnly||s.modal.isSaving!==K.isSaving||s.modal.error!==K.error||s.modal.pendingUploads!==K.pendingUploads||(((v=s.modal.visit)==null?void 0:v.id)||null)!==(K.visitId||null)||s.catalog!==Ge)&&(yt(s,e,y),We(e),K={isOpen:s.modal.isOpen,activeTab:s.modal.activeTab,loading:s.modal.loading,readOnly:s.modal.readOnly,isSaving:s.modal.isSaving,error:s.modal.error,visitId:((C=s.modal.visit)==null?void 0:C.id)||null,pendingUploads:s.modal.pendingUploads},Ge=s.catalog),s.intake!==He&&(St(s,e,y),Je(e),He=s.intake),ze=s.errors}),window.bbgfBoardSettings=l,window.bbgfBoardStore=w,window.bbgfBoardApi=z,window.bbgfBoardRefresh=()=>pe({reason:"manual",forceFull:!0}),e.addEventListener("click",os),e.addEventListener("keydown",Cs),e.addEventListener("dragstart",ms),e.addEventListener("dragend",ps),e.addEventListener("dragover",hs),e.addEventListener("dragleave",vs),e.addEventListener("drop",ys),e.addEventListener("touchstart",Ss,{passive:!0}),e.addEventListener("touchmove",ws,{passive:!1}),e.addEventListener("touchend",_s,{passive:!0}),pe({reason:"initial",forceFull:!l.initialBoard})})})();
//# sourceMappingURL=board.js.map
