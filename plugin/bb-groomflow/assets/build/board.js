(function(){"use strict";var Bt,Dt,Rt,Ht,Gt,zt,Wt,Kt,Jt,Qt,Xt,Yt,Zt,ea,ta,aa,sa,na,ia,oa,ra,la,da,ca,ba,ga,ua,fa,ma,pa,ha,va,ya,Sa,wa,ka,_a,$a,Na,Ca,Ea,La,xa,Ta,Ia,Aa,Pa,Ma,Fa,Va,Ua,Oa,ja,qa,Ba,Da,Ra,Ha,Ga,za,Wa,Ka,Ja,Qa,Xa,Ya;const b=window.bbgfBoardSettings||{},y={loading:((Bt=b.strings)==null?void 0:Bt.loading)??"Loading GroomFlow board‚Ä¶",emptyColumn:((Dt=b.strings)==null?void 0:Dt.emptyColumn)??"No visits in this stage yet",noVisits:((Rt=b.strings)==null?void 0:Rt.noVisits)??"No visits available.",refresh:((Ht=b.strings)==null?void 0:Ht.refresh)??"Refresh",lastUpdated:((Gt=b.strings)==null?void 0:Gt.lastUpdated)??"Last updated",viewSwitcher:((zt=b.strings)==null?void 0:zt.viewSwitcher)??"Board views",services:((Wt=b.strings)==null?void 0:Wt.services)??"Services",flags:((Kt=b.strings)==null?void 0:Kt.flags)??"Behavior flags",notes:((Jt=b.strings)==null?void 0:Jt.notes)??"Notes",checkIn:((Qt=b.strings)==null?void 0:Qt.checkIn)??"Check-in",addVisit:((Xt=b.strings)==null?void 0:Xt.addVisit)??"Add visit",movePrev:((Yt=b.strings)==null?void 0:Yt.movePrev)??"Back",moveNext:((Zt=b.strings)==null?void 0:Zt.moveNext)??"Next",unknownClient:((ea=b.strings)==null?void 0:ea.unknownClient)??"Client",stageControls:((ta=b.strings)==null?void 0:ta.stageControls)??"Stage controls",loadingError:((aa=b.strings)==null?void 0:aa.loadingError)??"Unable to load the board. Please refresh.",modalTitle:((sa=b.strings)==null?void 0:sa.modalTitle)??"Visit details",modalLoading:((na=b.strings)==null?void 0:na.modalLoading)??"Loading visit‚Ä¶",modalClose:((ia=b.strings)==null?void 0:ia.modalClose)??"Close",modalReadOnly:((oa=b.strings)==null?void 0:oa.modalReadOnly)??"Read-only view",modalSummary:((ra=b.strings)==null?void 0:ra.modalSummary)??"Summary",modalNotes:((la=b.strings)==null?void 0:la.modalNotes)??"Notes",modalServices:((da=b.strings)==null?void 0:da.modalServices)??"Services",modalVisit:((ca=b.strings)==null?void 0:ca.modalVisit)??"Visit",modalHistory:((ba=b.strings)==null?void 0:ba.modalHistory)??"History",modalPhotos:((ga=b.strings)==null?void 0:ga.modalPhotos)??"Photos",modalNoPrevious:((ua=b.strings)==null?void 0:ua.modalNoPrevious)??"No previous visits found.",modalUploadPhoto:((fa=b.strings)==null?void 0:fa.modalUploadPhoto)??"Upload photo",modalVisibleToGuardian:((ma=b.strings)==null?void 0:ma.modalVisibleToGuardian)??"Visible to guardian",modalViewPhoto:((pa=b.strings)==null?void 0:pa.modalViewPhoto)??"View full size",modalSave:((ha=b.strings)==null?void 0:ha.modalSave)??"Save changes",modalSaving:((va=b.strings)==null?void 0:va.modalSaving)??"Saving‚Ä¶",modalCheckout:((ya=b.strings)==null?void 0:ya.modalCheckout)??"Check out",modalCheckedOut:((Sa=b.strings)==null?void 0:Sa.modalCheckedOut)??"Checked out",modalCheckoutAt:((wa=b.strings)==null?void 0:wa.modalCheckoutAt)??"Checked out at",modalPreparingUpload:((ka=b.strings)==null?void 0:ka.modalPreparingUpload)??"Preparing photos‚Ä¶",modalNoHistory:((_a=b.strings)==null?void 0:_a.modalNoHistory)??"No history recorded yet.",modalNoPhotos:(($a=b.strings)==null?void 0:$a.modalNoPhotos)??"No photos uploaded for this visit.",searchPlaceholder:((Na=b.strings)==null?void 0:Na.searchPlaceholder)??"Search clients, guardians, services‚Ä¶",moveSuccess:((Ca=b.strings)==null?void 0:Ca.moveSuccess)??"Visit moved.",fullscreen:((Ea=b.strings)==null?void 0:Ea.fullscreen)??"Fullscreen",exitFullscreen:((La=b.strings)==null?void 0:La.exitFullscreen)??"Exit fullscreen",autoRefresh:((xa=b.strings)==null?void 0:xa.autoRefresh)??"Auto-refresh in",maskedGuardian:((Ta=b.strings)==null?void 0:Ta.maskedGuardian)??"Guardian hidden for lobby view",errorFetching:((Ia=b.strings)==null?void 0:Ia.errorFetching)??"Unable to refresh the board. Please try again.",activeVisits:((Aa=b.strings)==null?void 0:Aa.activeVisits)??"Active visits",overdueVisits:((Pa=b.strings)==null?void 0:Pa.overdueVisits)??"Overdue",flaggedVisits:((Ma=b.strings)==null?void 0:Ma.flaggedVisits)??"Flagged",filtersActive:((Fa=b.strings)==null?void 0:Fa.filtersActive)??"Filters applied",clearFilters:((Va=b.strings)==null?void 0:Va.clearFilters)??"Clear filters",guardianLabel:((Ua=b.strings)==null?void 0:Ua.guardianLabel)??"Guardian",stageLabel:((Oa=b.strings)==null?void 0:Oa.stageLabel)??"Stage",stagesLabel:((ja=b.strings)==null?void 0:ja.stagesLabel)??"Stages",intakeTitle:((qa=b.strings)==null?void 0:qa.intakeTitle)??"Add visit",intakeSearchLabel:((Ba=b.strings)==null?void 0:Ba.intakeSearchLabel)??"Search clients or guardians",intakeNoResults:((Da=b.strings)==null?void 0:Da.intakeNoResults)??"No matches found in this tab. Try Guardian/Client or add details below.",intakeGuardian:((Ra=b.strings)==null?void 0:Ra.intakeGuardian)??"Guardian",intakeClient:((Ha=b.strings)==null?void 0:Ha.intakeClient)??"Client",intakeVisit:((Ga=b.strings)==null?void 0:Ga.intakeVisit)??"Visit details",intakeSubmit:((za=b.strings)==null?void 0:za.intakeSubmit)??"Create visit",intakeSaving:((Wa=b.strings)==null?void 0:Wa.intakeSaving)??"Creating visit‚Ä¶",intakeSuccess:((Ka=b.strings)==null?void 0:Ka.intakeSuccess)??"Visit created and added to the board.",intakeSearchHint:((Ja=b.strings)==null?void 0:Ja.intakeSearchHint)??"Search by client, guardian, phone, or email.",intakeSelect:((Qa=b.strings)==null?void 0:Qa.intakeSelect)??"Select",modalCheckoutConfirm:((Xa=b.strings)==null?void 0:Xa.modalCheckoutConfirm)??"Are you sure you want to check out this visit?"},ze=b.presentation||{},je=b.appearance||{},ie=je.colors||{},es=je.show_services!==!1,ts=je.show_flags!==!1;je.show_notes;const m=e=>Array.isArray(e)?e:[],u=e=>typeof e=="string"?e:"",ue=e=>{const t=Number(e);return Number.isFinite(t)?t:null},We=m((Ya=b.placeholders)==null?void 0:Ya.photos).filter(e=>typeof e=="string"&&e.length>0),as=e=>{var l,c;const t=u(ze.mode??"");let a=t==="display"||t==="interactive"?t:"";a||(a=e.readonly||e.is_public?"display":"interactive");const n=($,_)=>{const w=ze[$];return typeof w=="boolean"?w:_},s=a==="display"?!1:!!((l=e.visibility)!=null&&l.mask_guardian),i=u(ze.view_switcher??""),o=((c=e==null?void 0:e.view)==null?void 0:c.allow_switcher)!==!1;let d=["dropdown","buttons","none"].includes(i)?i:a==="display"?"none":"dropdown";return(!o||a==="display")&&(d="none"),{mode:a,showToolbar:n("show_toolbar",a!=="display"),showSearch:n("show_search",a!=="display"),showFilters:n("show_filters",a!=="display"),showRefresh:n("show_refresh",a!=="display"),showLastUpdated:n("show_last_updated",a!=="display"),showCountdown:n("show_countdown",a!=="display"),showFullscreen:n("show_fullscreen",!0),showMaskBadge:n("show_mask_badge",s),showNotes:n("show_notes",a!=="display"),viewSwitcher:d}},Ke=e=>e&&typeof e=="object"?JSON.parse(JSON.stringify(e)):e,bt=e=>!e||typeof e!="object"?e:{...e,visits:m(e.visits).map(t=>Ke(t))},Je=e=>{const t=Date.parse(e);return Number.isNaN(t)?null:t},gt=e=>{const t=Je(e==null?void 0:e.check_in_at);if(t!==null)return t;const a=Je(e==null?void 0:e.created_at);if(a!==null)return a;const n=Je(e==null?void 0:e.updated_at);return n!==null?n:Number.MAX_SAFE_INTEGER},ss=e=>m(e).slice().sort((t,a)=>{const n=gt(t)-gt(a);return n!==0?n:(Number(t==null?void 0:t.id)||0)-(Number(a==null?void 0:a.id)||0)}),Ee=e=>{if(!e||typeof e!="object")return e;const t=m(e.stages).map(a=>({...a,visits:ss(a==null?void 0:a.visits)}));return{...e,stages:t}},ut=e=>{var n,s;const t=m(e==null?void 0:e.stages),a=t.find(i=>m(i==null?void 0:i.visits).length>0);return u(a?a.key??a.stage_key??"":((n=t[0])==null?void 0:n.key)??((s=t[0])==null?void 0:s.stage_key)??"")},ns=e=>{if(!e)return"horizontal";const n=260*3+24*2;return(e.clientWidth||window.innerWidth||0)<n?"vertical":"horizontal"},Qe=e=>{var d,l;const t=S.getState(),a=t.board,n=ns(e),s=m(a==null?void 0:a.stages).map(c=>u((c==null?void 0:c.key)??(c==null?void 0:c.stage_key)??"")),i=((d=t.layout)==null?void 0:d.mode)==="vertical";let o=((l=t.layout)==null?void 0:l.expandedStage)??"";if(n==="vertical"){if(o&&!s.includes(o)){const c=ut(a);c&&(o=c)}else if(!o&&!i){const c=ut(a);c&&(o=c)}}else o="";return(n!==t.layout.mode||o!==t.layout.expandedStage)&&Nt({mode:n,expandedStage:o}),{mode:n,expandedStage:o}},ft=e=>{const t=new Map;return m(e).forEach(a=>{const n=u((a==null?void 0:a.key)??(a==null?void 0:a.stage_key));n&&t.set(n,bt(a))}),t},is=(e,t)=>{if(!t||typeof t!="object")return Ee(e);if(!e||typeof e!="object")return Ee(t);const a=ft(e.stages),n=ft(t.stages);if(!n.size)return Ee({...e,...t,stages:m(e.stages).map(o=>bt(o))});const s=new Set;n.forEach(o=>{m(o.visits).forEach(d=>{d&&(d.id||d.id===0)&&s.add(Number(d.id))})}),s.size&&a.forEach((o,d)=>{if(!o)return;const l=m(o.visits).filter(c=>!c||c.id===void 0||c.id===null?!0:!s.has(Number(c.id)));a.set(d,{...o,visits:l})}),n.forEach((o,d)=>{const l=a.get(d),c=m(l==null?void 0:l.visits).map(w=>Ke(w)),$=m(o.visits).map(w=>Ke(w)),_={...l??{},...o,visits:[...c,...$]};a.set(d,_)});const i=Array.from(a.values());return i.sort((o,d)=>{const l=ue(o==null?void 0:o.sort_order)??0,c=ue(d==null?void 0:d.sort_order)??0;return l-c}),Ee({...e,...t,stages:i})},os=(e,t)=>{const a=Number(t);if(!e||Number.isNaN(a))return null;for(const n of m(e.stages))for(const s of m(n.visits))if(Number(s==null?void 0:s.id)===a)return{stage:n,visit:s};return null},qe=e=>{if(!Number.isFinite(e))return">1m";const t=Math.max(0,Math.floor(e)),a=Math.floor(t/3600),n=Math.floor(t%3600/60),s=t%60;return t<60?">1m":a>=1?`${a}h ${n.toString().padStart(2,"0")}m`:n>=1?`${n}m`:`${s}s`},mt=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})},rs=e=>mt(e),xe=e=>{if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString([],{hour:"numeric",minute:"2-digit",month:"short",day:"numeric",year:"numeric"})},ls=e=>{if(!e)return"";const t=new Date(e);if(Number.isNaN(t.getTime()))return"";const n=Math.round((new Date().getTime()-t.getTime())/1e3);if(n<10)return"just now";if(n<60)return`${n}s ago`;const s=Math.round(n/60);if(s<60)return`${s} min${s===1?"":"s"} ago`;const i=Math.round(s/60);if(i<24)return`${i} hr${i===1?"":"s"} ago`;const o=Math.round(i/24);return`${o} day${o===1?"":"s"} ago`},pt=(e,t={})=>{const a=ue(t.yellow)??0,n=ue(t.red)??0;return n>0&&e>=n?"critical":a>0&&e>=a?"warning":"on-track"},ds=e=>{var n,s,i;const t=m(e);if(!t.length)return null;const a=t[0];if(!a||typeof a!="object")return null;if(a.url)return{url:a.url,alt:u(a.alt)};if(a.sizes){const o=((n=a.sizes.thumbnail)==null?void 0:n.url)||((s=a.sizes.medium)==null?void 0:s.url)||((i=a.sizes.full)==null?void 0:i.url);if(o)return{url:o,alt:u(a.alt)}}return null},ht=e=>{var i;if(!We.length)return null;const t=Number(e==null?void 0:e.id),a=Number.isFinite(t)?Math.abs(t)%We.length:0,n=We[a],s=u(((i=e==null?void 0:e.client)==null?void 0:i.name)??y.unknownClient);return{url:n,alt:s?`${s} placeholder photo`:y.unknownClient}},vt=e=>{var t;return ds(e==null?void 0:e.photos)??((t=e==null?void 0:e.client)==null?void 0:t.main_photo)??ht(e)},cs=async e=>{if(!e)throw new Error("Missing file");if(window.createImageBitmap)try{const t=await createImageBitmap(e);return{source:t,width:t.width,height:t.height,cleanup:()=>{typeof t.close=="function"&&t.close()}}}catch{}return new Promise((t,a)=>{const n=URL.createObjectURL(e),s=new Image;s.onload=()=>{URL.revokeObjectURL(n),t({source:s,width:s.naturalWidth||s.width,height:s.naturalHeight||s.height,cleanup:()=>{}})},s.onerror=i=>{URL.revokeObjectURL(n),a(i||new Error("Unable to load image"))},s.src=n})},bs=async(e,t={})=>{if(!(e instanceof File)||typeof e.type!="string"||!e.type.startsWith("image/"))return e;const a=Number(t.maxDimension??1600),n=Number(t.maxBytes??1.8*1024*1024),s=Number(t.quality??.82),i=await cs(e),o=Math.max(i.width,i.height);if(!o)return i.cleanup(),e;const d=o>a?a/o:1,l=Math.max(1,Math.round(i.width*d)),c=Math.max(1,Math.round(i.height*d)),$=document.createElement("canvas");$.width=l,$.height=c;const _=$.getContext("2d");if(!_)return e;_.drawImage(i.source,0,0,l,c);const w=e.type==="image/png"?"image/png":"image/jpeg",G=h=>new Promise((f,p)=>{$.toBlob(v=>{v?f(v):p(new Error("Unable to process image"))},w,h)});let F=w==="image/png"?.92:s,U=await G(F),O=0;for(;U&&U.size>n&&F>.5&&O<5;)F=Math.max(.5,F-.1),U=await G(F),O+=1;if(U&&U.size>n&&d===1){const h=Math.sqrt(n/U.size),f=Math.max(1,Math.round(l*h)),p=Math.max(1,Math.round(c*h));$.width=f,$.height=p,_.clearRect(0,0,f,p),_.drawImage(i.source,0,0,f,p),U=await G(F)}if(!U)return i.cleanup(),e;i.cleanup();const R=e.name.replace(/\.[^.]+$/,"")||"photo",B=w==="image/png"?"png":"jpg";return new File([U],`${R}.${B}`,{type:w,lastModified:Date.now()})},gs=e=>m(e).map(t=>u(t==null?void 0:t.name)).filter(Boolean).join(", "),us=e=>{if(!e)return;const t=(a,n)=>{typeof n=="string"&&n&&e.style.setProperty(a,n)};t("--bbgf-accent",ie.accent),t("--bbgf-card-bg",ie.card),t("--bbgf-column-bg",ie.column),t("--bbgf-background-start",ie.background_start),t("--bbgf-background-end",ie.background_end),t("--bbgf-text",ie.text),ie.text&&(t("--bbgf-muted",ie.text),t("--bbgf-muted-soft",ie.text)),t("--bbgf-warning",ie.timer_warning),t("--bbgf-critical",ie.timer_critical),t("--bbgf-flag",ie.flag)},r=e=>u(e).replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return t}}),Xe=e=>!e||typeof e!="object"?{instructions:"",publicNotes:"",privateNotes:"",services:[]}:{instructions:u(e.instructions??""),publicNotes:u(e.public_notes??""),privateNotes:u(e.private_notes??""),services:m(e.services).map(t=>Number(t==null?void 0:t.id)).filter(t=>Number.isFinite(t))},Ye=(e,t)=>{const a=m(e==null?void 0:e.stages),n=a.findIndex(s=>s.key===t);return n===-1?{prev:null,next:null}:{prev:n>0?a[n-1]:null,next:n<a.length-1?a[n+1]:null}},fs=e=>{if(!e)return"";const t=Math.round((e-Date.now())/1e3);if(t<=0)return"0s";if(t<60)return`${t}s`;const a=Math.floor(t/60),n=t%60;return`${a}m ${n.toString().padStart(2,"0")}s`};let Be=null;const ms=(e,t,a)=>{e&&window.requestAnimationFrame(()=>{const n=e.scrollWidth>e.clientWidth+2,s=t==="horizontal"&&a!=="display";e.classList.toggle("bbgf-board--overflowing",n),e.classList.toggle("bbgf-board--centered",s&&!n),n&&(e.scrollLeft=0)})},ps=e=>{const t=mt(e);return t?`${y.checkIn} ${t}`:""},hs=e=>{const t=ue(e==null?void 0:e.timer_elapsed_seconds),a=60*60*24*14;if(Number.isFinite(t)&&t>=0&&t<=a)return t;const n=(e==null?void 0:e.timer_started_at)||(e==null?void 0:e.check_in_at);if(n){const s=new Date(n);if(!Number.isNaN(s.getTime()))return Math.max(0,Math.round((Date.now()-s.getTime())/1e3))}return Number.isFinite(t)&&t>=0?t:0},vs=(e={})=>{let t={...e};const a=new Set;return{getState:()=>t,setState:n=>{const s=typeof n=="function"?n(t):n;!s||typeof s!="object"||(t={...t,...s},a.forEach(i=>{try{i(t)}catch(o){console.error("[BBGF] store listener error",o)}}))},subscribe:n=>typeof n!="function"?()=>{}:(a.add(n),()=>a.delete(n))}},ys=(e={},t={})=>{var B;const a=((B=window==null?void 0:window.wpApiSettings)==null?void 0:B.nonce)||"",n=()=>{const h={Accept:"application/json"};return(e.nonce||a)&&(h["X-WP-Nonce"]=e.nonce||a),h},s=(h,f={})=>{if(!h)return"";const p=new URL(h,window.location.origin);return Object.entries(f).forEach(([v,k])=>{k==null||k===""||p.searchParams.append(v,k)}),p.toString()};return{fetchBoard:async(h={})=>{var k;const f={...h};t.publicToken&&(f.public_token=t.publicToken);const p=s((k=e.endpoints)==null?void 0:k.board,f);if(!p)throw new Error("Board endpoint unavailable");const v=await fetch(p,{method:"GET",headers:n(),credentials:"same-origin"});if(!v.ok)throw new Error(`Board request failed with status ${v.status}`);return v.json()},fetchVisit:async(h,f={})=>{var L;const p=(L=e.endpoints)==null?void 0:L.visits;if(!p)throw new Error("Visit endpoint unavailable");const v={...f};t.publicToken&&!v.public_token&&(v.public_token=t.publicToken),t.view&&!v.view&&(v.view=t.view);const k=s(`${p}/${encodeURIComponent(h)}`,v),N=await fetch(k,{method:"GET",headers:n(),credentials:"same-origin"});if(!N.ok)throw new Error(`Visit request failed with status ${N.status}`);return N.json()},moveVisit:async(h,f,p={})=>{var L;const v=(L=e.endpoints)==null?void 0:L.visits;if(!v)throw new Error("Visit endpoint unavailable");const k=s(`${v}/${encodeURIComponent(h)}/move`),N=await fetch(k,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({to_stage:f,comment:p.comment??""})});if(!N.ok){let g=`Move failed with status ${N.status}`;try{const j=await N.json();j!=null&&j.message&&(g=j.message)}catch{}throw new Error(g)}return N.json()},checkoutVisit:async(h,f={})=>{var N;const p=(N=e.endpoints)==null?void 0:N.visits;if(!p)throw new Error("Visit endpoint unavailable");const v=s(`${p}/${encodeURIComponent(h)}/checkout`),k=await fetch(v,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({comment:f.comment??""})});if(!k.ok){let L=`Checkout failed with status ${k.status}`;try{const g=await k.json();g!=null&&g.message&&(L=g.message)}catch{}throw new Error(L)}return k.json()},updateVisit:async(h,f={})=>{var N;const p=(N=e.endpoints)==null?void 0:N.visits;if(!p)throw new Error("Visit endpoint unavailable");const v=s(`${p}/${encodeURIComponent(h)}`),k=await fetch(v,{method:"PATCH",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(f)});if(!k.ok){let L=`Update failed with status ${k.status}`;try{const g=await k.json();g!=null&&g.message&&(L=g.message)}catch{}throw new Error(L)}return k.json()},createVisit:async(h={})=>{var k;const f=(k=e.endpoints)==null?void 0:k.visits;if(!f)throw new Error("Visit endpoint unavailable");const p=s(f),v=await fetch(p,{method:"POST",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(h)});if(!v.ok){let N=`Create failed with status ${v.status}`;try{const L=await v.json();L!=null&&L.message&&(N=L.message)}catch{}throw new Error(N)}return v.json()},searchIntake:async(h="")=>{var N;const f=(N=e.endpoints)==null?void 0:N.intakeSearch;if(!f)throw new Error("Intake search endpoint unavailable");const p=s(f,{query:h}),v=await fetch(p,{method:"GET",headers:n(),credentials:"same-origin"});if(!v.ok)throw new Error(`Search failed with status ${v.status}`);const k=await v.json();return(k==null?void 0:k.items)??[]},addPhoto:async(h,f,p=!0)=>{var g;const v=(g=e.endpoints)==null?void 0:g.visits;if(!v)throw new Error("Visit endpoint unavailable");const k=s(`${v}/${encodeURIComponent(h)}/photo`),N=new FormData;N.append("visible_to_guardian",p?"1":"0"),N.append("file",f);const L=await fetch(k,{method:"POST",headers:n(),credentials:"same-origin",body:N});if(!L.ok){let j=`Photo upload failed with status ${L.status}`;try{const q=await L.json();q!=null&&q.message&&(j=q.message)}catch{}throw new Error(j)}return L.json()},updatePhoto:async(h,f,p={})=>{var L;const v=(L=e.endpoints)==null?void 0:L.visits;if(!v)throw new Error("Visit endpoint unavailable");const k=s(`${v}/${encodeURIComponent(h)}/photo/${encodeURIComponent(f)}`),N=await fetch(k,{method:"PATCH",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(p)});if(!N.ok){let g=`Photo update failed with status ${N.status}`;try{const j=await N.json();j!=null&&j.message&&(g=j.message)}catch{}throw new Error(g)}return N.json()},fetchServices:async()=>{var v;const h=(v=e.endpoints)==null?void 0:v.services;if(!h)throw new Error("Services endpoint unavailable");const f=s(h,{per_page:100,context:"view"}),p=await fetch(f,{method:"GET",headers:n(),credentials:"same-origin"});if(!p.ok)throw new Error(`Services request failed with status ${p.status}`);return p.json()},fetchFlags:async()=>{var v;const h=(v=e.endpoints)==null?void 0:v.flags;if(!h)throw new Error("Flags endpoint unavailable");const f=s(h,{per_page:100,context:"view"}),p=await fetch(f,{method:"GET",headers:n(),credentials:"same-origin"});if(!p.ok)throw new Error(`Flags request failed with status ${p.status}`);return p.json()},updateClient:async(h,f={})=>{var N;const p=(N=e.endpoints)==null?void 0:N.clients;if(!p)throw new Error("Clients endpoint unavailable");const v=s(`${p}/${encodeURIComponent(h)}`),k=await fetch(v,{method:"PATCH",headers:{...n(),"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(f)});if(!k.ok){let L=`Client update failed with status ${k.status}`;try{const g=await k.json();g!=null&&g.message&&(L=g.message)}catch{}throw new Error(L)}return k.json()},fetchClientHistory:async(h,f={})=>{var N;const p=(N=e.endpoints)==null?void 0:N.clients;if(!p)throw new Error("Clients endpoint unavailable");const v=s(`${p}/${encodeURIComponent(h)}/history`,f),k=await fetch(v,{method:"GET",headers:n(),credentials:"same-origin"});if(!k.ok){let L=`History request failed with status ${k.status}`;try{const g=await k.json();g!=null&&g.message&&(L=g.message)}catch{}throw new Error(L)}return k.json()}}},Ss=(e,t,a)=>{var fe,ve,te,ke,x,K,J,le,ye;const{copy:n,pendingMoves:s,readonly:i,draggingVisitId:o}=a,d=u(t.key??t.stage_key??""),l=document.createElement("article");l.className="bbgf-card",l.dataset.visitId=String(e.id??""),l.dataset.stage=d,l.dataset.updatedAt=u(e.updated_at??""),l.setAttribute("role","listitem"),l.setAttribute("aria-label",u(((fe=e.client)==null?void 0:fe.name)??n.unknownClient)),!i&&((ve=b.capabilities)!=null&&ve.moveStages)?(l.setAttribute("draggable","true"),l.classList.add("bbgf-card--draggable")):(l.removeAttribute("draggable"),l.classList.remove("bbgf-card--draggable"));const c=Number(e.id),$=s==null?void 0:s.has(c),_=o!==null&&c===Number(o);l.classList.toggle("bbgf-card--pending",!!$),l.classList.toggle("is-dragging",!!_),l.setAttribute("aria-grabbed",_?"true":"false");const w=hs(e),G=pt(w,t.timer_thresholds??{});l.classList.add(`bbgf-card--timer-${G}`);const F=document.createElement("div");F.className="bbgf-card-photo",F.setAttribute("aria-hidden","true");const U=vt(e);if(U&&U.url){const A=document.createElement("img");A.src=U.url,A.alt=U.alt||u(((te=e.client)==null?void 0:te.name)??n.unknownClient),F.appendChild(A)}else{const A=document.createElement("span");A.textContent=(u(((ke=e.client)==null?void 0:ke.name)??n.unknownClient).charAt(0)||"üêæ").toUpperCase(),F.appendChild(A)}const O=document.createElement("div");O.className="bbgf-card-body";const R=document.createElement("div");R.className="bbgf-card-top",R.appendChild(F);const B=document.createElement("div");B.className="bbgf-card-info";const h=document.createElement("p");h.className="bbgf-card-name",h.textContent=u(((x=e.client)==null?void 0:x.name)??n.unknownClient),B.appendChild(h);const f=u(((K=e.client)==null?void 0:K.breed)??"");if(f){const A=document.createElement("p");A.className="bbgf-card-breed",A.textContent=f,B.appendChild(A)}const p=m(e.flags),v=m((J=e.client)==null?void 0:J.flags),k=[],N=new Set;if([...p,...v].forEach(A=>{const W=Number((A==null?void 0:A.id)??A);!Number.isFinite(W)||N.has(W)||(N.add(W),k.push(A))}),k.length&&ts){const A=document.createElement("div");A.className="bbgf-card-flags",A.setAttribute("aria-label",n.flags),k.forEach(W=>{const T=document.createElement("span");T.className="bbgf-flag-chip";const P=document.createElement("span");P.setAttribute("aria-hidden","true"),P.textContent=u(W.emoji),T.appendChild(P);const H=document.createElement("span");H.textContent=u(W.name),T.appendChild(H),A.appendChild(T)}),B.appendChild(A)}R.appendChild(B),O.appendChild(R);const L=document.createElement("div");L.className="bbgf-card-meta";const g=document.createElement("span");g.className="bbgf-card-timer",g.dataset.state=G,g.dataset.seconds=String(w),g.dataset.baseSeconds=String(w),g.dataset.yellow=String(ue((le=t.timer_thresholds)==null?void 0:le.yellow)??""),g.dataset.red=String(ue((ye=t.timer_thresholds)==null?void 0:ye.red)??""),g.textContent=qe(w),L.appendChild(g);const j=ps(e.check_in_at);if(j){const A=document.createElement("span");A.className="bbgf-card-checkin",A.textContent=j,L.appendChild(A)}O.appendChild(L);const q=m(e.services);if(q.length&&es){const A=document.createElement("div");A.className="bbgf-card-services",A.setAttribute("aria-label",n.services),q.forEach(W=>{const T=document.createElement("span");T.className="bbgf-service-chip",T.setAttribute("aria-hidden","true");const P=u(W.icon),H=u(W.name);T.textContent=P&&P!==H?`${P} ${H}`:H,A.appendChild(T)}),O.appendChild(A)}return l.appendChild(O),l},ws=(e,t)=>{const{copy:a,pendingMoves:n,readonly:s,draggingVisitId:i,layoutMode:o="horizontal",expandedStage:d}=t,l=u(e.key??e.stage_key??""),c=u(e.label??l),$=m(e.visits),_=$.length,w=o==="vertical",G=!w||d&&d===l,F=document.createElement("section");F.className="bbgf-column",F.dataset.stage=l,F.dataset.visitCount=String(_),F.dataset.expanded=G?"true":"false",F.setAttribute("role","listitem"),F.setAttribute("aria-label",c),F.setAttribute("aria-dropeffect",s?"none":"move"),w&&!G&&F.classList.add("bbgf-column--collapsed");const U=document.createElement("header");U.className="bbgf-column-header";const O=document.createElement("div");O.className="bbgf-column-title";const R=document.createElement("span");R.className="bbgf-column-label",R.textContent=c,O.appendChild(R);const B=document.createElement("span");B.className="bbgf-column-count",B.textContent=String(_),B.setAttribute("aria-label",String(_)),O.appendChild(B);const h=document.createElement("button");h.type="button",h.className="bbgf-column-toggle",h.dataset.role="bbgf-column-toggle",h.dataset.stage=l,h.setAttribute("aria-expanded",G?"true":"false"),h.appendChild(O),U.appendChild(h),F.appendChild(U);const f=document.createElement("div");if(f.className="bbgf-column-body",f.setAttribute("role","list"),f.setAttribute("aria-label",`${c} column cards`),w&&!G?f.setAttribute("hidden","hidden"):f.removeAttribute("hidden"),$.length)$.forEach(p=>{const v=Ss(p,e,{copy:a,pendingMoves:n,readonly:s,draggingVisitId:i});f.appendChild(v)});else{const p=document.createElement("p");p.className="bbgf-column-empty",p.textContent=a.emptyColumn,f.appendChild(p)}return F.appendChild(f),F},De=e=>{var t,a,n,s;return e.viewOverride||((a=(t=e.board)==null?void 0:t.view)==null?void 0:a.slug)||((n=b.context)==null?void 0:n.view)||((s=b.view)==null?void 0:s.slug)||""},yt=(e,t,a,n)=>{var p,v,k,N,L;t.classList.add("bbgf-board--bootstrapped");const s=Qe(t),i=(s==null?void 0:s.mode)||((p=e.layout)==null?void 0:p.mode)||"horizontal",o=(s==null?void 0:s.expandedStage)||((v=e.layout)==null?void 0:v.expandedStage)||"",d=e.board;if(!d){t.innerHTML="";const g=document.createElement("div");g.className="bbgf-board-loading",g.textContent=n.loading,t.appendChild(g);return}const l=as(d);He=l;const c=t.querySelector("#bbgf-modal"),$=t.querySelector("#bbgf-intake-modal");t.dataset.readonly=d.readonly?"true":"false",t.dataset.isPublic=d.is_public?"true":"false",t.dataset.activeView=De(e);const _=u(((k=d.view)==null?void 0:k.type)??"");t.dataset.viewType=_,t.dataset.boardMode=l.mode,t.dataset.layoutMode=i,t.dataset.expandedStage=o||"",d.readonly?t.classList.add("bbgf-board--readonly"):t.classList.remove("bbgf-board--readonly"),l.mode==="display"?t.classList.add("bbgf-board-wrapper--display"):t.classList.remove("bbgf-board-wrapper--display"),t.innerHTML="",wt(e,t,n);const w=document.createElement("div");w.className="bbgf-board",w.setAttribute("role","list"),w.dataset.layoutMode=i,w.dataset.expandedStage=o||"";const G=m(d.stages),F=g=>!!g,U=G.map(g=>({...g,visits:m(g.visits).filter(F)}));if(t.dataset.searchActive="false",U.length){const g=new Set(m(e.pendingMoves).map(q=>Number(q))),j=(N=e.drag)!=null&&N.isDragging?e.drag.visitId:null;U.forEach((q,fe)=>{var te;U[fe-1],U[fe+1];const ve=ws(q,{copy:n,canMove:!!((te=a.capabilities)!=null&&te.moveStages)&&!d.readonly,pendingMoves:g,readonly:d.readonly,draggingVisitId:j,layoutMode:i,expandedStage:o});w.appendChild(ve)})}else{const g=document.createElement("p");g.className="bbgf-board-empty",g.textContent=n.noVisits,w.appendChild(g)}t.appendChild(w);const O=()=>ms(w,i,l.mode);if(O(),typeof window<"u"&&(Be&&window.removeEventListener("resize",Be),Be=()=>O(),window.addEventListener("resize",Be,{passive:!0})),ks(t),!t.querySelector(".bbgf-floating-controls")){const g=document.createElement("div");if(g.className="bbgf-floating-controls",(L=b.capabilities)!=null&&L.editVisits&&He.mode!=="display"){const q=document.createElement("button");q.type="button",q.className="bbgf-icon-button bbgf-intake-button",q.dataset.role="bbgf-intake-open",q.setAttribute("aria-label",y.addVisit||y.intakeTitle),q.innerHTML=`<span aria-hidden="true">Ôºã</span><span class="screen-reader-text">${r(y.intakeTitle)}</span>`,g.appendChild(q)}const j=document.createElement("button");if(j.type="button",j.className="bbgf-icon-button bbgf-refresh-button",j.setAttribute("aria-label",n.refresh),j.textContent="‚ü≥",e.isLoading&&(j.setAttribute("disabled","disabled"),j.classList.add("is-disabled")),g.appendChild(j),l.showFullscreen){const q=document.createElement("button");q.type="button",q.className="bbgf-icon-button bbgf-toolbar-fullscreen",q.dataset.role="bbgf-fullscreen-toggle",q.setAttribute("aria-label",n.fullscreen),q.textContent="‚õ∂",g.appendChild(q)}t.appendChild(g)}const B=c||t.querySelector("#bbgf-modal");if(B)t.appendChild(B);else{const g=document.createElement("div");g.id="bbgf-modal",g.setAttribute("hidden","hidden"),g.className="bbgf-modal",g.innerHTML=`
			<div class="bbgf-modal__backdrop" data-role="bbgf-modal-backdrop"></div>
			<div class="bbgf-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="bbgf-modal-title">
				<header class="bbgf-modal__header">
					<div class="bbgf-modal__heading">
						<h2 id="bbgf-modal-title" class="bbgf-modal__title">${n.modalTitle}</h2>
						<span class="bbgf-modal__badge" data-role="bbgf-modal-readonly" hidden>${n.modalReadOnly}</span>
					</div>
					<div class="bbgf-modal__header-actions">
						<div class="bbgf-modal__nav" data-role="bbgf-modal-nav"></div>
						<button type="button" class="bbgf-modal__close" data-role="bbgf-modal-close" aria-label="${n.modalClose}">&times;</button>
					</div>
				</header>
				<nav class="bbgf-modal__tabs" data-role="bbgf-modal-tabs"></nav>
				<div class="bbgf-modal__body" data-role="bbgf-modal-body">
					<p class="bbgf-modal__loading">${n.modalLoading}</p>
				</div>
			</div>
		`.trim(),t.appendChild(g)}const h=$||t.querySelector("#bbgf-intake-modal");if(h)t.appendChild(h);else{const g=document.createElement("div");g.id="bbgf-intake-modal",g.setAttribute("hidden","hidden"),g.className="bbgf-modal bbgf-intake-modal",g.innerHTML=`
			<div class="bbgf-modal__backdrop" data-role="bbgf-intake-close"></div>
			<div class="bbgf-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="bbgf-intake-title">
				<header class="bbgf-modal__header">
					<div class="bbgf-modal__heading">
						<h2 id="bbgf-intake-title" class="bbgf-modal__title">${r(y.intakeTitle)}</h2>
					</div>
					<div class="bbgf-intake-header-actions" data-role="bbgf-intake-header-actions">
						<div class="bbgf-intake-selected--header" data-role="bbgf-intake-selected-slot"></div>
						<button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-intake-submit">${r(y.intakeSubmit)}</button>
						<button type="button" class="bbgf-modal__close" data-role="bbgf-intake-close" aria-label="${r(y.modalClose)}">&times;</button>
					</div>
				</header>
				<div class="bbgf-modal__body bbgf-intake-body" data-role="bbgf-intake-body">
					<p class="bbgf-modal__loading">${r(y.loading)}</p>
				</div>
				<div class="bbgf-modal__actions bbgf-intake-actions" data-role="bbgf-intake-actions"></div>
			</div>
		`.trim(),t.appendChild(g)}const f=t.querySelector('[data-role="bbgf-last-updated"]');f&&(f.dataset.timestamp=u(d.last_updated??e.lastFetchedAt??""))},St=()=>{S.setState(t=>({...t,errors:m(t.errors).slice(0,-1)})),he&&(window.clearTimeout(he),he=null);const e=Z==null?void 0:Z.querySelector("#bbgf-board-errors");e&&e.classList.remove("is-active")},wt=(e,t,a)=>{const n=t.querySelector("#bbgf-board-errors"),s=m(e.errors).slice(-1)[0];if(!s){n&&n.remove(),he&&(window.clearTimeout(he),he=null);return}let i=n;i||(i=document.createElement("div"),i.id="bbgf-board-errors",i.className="bbgf-toast",i.innerHTML=`
			<p class="bbgf-toast__message"></p>
			<button type="button" class="bbgf-button bbgf-button--ghost bbgf-toast__dismiss" data-role="bbgf-toast-dismiss" aria-label="${r(a.modalClose)}">√ó</button>
		`,i.querySelector('[data-role="bbgf-toast-dismiss"]').addEventListener("click",St),t.appendChild(i));const o=i.querySelector(".bbgf-toast__message");o&&(o.textContent=s),i.classList.add("is-active"),he&&window.clearTimeout(he),he=window.setTimeout(()=>{i==null||i.classList.remove("is-active"),St()},6e3)},kt=e=>{const t=e.querySelector(".bbgf-refresh-button");t&&!t.dataset.bound&&(t.addEventListener("click",()=>{t.disabled||Le({reason:"manual",forceFull:!0})}),t.dataset.bound="true"),oe=e.querySelector('[data-role="bbgf-fullscreen-toggle"]')||oe,oe&&oe.dataset.bound!=="true"&&(oe.addEventListener("click",Bs),oe.dataset.bound="true",Ge())},_t=(e,t)=>{const a=e.querySelector(".bbgf-refresh-button");a&&(t.isLoading?(a.setAttribute("disabled","disabled"),a.classList.add("is-disabled")):(a.removeAttribute("disabled"),a.classList.remove("is-disabled"))),oe=e.querySelector('[data-role="bbgf-fullscreen-toggle"]')||oe,Ge()},$t=e=>{const t=Array.from(e.querySelectorAll('[data-role="bbgf-last-updated"]'));if(!t.length){e._bbgfLastUpdatedInterval&&(window.clearInterval(e._bbgfLastUpdatedInterval),e._bbgfLastUpdatedInterval=null);return}const a=()=>{t.forEach(s=>{const i=s.dataset.timestamp,o=ls(i);s.textContent=i?`${y.lastUpdated} ${o||rs(i)}`:y.lastUpdated});const n=e.querySelector('[data-role="bbgf-next-refresh"]');if(n){const s=fs(S.getState().nextRefreshAt);n.textContent=s?`${y.autoRefresh} ${s}`:`${y.autoRefresh} ‚Ä¶`}};e._bbgfLastUpdatedInterval&&window.clearInterval(e._bbgfLastUpdatedInterval),a(),e._bbgfLastUpdatedInterval=window.setInterval(a,15e3)},ks=e=>{e.querySelectorAll(".bbgf-card-timer").forEach(a=>{const n=Math.max(0,Number(a.dataset.baseSeconds??a.dataset.seconds??0));a.textContent=qe(n);const s=ue(a.dataset.yellow),i=ue(a.dataset.red),o=pt(n,{yellow:s,red:i});a.dataset.state=o;const d=a.closest(".bbgf-card");d&&(d.classList.remove("bbgf-card--timer-on-track","bbgf-card--timer-warning","bbgf-card--timer-critical"),d.classList.remove("bbgf-card--overdue","bbgf-card--capacity-warning"),d.classList.add(`bbgf-card--timer-${o}`),o==="critical"?d.classList.add("bbgf-card--overdue"):o==="warning"&&d.classList.add("bbgf-card--capacity-warning"))})},ce=e=>{var t,a;e&&((a=(t=window.wp)==null?void 0:t.a11y)!=null&&a.speak)&&window.wp.a11y.speak(e,"polite")},Ze=e=>{var n,s,i;const t=m(e==null?void 0:e.stages);if(!t.length)return"";const a=((n=t[0])==null?void 0:n.key)??((s=t[0])==null?void 0:s.stage_key)??((i=t[0])==null?void 0:i.id)??"";return u(a).toLowerCase()},Te=e=>{var t;return{isOpen:!1,isSaving:!1,error:"",activeTab:"search",searchQuery:"",searchResults:[],selected:null,guardian:{id:null,first_name:"",last_name:"",email:"",phone:"",preferred_contact:"",notes:""},client:{id:null,name:"",breed:"",weight:"",temperament:"",notes:"",guardian_id:null},visit:{view_id:((t=e==null?void 0:e.view)==null?void 0:t.id)??null,current_stage:Ze(e),instructions:"",public_notes:""}}},_s={board:Ee(b.initialBoard||null),isLoading:!1,errors:[],lastFetchedAt:null,viewOverride:"",pendingMoves:[],filters:{query:"",services:[],flags:[]},nextRefreshAt:null,drag:{isDragging:!1,visitId:null,fromStage:""},layout:{mode:"horizontal",expandedStage:""},modal:{isOpen:!1,visitId:null,loading:!1,visit:null,readOnly:!1,activeTab:"summary",isSaving:!1,clientFlags:[],form:{instructions:"",publicNotes:"",privateNotes:"",services:[]},error:"",pendingUploads:[],isPreparingUploads:!1,history:{items:[],page:1,perPage:5,hasMore:!1,loaded:!1,loading:!1,error:""}},intake:Te(b.initialBoard||null),catalog:{services:{items:[],isLoading:!1,loaded:!1,error:""},flags:{items:[],isLoading:!1,loaded:!1,error:""}}},S=vs(_s),Q=ys(b.rest||{},b.context||{}),I=e=>{S.setState(t=>{const a=typeof e=="function"?e(t.modal,t):{...t.modal,...e};return{...t,modal:a}})},$s=async e=>{const t=++Ie,a=Array.isArray(e)?e:[];if(I(n=>({...n,isPreparingUploads:!0,error:"",pendingUploads:[]})),!a.length){I(n=>({...n,isPreparingUploads:!1,pendingUploads:[]}));return}try{const n=[];for(const s of a)n.push(await bs(s));if(t!==Ie)return;I(s=>({...s,pendingUploads:n,isPreparingUploads:!1}))}catch(n){if(t!==Ie)return;I(s=>({...s,pendingUploads:[],isPreparingUploads:!1,error:(n==null?void 0:n.message)||y.loadingError}))}},X=e=>{S.setState(t=>{const a=typeof e=="function"?e(t.intake,t):{...t.intake,...e};return{...t,intake:a}})},Nt=e=>{S.setState(t=>{const a=typeof e=="function"?e(t.layout,t):{...t.layout,...e};return{...t,layout:a}})},et=e=>{S.setState(t=>{const a=typeof e=="function"?e(t.drag,t):{...t.drag,...e};return{...t,drag:a}})},Ct=e=>{S.setState(t=>({...t,nextRefreshAt:e}))},Et=async()=>{var t;if(!((t=b.capabilities)!=null&&t.manageServices))return;const e=S.getState();if(!(e.catalog.services.loaded||e.catalog.services.isLoading)){S.setState(a=>({catalog:{...a.catalog,services:{...a.catalog.services,isLoading:!0,error:""}}}));try{const a=await Q.fetchServices();S.setState(n=>({catalog:{...n.catalog,services:{items:a,isLoading:!1,loaded:!0,error:""}}}))}catch(a){S.setState(n=>({catalog:{...n.catalog,services:{items:m(n.catalog.services.items),isLoading:!1,loaded:!1,error:(a==null?void 0:a.message)||y.loadingError}}}))}}},Lt=async()=>{const e=S.getState();if(!(e.catalog.flags.loaded||e.catalog.flags.isLoading)){S.setState(t=>({catalog:{...t.catalog,flags:{...t.catalog.flags,isLoading:!0,error:""}}}));try{const t=await Q.fetchFlags();S.setState(a=>({catalog:{...a.catalog,flags:{items:t,isLoading:!1,loaded:!0,error:""}}}))}catch(t){S.setState(a=>({catalog:{...a.catalog,flags:{items:m(a.catalog.flags.items),isLoading:!1,loaded:!1,error:(t==null?void 0:t.message)||y.loadingError}}}))}}},xt=async({page:e=1,append:t=!1}={})=>{var o,d;const a=S.getState(),{modal:n}=a,s=n.visit;if(!((o=s==null?void 0:s.client)!=null&&o.id))return;const i=((d=n.history)==null?void 0:d.perPage)||5;I(l=>({...l,history:{...l.history,loading:!0,error:"",items:t?l.history.items:[]}}));try{const l=await Q.fetchClientHistory(s.client.id,{page:e,per_page:i,exclude_visit:s.id});I(c=>({...c,history:{...c.history,items:t?[...m(c.history.items),...m(l.items)]:m(l.items),page:l.page??e,perPage:i,hasMore:!!l.has_more,loaded:!0,loading:!1,error:""}}))}catch(l){I(c=>({...c,history:{...c.history,loading:!1,error:(l==null?void 0:l.message)||y.loadingError}}))}},Ns=()=>{const e=S.getState();e.modal.history.loaded||e.modal.history.loading||xt({page:1,append:!1})},Cs=(e,t)=>{I(a=>({...a,form:{...a.form,[e]:t}}))},Es=(e,t)=>{I(a=>{const n=new Set(m(a.form.services).map(s=>Number(s)));return t?n.add(e):n.delete(e),{...a,form:{...a.form,services:Array.from(n.values())}}})},Ls=(e,t)=>{I(a=>{const n=new Set(m(a.clientFlags).map(s=>Number(s)));return t?n.add(e):n.delete(e),{...a,clientFlags:Array.from(n.values())}})},xs=async()=>{var n,s;const e=S.getState(),{modal:t,board:a}=e;if(!(!((s=(n=t.visit)==null?void 0:n.client)!=null&&s.id)||t.readOnly||a!=null&&a.readonly)){I(i=>({...i,isSaving:!0,error:""}));try{await Q.updateClient(t.visit.client.id,{flags:t.clientFlags});const i=await Q.fetchVisit(t.visitId,{view:De(S.getState())});S.setState(o=>{var d;return{modal:{...o.modal,visit:i,clientFlags:m((d=i==null?void 0:i.client)==null?void 0:d.flags).map(l=>Number((l==null?void 0:l.id)??l)).filter(l=>Number.isFinite(l)),error:""}}}),we()}catch(i){I(o=>({...o,error:(i==null?void 0:i.message)||y.loadingError}))}finally{I(i=>({...i,isSaving:!1}))}}},Ts=e=>{I(t=>({...t,activeTab:e,error:""})),e==="services"&&Et(),e==="visit"&&Lt(),e==="history"&&Ns()},Is=async e=>{var o,d,l;const t=S.getState(),{modal:a,board:n}=t;if(!a.visit||a.isSaving||a.readOnly||n!=null&&n.readonly||!((o=b.capabilities)!=null&&o.moveStages))return;const s=Ye(n,a.visit.current_stage),i=e==="prev"?(d=s.prev)==null?void 0:d.key:(l=s.next)==null?void 0:l.key;if(!(!i||i===a.visit.current_stage)){I({isSaving:!0,error:""});try{await Ae(a.visitId,i),await Me(a.visitId,{tab:a.activeTab||"summary"})}catch(c){const $=(c==null?void 0:c.message)||y.errorFetching||y.loadingError;I({error:$}),ce($)}finally{I({isSaving:!1})}}},As=async()=>{const e=S.getState(),{modal:t,board:a}=e;if(!(!t.visitId||t.isSaving||t.readOnly||a!=null&&a.readonly||!window.confirm(y.modalCheckoutConfirm||y.modalCheckout))){I({isSaving:!0,error:""});try{await Q.checkoutVisit(t.visitId,{}),Pe(),we()}catch(s){const i=(s==null?void 0:s.message)||y.loadingError;I({error:i,isSaving:!1}),ce(i);return}I(s=>({...s,isSaving:!1}))}},we=()=>{Le({reason:"modal-save",forceFull:!0})},Ps=async e=>{const t=e.closest('[data-role="bbgf-photo-upload"]'),a=t==null?void 0:t.querySelector('[data-role="bbgf-photo-file"]'),n=t==null?void 0:t.querySelector('[data-role="bbgf-photo-visible"]'),{modal:s}=S.getState(),i=m(s.pendingUploads),o=n?!!n.checked:!0;if(s.isPreparingUploads){I(d=>({...d,error:y.modalPreparingUpload||y.loadingError}));return}if(!(!i.length||!s.visitId)){I({isSaving:!0,error:""});try{for(const d of i)await Q.addPhoto(s.visitId,d,o);a&&(a.value=""),I(d=>({...d,pendingUploads:[],isPreparingUploads:!1})),await Me(s.visitId,{tab:s.activeTab||"photos"}),we()}catch(d){const l=(d==null?void 0:d.message)||y.loadingError;I({error:l}),ce(l)}finally{I({isSaving:!1})}}},Ms=async(e,t)=>{const{modal:a}=S.getState();if(a.visitId)try{I({isSaving:!0,error:""}),await Q.updatePhoto(a.visitId,e,{visible_to_guardian:t}),await Me(a.visitId,{tab:a.activeTab||"photos"}),we()}catch(n){const s=(n==null?void 0:n.message)||y.loadingError;I({error:s}),ce(s)}finally{I({isSaving:!1})}},Fs=async e=>{const{modal:t}=S.getState();if(t.visitId)try{I({isSaving:!0,error:""}),await Q.updatePhoto(t.visitId,e,{is_primary:!0}),await Me(t.visitId,{tab:t.activeTab||"photos"}),we()}catch(a){const n=(a==null?void 0:a.message)||y.loadingError;I({error:n}),ce(n)}finally{I({isSaving:!1})}},Vs=e=>{if(!e)return;const t=document.querySelector(".bbgf-lightbox");t&&t.remove();const a=document.createElement("div");a.className="bbgf-lightbox",a.innerHTML=`
		<div class="bbgf-lightbox__backdrop" data-role="bbgf-lightbox-close"></div>
		<div class="bbgf-lightbox__body">
			<button type="button" class="bbgf-button bbgf-lightbox__close" data-role="bbgf-lightbox-close">${r(y.modalClose)}</button>
			<img src="${r(e)}" alt="">
		</div>
	`,a.addEventListener("click",n=>{n.target.dataset.role==="bbgf-lightbox-close"&&a.remove()}),document.body.appendChild(a)},Us=async()=>{const e=S.getState(),{modal:t}=e;if(!(t.readOnly||t.isSaving)){I({isSaving:!0,error:""});try{const a={instructions:t.form.instructions,public_notes:t.form.publicNotes,private_notes:t.form.privateNotes},n=await Q.updateVisit(t.visitId,a);I(s=>({...s,isSaving:!1,visit:n,form:Xe(n),error:""})),ce(y.modalSave),we()}catch(a){I(n=>({...n,isSaving:!1,error:(a==null?void 0:a.message)||y.loadingError}))}}},Os=async()=>{const e=S.getState(),{modal:t}=e;if(!(t.readOnly||t.isSaving)){I({isSaving:!0,error:""});try{const a={services:m(t.form.services).map(s=>Number(s)).filter(s=>Number.isFinite(s))},n=await Q.updateVisit(t.visitId,a);I(s=>({...s,isSaving:!1,visit:n,form:{...s.form,services:m(n.services).map(i=>Number(i==null?void 0:i.id)).filter(i=>Number.isFinite(i))},error:""})),ce(y.modalSave),we()}catch(a){I(n=>({...n,isSaving:!1,error:(a==null?void 0:a.message)||y.loadingError}))}}},js=e=>{switch(e){case"notes":Us();break;case"services":Os();break}},qs=()=>30*1e3;let Re=null,tt=null,Z=null,at="",he=null,oe=null,He={mode:"interactive"},be=null,re=null,st=null,nt=null,it=null,Ie=0,$e=null,ot=null,rt=null;const Ge=()=>{if(!oe)return;const e=!!document.fullscreenElement;oe.textContent=e?"‚§¢":"‚õ∂",oe.setAttribute("title",e?y.exitFullscreen:y.fullscreen),oe.setAttribute("aria-pressed",e?"true":"false")},Bs=()=>{var t,a;const e=Z;e&&(document.fullscreenElement?(a=document.exitFullscreen)==null||a.call(document):(t=e.requestFullscreen)==null||t.call(e),Ge())},Tt=()=>{rt&&window.clearTimeout(rt),rt=window.setTimeout(()=>{Z&&Qe(Z)},120)},It=()=>{Re&&(window.clearTimeout(Re),Re=null)},Ds=()=>{It();const e=qs();Ct(Date.now()+e),Re=window.setTimeout(()=>{Le({reason:"poll"})},e)},Le=async({reason:e="manual",forceFull:t=!1,targetView:a}={})=>{var d;It(),Ct(null);const n=S.getState(),s=a||De(n),i={};s&&(i.view=s);const o=!t&&!!((d=n.board)!=null&&d.last_updated);o&&(i.modified_after=n.board.last_updated),S.setState({isLoading:!0});try{const l=await Q.fetchBoard(i);S.setState(c=>{const $=o&&c.board?is(c.board,l):l;return{board:Ee($),isLoading:!1,errors:[],lastFetchedAt:new Date().toISOString()}})}catch(l){const c=(l==null?void 0:l.message)||y.errorFetching||y.loadingError;S.setState($=>({isLoading:!1,errors:[...m($.errors),c]})),ce(y.errorFetching||y.loadingError)}Ds()},At=(e,t="add")=>{const a=Number(e);Number.isNaN(a)||S.setState(n=>{const s=new Set(m(n.pendingMoves).map(i=>Number(i)));return t==="remove"?s.delete(a):s.add(a),{pendingMoves:Array.from(s.values())}})},Ae=async(e,t)=>{var n,s,i;if(!t)return;const a=S.getState();if(!((n=a.board)!=null&&n.readonly||!((s=b.capabilities)!=null&&s.moveStages))&&!((i=a.pendingMoves)!=null&&i.includes(Number(e)))){At(e,"add");try{await Q.moveVisit(e,t),ce(y.moveSuccess),await Le({reason:"move",forceFull:!0})}catch(o){const d=(o==null?void 0:o.message)||y.errorFetching||y.loadingError;S.setState(l=>({errors:[...m(l.errors),d]})),ce(d)}finally{At(e,"remove")}}},Pt=(e,t)=>{const a=Number(e.dataset.visitId),n=u(e.dataset.stage);if(Number.isNaN(a)||!n)return;const s=S.getState().board,{prev:i,next:o}=Ye(s,n),d=t==="prev"?i==null?void 0:i.key:o==null?void 0:o.key;!d||d===n||Ae(a,d)},Mt=async e=>{var i,o;const t=e.closest(".bbgf-card");if(!t)return;const a=Number(t.dataset.visitId),n=u(e.dataset.targetStage);Number.isNaN(a)||!n||(i=S.getState().board)!=null&&i.readonly||!((o=b.capabilities)!=null&&o.moveStages)||(e.disabled=!0,e.classList.add("is-disabled"),await Ae(a,n),e.disabled=!1,e.classList.remove("is-disabled"))},Rs=e=>{var o,d;const t=e.target.closest('[data-role="bbgf-column-toggle"]');if(t){const l=u(t.dataset.stage),c=S.getState(),$=((o=c.layout)==null?void 0:o.mode)||"horizontal",_=m((d=c.board)==null?void 0:d.stages).map(w=>u((w==null?void 0:w.key)??(w==null?void 0:w.stage_key)??""));$==="vertical"&&l&&_.includes(l)&&Nt(w=>({...w,expandedStage:w.expandedStage===l?"":l}));return}if(He.mode==="display")return;if(e.target.closest('[data-role="bbgf-intake-open"]')){e.preventDefault(),Gs();return}const n=e.target.closest(".bbgf-move-next");if(n){e.preventDefault(),Mt(n);return}const s=e.target.closest(".bbgf-move-prev");if(s){e.preventDefault(),Mt(s);return}const i=e.target.closest(".bbgf-card");if(i){const l=Number(i.dataset.visitId);if(Number.isNaN(l))return;tt=i,Me(l,{tab:"summary"})}},Hs=()=>{const e=S.getState().board;X({...Te(e),isOpen:!1})},Gs=()=>{var t;if(!((t=b.capabilities)!=null&&t.editVisits))return;const e=S.getState().board;X({...Te(e),isOpen:!0,activeTab:"search"})},Ft=()=>{X(e=>({...e,isOpen:!1,isSaving:!1,error:""}))},zs=e=>{const t=S.getState().board,a=Te(t),n=e.guardian||{},s=e.client||{};X(i=>({...i,selected:e,guardian:{id:n.id??null,first_name:n.first_name??"",last_name:n.last_name??"",email:n.email??"",phone:n.phone_mobile??n.phone_alt??n.phone??"",preferred_contact:n.preferred_contact??"",notes:n.notes??""},client:{...i.client,id:s.id??null,name:s.name??"",breed:s.breed??"",weight:s.weight??"",temperament:s.temperament??"",notes:s.notes??"",guardian_id:s.guardian_id??n.id??null},visit:{...i.visit,view_id:i.visit.view_id??a.visit.view_id,current_stage:i.visit.current_stage||a.visit.current_stage},activeTab:"guardian"}))},Vt=(e,t,a)=>{!e||!t||X(n=>({...n,[e]:{...n[e]||{},[t]:a}}))},Ws=e=>{ot&&window.clearTimeout(ot);const t=u(e||"").trim();X(a=>({...a,searchQuery:e,searchResults:t.length<2?[]:a.searchResults})),!(t.length<2)&&(ot=window.setTimeout(async()=>{try{const a=await Q.searchIntake(e);X(n=>({...n,searchResults:a,error:""}))}catch(a){X(n=>({...n,error:(a==null?void 0:a.message)||y.loadingError}))}},200))},Ks=async()=>{var U,O,R,B,h;const e=S.getState(),t=e.board,a=e.intake,n=a.guardian||{},s=a.client||{},i=a.visit||{},o=u(n.first_name||""),d=u(n.last_name||""),l=u(s.name||""),c=u(Ze(t)),$=Number(i.view_id||((U=t==null?void 0:t.view)==null?void 0:U.id)||0)||null;if(!o||!d){X(f=>({...f,error:"Guardian first and last name are required."}));return}if(!l){X(f=>({...f,error:"Client name is required."}));return}if(!c){X(f=>({...f,error:y.stageLabel||"Stage is required."}));return}X(f=>({...f,isSaving:!0,error:""}));const _={id:n.id??((R=(O=a.selected)==null?void 0:O.guardian)==null?void 0:R.id)??null,first_name:o,last_name:d,email:u(n.email||""),phone:u(n.phone||n.phone_mobile||""),preferred_contact:u(n.preferred_contact||""),notes:u(n.notes||"")},w=u(s.weight||""),G={id:s.id??((h=(B=a.selected)==null?void 0:B.client)==null?void 0:h.id)??null,name:l,breed:u(s.breed||""),weight:w,temperament:u(s.temperament||""),notes:u(s.notes||""),guardian_id:s.guardian_id??_.id??null},F={current_stage:c,view_id:$,status:"in_progress",check_in_at:new Date().toISOString(),instructions:u(i.instructions||""),public_notes:u(i.public_notes||""),client:G,guardian:_};try{await Q.createVisit(F),ce(y.intakeSuccess),Hs(),we()}catch(f){X(p=>({...p,isSaving:!1,error:(f==null?void 0:f.message)||y.loadingError}));return}X(f=>({...Te(t),isOpen:!1}))},Pe=()=>{Ie+=1,S.setState(e=>({modal:{...e.modal,isOpen:!1,isSaving:!1,isPreparingUploads:!1,pendingUploads:[]}}))},Js=e=>{var s,i;const t=e.target.closest("[data-role]"),a=t==null?void 0:t.dataset.role;if(a==="bbgf-modal-close"){Pe();return}if(a==="bbgf-modal-tab"){const o=t.dataset.tab;o&&Ts(o);return}if(a==="bbgf-modal-save"){const o=t.dataset.section;o&&js(o);return}if(a==="bbgf-modal-move"){const o=t.dataset.direction;o&&Is(o);return}if(a==="bbgf-modal-checkout"){As();return}if(a==="bbgf-upload-photo"){Ps(t);return}if(a==="bbgf-photo-primary"){const o=Number(t.dataset.photoId);Number.isNaN(o)||Fs(o);return}if(a==="bbgf-client-flags-save"){xs();return}if(a==="bbgf-history-load-more"){const o=(((s=S.getState().modal.history)==null?void 0:s.page)||1)+1;xt({page:o,append:!0});return}if(a==="bbgf-history-toggle"){const o=t.closest(".bbgf-modal__dialog"),d=t.dataset.target,l=d?o==null?void 0:o.querySelector(`#${d}`):t.nextElementSibling,$=!(t.getAttribute("aria-expanded")==="true");t.setAttribute("aria-expanded",$?"true":"false"),l&&(l.hidden=!$);const _=t.closest(".bbgf-history-item");_&&_.classList.toggle("is-open",$);return}if(a==="bbgf-photo-cancel"){const o=e.target.closest('[data-role="bbgf-photo-upload"]'),d=o==null?void 0:o.querySelector('[data-role="bbgf-photo-file"]');d&&(d.value=""),Ie+=1,I(l=>({...l,pendingUploads:[],isPreparingUploads:!1}));return}if(e.target.closest('[data-role="bbgf-photo-visibility"]')||e.target.closest('[data-role="bbgf-photo-file"]'))return;const n=e.target.closest('[data-role="bbgf-photo-preview"]');if(n){const o=(i=n.dataset)==null?void 0:i.photoUrl;o&&Vs(o)}},Qs=e=>{var a;if(((a=e.target.dataset)==null?void 0:a.role)==="bbgf-modal-input"){const n=e.target.dataset.field;n&&Cs(n,e.target.value)}},Xs=e=>{const{dataset:t,checked:a}=e.target;if((t==null?void 0:t.role)==="bbgf-modal-service"){const n=Number(t.serviceId);Number.isNaN(n)||Es(n,a)}if((t==null?void 0:t.role)==="bbgf-client-flag"){const n=Number(t.flagId);Number.isNaN(n)||Ls(n,a)}if((t==null?void 0:t.role)==="bbgf-photo-visibility"){e.stopPropagation();const n=Number(t.photoId);Number.isNaN(n)||Ms(n,a)}if((t==null?void 0:t.role)==="bbgf-photo-file"){const n=e.target.files?Array.from(e.target.files):[];$s(n)}},Me=async(e,t={})=>{var i,o,d,l;if(!Number.isFinite(Number(e)))return;const a=S.getState(),n=((i=os(a.board,e))==null?void 0:i.visit)??null,s=t.tab||"summary";S.setState({modal:{isOpen:!0,visitId:e,loading:!0,visit:n,readOnly:((o=a.board)==null?void 0:o.readonly)||!((d=b.capabilities)!=null&&d.editVisits),activeTab:s,isSaving:!1,clientFlags:m((l=n==null?void 0:n.client)==null?void 0:l.flags).map(c=>Number((c==null?void 0:c.id)??c)).filter(c=>Number.isFinite(c)),form:Xe(n),error:"",pendingUploads:[],isPreparingUploads:!1,history:{items:[],page:1,perPage:5,hasMore:!1,loaded:!1,loading:!1,error:""}}}),Et(),Lt();try{const c=await Q.fetchVisit(e,{view:De(S.getState())});S.setState($=>{var _;return{modal:{...$.modal,loading:!1,visit:c,form:Xe(c),clientFlags:m((_=c==null?void 0:c.client)==null?void 0:_.flags).map(w=>Number((w==null?void 0:w.id)??w)).filter(w=>Number.isFinite(w)),history:{...$.modal.history,items:[],page:1,hasMore:!1,loaded:!1,loading:!1,error:""},error:""}}})}catch(c){S.setState($=>({errors:[...m($.errors),(c==null?void 0:c.message)||y.loadingError],modal:{...$.modal,loading:!1,error:(c==null?void 0:c.message)||y.loadingError}}))}},Ne=e=>{if(!Z)return;if(!e){Z.querySelectorAll(".bbgf-column--drag-hover").forEach(a=>{a.classList.remove("bbgf-column--drag-hover")}),at="";return}if(at===e)return;Z.querySelectorAll(".bbgf-column--drag-hover").forEach(a=>{a.classList.remove("bbgf-column--drag-hover")});const t=Z.querySelector(`.bbgf-column[data-stage="${e}"]`);t&&(t.classList.add("bbgf-column--drag-hover"),at=e)},Ys=e=>{var i,o;const t=e.target.closest(".bbgf-card");if(!t)return;if((i=S.getState().board)!=null&&i.readonly||!((o=b.capabilities)!=null&&o.moveStages)){e.preventDefault();return}const n=Number(t.dataset.visitId),s=u(t.dataset.stage);if(Number.isNaN(n)||!s){e.preventDefault();return}et({isDragging:!0,visitId:n,fromStage:s}),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(n))),t.classList.add("is-dragging"),t.setAttribute("aria-grabbed","true")},Zs=e=>{const t=e.target.closest(".bbgf-card");t&&(t.classList.remove("is-dragging"),t.setAttribute("aria-grabbed","false")),et({isDragging:!1,visitId:null,fromStage:""}),Ne(null)},en=e=>{var n,s,i;const t=S.getState();if(!((n=t.drag)!=null&&n.isDragging))return;const a=e.target.closest(".bbgf-column");if(a&&(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),!((s=t.board)!=null&&s.readonly)&&((i=b.capabilities)!=null&&i.moveStages))){e.preventDefault();const o=a.dataset.stage;o&&o!==t.drag.fromStage&&Ne(o)}},tn=e=>{const t=e.target.closest(".bbgf-column");t&&(t.contains(e.relatedTarget)||Ne(null))},an=e=>{var d,l;const t=S.getState();if(!((d=t.drag)!=null&&d.isDragging))return;const a=e.target.closest(".bbgf-column");if(!a)return;e.preventDefault();const n=a.dataset.stage,s=Number((l=e.dataTransfer)==null?void 0:l.getData("text/plain"))||t.drag.visitId,i=n,o=t.drag.fromStage;!i||i===o||(Ne(null),et({isDragging:!1,visitId:null,fromStage:""}),Number.isNaN(s)||Ae(s,i))},Ut=e=>{var n;const t=(n=e.changedTouches)==null?void 0:n[0];if(!t)return null;const a=document.elementFromPoint(t.clientX,t.clientY);return a?a.closest(".bbgf-column"):null},sn=e=>{var s;if(!((s=b.capabilities)!=null&&s.moveStages))return;const t=e.target.closest(".bbgf-card");if(!t)return;const a=Number(t.dataset.visitId),n=u(t.dataset.stage);Number.isNaN(a)||!n||($e={visitId:a,fromStage:n},Ne(null))},nn=e=>{if(!$e)return;e.preventDefault();const t=Ut(e);if(t){const a=u(t.dataset.stage);a&&a!==$e.fromStage&&Ne(a)}},on=e=>{if(!$e)return;const t=Ut(e),a=u((t==null?void 0:t.dataset.stage)??"");a&&a!==$e.fromStage&&Ae($e.visitId,a),Ne(null),$e=null},lt=e=>{const t=e.querySelector("#bbgf-modal");if(!t||t.dataset.bound==="true")return;const a=t.querySelector('[data-role="bbgf-modal-backdrop"]'),n=t.querySelector('[data-role="bbgf-modal-close"]');a&&a.addEventListener("click",Pe),n&&n.addEventListener("click",Pe),document.addEventListener("keydown",i=>{if(i.key==="Escape"){const{modal:o}=S.getState();o.isOpen&&(i.preventDefault(),Pe())}});const s=t.querySelector(".bbgf-modal__dialog");s&&(s.addEventListener("click",Js),s.addEventListener("input",Qs,!0),s.addEventListener("change",Xs)),t.dataset.bound="true"},Ot=(e,t,a)=>{var F,U,O,R,B,h,f,p,v,k,N,L,g,j,q,fe,ve,te,ke;const n=t.querySelector("#bbgf-modal");if(!n)return;const{modal:s}=e;if(!s.isOpen){n.setAttribute("hidden","hidden");const x=tt;x&&x.focus&&window.requestAnimationFrame(()=>x.focus()),tt=null;return}n.removeAttribute("hidden");const i=n.querySelector('[data-role="bbgf-modal-body"]'),o=n.querySelector('[data-role="bbgf-modal-tabs"]'),d=n.querySelector("#bbgf-modal-title"),l=n.querySelector('[data-role="bbgf-modal-close"]'),c=n.querySelector('[data-role="bbgf-modal-nav"]'),$=[{id:"summary",label:a.modalSummary},{id:"notes",label:a.modalNotes},{id:"services",label:a.modalServices},{id:"visit",label:a.modalVisit},{id:"history",label:a.modalHistory},{id:"photos",label:a.modalPhotos}];if(o&&(o.innerHTML=$.map(x=>{const K=s.activeTab===x.id;return`<button type="button" class="bbgf-modal__tab${K?" is-active":""}" data-role="bbgf-modal-tab" data-tab="${x.id}" aria-selected="${K?"true":"false"}">${r(x.label)}</button>`}).join("")),c)if(s.visit){const x=Ye(e.board,s.visit.current_stage);((U=m((F=e.board)==null?void 0:F.stages).find(P=>P.key===s.visit.current_stage))==null?void 0:U.label)??s.visit.current_stage;const K=((O=b.capabilities)==null?void 0:O.editVisits)&&!((R=e.board)!=null&&R.readonly)&&!s.readOnly,J=((B=b.capabilities)==null?void 0:B.moveStages)&&!((h=e.board)!=null&&h.readonly)&&!s.readOnly&&!s.visit.check_out_at,le=J&&x.prev?`<button type="button" class="bbgf-icon-button" data-role="bbgf-modal-move" data-direction="prev" aria-label="${r(a.movePrev)}" title="${r(a.movePrev)}">‚Üê</button>`:"",ye=J&&x.next?`<button type="button" class="bbgf-icon-button" data-role="bbgf-modal-move" data-direction="next" aria-label="${r(a.moveNext)}" title="${r(a.moveNext)}">‚Üí</button>`:"",A=K&&!s.visit.check_out_at?`<button type="button" class="bbgf-icon-button bbgf-icon-button--critical" data-role="bbgf-modal-checkout" aria-label="${r(a.modalCheckout)}" title="${r(a.modalCheckout)}" ${s.isSaving?"disabled":""}>‚úì</button>`:"",W=s.visit.check_out_at?xe(s.visit.check_out_at):"",T=s.visit.check_out_at?`<span class="bbgf-modal__nav-status">${r(a.modalCheckedOut||a.modalCheckoutAt)}${W?` ‚Ä¢ ${r(W)}`:""}</span>`:"";c.innerHTML=`
				<div class="bbgf-modal__nav-actions">
					${le}
					${ye}
					${A}
				</div>
				${T?`<div class="bbgf-modal__nav-info">${T}</div>`:""}
			`}else c.innerHTML="";let _=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`;if(s.loading)_=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`;else if(!s.visit)_=`<p class="bbgf-modal__loading">${a.loadingError}</p>`;else{const x=s.visit,K=((p=m((f=e.board)==null?void 0:f.stages).find(T=>T.key===x.current_stage))==null?void 0:p.label)??x.current_stage,J=r(((v=x.client)==null?void 0:v.name)??a.unknownClient),le=x.guardian||{},ye=!!((N=(k=e.board)==null?void 0:k.visibility)!=null&&N.mask_guardian),A=new Set(m(s.form.services).map(T=>Number(T))),W=e.catalog.services;if(s.activeTab==="summary"){const T=vt(x),P=T&&T.url?`<img src="${r(T.url)}" alt="${r(T.alt??J)}">`:`<span>${(u(((L=x.client)==null?void 0:L.name)??a.unknownClient).charAt(0)||"üêæ").toUpperCase()}</span>`,H=m(x.services).map(D=>{const de=u((D==null?void 0:D.icon)??""),Ce=u((D==null?void 0:D.name)??""),Oe=Ce?de&&de!==Ce?`${de} ${Ce}`:Ce:de;return Oe?`<span class="bbgf-modal-chip">${r(Oe)}</span>`:""}).filter(Boolean).join(""),C=[],V=new Set;m(x.flags).concat(m((g=x.client)==null?void 0:g.flags)).forEach(D=>{const de=Number((D==null?void 0:D.id)??D);!Number.isFinite(de)||V.has(de)||(V.add(de),C.push(D))});const M=C.map(D=>{const de=u((D==null?void 0:D.emoji)??""),Ce=u((D==null?void 0:D.name)??""),Oe=Ce?`${de?`${de} `:""}${Ce}`:de;return Oe?`<span class="bbgf-modal-chip bbgf-modal-chip--flag">${r(Oe)}</span>`:""}).filter(Boolean).join(""),E=[H,M].filter(Boolean).join(""),se=[u(le.first_name??""),u(le.last_name??"")].filter(Boolean).join(" ").trim(),Y=[u(le.phone??""),u(le.email??"")].filter(Boolean),z=[];ye?z.push(r(a.maskedGuardian)):(se&&z.push(r(se)),Y.length&&z.push(Y.map(D=>r(D)).join(" ‚Ä¢ ")));const ae=z.length>0?`<p class="bbgf-modal-summary__meta">${z.join(" ‚Ä¢ ")}</p>`:"",me=r(xe(x.check_in_at)||""),pe=r(xe(x.check_out_at)||""),ge=ue(x.timer_elapsed_seconds)??0,_e=ge>0?r(qe(ge)):"",Se=r(((j=x.client)==null?void 0:j.breed)??""),ne=r(x.instructions??"").replace(/\n/g,"<br>"),Fe=r(x.public_notes??"").replace(/\n/g,"<br>"),Ve=r(x.private_notes??"").replace(/\n/g,"<br>"),ct=[];ct.push({label:a.checkIn,value:me||"-"}),ct.push({label:a.modalCheckoutAt||"Check-out",value:pe||"-"});const Za=ct.map(D=>`<div class="bbgf-summary-item"><span class="bbgf-summary-item__label">${r(D.label)}</span><span class="bbgf-summary-item__value">${D.value}</span></div>`).join(""),Ue=[];ne&&Ue.push({heading:"Instructions",body:ne}),Fe&&Ue.push({heading:"Public notes",body:Fe}),!s.readOnly&&Ve&&Ue.push({heading:"Private notes",body:Ve});const bn=Ue.length?`<div class="bbgf-modal-summary__notes">${Ue.map(D=>`<article class="bbgf-modal-note"><h4>${r(D.heading)}</h4><p>${D.body}</p></article>`).join("")}</div>`:"";_=`
				<section class="bbgf-modal-summary">
					<header class="bbgf-modal-summary__header">
						<div class="bbgf-modal-summary__photo">${P}</div>
						<div class="bbgf-modal-summary__primary">
							<h3 class="bbgf-modal-summary__name">${J}</h3>
							${Se?`<p class="bbgf-modal-summary__breed">${Se}</p>`:""}
							<p class="bbgf-modal-summary__subtitle">
								<span class="bbgf-modal-summary__stage">${r(K||x.current_stage||"")}</span>
								${_e?`<span class="bbgf-modal-summary__elapsed">${_e}</span>`:""}
							</p>
							${ae}
						</div>
					</header>
					${E?`<div class="bbgf-modal-summary__tags">${E}</div>`:""}
					${Za?`<div class="bbgf-modal-summary__grid">${Za}</div>`:""}
					${bn}
				</section>
			`}else if(s.activeTab==="notes")_=`
				<form class="bbgf-modal-form" data-role="bbgf-modal-notes-form">
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-instructions">${r(a.notes)} (${r("Instructions")})</label>
						<textarea id="bbgf-modal-instructions" data-role="bbgf-modal-input" data-field="instructions" ${s.readOnly?"disabled":""}></textarea>
					</div>
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-public-notes">${r("Public notes")}</label>
						<textarea id="bbgf-modal-public-notes" data-role="bbgf-modal-input" data-field="publicNotes" ${s.readOnly?"disabled":""}></textarea>
					</div>
					<div class="bbgf-modal-field">
						<label for="bbgf-modal-private-notes">${r("Private notes")}</label>
						<textarea id="bbgf-modal-private-notes" data-role="bbgf-modal-input" data-field="privateNotes" ${s.readOnly?"disabled":""}></textarea>
					</div>
					${s.readOnly?"":`<div class="bbgf-modal__actions"><button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-modal-save" data-section="notes" ${s.isSaving?"disabled":""}>${r(s.isSaving?a.modalSaving:a.modalSave)}</button></div>`}
				</form>
			`;else if(s.activeTab==="services")if((q=b.capabilities)!=null&&q.manageServices)W.isLoading&&!W.loaded?_=`<p class="bbgf-modal__loading">${a.modalLoading}</p>`:W.error?_=`<p class="bbgf-modal__error">${r(W.error)}</p>`:_=`
					<div class="bbgf-modal-service-list">
						${m(W.items).map(P=>{const H=Number(P==null?void 0:P.id),C=A.has(H)?"checked":"";return`
							<label class="bbgf-modal-service">
								<input type="checkbox" data-role="bbgf-modal-service" data-service-id="${H}" ${C} ${s.readOnly?"disabled":""}>
								<span>${r((P==null?void 0:P.name)??"")}</span>
							</label>
						`}).join("")||`<p class="bbgf-modal__loading">${r(a.emptyColumn)}</p>`}
					</div>
					${s.readOnly?"":`<div class="bbgf-modal__actions"><button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-modal-save" data-section="services" ${s.isSaving?"disabled":""}>${r(s.isSaving?a.modalSaving:a.modalSave)}</button></div>`}
				`;else{const T=m(x.services).map(P=>`<li>${r(P.name)}</li>`).join("");_=`
					<div class="bbgf-modal-section">
						<p>${r("You do not have permission to modify services. Contact an administrator if you need changes.")}</p>
						<ul class="bbgf-modal-list">${T||`<li>${r(a.emptyColumn)}</li>`}</ul>
					</div>
				`}else if(s.activeTab==="visit"){const T=m(x.history).map(M=>{var ae,me,pe,ge;const E=xe(M.changed_at),ee=r(((ae=M.from_stage)==null?void 0:ae.label)??((me=M.from_stage)==null?void 0:me.key)??""),se=r(((pe=M.to_stage)==null?void 0:pe.label)??((ge=M.to_stage)==null?void 0:ge.key)??""),Y=r(M.comment??"").replace(/\n/g,"<br>"),z=M.elapsed_seconds?qe(M.elapsed_seconds):"";return`
						<li>
							<div class="bbgf-history-entry">
								<strong>${E}</strong>
								<p>${ee} ‚Üí ${se}</p>
								${z?`<p class="bbgf-history-duration">${r(z)}</p>`:""}
								${Y?`<p>${Y}</p>`:""}
							</div>
						</li>
					`}).join(""),P=m(e.catalog.flags.items),H=new Set(m(s.clientFlags).map(M=>Number(M)));let C="";e.catalog.flags.isLoading&&!P.length?C=`<p class="bbgf-modal__loading">${r(a.modalLoading)}</p>`:e.catalog.flags.error?C=`<p class="bbgf-modal__error">${r(e.catalog.flags.error)}</p>`:C=P.map(M=>{const E=Number(M==null?void 0:M.id);if(!Number.isFinite(E))return"";const ee=H.has(E)?"checked":"",se=u((M==null?void 0:M.name)??""),Y=u((M==null?void 0:M.emoji)??""),z=`${Y?`${Y} `:""}${se}`;return`<label class="bbgf-flag-option"><input type="checkbox" data-role="bbgf-client-flag" data-flag-id="${E}" ${ee} ${s.readOnly?"disabled":""}>${r(z)}</label>`}).filter(Boolean).join("")||`<p class="bbgf-modal__loading">${r(a.modalNoPrevious)}</p>`;const V=`
				<section class="bbgf-modal-section bbgf-client-flags">
					<div class="bbgf-modal-section__header">
						<h3>${r(y.flags)}</h3>
						<p class="bbgf-modal__hint">Persisted at the client level.</p>
					</div>
					<div class="bbgf-flag-grid">
						${C}
					</div>
					${s.readOnly?"":`<div class="bbgf-modal__actions"><button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-client-flags-save" ${s.isSaving?"disabled":""}>${r(s.isSaving?a.modalSaving:a.modalSave)}</button></div>`}
				</section>
			`;_=`
				<div class="bbgf-visit-tab">
					<section class="bbgf-modal-section">
						<ul class="bbgf-modal-history">
							${T||`<li>${r(a.modalNoHistory)}</li>`}
						</ul>
					</section>
					${V}
				</div>
			`}else if(s.activeTab==="history"){const T=s.history||{},P=m(T.items).map((E,ee)=>{const se=xe(E.check_in_at||E.created_at||E.check_out_at)||a.modalHistory,Y=r(E.stage_label||E.stage||""),z=r(E.instructions??"").replace(/\n/g,"<br>"),ae=r(E.public_notes??"").replace(/\n/g,"<br>"),me=r(E.private_notes??"").replace(/\n/g,"<br>"),pe=gs(E.services),ge=m(E.photos).slice(0,6).map(ne=>{var Ve;const Fe=u(((Ve=ne==null?void 0:ne.thumbnail)==null?void 0:Ve.url)||(ne==null?void 0:ne.url)||"");return Fe?`<img src="${r(Fe)}" alt="${r(ne.alt??J)}">`:""}).filter(Boolean).join(""),_e=`bbgf-history-${E.id||ee}`,Se=ee===0;return`
						<article class="bbgf-history-item${Se?" is-open":""}">
							<button type="button" class="bbgf-history-toggle" data-role="bbgf-history-toggle" data-target="${_e}" aria-expanded="${Se?"true":"false"}">
								<span class="bbgf-history-title">${r(se)}</span>
								${Y?`<span class="bbgf-history-stage">${Y}</span>`:""}
							</button>
							<div class="bbgf-history-panel"${Se?"":" hidden"} id="${_e}">
								${pe?`<p class="bbgf-history-services"><strong>${r(y.services)}:</strong> ${r(pe)}</p>`:""}
								${z?`<p class="bbgf-history-note"><strong>Instructions:</strong> ${z}</p>`:""}
								${ae?`<p class="bbgf-history-note"><strong>Public:</strong> ${ae}</p>`:""}
								${me?`<p class="bbgf-history-note"><strong>Private:</strong> ${me}</p>`:""}
								${ge?`<div class="bbgf-history-photos">${ge}</div>`:""}
							</div>
						</article>
					`}).join(""),H=T.hasMore&&!T.loading?'<div class="bbgf-history-actions"><button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-history-load-more">Load more</button></div>':"",C=T.loading?`<p class="bbgf-modal__loading">${r(a.modalLoading)}</p>`:"",V=!!P;_=`
				<div class="bbgf-history-accordion">
					${T.error?`<p class="bbgf-modal__error">${r(T.error)}</p>`:T.loading&&!V?`<p class="bbgf-modal__loading">${r(a.modalLoading)}</p>`:P||`<p class="bbgf-modal__loading">${r(a.modalNoPrevious)}</p>`}
				</div>
				${C&&V?C:""}
				${H}
			`}else if(s.activeTab==="photos"){const T=m(x.photos),P=m(s.pendingUploads),H=!!s.isPreparingUploads,C=P.length?`<ul class="bbgf-photo-upload__list">${P.map(E=>`<li>${r(E.name||"Untitled file")}</li>`).join("")}</ul>`:`<p class="bbgf-photo-upload__hint">${r(H?a.modalPreparingUpload:"Select images to preview filenames before uploading.")}</p>`;let V=T.map(E=>{var ge,_e,Se,ne;const ee=r(E.url??""),se=r(E.alt??J),Y=E.visible_to_guardian!==!1,z=Number(E.id),ae=E.is_primary===!0,me=(ge=b.capabilities)!=null&&ge.editVisits&&!((_e=e.board)!=null&&_e.readonly)&&!s.readOnly&&Number.isFinite(z)?`<label class="bbgf-photo-visibility"><input type="checkbox" data-role="bbgf-photo-visibility" data-photo-id="${z}" ${Y?"checked":""}>${r(a.modalVisibleToGuardian)}</label>`:"",pe=(Se=b.capabilities)!=null&&Se.editVisits&&!((ne=e.board)!=null&&ne.readonly)&&!s.readOnly&&Number.isFinite(z)?`<button type="button" class="bbgf-button bbgf-button--ghost bbgf-photo-primary" data-role="bbgf-photo-primary" data-photo-id="${z}" ${ae?"disabled":""}>${r(ae?"Main photo":"Set as main photo")}</button>`:"";return`<figure class="bbgf-modal-photo" data-role="bbgf-photo-preview" data-photo-id="${z}" data-photo-url="${ee}" aria-label="${r(a.modalViewPhoto)}">
						<div class="bbgf-modal-photo__thumb">
							<img src="${ee}" alt="${se}">
							${ae?'<span class="bbgf-photo-badge bbgf-photo-badge--primary">Main</span>':""}
							${Y?"":'<span class="bbgf-photo-badge">Hidden</span>'}
						</div>
						<figcaption>${se}${me||pe?`<div class="bbgf-photo-actions">${pe}${me}</div>`:""}</figcaption>
					</figure>`}).join("");if(!V){const E=ht(x);if(E&&E.url){const ee=r(E.alt??J);V=`<figure class="bbgf-modal-photo"><img src="${r(E.url)}" alt="${ee}"><figcaption>${ee}</figcaption></figure>`}}const M=`
				<div class="bbgf-modal__actions bbgf-modal__actions--photos">
					<span class="bbgf-modal__hint">Changes save automatically.</span>
					<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-modal-close">${r(a.modalClose)}</button>
				</div>
			`;_=`
				${(fe=b.capabilities)!=null&&fe.editVisits&&!((ve=e.board)!=null&&ve.readonly)&&!s.readOnly?`
				<div class="bbgf-photo-upload" data-role="bbgf-photo-upload">
					<label class="bbgf-photo-upload__file">
						<input type="file" accept="image/*" data-role="bbgf-photo-file" multiple>
						<span>${r(a.modalUploadPhoto)}</span>
					</label>
					<label class="bbgf-photo-upload__visibility">
						<input type="checkbox" data-role="bbgf-photo-visible" checked>
						<span>${r(a.modalVisibleToGuardian)}</span>
					</label>
					<div class="bbgf-photo-upload__pending">
						${C}
					</div>
					<div class="bbgf-photo-upload__actions">
						<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-photo-cancel" ${s.isSaving||H?"disabled":P.length?"":"disabled"}>Clear</button>
						<button type="button" class="bbgf-button bbgf-button--primary" data-role="bbgf-upload-photo" ${H||s.isSaving||!P.length?"disabled":""}>${r(H?a.modalPreparingUpload:P.length?`Upload ${P.length} file${P.length===1?"":"s"}`:a.modalUploadPhoto)}</button>
					</div>
				</div>`:""}
				<div class="bbgf-modal-photos">
					${V||`<p class="bbgf-modal__loading">${r(a.modalNoPhotos)}</p>`}
				</div>
				${M}
			`}s.error&&(_=`<div class="bbgf-modal__error">${r(s.error)}</div>${_}`)}if(i.innerHTML=_,s.activeTab==="notes"){const x=i.querySelector('[data-field="instructions"]'),K=i.querySelector('[data-field="publicNotes"]'),J=i.querySelector('[data-field="privateNotes"]');x&&(x.value=s.form.instructions??""),K&&(K.value=s.form.publicNotes??""),J&&(J.value=s.form.privateNotes??"")}if(s.activeTab==="services"&&i.querySelectorAll('[data-role="bbgf-modal-service"]').forEach(K=>{const J=Number(K.dataset.serviceId);K.checked=servicesSelection.has(J),s.isSaving&&K.setAttribute("disabled","disabled")}),d){const x=(ke=(te=s.visit)==null?void 0:te.client)!=null&&ke.name?`: ${s.visit.client.name}`:"";d.textContent=`${a.modalTitle}${x}`}s.readOnly?n.classList.add("bbgf-modal--readonly"):n.classList.remove("bbgf-modal--readonly");const w=n.querySelector('[data-role="bbgf-modal-readonly"]');w&&(s.readOnly?w.removeAttribute("hidden"):w.setAttribute("hidden","hidden"));const G=document.activeElement;l&&(!n.contains(G)||G===n)&&window.requestAnimationFrame(()=>l.focus())},jt=(e,t,a)=>{var K,J,le,ye,A,W,T,P,H;const n=t.querySelector("#bbgf-intake-modal");if(!n)return;const{intake:s,board:i}=e;if(!s.isOpen){n.setAttribute("hidden","hidden");return}n.removeAttribute("hidden");const o=n.querySelector('[data-role="bbgf-intake-body"]'),d=n.querySelector('[data-role="bbgf-intake-actions"]');if(!o||!d)return;const l=n.contains(document.activeElement)?document.activeElement:null,c=l?{role:(K=l.dataset)==null?void 0:K.role,section:(J=l.dataset)==null?void 0:J.section,field:(le=l.dataset)==null?void 0:le.field,selection:typeof l.selectionStart=="number"?{start:l.selectionStart,end:l.selectionEnd}:null}:null,$=m(i==null?void 0:i.stages),_=u(((ye=i==null?void 0:i.view)==null?void 0:ye.name)??((A=i==null?void 0:i.view)==null?void 0:A.slug)??""),w=Ze(i),G=((W=$.find(C=>u(C.key??C.stage_key??"")===w))==null?void 0:W.label)??w,U=m(s.searchResults).map((C,V)=>{const M=C.client||{},E=C.guardian||{},ee=u(M.name||""),se=E&&(E.first_name||E.last_name)?`${u(E.first_name)} ${u(E.last_name)}`.trim():"",Y=[E.phone_mobile||E.phone_alt||"",E.email||""].filter(Boolean),z=[M.breed||"",se].filter(Boolean).join(" ‚Ä¢ "),ae=Y.join(" ‚Ä¢ ");return`
				<article class="bbgf-intake-result">
					<div class="bbgf-intake-result__body">
						<p class="bbgf-intake-result__title">${r(ee||a.unknownClient)}</p>
						${z?`<p class="bbgf-intake-result__meta">${r(z)}</p>`:""}
						${ae?`<p class="bbgf-intake-result__contact">${r(ae)}</p>`:""}
					</div>
					<button type="button" class="bbgf-button bbgf-button--ghost" data-role="bbgf-intake-select" data-result-index="${V}">${r(a.intakeSelect)}</button>
				</article>
			`}).join(""),O=s.guardian||{},R=s.client||{},B=s.visit||{},f=u(s.searchQuery||"").trim().length>=2,p=[{id:"search",label:a.intakeSearchLabel},{id:"guardian",label:a.intakeGuardian},{id:"client",label:a.intakeClient},{id:"visit",label:a.intakeVisit}],v=p.some(C=>C.id===s.activeTab)?s.activeTab:"search",k=p.map(C=>{const V=C.id===v;return`<button type="button" class="bbgf-modal__tab${V?" is-active":""}" data-role="bbgf-intake-tab" data-tab="${C.id}" aria-selected="${V?"true":"false"}">${r(C.label)}</button>`}).join(""),N=s.selected?`<div class="bbgf-intake-selected">Using ${r(((T=s.selected.client)==null?void 0:T.name)??a.unknownClient)}${s.selected.guardian?` ‚Ä¢ ${r(((P=s.selected.guardian)==null?void 0:P.first_name)??"")} ${r(((H=s.selected.guardian)==null?void 0:H.last_name)??"")}`:""} <button type="button" class="bbgf-chip-clear" data-role="bbgf-intake-clear" aria-label="${r(a.clearFilters||"Clear")}">√ó</button></div>`:"",L=f?U||`<p class="bbgf-modal__loading">${r(a.intakeNoResults)}</p>`:`<p class="bbgf-modal__hint">${r("Start typing at least 2 characters to search.")}</p>`,g=`
		<section class="bbgf-intake-panel bbgf-intake-panel--search" role="tabpanel" aria-label="${r(a.intakeSearchLabel)}">
			<label class="bbgf-field-label">${r(a.intakeSearchLabel)}</label>
			<div class="bbgf-intake-search">
				<input type="search" data-role="bbgf-intake-search" value="${r(s.searchQuery)}" placeholder="${r(a.intakeSearchHint)}" aria-label="${r(a.intakeSearchLabel)}">
			</div>
			<div class="bbgf-intake-results">
				${L}
			</div>
		</section>
	`,j=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${r(a.intakeGuardian)}">
			<h3>${r(a.intakeGuardian)}</h3>
			<div class="bbgf-intake-field">
				<label>${r("First name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="guardian" data-field="first_name" value="${r(O.first_name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Last name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="guardian" data-field="last_name" value="${r(O.last_name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Email")}</label>
				<input type="email" data-role="bbgf-intake-field" data-section="guardian" data-field="email" value="${r(O.email??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Mobile")}</label>
				<input type="tel" data-role="bbgf-intake-field" data-section="guardian" data-field="phone" value="${r(O.phone??O.phone_mobile??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Preferred contact")}</label>
				<select data-role="bbgf-intake-field" data-section="guardian" data-field="preferred_contact">
					${["","email","phone_mobile","sms"].map(C=>{const V=u(C)===u(O.preferred_contact??"")?"selected":"",M=C?C.replace("_"," "):"None";return`<option value="${r(C)}" ${V}>${r(M)}</option>`}).join("")}
				</select>
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Notes")}</label>
				<textarea data-role="bbgf-intake-field" data-section="guardian" data-field="notes">${r(O.notes??"")}</textarea>
			</div>
		</section>
	`,q=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${r(a.intakeClient)}">
			<h3>${r(a.intakeClient)}</h3>
			<div class="bbgf-intake-field">
				<label>${r("Name")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="name" value="${r(R.name??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Breed")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="breed" value="${r(R.breed??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Weight")}</label>
				<input type="text" inputmode="decimal" data-role="bbgf-intake-field" data-section="client" data-field="weight" value="${r(R.weight??"")}" placeholder="lbs">
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Temperament")}</label>
				<input type="text" data-role="bbgf-intake-field" data-section="client" data-field="temperament" value="${r(R.temperament??"")}">
			</div>
			<div class="bbgf-intake-field">
				<label>${r(a.notes)}</label>
				<textarea data-role="bbgf-intake-field" data-section="client" data-field="notes">${r(R.notes??"")}</textarea>
			</div>
		</section>
	`,fe=`
		<section class="bbgf-intake-panel" role="tabpanel" aria-label="${r(a.intakeVisit)}">
			<h3>${r(a.intakeVisit)}</h3>
			${G?`<p class="bbgf-modal__hint">${r(`Starts in ${G}`)}</p>`:""}
			${_?`<p class="bbgf-intake-view-hint">${r(`Will appear on the ${_} board`)}</p>`:""}
			<div class="bbgf-intake-field">
				<label>${r("Instructions")}</label>
				<textarea data-role="bbgf-intake-field" data-section="visit" data-field="instructions">${r(B.instructions??"")}</textarea>
			</div>
			<div class="bbgf-intake-field">
				<label>${r("Public notes")}</label>
				<textarea data-role="bbgf-intake-field" data-section="visit" data-field="public_notes">${r(B.public_notes??"")}</textarea>
			</div>
		</section>
	`,ve={search:g,guardian:j,client:q,visit:fe};o.innerHTML=`
		<div class="bbgf-modal__tabs bbgf-intake-tabs" role="tablist">
			${k}
		</div>
		<div class="bbgf-intake-panel-wrap" id="bbgf-intake-panel-${r(v)}">
			${ve[v]??""}
		</div>
	`,d.innerHTML=`${s.error?`<div class="bbgf-modal__error">${r(s.error)}</div>`:""}`;const te=n.querySelector('[data-role="bbgf-intake-selected-slot"]');te&&(N?(te.innerHTML=N,te.removeAttribute("hidden")):(te.innerHTML="",te.setAttribute("hidden","hidden")));const ke=n.querySelector('[data-role="bbgf-intake-header-actions"]');if(ke){const C=ke.querySelector('[data-role="bbgf-intake-submit"]');C&&(C.textContent=s.isSaving?a.intakeSaving:a.intakeSubmit,C.disabled=!!s.isSaving)}(()=>{if(c!=null&&c.role){let C=`[data-role="${c.role}"]`;c.section&&(C+=`[data-section="${c.section}"]`),c.field&&(C+=`[data-field="${c.field}"]`);let V=o.querySelector(C);if(V||(V=o.querySelector(`[data-role="${c.role}"]`)),V&&typeof V.focus=="function"){if(V.focus({preventScroll:!0}),c.selection&&typeof V.setSelectionRange=="function"){const{start:M,end:E}=c.selection;V.setSelectionRange(M,E)}else if(typeof V.setSelectionRange=="function"&&typeof V.value=="string"){const M=V.value.length;V.setSelectionRange(M,M)}}return}if(s.activeTab==="search"){const C=o.querySelector('[data-role="bbgf-intake-search"]');if(C&&typeof C.focus=="function"&&(C.focus({preventScroll:!0}),typeof C.setSelectionRange=="function")){const V=C.value.length;C.setSelectionRange(V,V)}}})()},rn=e=>{var a;const t=(a=e.target.dataset)==null?void 0:a.role;if(t==="bbgf-intake-tab"){const n=u(e.target.dataset.tab),i=["search","guardian","client","visit"].includes(n)?n:"search";X(o=>({...o,activeTab:i}));return}if(t==="bbgf-intake-close"){Ft();return}if(t==="bbgf-intake-select"){const n=Number(e.target.dataset.resultIndex),s=S.getState().intake.searchResults||[],i=Number.isInteger(n)?s[n]:null;i&&zs(i);return}if(t==="bbgf-intake-clear"){X(n=>({...n,selected:null,client:{...n.client||{},id:null,guardian_id:null},guardian:{...n.guardian||{},id:null}}));return}t==="bbgf-intake-submit"&&Ks()},ln=e=>{var a;const t=(a=e.target.dataset)==null?void 0:a.role;if(t==="bbgf-intake-search"){Ws(e.target.value||"");return}if(t==="bbgf-intake-field"){const n=e.target.dataset.section,s=e.target.dataset.field;Vt(n,s,e.target.value)}},dn=e=>{var a;if(((a=e.target.dataset)==null?void 0:a.role)==="bbgf-intake-field"){const n=e.target.dataset.section,s=e.target.dataset.field;Vt(n,s,e.target.value)}},dt=e=>{const t=e.querySelector("#bbgf-intake-modal");!t||t.dataset.bound==="true"||(t.addEventListener("click",rn),t.addEventListener("input",ln,!0),t.addEventListener("change",dn),document.addEventListener("keydown",a=>{if(a.key==="Escape"){const{intake:n}=S.getState();n.isOpen&&(a.preventDefault(),Ft())}}),t.dataset.bound="true")},qt=(e,t)=>{var s;if(He.mode==="display")return;const a=e.querySelectorAll(".bbgf-card"),n=(s=t.board)==null?void 0:s.readonly;a.forEach(i=>{var o;n||!((o=b.capabilities)!=null&&o.moveStages)?(i.removeAttribute("draggable"),i.setAttribute("aria-grabbed","false")):(i.setAttribute("draggable","true"),i.hasAttribute("aria-grabbed")||i.setAttribute("aria-grabbed","false"))})},cn=e=>{const t=e.target.closest(".bbgf-card");if(t&&!e.target.closest(".bbgf-card-actions button")){if(e.key==="Enter"||e.key===" "){e.preventDefault(),t.click();return}if(e.key==="ArrowLeft"){e.preventDefault(),Pt(t,"prev");return}e.key==="ArrowRight"&&(e.preventDefault(),Pt(t,"next"))}};document.addEventListener("DOMContentLoaded",()=>{var a,n;const e=document.getElementById("bbgf-board-root");if(!e)return;Z=e,Z.style.overflow="visible",Z.style.overflowX="visible",Z.style.overflowY="visible",us(Z),document.addEventListener("fullscreenchange",Ge),Qe(e),(a=b.context)!=null&&a.view&&(e.dataset.activeView=b.context.view);const t=S.getState();yt(t,e,b,y),_t(e,t),kt(e),$t(e),Ot(t,e,y),lt(e),jt(t,e,y),dt(e),qt(e,t),be={board:t.board,isLoading:t.isLoading,pendingMoves:t.pendingMoves,filters:t.filters,viewOverride:t.viewOverride,nextRefreshAt:t.nextRefreshAt,lastFetchedAt:t.lastFetchedAt,layout:t.layout},re={isOpen:t.modal.isOpen,activeTab:t.modal.activeTab,loading:t.modal.loading,readOnly:t.modal.readOnly,isSaving:t.modal.isSaving,error:t.modal.error,visitId:((n=t.modal.visit)==null?void 0:n.id)||null,pendingUploads:t.modal.pendingUploads,isPreparingUploads:t.modal.isPreparingUploads},st=t.intake,nt=t.catalog,it=t.errors,S.subscribe(s=>{var c,$;const i=!be||s.board!==be.board||s.isLoading!==be.isLoading||s.pendingMoves!==be.pendingMoves||s.filters!==be.filters||s.viewOverride!==be.viewOverride||s.nextRefreshAt!==be.nextRefreshAt||s.lastFetchedAt!==be.lastFetchedAt||s.layout!==be.layout,o=s.errors!==it;i?(yt(s,e,b,y),_t(e,s),kt(e),$t(e),lt(e),qt(e,s),dt(e),be={board:s.board,isLoading:s.isLoading,pendingMoves:s.pendingMoves,filters:s.filters,viewOverride:s.viewOverride,nextRefreshAt:s.nextRefreshAt,lastFetchedAt:s.lastFetchedAt,layout:s.layout}):o&&wt(s,e,y),(!re||s.modal.isOpen!==re.isOpen||s.modal.activeTab!==re.activeTab||s.modal.loading!==re.loading||s.modal.readOnly!==re.readOnly||s.modal.isSaving!==re.isSaving||s.modal.error!==re.error||s.modal.pendingUploads!==re.pendingUploads||s.modal.isPreparingUploads!==re.isPreparingUploads||(((c=s.modal.visit)==null?void 0:c.id)||null)!==(re.visitId||null)||s.catalog!==nt)&&(Ot(s,e,y),lt(e),re={isOpen:s.modal.isOpen,activeTab:s.modal.activeTab,loading:s.modal.loading,readOnly:s.modal.readOnly,isSaving:s.modal.isSaving,error:s.modal.error,visitId:(($=s.modal.visit)==null?void 0:$.id)||null,pendingUploads:s.modal.pendingUploads,isPreparingUploads:s.modal.isPreparingUploads},nt=s.catalog),s.intake!==st&&(jt(s,e,y),dt(e),st=s.intake),it=s.errors}),window.bbgfBoardSettings=b,window.bbgfBoardStore=S,window.bbgfBoardApi=Q,window.bbgfBoardRefresh=()=>Le({reason:"manual",forceFull:!0}),e.addEventListener("click",Rs),e.addEventListener("keydown",cn),e.addEventListener("dragstart",Ys),e.addEventListener("dragend",Zs),e.addEventListener("dragover",en),e.addEventListener("dragleave",tn),e.addEventListener("drop",an),e.addEventListener("touchstart",sn,{passive:!0}),e.addEventListener("touchmove",nn,{passive:!1}),e.addEventListener("touchend",on,{passive:!0}),window.addEventListener("resize",Tt,{passive:!0}),window.addEventListener("orientationchange",Tt,{passive:!0}),Le({reason:"initial",forceFull:!b.initialBoard})})})();
//# sourceMappingURL=board.js.map
