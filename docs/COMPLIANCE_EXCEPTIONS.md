# Compliance Exceptions

This log documents intentional PHPCS suppressions that remain after custom capability registration. Each entry lists the file, sniff(s), reason, and the safer alternative considered.

| File | Sniff(s) | Reason | Safer alternative considered |
| --- | --- | --- | --- |
| `plugin/bb-groomflow/uninstall.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.DirectDatabaseQuery.SchemaChange`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | Uninstall cleanup must drop custom tables and delete prefixed options/meta across sites; raw SQL is required and cannot rely on WP APIs. | Use a schema helper with `%i` identifiers and prebuilt queries; declined because uninstall requires DDL and dynamic table list. |
| `plugin/bb-groomflow/includes/cli/class-visits-command.php` | `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | WP-CLI maintenance queries are built from schema map and sanitized inputs, but require dynamic SQL for bulk operations. | Move SQL into repositories with fixed placeholder counts or batch calls; deferred due to CLI scope. |
| `plugin/bb-groomflow/includes/notifications/class-notifications-service.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Arrays.MultipleStatementAlignment`, `WordPress.WhiteSpace.OperatorSpacing` | Notifications read/write custom tables directly for latency and use alignment for template readability. | Introduce repository methods and reformat arrays; postponed to keep notification payloads stable. |
| `plugin/bb-groomflow/includes/class-plugin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | Activation/upgrade checks and seed data require direct queries against custom tables and schema inspection. | Move install/seed logic into schema/repository helpers with `%i` guards; staged for later. |
| `plugin/bb-groomflow/includes/data/class-visit-service.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.DB.PreparedSQLPlaceholders.ReplacementsWrongNumber`, `WordPress.DB.SlowDBQuery.slow_db_query_meta_query` | Visit payload assembly relies on dynamic IN clauses and attachment meta queries scoped to visit IDs. | Expand repository coverage and replace meta queries with joins or cached tables; incremental refactor in progress. |
| `plugin/bb-groomflow/includes/data/class-visit-repository.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.DB.PreparedSQLPlaceholders.ReplacementsWrongNumber` | Board queries use dynamic clause assembly from sanitized filters; PHPCS cannot resolve placeholder counts. | Precompute fixed-size batches or use temp tables to avoid dynamic IN lists. |
| `plugin/bb-groomflow/includes/bootstrap/class-assets-service.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared` | Board settings require direct reads from custom tables during asset localization. | Route through repository + cache layer; deferred to avoid regressions in boot flow. |
| `plugin/bb-groomflow/includes/bootstrap/class-admin-menu-service.php` | `WordPress.Security.EscapeOutput.OutputNotEscaped` | Placeholder board markup is generated by a renderer that already escapes internal data. | Wrap output in `wp_kses_post` or return structured data; not applied to preserve existing markup. |
| `plugin/bb-groomflow/includes/api/class-clients-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching` | REST endpoints query custom tables directly for search and history. | Move reads into repositories with optional caching; staged. |
| `plugin/bb-groomflow/includes/api/class-flags-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | REST endpoints operate on custom tables with dynamic ORDER/LIMIT clauses. | Repository methods with whitelisted sort columns and prepared statements. |
| `plugin/bb-groomflow/includes/api/class-guardians-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | REST endpoints operate on custom tables with dynamic ORDER/LIMIT clauses. | Repository methods with whitelisted sort columns and prepared statements. |
| `plugin/bb-groomflow/includes/api/class-packages-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | REST endpoints operate on custom tables with dynamic ORDER/LIMIT clauses. | Repository methods with whitelisted sort columns and prepared statements. |
| `plugin/bb-groomflow/includes/api/class-services-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | REST endpoints operate on custom tables with dynamic ORDER/LIMIT clauses. | Repository methods with whitelisted sort columns and prepared statements. |
| `plugin/bb-groomflow/includes/api/class-stats-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | Reporting queries are aggregation-heavy and read from custom tables without WP APIs. | Introduce read-only reporting repository and optional caching. |
| `plugin/bb-groomflow/includes/api/class-views-controller.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | REST endpoints operate on custom tables with dynamic ORDER/LIMIT clauses. | Repository methods with whitelisted sort columns and prepared statements. |
| `plugin/bb-groomflow/includes/admin/class-clients-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and GET parameters for view state; nonces are applied only to state-changing actions. | Use repositories for DB access and add nonces to filter query args where feasible. |
| `plugin/bb-groomflow/includes/admin/class-flags-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and GET parameters for view state; nonces are applied only to state-changing actions. | Use repositories for DB access and add nonces to filter query args where feasible. |
| `plugin/bb-groomflow/includes/admin/class-guardians-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and GET parameters for view state; nonces are applied only to state-changing actions. | Use repositories for DB access and add nonces to filter query args where feasible. |
| `plugin/bb-groomflow/includes/admin/class-services-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and GET parameters for view state; nonces are applied only to state-changing actions. | Use repositories for DB access and add nonces to filter query args where feasible. |
| `plugin/bb-groomflow/includes/admin/class-packages-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and GET parameters for view state; nonces are applied only to state-changing actions. | Use repositories for DB access and add nonces to filter query args where feasible. |
| `plugin/bb-groomflow/includes/admin/class-stages-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and dynamic stage libraries; GET parameters drive edit flows. | Use repositories with `%i` table guards and add nonce to filter-only query args. |
| `plugin/bb-groomflow/includes/admin/class-views-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Admin CRUD uses custom tables and dynamic stage libraries; GET parameters drive edit flows. | Use repositories with `%i` table guards and add nonce to filter-only query args. |
| `plugin/bb-groomflow/includes/admin/class-notifications-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Notification templates are stored in custom tables and edited via admin forms. | Move CRUD into repositories and add nonce coverage for all view-state query args. |
| `plugin/bb-groomflow/includes/admin/class-notification-triggers-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | Trigger management uses dynamic joins and GET filters for admin list flow. | Repository methods with prepared queries and nonce-protected filter params. |
| `plugin/bb-groomflow/includes/admin/class-notification-logs-admin.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended`, `WordPress.WP.AlternativeFunctions.file_system_operations_fclose` | Log screens use direct queries and stream CSV exports to output; GET params are sanitized but not nonce-protected for view state. | Repository + cache layer for logs; use `WP_Filesystem` or `wp_tempnam` for export writes. |
| `plugin/bb-groomflow/includes/admin/class-settings-admin.php` | `WordPress.Security.NonceVerification.Recommended` | Admin messages are passed via sanitized query args after redirect. | Store flash messages in options/transients instead of URL. |
| `plugin/bb-groomflow/includes/admin/class-clients-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-flags-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-guardians-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-services-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-packages-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-views-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Security.NonceVerification.Recommended`, `Generic.CodeAnalysis.UnusedFunctionParameter.FoundInExtendedClassBeforeLastUsed` | List tables run direct queries against custom tables with sanitized order/search parameters and must retain method signatures for `WP_List_Table`. | Introduce repository list queries with whitelisted sort columns; keep signature but suppress unused parameter warning. |
| `plugin/bb-groomflow/includes/admin/class-notifications-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-notification-triggers-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared` | List tables run direct queries against custom tables with sanitized order/search parameters. | Introduce repository list queries with whitelisted sort columns and nonce-protected filters. |
| `plugin/bb-groomflow/includes/admin/class-notification-logs-list-table.php` | `WordPress.DB.DirectDatabaseQuery.DirectQuery`, `WordPress.DB.DirectDatabaseQuery.NoCaching`, `WordPress.DB.PreparedSQL.InterpolatedNotPrepared`, `WordPress.DB.PreparedSQL.NotPrepared`, `WordPress.Arrays.MultipleStatementAlignment.DoubleArrowNotAligned` | List tables run direct queries against custom tables with sanitized order/search parameters; alignment retained for readability. | Introduce repository list queries and reformat arrays; deferred to keep output stable. |
